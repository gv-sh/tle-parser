/**
 * tle-parser v1.0.0
 * A parser for TLE (Two-Line Element) satellite data.
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("fs"),require("util"),require("stream"),require("zlib")):"function"==typeof define&&define.amd?define(["exports","fs","util","stream","zlib"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TLEParser={},e.fs,e.util,e.stream,e.zlib)}(this,function(e,t,i,n,r){"use strict";var s;function a(t){return[e.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,e.ERROR_CODES.CLASSIFIED_DATA_WARNING,e.ERROR_CODES.STALE_TLE_WARNING,e.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,e.ERROR_CODES.LOW_MEAN_MOTION_WARNING,e.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,e.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,e.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,e.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,e.ERROR_CODES.NEGATIVE_DECAY_WARNING].includes(t)}e.ERROR_CODES=void 0,(s=e.ERROR_CODES||(e.ERROR_CODES={})).INVALID_INPUT_TYPE="INVALID_INPUT_TYPE",s.EMPTY_INPUT="EMPTY_INPUT",s.INVALID_LINE_COUNT="INVALID_LINE_COUNT",s.INVALID_LINE_LENGTH="INVALID_LINE_LENGTH",s.INVALID_LINE_NUMBER="INVALID_LINE_NUMBER",s.CHECKSUM_MISMATCH="CHECKSUM_MISMATCH",s.INVALID_CHECKSUM_CHARACTER="INVALID_CHECKSUM_CHARACTER",s.SATELLITE_NUMBER_MISMATCH="SATELLITE_NUMBER_MISMATCH",s.INVALID_SATELLITE_NUMBER="INVALID_SATELLITE_NUMBER",s.INVALID_CLASSIFICATION="INVALID_CLASSIFICATION",s.VALUE_OUT_OF_RANGE="VALUE_OUT_OF_RANGE",s.INVALID_NUMBER_FORMAT="INVALID_NUMBER_FORMAT",s.SATELLITE_NAME_TOO_LONG="SATELLITE_NAME_TOO_LONG",s.SATELLITE_NAME_FORMAT_WARNING="SATELLITE_NAME_FORMAT_WARNING",s.CLASSIFIED_DATA_WARNING="CLASSIFIED_DATA_WARNING",s.STALE_TLE_WARNING="STALE_TLE_WARNING",s.HIGH_ECCENTRICITY_WARNING="HIGH_ECCENTRICITY_WARNING",s.LOW_MEAN_MOTION_WARNING="LOW_MEAN_MOTION_WARNING",s.DEPRECATED_EPOCH_YEAR_WARNING="DEPRECATED_EPOCH_YEAR_WARNING",s.REVOLUTION_NUMBER_ROLLOVER_WARNING="REVOLUTION_NUMBER_ROLLOVER_WARNING",s.NEAR_ZERO_DRAG_WARNING="NEAR_ZERO_DRAG_WARNING",s.NON_STANDARD_EPHEMERIS_WARNING="NON_STANDARD_EPHEMERIS_WARNING",s.NEGATIVE_DECAY_WARNING="NEGATIVE_DECAY_WARNING",e.ERROR_CODES.INVALID_INPUT_TYPE,e.ERROR_CODES.EMPTY_INPUT,e.ERROR_CODES.INVALID_LINE_COUNT,e.ERROR_CODES.INVALID_LINE_LENGTH,e.ERROR_CODES.INVALID_LINE_NUMBER,e.ERROR_CODES.CHECKSUM_MISMATCH,e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER,e.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,e.ERROR_CODES.INVALID_SATELLITE_NUMBER,e.ERROR_CODES.INVALID_CLASSIFICATION,e.ERROR_CODES.VALUE_OUT_OF_RANGE,e.ERROR_CODES.INVALID_NUMBER_FORMAT,e.ERROR_CODES.SATELLITE_NAME_TOO_LONG,e.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,e.ERROR_CODES.CLASSIFIED_DATA_WARNING,e.ERROR_CODES.STALE_TLE_WARNING,e.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,e.ERROR_CODES.LOW_MEAN_MOTION_WARNING,e.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,e.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,e.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,e.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,e.ERROR_CODES.NEGATIVE_DECAY_WARNING;var o,c,l,u;function m(e){return"object"==typeof e&&null!==e&&"code"in e&&"message"in e&&"severity"in e}e.TLEErrorCode=void 0,(o=e.TLEErrorCode||(e.TLEErrorCode={})).INVALID_LINE_COUNT="INVALID_LINE_COUNT",o.INVALID_LINE_LENGTH="INVALID_LINE_LENGTH",o.INVALID_LINE_NUMBER="INVALID_LINE_NUMBER",o.SATELLITE_NUMBER_MISMATCH="SATELLITE_NUMBER_MISMATCH",o.CHECKSUM_MISMATCH="CHECKSUM_MISMATCH",o.INVALID_CHECKSUM_CHARACTER="INVALID_CHECKSUM_CHARACTER",o.INVALID_CLASSIFICATION="INVALID_CLASSIFICATION",o.INVALID_SATELLITE_NUMBER="INVALID_SATELLITE_NUMBER",o.INVALID_INTL_DESIGNATOR_YEAR="INVALID_INTL_DESIGNATOR_YEAR",o.INVALID_INTL_DESIGNATOR_LAUNCH="INVALID_INTL_DESIGNATOR_LAUNCH",o.INVALID_EPOCH_YEAR="INVALID_EPOCH_YEAR",o.INVALID_EPOCH_DAY="INVALID_EPOCH_DAY",o.INVALID_EPHEMERIS_TYPE="INVALID_EPHEMERIS_TYPE",o.INVALID_ELEMENT_SET_NUMBER="INVALID_ELEMENT_SET_NUMBER",o.INVALID_INCLINATION="INVALID_INCLINATION",o.INVALID_RIGHT_ASCENSION="INVALID_RIGHT_ASCENSION",o.INVALID_ECCENTRICITY="INVALID_ECCENTRICITY",o.INVALID_ARG_OF_PERIGEE="INVALID_ARG_OF_PERIGEE",o.INVALID_MEAN_ANOMALY="INVALID_MEAN_ANOMALY",o.INVALID_MEAN_MOTION="INVALID_MEAN_MOTION",o.INVALID_REVOLUTION_NUMBER="INVALID_REVOLUTION_NUMBER",o.UNUSUAL_CLASSIFICATION="UNUSUAL_CLASSIFICATION",o.OLD_EPOCH="OLD_EPOCH",o.EXTREME_ECCENTRICITY="EXTREME_ECCENTRICITY",o.EXTREME_INCLINATION="EXTREME_INCLINATION",o.HIGH_MEAN_MOTION="HIGH_MEAN_MOTION",o.LOW_MEAN_MOTION="LOW_MEAN_MOTION",o.PARSE_ERROR="PARSE_ERROR",o.VALIDATION_ERROR="VALIDATION_ERROR",function(e){e.INITIAL="INITIAL",e.READING_NAME="READING_NAME",e.READING_LINE1="READING_LINE1",e.READING_LINE2="READING_LINE2",e.COMPLETE="COMPLETE",e.ERROR="ERROR",e.RECOVERING="RECOVERING"}(c||(c={})),function(e){e.CONTINUE="CONTINUE",e.SKIP_FIELD="SKIP_FIELD",e.USE_DEFAULT="USE_DEFAULT",e.ATTEMPT_FIX="ATTEMPT_FIX",e.ABORT="ABORT"}(l||(l={})),e.ParserState=void 0,function(e){e.INITIAL="INITIAL",e.DETECTING_FORMAT="DETECTING_FORMAT",e.PARSING_NAME="PARSING_NAME",e.PARSING_LINE1="PARSING_LINE1",e.PARSING_LINE2="PARSING_LINE2",e.VALIDATING="VALIDATING",e.COMPLETED="COMPLETED",e.ERROR="ERROR"}(e.ParserState||(e.ParserState={})),e.ErrorSeverity=void 0,(u=e.ErrorSeverity||(e.ErrorSeverity={})).WARNING="warning",u.ERROR="error",u.CRITICAL="critical",e.RecoveryAction=void 0,function(e){e.CONTINUE="CONTINUE",e.SKIP_FIELD="SKIP_FIELD",e.USE_DEFAULT="USE_DEFAULT",e.ATTEMPT_FIX="ATTEMPT_FIX",e.ABORT="ABORT"}(e.RecoveryAction||(e.RecoveryAction={}));class h{constructor(t={}){this.options=Object.assign({attemptRecovery:!0,maxRecoveryAttempts:10,includePartialResults:!0,strictMode:!1},t),this.state=e.ParserState.INITIAL,this.errors=[],this.warnings=[],this.recoveryActions=[],this.parsedData={},this.context={lineCount:0,hasName:!1,nameLineIndex:-1,line1Index:-1,line2Index:-1,lines:[],recoveryAttempts:0},this.reset()}reset(){this.state=e.ParserState.INITIAL,this.errors=[],this.warnings=[],this.recoveryActions=[],this.parsedData={},this.context={lineCount:0,hasName:!1,nameLineIndex:-1,line1Index:-1,line2Index:-1,lines:[],recoveryAttempts:0}}addIssue(t,i,n,r={}){const s=Object.assign({severity:t,code:i,message:n,state:this.state},r);return t===e.ErrorSeverity.WARNING?this.warnings.push(s):this.errors.push(s),s}recordRecovery(e,t,i={}){this.recoveryActions.push(Object.assign({action:e,description:t,state:this.state,timestamp:Date.now()},i)),this.context.recoveryAttempts++}transition(e,t=""){const i=this.state;return this.state=e,{from:i,to:e,reason:t}}parse(t){return this.reset(),"string"!=typeof t?(this.addIssue(e.ErrorSeverity.CRITICAL,e.ERROR_CODES.INVALID_INPUT_TYPE,"TLE data must be a string",{inputType:typeof t}),this.transition(e.ParserState.ERROR),this.getResult()):0===t.length?(this.addIssue(e.ErrorSeverity.CRITICAL,e.ERROR_CODES.EMPTY_INPUT,"TLE string cannot be empty",{inputLength:0}),this.transition(e.ParserState.ERROR),this.getResult()):(this.transition(e.ParserState.DETECTING_FORMAT,"Starting parse"),this.detectFormat(t),this.state===e.ParserState.DETECTING_FORMAT&&this.executeStateMachine(),this.getResult())}detectFormat(t){var i;const n=t.trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(this.context.lines=n,this.context.lineCount=n.length,n.length<2)return this.addIssue(e.ErrorSeverity.CRITICAL,e.ERROR_CODES.INVALID_LINE_COUNT,`TLE must contain at least 2 lines (found ${n.length})`,{expected:"2 or 3",actual:n.length}),this.options.attemptRecovery&&this.recordRecovery(e.RecoveryAction.ABORT,"Insufficient lines to parse TLE",{lineCount:n.length}),void this.transition(e.ParserState.ERROR);if(n.length>3){if(this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_LINE_COUNT,`TLE should contain 2 or 3 lines (found ${n.length})`,{expected:"2 or 3",actual:n.length}),this.options.attemptRecovery){this.recordRecovery(e.RecoveryAction.ATTEMPT_FIX,"Attempting to identify valid TLE lines from excess lines",{lineCount:n.length});const t=n.filter(e=>"1"===e[0]),i=n.filter(e=>"2"===e[0]);if(1===t.length&&1===i.length){const r=t[0],s=i[0];if(!r||!s)return;const a=n.indexOf(r),o=n.indexOf(s);if(a<o){a>0&&(this.context.hasName=!0,this.context.nameLineIndex=a-1),this.context.line1Index=a,this.context.line2Index=o;const t=n[this.context.nameLineIndex],i=n[a],r=n[o];this.context.lines=this.context.hasName&&t&&i&&r?[t,i,r]:i&&r?[i,r]:[],this.context.lineCount=this.context.lines.length,this.recordRecovery(e.RecoveryAction.CONTINUE,"Successfully identified TLE lines from excess input",{extractedLines:this.context.lineCount})}}}}else if(3===n.length){const t=null===(i=n[0])||void 0===i?void 0:i[0];"1"!==t&&"2"!==t||this.addIssue(e.ErrorSeverity.WARNING,e.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,'First line starts with "1" or "2", might be missing satellite name',{firstLine:n[0]}),this.context.hasName=!0,this.context.nameLineIndex=0,this.context.line1Index=1,this.context.line2Index=2}else this.context.hasName=!1,this.context.line1Index=0,this.context.line2Index=1}executeStateMachine(){let t=0;for(;this.state!==e.ParserState.COMPLETED&&this.state!==e.ParserState.ERROR&&t<100;){switch(this.state){case e.ParserState.DETECTING_FORMAT:this.context.hasName?this.transition(e.ParserState.PARSING_NAME):this.transition(e.ParserState.PARSING_LINE1);break;case e.ParserState.PARSING_NAME:this.parseSatelliteName(),this.transition(e.ParserState.PARSING_LINE1);break;case e.ParserState.PARSING_LINE1:this.parseLine1(),this.transition(e.ParserState.PARSING_LINE2);break;case e.ParserState.PARSING_LINE2:this.parseLine2(),this.transition(e.ParserState.VALIDATING);break;case e.ParserState.VALIDATING:this.validateCrossFields(),this.errors.some(t=>t.severity===e.ErrorSeverity.CRITICAL)&&!this.options.includePartialResults?this.transition(e.ParserState.ERROR):this.transition(e.ParserState.COMPLETED);break;default:this.transition(e.ParserState.ERROR,"Unexpected state")}t++}t>=100&&(this.addIssue(e.ErrorSeverity.CRITICAL,"STATE_MACHINE_LOOP","State machine exceeded maximum iterations",{iterations:t}),this.transition(e.ParserState.ERROR))}parseSatelliteName(){const t=this.context.nameLineIndex;if(t<0||t>=this.context.lines.length)return void this.addIssue(e.ErrorSeverity.ERROR,"INVALID_NAME_LINE_INDEX","Invalid satellite name line index",{index:t});const i=this.context.lines[t];i&&(this.parsedData.satelliteName=i,i.length>24&&this.addIssue(e.ErrorSeverity.WARNING,e.ERROR_CODES.SATELLITE_NAME_TOO_LONG,"Satellite name exceeds recommended 24 characters",{length:i.length,name:i}),"1"!==i[0]&&"2"!==i[0]||this.addIssue(e.ErrorSeverity.WARNING,e.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,'Satellite name starts with "1" or "2", might be incorrectly formatted',{name:i}))}parseLine1(){const t=this.context.line1Index;if(t<0||t>=this.context.lines.length)return void this.addIssue(e.ErrorSeverity.CRITICAL,"INVALID_LINE1_INDEX","Invalid Line 1 index",{index:t});const i=this.context.lines[t];if(!i)return;if(this.parsedData.line1Raw=i,69!==i.length)if(this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_LINE_LENGTH,`Line 1 must be exactly 69 characters (got ${i.length})`,{line:1,expected:69,actual:i.length}),this.options.attemptRecovery)this.recordRecovery(e.RecoveryAction.CONTINUE,"Attempting to parse Line 1 despite incorrect length",{length:i.length});else if(this.options.strictMode)return;this.parseFieldSafe("lineNumber1",i,0,1,"Line 1 number"),this.parseFieldSafe("satelliteNumber1",i,2,7,"Satellite number"),this.parseFieldSafe("classification",i,7,8,"Classification"),this.parseFieldSafe("internationalDesignatorYear",i,9,11,"Int. designator year"),this.parseFieldSafe("internationalDesignatorLaunchNumber",i,11,14,"Int. designator launch"),this.parseFieldSafe("internationalDesignatorPiece",i,14,17,"Int. designator piece"),this.parseFieldSafe("epochYear",i,18,20,"Epoch year"),this.parseFieldSafe("epoch",i,20,32,"Epoch"),this.parseFieldSafe("firstDerivative",i,33,43,"First derivative"),this.parseFieldSafe("secondDerivative",i,44,52,"Second derivative"),this.parseFieldSafe("bStar",i,53,61,"B* drag term"),this.parseFieldSafe("ephemerisType",i,62,63,"Ephemeris type"),this.parseFieldSafe("elementSetNumber",i,64,68,"Element set number"),this.parseFieldSafe("checksum1",i,68,69,"Checksum"),"1"!==this.parsedData.lineNumber1&&this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_LINE_NUMBER,`Line 1 must start with '1' (got '${this.parsedData.lineNumber1}')`,{line:1,expected:"1",actual:this.parsedData.lineNumber1});const n=["U","C","S"];if(this.parsedData.classification&&!n.includes(this.parsedData.classification)&&this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_CLASSIFICATION,`Classification must be U, C, or S (got '${this.parsedData.classification}')`,{expected:n,actual:this.parsedData.classification}),69===i.length){const t=this.calculateChecksum(i),n=parseInt(this.parsedData.checksum1||"",10);isNaN(n)||t===n||(this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.CHECKSUM_MISMATCH,`Line 1 checksum mismatch (expected ${t}, got ${n})`,{line:1,expected:t,actual:n}),this.options.attemptRecovery&&this.recordRecovery(e.RecoveryAction.CONTINUE,"Continuing despite checksum mismatch",{line:1}))}}parseLine2(){const t=this.context.line2Index;if(t<0||t>=this.context.lines.length)return void this.addIssue(e.ErrorSeverity.CRITICAL,"INVALID_LINE2_INDEX","Invalid Line 2 index",{index:t});const i=this.context.lines[t];if(i){if(this.parsedData.line2Raw=i,69!==i.length)if(this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_LINE_LENGTH,`Line 2 must be exactly 69 characters (got ${i.length})`,{line:2,expected:69,actual:i.length}),this.options.attemptRecovery)this.recordRecovery(e.RecoveryAction.CONTINUE,"Attempting to parse Line 2 despite incorrect length",{length:i.length});else if(this.options.strictMode)return;if(this.parseFieldSafe("lineNumber2",i,0,1,"Line 2 number"),this.parseFieldSafe("satelliteNumber2",i,2,7,"Satellite number"),this.parseFieldSafe("inclination",i,8,16,"Inclination"),this.parseFieldSafe("rightAscension",i,17,25,"Right ascension"),this.parseFieldSafe("eccentricity",i,26,33,"Eccentricity"),this.parseFieldSafe("argumentOfPerigee",i,34,42,"Argument of perigee"),this.parseFieldSafe("meanAnomaly",i,43,51,"Mean anomaly"),this.parseFieldSafe("meanMotion",i,52,63,"Mean motion"),this.parseFieldSafe("revolutionNumber",i,63,68,"Revolution number"),this.parseFieldSafe("checksum2",i,68,69,"Checksum"),"2"!==this.parsedData.lineNumber2&&this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_LINE_NUMBER,`Line 2 must start with '2' (got '${this.parsedData.lineNumber2}')`,{line:2,expected:"2",actual:this.parsedData.lineNumber2}),69===i.length){const t=this.calculateChecksum(i),n=parseInt(this.parsedData.checksum2||"",10);isNaN(n)||t===n||(this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.CHECKSUM_MISMATCH,`Line 2 checksum mismatch (expected ${t}, got ${n})`,{line:2,expected:t,actual:n}),this.options.attemptRecovery&&this.recordRecovery(e.RecoveryAction.CONTINUE,"Continuing despite checksum mismatch",{line:2}))}}}validateCrossFields(){if(this.parsedData.satelliteNumber1&&this.parsedData.satelliteNumber2){const t=this.parsedData.satelliteNumber1.trim(),i=this.parsedData.satelliteNumber2.trim();t!==i&&this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,`Satellite numbers must match (Line 1: ${t}, Line 2: ${i})`,{line1Value:t,line2Value:i})}if(this.validateNumericField("inclination",0,180,"Inclination"),this.validateNumericField("rightAscension",0,360,"Right Ascension"),this.validateNumericField("argumentOfPerigee",0,360,"Argument of Perigee"),this.validateNumericField("meanAnomaly",0,360,"Mean Anomaly"),this.parsedData.eccentricity){const t=parseFloat("0."+this.parsedData.eccentricity.trim());!isNaN(t)&&(t<0||t>1)&&this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.VALUE_OUT_OF_RANGE,`Eccentricity must be between 0 and 1 (got ${t})`,{field:"eccentricity",value:t,min:0,max:1})}this.validateNumericField("meanMotion",0,20,"Mean Motion",!0),this.validateNumericField("epochYear",0,99,"Epoch Year")}validateNumericField(t,i,n,r,s=!1){const a=this.parsedData[t];if(!a||"string"!=typeof a)return;const o=parseFloat(a.trim());isNaN(o)?this.addIssue(s?e.ErrorSeverity.WARNING:e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_NUMBER_FORMAT,`${r} must be numeric (got '${a}')`,{field:t,value:a}):(o<i||o>n)&&this.addIssue(s?e.ErrorSeverity.WARNING:e.ErrorSeverity.ERROR,e.ERROR_CODES.VALUE_OUT_OF_RANGE,`${r} must be between ${i} and ${n} (got ${o})`,{field:t,value:o,min:i,max:n})}parseFieldSafe(t,i,n,r,s){try{i.length>=r?this.parsedData[t]=i.substring(n,r).trim():i.length>n?(this.parsedData[t]=i.substring(n).trim(),this.addIssue(e.ErrorSeverity.WARNING,"PARTIAL_FIELD",`${s} is incomplete due to short line`,{field:t,expected:[n,r],actual:i.length}),this.options.attemptRecovery&&this.recordRecovery(e.RecoveryAction.USE_DEFAULT,`Using partial value for ${s}`,{field:t})):(this.parsedData[t]=null,this.addIssue(e.ErrorSeverity.WARNING,"MISSING_FIELD",`${s} is missing due to short line`,{field:t,expected:[n,r],actual:i.length}),this.options.attemptRecovery&&this.recordRecovery(e.RecoveryAction.USE_DEFAULT,`Using null for missing ${s}`,{field:t}))}catch(i){this.parsedData[t]=null;const n=i instanceof Error?i.message:String(i);this.addIssue(e.ErrorSeverity.ERROR,"FIELD_PARSE_ERROR",`Error parsing ${s}: ${n}`,{field:t,error:n})}}calculateChecksum(e){let t=0;for(let i=0;i<e.length-1;i++){const n=e[i];n&&n>="0"&&n<="9"?t+=parseInt(n,10):"-"===n&&(t+=1)}return t%10}getResult(){const t=this.errors.map(t=>Object.assign({code:t.code,message:t.message,severity:t.severity===e.ErrorSeverity.CRITICAL?"error":t.severity},Object.fromEntries(Object.entries(t).filter(([e])=>!["severity","code","message","state"].includes(e))))),i=this.warnings.map(e=>Object.assign({code:e.code,message:e.message,severity:"warning"},Object.fromEntries(Object.entries(e).filter(([e])=>!["severity","code","message","state"].includes(e)))));return{success:this.state===e.ParserState.COMPLETED,state:this.state,data:this.parsedData,errors:t,warnings:i,recoveryActions:this.recoveryActions.map(e=>e.action),partialData:this.options.includePartialResults?this.parsedData:void 0,context:{lineCount:this.context.lineCount,hasName:this.context.hasName,recoveryAttempts:this.context.recoveryAttempts}}}}function E(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}function d(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((n=n.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;const R=i.promisify(t.readFile);function N(e,t={}){const{filter:i,continueOnError:n=!1,limit:r,skip:s=0,onTLE:a,onError:o}=t,c=E(t,["filter","continueOnError","limit","skip","onTLE","onError"]),l=[],u=p(e);let m=0;for(let e=0;e<u.length;e++){if(e<s)continue;if(void 0!==r&&m>=r)break;const t=u[e];if(t)try{const n=Oe(t,c);if(i&&!g(n,i))continue;l.push(n),m++,a&&a(n,e)}catch(i){if(o&&o(i,e,t),!n)throw i}}return l}function p(e){const t=ue(e).split("\n").map(e=>e.trim()).filter(e=>e.length>0),i=[];let n=[];for(const e of t)e.startsWith("#")?n.length>0&&n.push(e):"1"===e[0]?(n.length>=2&&i.push(n.join("\n")),n=[e]):"2"===e[0]?n.push(e):n.length>=2?(i.push(n.join("\n")),n=[e]):0===n.length?n=[e]:n.push(e);return n.length>=2&&i.push(n.join("\n")),i}function I(e){return d(this,arguments,void 0,function*(e,t={}){return Promise.resolve(Oe(e,t))})}function g(e,t){if(void 0!==t.satelliteNumber){const i=e.satelliteNumber1||"";if("function"==typeof t.satelliteNumber){if(!t.satelliteNumber(i))return!1}else if(Array.isArray(t.satelliteNumber)){if(!t.satelliteNumber.includes(i))return!1}else if(i!==t.satelliteNumber)return!1}if(void 0!==t.satelliteName&&e.satelliteName){const i=e.satelliteName;if("function"==typeof t.satelliteName){if(!t.satelliteName(i))return!1}else if(Array.isArray(t.satelliteName)){if(!t.satelliteName.some(e=>i.includes(e)))return!1}else if(!i.includes(t.satelliteName))return!1}if(void 0!==t.intlDesignator){const i=`${e.internationalDesignatorYear||""}${e.internationalDesignatorLaunchNumber||""}${e.internationalDesignatorPiece||""}`.trim();if("function"==typeof t.intlDesignator){if(!t.intlDesignator(i))return!1}else if(Array.isArray(t.intlDesignator)){if(!t.intlDesignator.includes(i))return!1}else if(i!==t.intlDesignator)return!1}if(void 0!==t.classification){const i=e.classification;if(Array.isArray(t.classification)){if(!t.classification.includes(i))return!1}else if(i!==t.classification)return!1}if(t.epochRange){const i=parseInt(e.epochYear||"0",10),n=e.epoch||"0",r=parseFloat(n),s=new Date(i>=57?1900+i:2e3+i,0,1);if(s.setDate(s.getDate()+r-1),t.epochRange.start&&s<t.epochRange.start)return!1;if(t.epochRange.end&&s>t.epochRange.end)return!1}if(t.inclinationRange){const i=parseFloat(e.inclination||"0");if(void 0!==t.inclinationRange.min&&i<t.inclinationRange.min)return!1;if(void 0!==t.inclinationRange.max&&i>t.inclinationRange.max)return!1}return!(t.custom&&!t.custom(e))}class A extends n.Transform{constructor(e={}){super({objectMode:!0,highWaterMark:e.highWaterMark||16}),this.buffer="",this.index=0,this.options=e}_transform(e,t,i){this.buffer+=e.toString();const n=this.buffer.split("\n");this.buffer=n.pop()||"";let r=[];for(const e of n){const t=e.trim();0!==t.length&&(t.startsWith("#")?r.push(t):"1"===t[0]?(r.length>=2&&this.processTLE(r.join("\n")),r=[t]):"2"===t[0]?(r.push(t),r.length>=2&&(this.processTLE(r.join("\n")),r=[])):(r.length>=2&&this.processTLE(r.join("\n")),r=[t]))}i()}_flush(e){if(this.buffer.trim().length>0){const e=this.buffer.split("\n").filter(e=>e.trim().length>0);e.length>=2&&this.processTLE(e.join("\n"))}e()}processTLE(e){const t=this.options,{continueOnError:i=!0,filter:n,onTLE:r,onError:s}=t,a=E(t,["continueOnError","filter","onTLE","onError"]);try{const t=Oe(e,a);if(n&&!g(t,n))return;this.push(t),r&&r(t,this.index),this.index++}catch(t){s&&s(t,this.index,e),i||this.destroy(t),this.index++}}}function _(e={}){return new A(e)}function f(e){return d(this,arguments,void 0,function*(e,t={}){return new Promise((i,n)=>{const r=[],s=_(Object.assign(Object.assign({},t),{onTLE:(e,i)=>{r.push(e),t.onTLE&&t.onTLE(e,i)}}));e.pipe(s).on("data",()=>{}).on("end",()=>i(r)).on("error",n)})})}class O{constructor(){this.middlewares=[],this.plugins=[]}use(e){return this.middlewares.push(e),this}plugin(e){return this.plugins.push(e),e.middleware&&this.use(e.middleware),this}parse(e){return d(this,arguments,void 0,function*(e,t={}){const i={rawTLE:e,options:t,metadata:{}},n=e=>d(this,void 0,void 0,function*(){if(e>=this.middlewares.length)return Oe(i.rawTLE,i.options);const t=this.middlewares[e];return t?t(i,()=>n(e+1)):Oe(i.rawTLE,i.options)});return n(0)})}parseBatch(e){return d(this,arguments,void 0,function*(e,t={}){for(const e of this.plugins)e.onBatchStart&&(yield e.onBatchStart(t));const i=[],n=p(e);for(let e=0;e<n.length;e++){const r=n[e];if(r)try{const n=yield this.parse(r,t);if(t.filter&&!g(n,t.filter))continue;i.push(n);for(const t of this.plugins)t.onTLEParsed&&(yield t.onTLEParsed(n,e));t.onTLE&&t.onTLE(n,e)}catch(i){for(const t of this.plugins)t.onError&&(yield t.onError(i,e));if(t.onError&&t.onError(i,e,r),!t.continueOnError)throw i}}for(const e of this.plugins)e.onBatchEnd&&(yield e.onBatchEnd(i));return i})}}class S{constructor(e={}){this.cache=new Map,this.maxSize=e.maxSize||1e3,this.ttl=e.ttl||36e5,this.keyGenerator=e.keyGenerator||this.defaultKeyGenerator}defaultKeyGenerator(e,t){return`${e}:${JSON.stringify(t)}`}get(e,t={}){const i=this.keyGenerator(e,t),n=this.cache.get(i);return n?Date.now()-n.timestamp>this.ttl?(this.cache.delete(i),null):(this.cache.delete(i),this.cache.set(i,n),n.tle):null}set(e,t,i={}){const n=this.keyGenerator(e,i);if(this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;e&&this.cache.delete(e)}this.cache.set(n,{tle:t,timestamp:Date.now()})}clear(){this.cache.clear()}size(){return this.cache.size}}function T(e){return{strict:{validate:!0,strictChecksums:!0,validateRanges:!0,mode:"strict",includeWarnings:!0,includeComments:!0},permissive:{validate:!0,strictChecksums:!1,validateRanges:!1,mode:"permissive",includeWarnings:!0,includeComments:!0},fast:{validate:!1,includeWarnings:!1,includeComments:!1},realtime:{validate:!0,strictChecksums:!1,validateRanges:!1,mode:"permissive",includeWarnings:!1,includeComments:!1},batch:{validate:!0,strictChecksums:!0,validateRanges:!0,mode:"strict",includeWarnings:!1,includeComments:!1},recovery:{validate:!1,includeWarnings:!0,includeComments:!0},legacy:{validate:!0,strictChecksums:!1,validateRanges:!1,mode:"permissive",includeWarnings:!0,includeComments:!0}}[e]}class L{constructor(e,t={}){this.buffer="",this.currentSet=[],this.onTLE=e,this.options=t}push(e){this.buffer+=e,this.processBuffer()}flush(){this.currentSet.length>=2&&(this.emitTLE(this.currentSet.join("\n")),this.currentSet=[])}processBuffer(){const e=this.buffer.split("\n");this.buffer=e.pop()||"";for(const t of e){const e=t.trim();0!==e.length&&(e.startsWith("#")?this.currentSet.push(e):"1"===e[0]?(this.currentSet.length>=2&&this.emitTLE(this.currentSet.join("\n")),this.currentSet=[e]):"2"===e[0]?(this.currentSet.push(e),this.currentSet.length>=2&&(this.emitTLE(this.currentSet.join("\n")),this.currentSet=[])):(this.currentSet.length>=2&&this.emitTLE(this.currentSet.join("\n")),this.currentSet=[e]))}}emitTLE(e){try{const t=Oe(e,this.options);this.onTLE(t)}catch(e){}}}function v(e){return{celestrak:{validate:!0,strictChecksums:!0,validateRanges:!0,mode:"strict",includeWarnings:!0,includeComments:!0},spacetrack:{validate:!0,strictChecksums:!0,validateRanges:!0,mode:"strict",includeWarnings:!0,includeComments:!0},amsat:{validate:!0,strictChecksums:!1,validateRanges:!1,mode:"permissive",includeWarnings:!0,includeComments:!0},custom:{validate:!1,includeWarnings:!0,includeComments:!0}}[e]}const C={meanMotion:{min:0,max:20,typical:{min:10,max:17}},eccentricity:{min:0,max:.999999,typical:{min:0,max:.25}},inclination:{min:0,max:180,typical:{min:0,max:100}},rightAscension:{min:0,max:360},argumentOfPerigee:{min:0,max:360},meanAnomaly:{min:0,max:360},bStar:{min:-1,max:1,typical:{min:-.001,max:.001}},meanMotionFirstDerivative:{min:-1,max:1,typical:{min:-.001,max:.001}},meanMotionSecondDerivative:{min:-1,max:1,typical:{min:-1e-5,max:1e-5}},revolutionNumber:{min:0,max:99999},elementSetNumber:{min:0,max:999},ephemerisType:{min:0,max:9}},D={min:1,max:999999,historical5Digit:99999,modern6Digit:999999},y={minYear:57,maxYear:99,minDayOfYear:1,maxDayOfYear:366.99999999,warningAgeThreshold:7,criticalAgeThreshold:30,maxFutureDays:30},b={yearMin:57,yearMax:99,launchNumberMin:1,launchNumberMax:999,piecePattern:/^[A-Z]{1,3}$/},M={checksumValid:20,fieldFormatValid:15,parametersInRange:15,parametersInTypicalRange:10,epochRecent:15,noAnomalies:10,designatorValid:5,consistencyChecks:10};function x(e,t){let i;i=e>=57?1900+e:2e3+e;const n=new Date(Date.UTC(i,0,1)).getTime()+864e5*(t-1),r=new Date(n),s=Math.floor((14-(r.getUTCMonth()+1))/12),a=i+4800-s,o=r.getUTCMonth()+1+12*s-3,c=r.getUTCDate()+Math.floor((153*o+2)/5)+365*a+Math.floor(a/4)-Math.floor(a/100)+Math.floor(a/400)-32045+(r.getUTCHours()+r.getUTCMinutes()/60+r.getUTCSeconds()/3600)/24,l=c-2400000.5;return{year:i,twoDigitYear:e,dayOfYear:t,isoDate:r.toISOString(),date:r,julianDate:c,modifiedJulianDate:l}}function $(e,t){const i=[];if((e<y.minYear||e>y.maxYear)&&i.push(`Epoch year ${e} outside valid range [${y.minYear}, ${y.maxYear}]`),(t<y.minDayOfYear||t>y.maxDayOfYear)&&i.push(`Epoch day ${t} outside valid range [${y.minDayOfYear}, ${y.maxDayOfYear}]`),i.length>0)return{valid:!1,message:i.join("; "),context:{epochYear:e,epochDay:t}};const n=x(e,t),r=n.year,s=r%4==0&&r%100!=0||r%400==0,a=s?366:365;return Math.floor(t)>a&&i.push(`Day ${Math.floor(t)} exceeds maximum for ${r} (${s?"leap year":"non-leap year"}: ${a} days)`),i.length>0?{valid:!1,message:i.join("; "),context:{epochYear:e,epochDay:t,fullYear:r,isLeapYear:s}}:{valid:!0,context:{epochDate:n}}}function P(e,t,i=new Date){const n=x(e,t);return(i.getTime()-n.date.getTime())/864e5}function V(e,t,i={}){const n=P(e,t,i.referenceDate||new Date),r=[];if(n<0){const e=Math.abs(n);if(!i.allowFuture)return{valid:!1,message:`Epoch is ${e.toFixed(2)} days in the future`,context:{age:n,futureDays:e}};e>y.maxFutureDays&&r.push(`Epoch is ${e.toFixed(2)} days in the future (threshold: ${y.maxFutureDays} days)`)}if(n>0){const e=i.maxAge||y.criticalAgeThreshold;n>e&&r.push(`Epoch is ${n.toFixed(2)} days old (threshold: ${e} days)`)}return{valid:!0,message:r.length>0?r.join("; "):void 0,context:{age:n}}}function U(e,t,i=!1){const n=C[e];if(!n)return{valid:!1,message:`Unknown parameter: ${e}`};if(t<n.min||t>n.max)return{valid:!1,message:`${e} value ${t} outside valid range [${n.min}, ${n.max}]`,context:{paramName:e,value:t,min:n.min,max:n.max}};if(i&&"typical"in n&&n.typical){const i=n.typical;if(t<i.min||t>i.max)return{valid:!0,message:`${e} value ${t} outside typical range [${i.min}, ${i.max}]`,context:{paramName:e,value:t,typicalMin:i.min,typicalMax:i.max,outsideTypical:!0}}}return{valid:!0,context:{paramName:e,value:t}}}function G(e,t=!1){const i=[],n={meanMotion:{field:"meanMotion",param:"meanMotion"},eccentricity:{field:"eccentricity",param:"eccentricity"},inclination:{field:"inclination",param:"inclination"},rightAscension:{field:"rightAscension",param:"rightAscension"},argumentOfPerigee:{field:"argumentOfPerigee",param:"argumentOfPerigee"},meanAnomaly:{field:"meanAnomaly",param:"meanAnomaly"},bStar:{field:"bStar",param:"bStar"},firstDerivative:{field:"firstDerivative",param:"meanMotionFirstDerivative"},secondDerivative:{field:"secondDerivative",param:"meanMotionSecondDerivative"},revolutionNumber:{field:"revolutionNumber",param:"revolutionNumber"},elementSetNumber:{field:"elementSetNumber",param:"elementSetNumber"},ephemerisType:{field:"ephemerisType",param:"ephemerisType"}};for(const[r,s]of Object.entries(n)){const n=parseFloat(e[s.field]);if(isNaN(n)){i.push({valid:!1,message:`Field ${r} is not a valid number`,context:{field:r,value:e[s.field]}});continue}const a=U(s.param,n,t);a.valid&&!a.message||i.push(Object.assign(Object.assign({},a),{context:Object.assign(Object.assign({},a.context),{field:r})}))}return i}function F(e,t){if(e.length<69)return{valid:!1,message:`Line ${t} is too short (${e.length} chars, expected 69)`,context:{lineNumber:t,length:e.length}};const i=e.charAt(68),n=parseInt(i,10),r=function(e){let t=0;const i=e.substring(0,68);for(const e of i)e>="0"&&e<="9"?t+=parseInt(e,10):"-"===e&&(t+=1);return t%10}(e);return isNaN(n)?{valid:!1,message:`Line ${t} checksum is not a digit: '${i}'`,context:{lineNumber:t,checksumChar:i}}:r!==n?{valid:!1,message:`Line ${t} checksum mismatch: expected ${n}, calculated ${r}`,context:{lineNumber:t,expected:n,calculated:r,line:e.substring(0,68)}}:{valid:!0,context:{lineNumber:t,checksum:r}}}function w(e){const t="-"===(e=e.trim())[0]?-1:1,i=e.replace(/^[-+\s]+/,"").replace(/\s+/g,""),n=i.match(/([+-])(\d+)$/);if(!n)return t*parseFloat("0."+i);const r=i.substring(0,i.length-n[0].length),s="-"===(n[1]||"+")?-1:1,a=parseInt(n[2]||"0",10);return t*parseFloat("0."+r)*Math.pow(10,s*a)}function H(e){const t="string"==typeof e?parseInt(e.trim(),10):e;return isNaN(t)?{valid:!1,message:`Satellite number is not a valid integer: '${e}'`,context:{satelliteNumber:e}}:t<D.min||t>D.max?{valid:!1,message:`Satellite number ${t} outside valid range [${D.min}, ${D.max}]`,context:{satelliteNumber:t,min:D.min,max:D.max}}:{valid:!0,context:{satelliteNumber:t,format:t<=D.historical5Digit?"5-digit":"6-digit"}}}function W(e){const t=e.trim(),i=t.match(/^(\d{2})(\d{1,3})([A-Z]{1,3})$/);if(!i)return{valid:!1,message:`Invalid international designator format: '${e}' (expected YYLLLPPP)`,context:{designator:t}};const n=i[1]||"0",r=i[2]||"0",s=i[3]||"",a=parseInt(n,10),o=parseInt(r,10);return a<b.yearMin||a>b.yearMax?{valid:!1,message:`International designator year ${a} outside valid range [${b.yearMin}, ${b.yearMax}]`,context:{designator:t,year:a}}:o<b.launchNumberMin||o>b.launchNumberMax?{valid:!1,message:`International designator launch number ${o} outside valid range [${b.launchNumberMin}, ${b.launchNumberMax}]`,context:{designator:t,launchNumber:o}}:b.piecePattern.test(s)?{valid:!0,context:{designator:t,year:a,launchNumber:o,piece:s,fullYear:a>=b.yearMin?1900+a:2e3+a}}:{valid:!1,message:`International designator piece '${s}' invalid (must be 1-3 uppercase letters)`,context:{designator:t,piece:s}}}const k=.01,Y=.01;function j(e){const t=[],i=parseFloat(e.eccentricity),n=parseFloat(e.meanMotion),r=parseFloat(e.inclination),s=w(e.bStar),a=parseFloat(e.firstDerivative),o=parseInt(e.revolutionNumber,10);return i>.5&&t.push({hasAnomaly:!0,type:"HIGH_ECCENTRICITY",description:`Unusually high eccentricity: ${i.toFixed(6)} (threshold: 0.5)`,severity:i>.9?"error":"warning",score:Math.min(i/.5,1)}),n<1&&t.push({hasAnomaly:!0,type:"LOW_MEAN_MOTION",description:`Unusually low mean motion: ${n.toFixed(8)} rev/day (threshold: 1)`,severity:"warning",score:1-n/1}),n>18&&t.push({hasAnomaly:!0,type:"HIGH_MEAN_MOTION",description:`Unusually high mean motion: ${n.toFixed(8)} rev/day (threshold: 18)`,severity:"warning",score:Math.min(n/18,1)}),r>90&&r<180&&t.push({hasAnomaly:!0,type:"RETROGRADE_ORBIT",description:`Retrograde orbit detected: inclination ${r.toFixed(4)}Â° (>90Â°)`,severity:"info",score:(r-90)/90}),Math.abs(s)>k&&t.push({hasAnomaly:!0,type:"HIGH_DRAG",description:`Unusually high drag coefficient: B* = ${s.toExponential(4)} (threshold: 0.01)`,severity:"warning",score:Math.min(Math.abs(s)/k,1)}),Math.abs(a)>Y&&t.push({hasAnomaly:!0,type:"RAPID_ORBITAL_CHANGE",description:`Rapid orbital evolution: dn/dt = ${a.toFixed(8)} (threshold: 0.01)`,severity:"warning",score:Math.min(Math.abs(a)/Y,1)}),o<100&&t.push({hasAnomaly:!0,type:"NEW_SATELLITE",description:`Recently launched satellite: revolution number ${o}`,severity:"info",score:1-o/100}),0===i&&t.push({hasAnomaly:!0,type:"CIRCULAR_ORBIT",description:"Perfect circular orbit (eccentricity = 0)",severity:"info",score:.1}),t}function B(e,t){let i=0;const n={checksumScore:0,formatScore:0,rangeScore:0,epochScore:0,anomalyScore:0,consistencyScore:0};t.checksumValid&&(n.checksumScore=M.checksumValid),t.formatValid&&(n.formatScore=M.fieldFormatValid);const r=t.rangeErrors.filter(e=>!e.valid),s=t.rangeResults.filter(e=>e.valid&&e.message);if(0===r.length)n.rangeScore=M.parametersInRange,0===s.length&&(n.rangeScore+=M.parametersInTypicalRange);else{const e=r.length+s.length,t=s.length;n.rangeScore=t/e*M.parametersInRange}const a=Math.abs(t.epochAge);n.epochScore=a<=1?M.epochRecent:a<=y.warningAgeThreshold?.9*M.epochRecent:a<=y.criticalAgeThreshold?.5*M.epochRecent:.2*M.epochRecent;const o={error:1,warning:.5,info:.1},c=t.anomalies.reduce((e,t)=>{const i=o[t.severity||"info"];return e+(t.score||.5)*i},0);n.anomalyScore=Math.max(0,M.noAnomalies-2*c);let l,u,m=M.consistencyChecks;return e.satelliteNumber1!==e.satelliteNumber2&&(m-=5),["U","C","S"].includes(e.classification)||(m-=2),W(e.internationalDesignatorYear+e.internationalDesignatorLaunchNumber+e.internationalDesignatorPiece).valid||(m-=3),n.consistencyScore=Math.max(0,m),i=Object.values(n).reduce((e,t)=>e+t,0),l=i>=90?"A":i>=80?"B":i>=70?"C":i>=60?"D":"F",u="A"===l?"Excellent quality - TLE is fresh, valid, and anomaly-free":"B"===l?"Good quality - TLE is valid with minor warnings":"C"===l?"Acceptable quality - TLE has some issues but is usable":"D"===l?"Poor quality - TLE has significant issues, use with caution":"Invalid - TLE has critical errors and should not be used",{overall:Math.round(i),components:n,grade:l,assessment:u}}function K(e,t){let i=e;const n=[];i.includes("\0")&&(i=i.replace(/\0/g,""),n.push("Removed null bytes")),i.includes("\t")&&(i=i.replace(/\t/g," "),n.push("Normalized tabs to spaces"));const r=/[\x00-\x1F\x7F-\x9F]/g;switch(r.test(i)&&(i=i.replace(r,""),n.push("Removed non-printable characters")),t){case"satelliteName":/^[A-Z0-9\s\-\(\)]+$/i.test(i)||(i=i.replace(/[^A-Z0-9\s\-\(\)]/gi,""),n.push("Removed invalid characters from satellite name"));break;case"classification":i=i.trim().toUpperCase(),i.length>1&&(i=i.charAt(0),n.push("Truncated classification to single character"));break;case"internationalDesignatorYear":case"internationalDesignatorLaunchNumber":case"satelliteNumber1":case"satelliteNumber2":case"elementSetNumber":case"revolutionNumber":/^\d+$/.test(i.trim())||(i=i.replace(/\D/g,""),n.push(`Removed non-numeric characters from ${t}`));break;case"internationalDesignatorPiece":{const e=i;i=i.trim().toUpperCase().replace(/[^A-Z]/g,""),i!==e.trim()&&n.push("Normalized designator piece to uppercase letters");break}}const s=i.trim();return s!==i&&(i=s,n.push("Trimmed whitespace")),{value:i,modified:n.length>0,modifications:n.length>0?n:void 0}}function z(e){const t=new Map;for(const[i,n]of Object.entries(e))if("string"==typeof n){const e=K(n,i);e.modified&&t.set(i,e)}return t}const q=[{name:"checksum",description:"Validate line checksums",severity:"error",enabled:!0,validate:()=>({valid:!0})},{name:"satelliteNumberRange",description:"Validate satellite number is in valid range",severity:"error",enabled:!0,validate:e=>H(e)},{name:"epochDate",description:"Validate epoch date format and range",severity:"error",enabled:!0,validate:e=>$(parseInt(e.epochYear,10),parseFloat(e.epoch))},{name:"epochAge",description:"Warn if epoch is stale or in future",severity:"warning",enabled:!0,validate:(e,t)=>V(parseInt(e.epochYear,10),parseFloat(e.epoch),{referenceDate:null==t?void 0:t.referenceDate})},{name:"internationalDesignator",description:"Validate international designator format",severity:"warning",enabled:!0,validate:e=>W(e.internationalDesignatorYear+e.internationalDesignatorLaunchNumber+e.internationalDesignatorPiece)},{name:"orbitalParameterRanges",description:"Validate orbital parameters are in valid ranges",severity:"error",enabled:!0,validate:e=>{const t=G(e,!1).filter(e=>!e.valid);return t.length>0?{valid:!1,message:t.map(e=>e.message).join("; "),context:{errors:t}}:{valid:!0}}},{name:"anomalyDetection",description:"Detect unusual orbital parameters",severity:"warning",enabled:!1,validate:e=>{const t=j(e);return t.length>0?{valid:!0,message:`${t.length} anomalies detected`,context:{anomalies:t}}:{valid:!0}}}];function X(e){return e.satelliteNumber1||e.satelliteNumber2||""}function Z(e){return`${e.internationalDesignatorYear||""}${e.internationalDesignatorLaunchNumber||""}${e.internationalDesignatorPiece||""}`.trim()}const J={reset:"[0m",bright:"[1m",dim:"[2m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",bgBlack:"[40m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m"};function Q(e,t,i=!0){return i?`${t}${e}${J.reset}`:e}function ee(e,t={}){const{pretty:i=!1,includeWarnings:n=!0,includeComments:r=!0,verbosity:s="normal"}=t,a=e=>{const t=Object.assign({},e);return!n&&"warnings"in t&&delete t.warnings,!r&&"comments"in t&&delete t.comments,"compact"===s?{satelliteName:t.satelliteName,satelliteNumber:X(t),epoch:t.epochYear+":"+t.epoch,inclination:t.inclination,eccentricity:t.eccentricity,meanMotion:t.meanMotion}:t},o=Array.isArray(e)?e.map(a):a(e);return JSON.stringify(o,null,i?2:0)}function te(e,t={}){const{includeHeader:i=!0,delimiter:n=",",quote:r=!0,verbosity:s="normal"}=t,a=Array.isArray(e)?e:[e],o=[],c=Object.keys(a[0]||{}).filter(e=>!["warnings","comments","checksum1","checksum2","lineNumber1","lineNumber2"].includes(e)),l="compact"===s?["satelliteName","satelliteNumber1","epochYear","epoch","inclination","eccentricity","meanMotion"]:"verbose"===s?c:["satelliteName","satelliteNumber1","classification","epochYear","epoch","firstDerivative","secondDerivative","bStar","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion","revolutionNumber"];i&&o.push(l.map(e=>r?`"${e}"`:e).join(n));for(const e of a){const t=l.map(t=>{var i;const n=null!==(i=e[t])&&void 0!==i?i:"",s=String(n);return r?`"${s.replace(/"/g,'""')}"`:s});o.push(t.join(n))}return o.join("\n")}function ie(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function ne(e,t={}){const{pretty:i=!1,includeWarnings:n=!0,includeComments:r=!0}=t,s=i?"  ":"",a=i?"\n":"",o=Array.isArray(e)?e:[e],c=['<?xml version="1.0" encoding="UTF-8"?>'];c.push(`<tles>${a}`);for(const e of o){c.push(`${s}<tle>${a}`);for(const[t,i]of Object.entries(e))if(("warnings"!==t||n)&&("comments"!==t||r))if(Array.isArray(i)){c.push(`${s}${s}<${t}>${a}`);for(const e of i){const t="object"==typeof e?JSON.stringify(e):String(e);c.push(`${s}${s}${s}<item>${ie(t)}</item>${a}`)}c.push(`${s}${s}</${t}>${a}`)}else{const e=ie(String(null!=i?i:""));c.push(`${s}${s}<${t}>${e}</${t}>${a}`)}c.push(`${s}</tle>${a}`)}return c.push("</tles>"),c.join("")}function re(e,t={}){const{includeWarnings:i=!0,includeComments:n=!0}=t,r=Array.isArray(e)?e:[e],s=[],a=(e,t=0)=>{const i="  ".repeat(t);return null==e?"null":"string"==typeof e?/[:#\[\]{},&*!|>'"%@`]/.test(e)||/^\s|\s$/.test(e)?`"${e.replace(/"/g,'\\"')}"`:e:"number"==typeof e||"boolean"==typeof e?String(e):Array.isArray(e)?0===e.length?"[]":"\n"+e.map(e=>{if("object"==typeof e&&null!==e){const n=o(e,t+1);return`${i}  -${n.substring(i.length+3)}`}return`${i}  - ${a(e,0)}`}).join("\n"):"object"==typeof e?"\n"+o(e,t+1):String(e)},o=(e,t=0)=>{const r="  ".repeat(t),s=[];for(const[o,c]of Object.entries(e)){if("warnings"===o&&!i)continue;if("comments"===o&&!n)continue;const e=a(c,t);e.startsWith("\n")?s.push(`${r}${o}:${e}`):s.push(`${r}${o}: ${e}`)}return s.join("\n")};if(1===r.length)return o(r[0],0);s.push("tles:");for(const e of r){s.push("  -");const t=o(e,2);s.push(t)}return s.join("\n")}function se(e,t={}){const{colors:i=!1,verbosity:n="normal",includeWarnings:r=!0}=t,s=[];if(s.push(Q("â•".repeat(70),J.cyan,i)),s.push(Q(`  ${e.satelliteName||"Unknown Satellite"}`,J.bright+J.cyan,i)),s.push(Q("â•".repeat(70),J.cyan,i)),s.push(""),s.push(Q("Basic Information:",J.bright+J.yellow,i)),s.push(`  ${Q("Satellite Number:",J.green,i)} ${X(e)}`),s.push(`  ${Q("Classification:",J.green,i)} ${e.classification||"N/A"}`),s.push(`  ${Q("International Designator:",J.green,i)} ${Z(e)||"N/A"}`),s.push(""),s.push(Q("Epoch Information:",J.bright+J.yellow,i)),s.push(`  ${Q("Epoch Year:",J.green,i)} ${e.epochYear}`),s.push(`  ${Q("Epoch Day:",J.green,i)} ${e.epoch}`),s.push(""),s.push(Q("Orbital Parameters:",J.bright+J.yellow,i)),s.push(`  ${Q("Inclination:",J.green,i)} ${e.inclination}Â°`),s.push(`  ${Q("Right Ascension:",J.green,i)} ${e.rightAscension}Â°`),s.push(`  ${Q("Eccentricity:",J.green,i)} ${e.eccentricity}`),s.push(`  ${Q("Argument of Perigee:",J.green,i)} ${e.argumentOfPerigee}Â°`),s.push(`  ${Q("Mean Anomaly:",J.green,i)} ${e.meanAnomaly}Â°`),s.push(`  ${Q("Mean Motion:",J.green,i)} ${e.meanMotion} rev/day`),s.push(""),"verbose"===n&&(s.push(Q("Additional Parameters:",J.bright+J.yellow,i)),s.push(`  ${Q("First Derivative (Mean Motion):",J.green,i)} ${e.firstDerivative}`),s.push(`  ${Q("Second Derivative (Mean Motion):",J.green,i)} ${e.secondDerivative}`),s.push(`  ${Q("B* Drag Term:",J.green,i)} ${e.bStar}`),s.push(`  ${Q("Ephemeris Type:",J.green,i)} ${e.ephemerisType}`),s.push(`  ${Q("Element Set Number:",J.green,i)} ${e.elementSetNumber}`),s.push(`  ${Q("Revolution Number:",J.green,i)} ${e.revolutionNumber}`),s.push("")),r&&"warnings"in e&&Array.isArray(e.warnings)&&e.warnings.length>0){s.push(Q("Warnings:",J.bright+J.yellow,i));for(const t of e.warnings){const e="object"==typeof t&&"message"in t?t.message:String(t);s.push(`  ${Q("âš ",J.yellow,i)} ${e}`)}s.push("")}return s.push(Q("â•".repeat(70),J.cyan,i)),s.join("\n")}function ae(e,t={}){const{includeName:i=!0}=t,n=(e,t)=>e.padEnd(t," "),r=(e,t,i=" ")=>e.padStart(t,i);let s="1 ";s+=r(X(e),5," "),s+=e.classification||"U",s+=" "+n(Z(e),8),s+=" "+r(e.epochYear||"",2,"0"),s+=r(e.epoch||"",12," "),s+=" "+r(e.firstDerivative||"",10," "),s+=" "+n(e.secondDerivative||"",8),s+=" "+n(e.bStar||"",8),s+=" "+(e.ephemerisType||"0"),s+=" "+r(e.elementSetNumber||"",4," ");let a=0;for(let e=0;e<s.length;e++){const t=s[e];t&&t>="0"&&t<="9"?a+=parseInt(t,10):"-"===t&&(a+=1)}s+=(a%10).toString();let o="2 ";o+=r(X(e),5," "),o+=" "+r(e.inclination||"",8," "),o+=" "+r(e.rightAscension||"",8," "),o+=" "+r((e.eccentricity||"").replace(/^0\./,""),7,"0"),o+=" "+r(e.argumentOfPerigee||"",8," "),o+=" "+r(e.meanAnomaly||"",8," "),o+=" "+r(e.meanMotion||"",11," "),o+=r(e.revolutionNumber||"",5," ");let c=0;for(let e=0;e<o.length;e++){const t=o[e];t&&t>="0"&&t<="9"?c+=parseInt(t,10):"-"===t&&(c+=1)}o+=(c%10).toString();const l=[];return i&&e.satelliteName&&l.push(e.satelliteName),l.push(s),l.push(o),l.join("\n")}const oe={lineNumber1:[0,1],satelliteNumber1:[2,7],classification:[7,8],internationalDesignatorYear:[9,11],internationalDesignatorLaunchNumber:[11,14],internationalDesignatorPiece:[14,17],epochYear:[18,20],epoch:[20,32],firstDerivative:[33,43],secondDerivative:[44,52],bStar:[53,61],ephemerisType:[62,63],elementSetNumber:[64,68],checksum1:[68,69],lineNumber2:[0,1],satelliteNumber2:[2,7],inclination:[8,16],rightAscension:[17,25],eccentricity:[26,33],argumentOfPerigee:[34,42],meanAnomaly:[43,51],meanMotion:[52,63],revolutionNumber:[63,68],checksum2:[68,69]};class ce extends Error{constructor(e,t,i=[]){super(e),this.name="TLEValidationError",this.errors=t,this.warnings=i,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class le extends Error{constructor(e,t,i={}){super(e),this.name="TLEFormatError",this.code=t,this.details=i,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}function ue(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}function me(e){return ue(e).split("\n").map(e=>e.replace(/\t/g," ").trim()).filter(e=>e.length>0)}function he(e){let t=0;for(let i=0;i<e.length-1;i++){const n=e[i];n&&n>="0"&&n<="9"?t+=parseInt(n,10):"-"===n&&(t+=1)}return t%10}function Ee(t){if(69!==t.length)return{isValid:!1,expected:null,actual:null,error:{code:e.ERROR_CODES.INVALID_LINE_LENGTH,message:"Line length must be 69 characters",field:"line_length",expected:69,actual:t.length,severity:"error"}};const i=he(t),n=parseInt(t[68]||"",10);if(isNaN(n))return{isValid:!1,expected:i,actual:null,error:{code:e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER,message:"Checksum position must contain a digit",field:"checksum",position:68,value:t[68],severity:"error"}};const r=i===n;return{isValid:r,expected:i,actual:n,error:r?null:{code:e.ERROR_CODES.CHECKSUM_MISMATCH,message:`Checksum mismatch: expected ${i}, got ${n}`,field:"checksum",expected:i,actual:n,severity:"error"}}}function de(t,i){const n=[];if(69!==t.length)return n.push({code:e.ERROR_CODES.INVALID_LINE_LENGTH,message:`Line ${i} must be exactly 69 characters (got ${t.length})`,line:i,field:"line_length",expected:69,actual:t.length,severity:"error"}),{isValid:!1,errors:n};const r=t[0];r!==i.toString()&&n.push({code:e.ERROR_CODES.INVALID_LINE_NUMBER,message:`Line ${i} must start with '${i}' (got '${r}')`,line:i,field:"line_number",expected:i.toString(),actual:r,severity:"error"});const s=Ee(t);return!s.isValid&&s.error&&n.push(Object.assign(Object.assign({},s.error),{line:i,message:`Line ${i}: ${s.error.message}`})),{isValid:0===n.length,errors:n}}function Re(t,i){const n=t.substring(2,7).trim(),r=i.substring(2,7).trim();return n!==r?{isValid:!1,error:{code:e.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,message:`Satellite numbers must match (Line 1: ${n}, Line 2: ${r})`,field:"satellite_number",line1Value:n,line2Value:r,severity:"error"}}:/^\d+$/.test(n)?{isValid:!0,error:null}:{isValid:!1,error:{code:e.ERROR_CODES.INVALID_SATELLITE_NUMBER,message:`Satellite number must be numeric (got '${n}')`,field:"satellite_number",value:n,severity:"error"}}}function Ne(t){const i=t[7],n=["U","C","S"];return n.includes(i||"")?{isValid:!0,error:null}:{isValid:!1,error:{code:e.ERROR_CODES.INVALID_CLASSIFICATION,message:`Classification must be U, C, or S (got '${i}')`,field:"classification",expected:n,actual:i,severity:"error"}}}function pe(t,i,n,r){const s=parseFloat(t);return isNaN(s)?{isValid:!1,error:{code:e.ERROR_CODES.INVALID_NUMBER_FORMAT,message:`${i} must be numeric (got '${t}')`,field:i,value:t,severity:"error"}}:s<n||s>r?{isValid:!1,error:{code:e.ERROR_CODES.VALUE_OUT_OF_RANGE,message:`${i} must be between ${n} and ${r} (got ${s})`,field:i,value:s,min:n,max:r,severity:"error"}}:{isValid:!0,error:null}}function Ie(t){const i=[],n=t[7];return"C"!==n&&"S"!==n||i.push({code:e.ERROR_CODES.CLASSIFIED_DATA_WARNING,message:`Classification '${n}' is unusual in public TLE data (typically 'U' for unclassified)`,field:"classification",value:n,severity:"warning"}),i}function ge(t){const i=[],n=parseInt(t.substring(18,20),10),r=parseFloat(t.substring(20,32));if(isNaN(n)||isNaN(r))return i;const s=n>=57?1900+n:2e3+n;s<2e3&&i.push({code:e.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,message:`Epoch year ${s} is in the deprecated 1900s range (two-digit year: ${n})`,field:"epochYear",value:n,fullYear:s,severity:"warning"});const a=new Date(s,0,1);a.setDate(a.getDate()+r-1);const o=((new Date).getTime()-a.getTime())/864e5;return o>30&&i.push({code:e.ERROR_CODES.STALE_TLE_WARNING,message:`TLE epoch is ${Math.floor(o)} days old (epoch: ${a.toISOString().split("T")[0]}). TLE data may be stale.`,field:"epoch",daysSinceEpoch:Math.floor(o),epochDate:a.toISOString().split("T")[0],severity:"warning"}),i}function Ae(t){const i=[],n=parseFloat("0."+t.substring(26,33).trim());!isNaN(n)&&n>.25&&i.push({code:e.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,message:`Eccentricity ${n.toFixed(7)} is unusually high. This indicates a highly elliptical orbit.`,field:"eccentricity",value:n,severity:"warning"});const r=parseFloat(t.substring(52,63).trim());!isNaN(r)&&r<1&&i.push({code:e.ERROR_CODES.LOW_MEAN_MOTION_WARNING,message:`Mean motion ${r.toFixed(8)} rev/day is unusually low. This indicates a very high orbit.`,field:"meanMotion",value:r,severity:"warning"});const s=parseInt(t.substring(63,68).trim(),10);return!isNaN(s)&&s>9e4&&i.push({code:e.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,message:`Revolution number ${s} is approaching rollover limit (99999). Counter may reset soon.`,field:"revolutionNumber",value:s,severity:"warning"}),i}function _e(t){const i=[],n=t.substring(53,61).trim();"00000-0"!==n&&"00000+0"!==n&&"00000 0"!==n||i.push({code:e.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,message:"B* drag term is zero or near-zero, which is unusual for most satellites in LEO",field:"bStar",value:n,severity:"warning"});const r=parseFloat(t.substring(33,43).trim());!isNaN(r)&&r<0&&i.push({code:e.ERROR_CODES.NEGATIVE_DECAY_WARNING,message:`First derivative of mean motion is negative (${r}), indicating orbital decay`,field:"firstDerivative",value:r,severity:"warning"});const s=t.substring(62,63).trim();return"0"!==s&&""!==s&&i.push({code:e.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,message:`Ephemeris type '${s}' is non-standard (expected '0' for SGP4/SDP4)`,field:"ephemerisType",value:s,severity:"warning"}),i}function fe(t,i={}){if("string"!=typeof t)throw new TypeError("TLE data must be a string");if("object"!=typeof i||null===i||Array.isArray(i))throw new TypeError("Options must be an object");if(0===t.length)throw new le("TLE string cannot be empty",e.ERROR_CODES.EMPTY_INPUT,{inputLength:0});const{strictChecksums:n=!0,validateRanges:r=!0,mode:s="strict"}=i;if("strict"!==s&&"permissive"!==s)throw new TypeError('Mode must be either "strict" or "permissive"');const a=[],o=[],c=ue(t).trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0&&!e.startsWith("#"));if(c.length<2)return a.push({code:e.ERROR_CODES.INVALID_LINE_COUNT,message:"TLE must contain at least 2 lines",field:"line_count",expected:"2 or 3",actual:c.length,severity:"error"}),{isValid:!1,errors:a,warnings:o};if(c.length>3)return a.push({code:e.ERROR_CODES.INVALID_LINE_COUNT,message:`TLE must contain 2 or 3 lines (got ${c.length})`,field:"line_count",expected:"2 or 3",actual:c.length,severity:"error"}),{isValid:!1,errors:a,warnings:o};let l=0,u=1;if(3===c.length){l=1,u=2;const t=c[0];!t||"1"!==t[0]&&"2"!==t[0]||o.push({code:e.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,message:'Line 0 starts with "1" or "2", might be incorrectly formatted',field:"satellite_name",value:t,severity:"warning"}),t&&t.length>24&&o.push({code:e.ERROR_CODES.SATELLITE_NAME_TOO_LONG,message:"Satellite name (Line 0) should be 24 characters or less",field:"satellite_name",expected:24,actual:t.length,severity:"warning"})}const m=c[l],h=c[u];if(!m||!h)return a.push({code:e.ERROR_CODES.INVALID_LINE_COUNT,message:"Missing required TLE lines",severity:"error"}),{isValid:!1,errors:a,warnings:o};const E=de(m,1);if(!E.isValid)if("permissive"===s){const t=E.errors.filter(t=>t.code!==e.ERROR_CODES.CHECKSUM_MISMATCH&&t.code!==e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER),i=E.errors.filter(t=>t.code===e.ERROR_CODES.CHECKSUM_MISMATCH||t.code===e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER);if(a.push(...t),o.push(...i.map(e=>Object.assign(Object.assign({},e),{severity:"warning"}))),t.length>0)return{isValid:!1,errors:a,warnings:o}}else if(a.push(...E.errors),n)return{isValid:!1,errors:a,warnings:o};const d=de(h,2);if(!d.isValid)if("permissive"===s){const t=d.errors.filter(t=>t.code!==e.ERROR_CODES.CHECKSUM_MISMATCH&&t.code!==e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER),i=d.errors.filter(t=>t.code===e.ERROR_CODES.CHECKSUM_MISMATCH||t.code===e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER);if(a.push(...t),o.push(...i.map(e=>Object.assign(Object.assign({},e),{severity:"warning"}))),t.length>0)return{isValid:!1,errors:a,warnings:o}}else if(a.push(...d.errors),n)return{isValid:!1,errors:a,warnings:o};const R=Re(m,h);!R.isValid&&R.error&&("permissive"===s?o.push(Object.assign(Object.assign({},R.error),{severity:"warning"})):a.push(R.error));const N=Ne(m);if(!N.isValid&&N.error&&("permissive"===s?o.push(Object.assign(Object.assign({},N.error),{severity:"warning"})):a.push(N.error)),r&&69===m.length&&69===h.length){const e=[{value:m.substring(2,7).trim(),name:"Satellite Number",min:1,max:99999},{value:m.substring(9,11).trim(),name:"International Designator Year",min:0,max:99,optional:!0},{value:m.substring(11,14).trim(),name:"International Designator Launch Number",min:1,max:999,optional:!0},{value:m.substring(62,63).trim(),name:"Ephemeris Type",min:0,max:9,optional:!0},{value:m.substring(64,68).trim(),name:"Element Set Number",min:0,max:9999,optional:!0},{value:m.substring(18,20).trim(),name:"Epoch Year",min:0,max:99},{value:m.substring(20,32).trim(),name:"Epoch Day",min:1,max:366.99999999},{value:h.substring(8,16).trim(),name:"Inclination",min:0,max:180},{value:h.substring(17,25).trim(),name:"Right Ascension",min:0,max:360},{value:"0."+h.substring(26,33).trim(),name:"Eccentricity",min:0,max:1},{value:h.substring(34,42).trim(),name:"Argument of Perigee",min:0,max:360},{value:h.substring(43,51).trim(),name:"Mean Anomaly",min:0,max:360},{value:h.substring(52,63).trim(),name:"Mean Motion",min:0,max:20,warningOnly:!0},{value:h.substring(63,68).trim(),name:"Revolution Number",min:0,max:99999,optional:!0}];for(const{value:t,name:i,min:n,max:r,optional:c,warningOnly:l}of e){if(c&&0===t.length)continue;const e=pe(t,i,n,r);!e.isValid&&e.error&&(l||"permissive"===s?o.push(Object.assign(Object.assign({},e.error),{severity:"warning"})):a.push(e.error))}}return 69===m.length&&(o.push(...Ie(m)),o.push(...ge(m)),o.push(..._e(m))),69===h.length&&o.push(...Ae(h)),{isValid:0===a.length,errors:a,warnings:o}}function Oe(t,i={}){if("string"!=typeof t)throw new TypeError("TLE data must be a string");if("object"!=typeof i||null===i||Array.isArray(i))throw new TypeError("Options must be an object");const{validate:n=!0,strictChecksums:r=!0,validateRanges:s=!0,includeWarnings:a=!0,includeComments:o=!0,mode:c="strict"}=i;let l=[];if(n){const e=fe(t,{strictChecksums:r,validateRanges:s,mode:c});if(!e.isValid){const t="TLE validation failed:\n"+e.errors.map(e=>"string"==typeof e?e:e.message).join("\n");throw new ce(t,e.errors,e.warnings)}l=e.warnings}const u=ue(t).trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0),m=u.filter(e=>e.startsWith("#")),h=u.filter(e=>!e.startsWith("#"));let E=0,d=1,R=null;3===h.length&&(R=h[0]||null,E=1,d=2);const N=h[E],p=h[d];if(!N||!p)throw new le("Missing required TLE lines",e.ERROR_CODES.INVALID_LINE_COUNT);const I={satelliteName:R},g=["lineNumber2","satelliteNumber2","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion","revolutionNumber","checksum2"];for(const[e,t]of Object.entries(oe)){const[i,n]=t,r=g.includes(e)?p:N;I[e]=r.substring(i,n).trim()}return a&&l.length>0&&(I.warnings=l),o&&m.length>0&&(I.comments=m),I}var Se={parseTLE:Oe,validateTLE:fe,calculateChecksum:he,validateChecksum:Ee,validateLineStructure:de,validateSatelliteNumber:Re,validateClassification:Ne,validateNumericRange:pe,checkClassificationWarnings:Ie,checkEpochWarnings:ge,checkOrbitalParameterWarnings:Ae,checkDragAndEphemerisWarnings:_e,normalizeLineEndings:ue,parseTLELines:me,TLEValidationError:ce,TLEFormatError:le,ERROR_CODES:e.ERROR_CODES};e.Colors=J,e.DEFAULT_VALIDATION_RULES=q,e.DESIGNATOR_CONSTRAINTS=b,e.EPOCH_CONSTRAINTS=y,e.IncrementalParser=L,e.MiddlewareParser=O,e.ORBITAL_PARAMETER_RANGES=C,e.QUALITY_SCORE_WEIGHTS=M,e.SATELLITE_NUMBER_RANGES=D,e.TLECache=S,e.TLEFormatError=le,e.TLEParserStream=A,e.TLEStateMachineParser=h,e.TLEValidationError=ce,e.ValidationRuleManager=class{constructor(e=q){this.rules=new Map;for(const t of e)this.rules.set(t.name,t)}addRule(e){this.rules.set(e.name,e)}removeRule(e){return this.rules.delete(e)}enableRule(e){const t=this.rules.get(e);return!!t&&(t.enabled=!0,!0)}disableRule(e){const t=this.rules.get(e);return!!t&&(t.enabled=!1,!0)}getEnabledRules(){return Array.from(this.rules.values()).filter(e=>e.enabled)}getRule(e){return this.rules.get(e)}getAllRules(){return Array.from(this.rules.values())}},e.applyFilter=g,e.calculateChecksum=he,e.calculateEpochAge=P,e.calculateQualityScore=B,e.checkClassificationWarnings=Ie,e.checkDragAndEphemerisWarnings=_e,e.checkEpochWarnings=ge,e.checkOrbitalParameterWarnings=Ae,e.convertEpochToDate=x,e.createCachedParser=function(e={}){const t=new S(e);return{parse:(e,i={})=>{const n=t.get(e,i);if(n)return n;const r=Oe(e,i);return t.set(e,r,i),r},parseAsync:(e,...i)=>d(this,[e,...i],void 0,function*(e,i={}){const n=t.get(e,i);if(n)return n;const r=yield I(e,i);return t.set(e,r,i),r}),cache:t}},e.createIncrementalParser=function(e,t={}){return new L(e,t)},e.createMiddlewareParser=function(){return new O},e.createTLEParserStream=_,e.createValidationRule=function(e,t,i,n={}){return{name:e,description:t,severity:n.severity||"warning",enabled:!1!==n.enabled,validate:i,errorMessage:n.errorMessage}},e.default=Se,e.detectAnomalies=j,e.formatAsCSV=te,e.formatAsHuman=se,e.formatAsJSON=ee,e.formatAsXML=ne,e.formatAsYAML=re,e.formatTLE=function(e,t={}){const{format:i="json"}=t;switch(i){case"json":return ee(e,t);case"csv":return te(e,t);case"xml":return ne(e,t);case"yaml":return re(e,t);case"human":return Array.isArray(e)?e.map(e=>se(e,t)).join("\n\n"):se(e,t);case"tle":return Array.isArray(e)?e.map(e=>ae(e,{includeName:!0})).join("\n\n"):ae(e,{includeName:!0});default:throw new Error(`Unsupported output format: ${i}`)}},e.generateValidationReport=function(e,t,i={}){var n,r;const s=[],a=[],o=[],c=[],l=[];let u=0,m=0,h=0;if(!1!==i.validateChecksums){u+=2,l.push("checksum");const e=F(t.line1,1);e.valid?m++:(s.push({code:"CHECKSUM_MISMATCH",message:e.message||"Checksum validation failed",line:1,severity:"error",field:"checksum1"}),h++);const i=F(t.line2,2);i.valid?m++:(s.push({code:"CHECKSUM_MISMATCH",message:i.message||"Checksum validation failed",line:2,severity:"error",field:"checksum2"}),h++)}if(!1!==i.validateEpoch){u++,l.push("epochDate");const t=parseInt(e.epochYear,10),n=parseFloat(e.epoch),r=$(t,n);r.valid?m++:(s.push({code:"INVALID_EPOCH",message:r.message||"Invalid epoch date",severity:"error",field:"epoch"}),h++);const o=V(t,n,{referenceDate:i.referenceDate,allowFuture:i.allowFutureEpochs,maxAge:i.maxEpochAge});o.valid?o.message&&a.push({code:"STALE_EPOCH",message:o.message,severity:"warning",field:"epoch"}):s.push({code:"EPOCH_OUT_OF_RANGE",message:o.message||"Epoch age out of acceptable range",severity:"error",field:"epoch"})}const E={valid:[],invalid:[]};if(!1!==i.validateRanges){l.push("orbitalParameterRanges");const t=G(e,i.strict);u+=t.length;for(const e of t)e.valid?e.message?(a.push({code:"PARAMETER_OUTSIDE_TYPICAL",message:e.message,severity:"warning",field:null===(r=e.context)||void 0===r?void 0:r.field}),m++,E.valid.push(e)):(m++,E.valid.push(e)):(s.push({code:"PARAMETER_OUT_OF_RANGE",message:e.message||"Parameter out of valid range",severity:"error",field:null===(n=e.context)||void 0===n?void 0:n.field}),h++,E.invalid.push(e))}if(i.detectAnomalies&&(l.push("anomalyDetection"),o.push(...j(e))),i.sanitizeFields){l.push("fieldSanitization");const t=z(e);for(const[e]of t)c.push(e)}u++,l.push("satelliteNumber");const d=H(e.satelliteNumber1);d.valid?m++:(s.push({code:"INVALID_SATELLITE_NUMBER",message:d.message||"Invalid satellite number",severity:"error",field:"satelliteNumber"}),h++),e.satelliteNumber1!==e.satelliteNumber2&&a.push({code:"SATELLITE_NUMBER_MISMATCH",message:`Satellite numbers do not match: ${e.satelliteNumber1} vs ${e.satelliteNumber2}`,severity:"warning",field:"satelliteNumber"}),u++,l.push("internationalDesignator");const R=W(e.internationalDesignatorYear+e.internationalDesignatorLaunchNumber+e.internationalDesignatorPiece);let N;if(R.valid?m++:(a.push({code:"INVALID_DESIGNATOR",message:R.message||"Invalid international designator",severity:"warning",field:"internationalDesignator"}),h++),!1!==i.calculateQuality){const t=P(parseInt(e.epochYear,10),parseFloat(e.epoch),i.referenceDate);N=B(e,{checksumValid:0===s.filter(e=>"CHECKSUM_MISMATCH"===e.code).length,formatValid:0===s.filter(e=>{var t;return null===(t=e.code)||void 0===t?void 0:t.includes("FORMAT")}).length,rangeErrors:E.invalid,rangeResults:[...E.valid,...E.invalid],epochAge:t,anomalies:o})}else N={overall:0,components:{checksumScore:0,formatScore:0,rangeScore:0,epochScore:0,anomalyScore:0,consistencyScore:0},grade:"F",assessment:"Not calculated"};return{isValid:0===s.length,qualityScore:N,errors:s,warnings:a,anomalies:o,sanitizedFields:c,timestamp:new Date,rulesApplied:l,summary:{totalChecks:u,passedChecks:m,failedChecks:h,warningCount:a.length,errorCount:s.length}}},e.getErrorDescription=function(t){return{[e.ERROR_CODES.INVALID_INPUT_TYPE]:"Input data must be a string",[e.ERROR_CODES.EMPTY_INPUT]:"Input string is empty or contains only whitespace",[e.ERROR_CODES.INVALID_LINE_COUNT]:"TLE must contain exactly 2 or 3 lines",[e.ERROR_CODES.INVALID_LINE_LENGTH]:"TLE line must be exactly 69 characters",[e.ERROR_CODES.INVALID_LINE_NUMBER]:"Line number must be 1 or 2",[e.ERROR_CODES.CHECKSUM_MISMATCH]:"Calculated checksum does not match",[e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER]:"Checksum must be a digit 0-9",[e.ERROR_CODES.SATELLITE_NUMBER_MISMATCH]:"Satellite numbers on line 1 and line 2 must match",[e.ERROR_CODES.INVALID_SATELLITE_NUMBER]:"Satellite catalog number is invalid",[e.ERROR_CODES.INVALID_CLASSIFICATION]:"Classification must be U, C, or S",[e.ERROR_CODES.VALUE_OUT_OF_RANGE]:"Field value is outside valid range",[e.ERROR_CODES.INVALID_NUMBER_FORMAT]:"Field contains invalid numeric format",[e.ERROR_CODES.SATELLITE_NAME_TOO_LONG]:"Satellite name exceeds maximum length",[e.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING]:"Satellite name contains unusual characters",[e.ERROR_CODES.CLASSIFIED_DATA_WARNING]:"TLE contains classified satellite data",[e.ERROR_CODES.STALE_TLE_WARNING]:"TLE epoch is significantly old",[e.ERROR_CODES.HIGH_ECCENTRICITY_WARNING]:"Eccentricity is unusually high",[e.ERROR_CODES.LOW_MEAN_MOTION_WARNING]:"Mean motion is unusually low",[e.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING]:"Epoch year is in the far past",[e.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING]:"Revolution number may have rolled over",[e.ERROR_CODES.NEAR_ZERO_DRAG_WARNING]:"Drag coefficient is near zero",[e.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING]:"Ephemeris type is non-standard",[e.ERROR_CODES.NEGATIVE_DECAY_WARNING]:"Mean motion decay is negative"}[t]||"Unknown error code"},e.getProfileOptions=T,e.getProviderOptions=v,e.isCriticalError=function(e){return!a(e)},e.isParseFailure=function(e){return!1===e.success},e.isParseSuccess=function(e){return!0===e.success},e.isParsedTLE=function(e){return"object"==typeof e&&null!==e&&["lineNumber1","satelliteNumber1","classification","lineNumber2","satelliteNumber2","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion"].every(t=>t in e)},e.isTLEError=m,e.isTLEWarning=function(e){return m(e)&&"warning"===e.severity},e.isValidClassification=function(e){return"U"===e||"C"===e||"S"===e},e.isValidErrorCode=function(t){return Object.values(e.ERROR_CODES).includes(t)},e.isValidationFailure=function(e){return!1===e.success},e.isValidationSuccess=function(e){return!0===e.success},e.isWarningCode=a,e.normalizeAssumedDecimalNotation=w,e.normalizeLineEndings=ue,e.normalizeScientificNotation=function(e,t="standard"){return"assumedDecimal"===t?w(e):"integer"===t?parseInt(e.trim(),10):parseFloat(e.trim())},e.parseBatch=N,e.parseBatchAsync=function(e){return d(this,arguments,void 0,function*(e,t={}){return Promise.resolve(N(e,t))})},e.parseFromCompressed=function(e){return d(this,arguments,void 0,function*(e,i={}){const n=t.createReadStream(e),s=r.createGunzip();return f(n.pipe(s),i)})},e.parseFromFile=function(e){return d(this,arguments,void 0,function*(e,t={}){const{encoding:i="utf8"}=t,n=E(t,["encoding"]);return N(yield R(e,{encoding:i}),n)})},e.parseFromStream=f,e.parseFromURL=function(e){return d(this,arguments,void 0,function*(e,t={}){const{headers:i,timeout:n=3e4}=t,r=E(t,["headers","timeout"]),s=new AbortController,a=setTimeout(()=>s.abort(),n);try{const t=yield fetch(e,{headers:i,signal:s.signal});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return N(yield t.text(),r)}finally{clearTimeout(a)}})},e.parseParallel=function(e){return d(this,arguments,void 0,function*(e,t={},i){return N(e,t)})},e.parseTLE=Oe,e.parseTLEAsync=I,e.parseTLELines=me,e.parseWithProfile=function(e,t){return Oe(e,T(t))},e.parseWithProvider=function(e,t){return Oe(e,v(t))},e.parseWithStateMachine=function(e,t={}){return new h(t).parse(e)},e.reconstructTLE=ae,e.sanitizeAllFields=z,e.sanitizeField=K,e.splitTLEs=p,e.validateAllOrbitalParameters=G,e.validateChecksum=Ee,e.validateClassification=Ne,e.validateEpochAge=V,e.validateEpochDate=$,e.validateInternationalDesignator=W,e.validateLineStructure=de,e.validateNumericRange=pe,e.validateOrbitalParameter=U,e.validateSatelliteNumber=Re,e.validateTLE=fe,e.validateTLEAsync=function(e){return d(this,arguments,void 0,function*(e,t={}){return Promise.resolve(fe(e,t))})},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.min.js.map
