/**
 * tle-parser v1.0.0
 * A parser for TLE (Two-Line Element) satellite data.
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TLEParser={})}(this,function(e){"use strict";var t;function i(t){return[e.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,e.ERROR_CODES.CLASSIFIED_DATA_WARNING,e.ERROR_CODES.STALE_TLE_WARNING,e.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,e.ERROR_CODES.LOW_MEAN_MOTION_WARNING,e.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,e.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,e.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,e.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,e.ERROR_CODES.NEGATIVE_DECAY_WARNING].includes(t)}e.ERROR_CODES=void 0,(t=e.ERROR_CODES||(e.ERROR_CODES={})).INVALID_INPUT_TYPE="INVALID_INPUT_TYPE",t.EMPTY_INPUT="EMPTY_INPUT",t.INVALID_LINE_COUNT="INVALID_LINE_COUNT",t.INVALID_LINE_LENGTH="INVALID_LINE_LENGTH",t.INVALID_LINE_NUMBER="INVALID_LINE_NUMBER",t.CHECKSUM_MISMATCH="CHECKSUM_MISMATCH",t.INVALID_CHECKSUM_CHARACTER="INVALID_CHECKSUM_CHARACTER",t.SATELLITE_NUMBER_MISMATCH="SATELLITE_NUMBER_MISMATCH",t.INVALID_SATELLITE_NUMBER="INVALID_SATELLITE_NUMBER",t.INVALID_CLASSIFICATION="INVALID_CLASSIFICATION",t.VALUE_OUT_OF_RANGE="VALUE_OUT_OF_RANGE",t.INVALID_NUMBER_FORMAT="INVALID_NUMBER_FORMAT",t.SATELLITE_NAME_TOO_LONG="SATELLITE_NAME_TOO_LONG",t.SATELLITE_NAME_FORMAT_WARNING="SATELLITE_NAME_FORMAT_WARNING",t.CLASSIFIED_DATA_WARNING="CLASSIFIED_DATA_WARNING",t.STALE_TLE_WARNING="STALE_TLE_WARNING",t.HIGH_ECCENTRICITY_WARNING="HIGH_ECCENTRICITY_WARNING",t.LOW_MEAN_MOTION_WARNING="LOW_MEAN_MOTION_WARNING",t.DEPRECATED_EPOCH_YEAR_WARNING="DEPRECATED_EPOCH_YEAR_WARNING",t.REVOLUTION_NUMBER_ROLLOVER_WARNING="REVOLUTION_NUMBER_ROLLOVER_WARNING",t.NEAR_ZERO_DRAG_WARNING="NEAR_ZERO_DRAG_WARNING",t.NON_STANDARD_EPHEMERIS_WARNING="NON_STANDARD_EPHEMERIS_WARNING",t.NEGATIVE_DECAY_WARNING="NEGATIVE_DECAY_WARNING",e.ERROR_CODES.INVALID_INPUT_TYPE,e.ERROR_CODES.EMPTY_INPUT,e.ERROR_CODES.INVALID_LINE_COUNT,e.ERROR_CODES.INVALID_LINE_LENGTH,e.ERROR_CODES.INVALID_LINE_NUMBER,e.ERROR_CODES.CHECKSUM_MISMATCH,e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER,e.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,e.ERROR_CODES.INVALID_SATELLITE_NUMBER,e.ERROR_CODES.INVALID_CLASSIFICATION,e.ERROR_CODES.VALUE_OUT_OF_RANGE,e.ERROR_CODES.INVALID_NUMBER_FORMAT,e.ERROR_CODES.SATELLITE_NAME_TOO_LONG,e.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,e.ERROR_CODES.CLASSIFIED_DATA_WARNING,e.ERROR_CODES.STALE_TLE_WARNING,e.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,e.ERROR_CODES.LOW_MEAN_MOTION_WARNING,e.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,e.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,e.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,e.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,e.ERROR_CODES.NEGATIVE_DECAY_WARNING;var s,r,n,a;function E(e){return"object"==typeof e&&null!==e&&"code"in e&&"message"in e&&"severity"in e}e.TLEErrorCode=void 0,(s=e.TLEErrorCode||(e.TLEErrorCode={})).INVALID_LINE_COUNT="INVALID_LINE_COUNT",s.INVALID_LINE_LENGTH="INVALID_LINE_LENGTH",s.INVALID_LINE_NUMBER="INVALID_LINE_NUMBER",s.SATELLITE_NUMBER_MISMATCH="SATELLITE_NUMBER_MISMATCH",s.CHECKSUM_MISMATCH="CHECKSUM_MISMATCH",s.INVALID_CHECKSUM_CHARACTER="INVALID_CHECKSUM_CHARACTER",s.INVALID_CLASSIFICATION="INVALID_CLASSIFICATION",s.INVALID_SATELLITE_NUMBER="INVALID_SATELLITE_NUMBER",s.INVALID_INTL_DESIGNATOR_YEAR="INVALID_INTL_DESIGNATOR_YEAR",s.INVALID_INTL_DESIGNATOR_LAUNCH="INVALID_INTL_DESIGNATOR_LAUNCH",s.INVALID_EPOCH_YEAR="INVALID_EPOCH_YEAR",s.INVALID_EPOCH_DAY="INVALID_EPOCH_DAY",s.INVALID_EPHEMERIS_TYPE="INVALID_EPHEMERIS_TYPE",s.INVALID_ELEMENT_SET_NUMBER="INVALID_ELEMENT_SET_NUMBER",s.INVALID_INCLINATION="INVALID_INCLINATION",s.INVALID_RIGHT_ASCENSION="INVALID_RIGHT_ASCENSION",s.INVALID_ECCENTRICITY="INVALID_ECCENTRICITY",s.INVALID_ARG_OF_PERIGEE="INVALID_ARG_OF_PERIGEE",s.INVALID_MEAN_ANOMALY="INVALID_MEAN_ANOMALY",s.INVALID_MEAN_MOTION="INVALID_MEAN_MOTION",s.INVALID_REVOLUTION_NUMBER="INVALID_REVOLUTION_NUMBER",s.UNUSUAL_CLASSIFICATION="UNUSUAL_CLASSIFICATION",s.OLD_EPOCH="OLD_EPOCH",s.EXTREME_ECCENTRICITY="EXTREME_ECCENTRICITY",s.EXTREME_INCLINATION="EXTREME_INCLINATION",s.HIGH_MEAN_MOTION="HIGH_MEAN_MOTION",s.LOW_MEAN_MOTION="LOW_MEAN_MOTION",s.PARSE_ERROR="PARSE_ERROR",s.VALIDATION_ERROR="VALIDATION_ERROR",function(e){e.INITIAL="INITIAL",e.READING_NAME="READING_NAME",e.READING_LINE1="READING_LINE1",e.READING_LINE2="READING_LINE2",e.COMPLETE="COMPLETE",e.ERROR="ERROR",e.RECOVERING="RECOVERING"}(r||(r={})),function(e){e.CONTINUE="CONTINUE",e.SKIP_FIELD="SKIP_FIELD",e.USE_DEFAULT="USE_DEFAULT",e.ATTEMPT_FIX="ATTEMPT_FIX",e.ABORT="ABORT"}(n||(n={})),e.ParserState=void 0,function(e){e.INITIAL="INITIAL",e.DETECTING_FORMAT="DETECTING_FORMAT",e.PARSING_NAME="PARSING_NAME",e.PARSING_LINE1="PARSING_LINE1",e.PARSING_LINE2="PARSING_LINE2",e.VALIDATING="VALIDATING",e.COMPLETED="COMPLETED",e.ERROR="ERROR"}(e.ParserState||(e.ParserState={})),e.ErrorSeverity=void 0,(a=e.ErrorSeverity||(e.ErrorSeverity={})).WARNING="warning",a.ERROR="error",a.CRITICAL="critical",e.RecoveryAction=void 0,function(e){e.CONTINUE="CONTINUE",e.SKIP_FIELD="SKIP_FIELD",e.USE_DEFAULT="USE_DEFAULT",e.ATTEMPT_FIX="ATTEMPT_FIX",e.ABORT="ABORT"}(e.RecoveryAction||(e.RecoveryAction={}));class o{constructor(t={}){this.options=Object.assign({attemptRecovery:!0,maxRecoveryAttempts:10,includePartialResults:!0,strictMode:!1},t),this.state=e.ParserState.INITIAL,this.errors=[],this.warnings=[],this.recoveryActions=[],this.parsedData={},this.context={lineCount:0,hasName:!1,nameLineIndex:-1,line1Index:-1,line2Index:-1,lines:[],recoveryAttempts:0},this.reset()}reset(){this.state=e.ParserState.INITIAL,this.errors=[],this.warnings=[],this.recoveryActions=[],this.parsedData={},this.context={lineCount:0,hasName:!1,nameLineIndex:-1,line1Index:-1,line2Index:-1,lines:[],recoveryAttempts:0}}addIssue(t,i,s,r={}){const n=Object.assign({severity:t,code:i,message:s,state:this.state},r);return t===e.ErrorSeverity.WARNING?this.warnings.push(n):this.errors.push(n),n}recordRecovery(e,t,i={}){this.recoveryActions.push(Object.assign({action:e,description:t,state:this.state,timestamp:Date.now()},i)),this.context.recoveryAttempts++}transition(e,t=""){const i=this.state;return this.state=e,{from:i,to:e,reason:t}}parse(t){return this.reset(),"string"!=typeof t?(this.addIssue(e.ErrorSeverity.CRITICAL,e.ERROR_CODES.INVALID_INPUT_TYPE,"TLE data must be a string",{inputType:typeof t}),this.transition(e.ParserState.ERROR),this.getResult()):0===t.length?(this.addIssue(e.ErrorSeverity.CRITICAL,e.ERROR_CODES.EMPTY_INPUT,"TLE string cannot be empty",{inputLength:0}),this.transition(e.ParserState.ERROR),this.getResult()):(this.transition(e.ParserState.DETECTING_FORMAT,"Starting parse"),this.detectFormat(t),this.state===e.ParserState.DETECTING_FORMAT&&this.executeStateMachine(),this.getResult())}detectFormat(t){var i;const s=t.trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(this.context.lines=s,this.context.lineCount=s.length,s.length<2)return this.addIssue(e.ErrorSeverity.CRITICAL,e.ERROR_CODES.INVALID_LINE_COUNT,`TLE must contain at least 2 lines (found ${s.length})`,{expected:"2 or 3",actual:s.length}),this.options.attemptRecovery&&this.recordRecovery(e.RecoveryAction.ABORT,"Insufficient lines to parse TLE",{lineCount:s.length}),void this.transition(e.ParserState.ERROR);if(s.length>3){if(this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_LINE_COUNT,`TLE should contain 2 or 3 lines (found ${s.length})`,{expected:"2 or 3",actual:s.length}),this.options.attemptRecovery){this.recordRecovery(e.RecoveryAction.ATTEMPT_FIX,"Attempting to identify valid TLE lines from excess lines",{lineCount:s.length});const t=s.filter(e=>"1"===e[0]),i=s.filter(e=>"2"===e[0]);if(1===t.length&&1===i.length){const r=t[0],n=i[0];if(!r||!n)return;const a=s.indexOf(r),E=s.indexOf(n);if(a<E){a>0&&(this.context.hasName=!0,this.context.nameLineIndex=a-1),this.context.line1Index=a,this.context.line2Index=E;const t=s[this.context.nameLineIndex],i=s[a],r=s[E];this.context.lines=this.context.hasName&&t&&i&&r?[t,i,r]:i&&r?[i,r]:[],this.context.lineCount=this.context.lines.length,this.recordRecovery(e.RecoveryAction.CONTINUE,"Successfully identified TLE lines from excess input",{extractedLines:this.context.lineCount})}}}}else if(3===s.length){const t=null===(i=s[0])||void 0===i?void 0:i[0];"1"!==t&&"2"!==t||this.addIssue(e.ErrorSeverity.WARNING,e.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,'First line starts with "1" or "2", might be missing satellite name',{firstLine:s[0]}),this.context.hasName=!0,this.context.nameLineIndex=0,this.context.line1Index=1,this.context.line2Index=2}else this.context.hasName=!1,this.context.line1Index=0,this.context.line2Index=1}executeStateMachine(){let t=0;for(;this.state!==e.ParserState.COMPLETED&&this.state!==e.ParserState.ERROR&&t<100;){switch(this.state){case e.ParserState.DETECTING_FORMAT:this.context.hasName?this.transition(e.ParserState.PARSING_NAME):this.transition(e.ParserState.PARSING_LINE1);break;case e.ParserState.PARSING_NAME:this.parseSatelliteName(),this.transition(e.ParserState.PARSING_LINE1);break;case e.ParserState.PARSING_LINE1:this.parseLine1(),this.transition(e.ParserState.PARSING_LINE2);break;case e.ParserState.PARSING_LINE2:this.parseLine2(),this.transition(e.ParserState.VALIDATING);break;case e.ParserState.VALIDATING:this.validateCrossFields(),this.errors.some(t=>t.severity===e.ErrorSeverity.CRITICAL)&&!this.options.includePartialResults?this.transition(e.ParserState.ERROR):this.transition(e.ParserState.COMPLETED);break;default:this.transition(e.ParserState.ERROR,"Unexpected state")}t++}t>=100&&(this.addIssue(e.ErrorSeverity.CRITICAL,"STATE_MACHINE_LOOP","State machine exceeded maximum iterations",{iterations:t}),this.transition(e.ParserState.ERROR))}parseSatelliteName(){const t=this.context.nameLineIndex;if(t<0||t>=this.context.lines.length)return void this.addIssue(e.ErrorSeverity.ERROR,"INVALID_NAME_LINE_INDEX","Invalid satellite name line index",{index:t});const i=this.context.lines[t];i&&(this.parsedData.satelliteName=i,i.length>24&&this.addIssue(e.ErrorSeverity.WARNING,e.ERROR_CODES.SATELLITE_NAME_TOO_LONG,"Satellite name exceeds recommended 24 characters",{length:i.length,name:i}),"1"!==i[0]&&"2"!==i[0]||this.addIssue(e.ErrorSeverity.WARNING,e.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,'Satellite name starts with "1" or "2", might be incorrectly formatted',{name:i}))}parseLine1(){const t=this.context.line1Index;if(t<0||t>=this.context.lines.length)return void this.addIssue(e.ErrorSeverity.CRITICAL,"INVALID_LINE1_INDEX","Invalid Line 1 index",{index:t});const i=this.context.lines[t];if(!i)return;if(this.parsedData.line1Raw=i,69!==i.length)if(this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_LINE_LENGTH,`Line 1 must be exactly 69 characters (got ${i.length})`,{line:1,expected:69,actual:i.length}),this.options.attemptRecovery)this.recordRecovery(e.RecoveryAction.CONTINUE,"Attempting to parse Line 1 despite incorrect length",{length:i.length});else if(this.options.strictMode)return;this.parseFieldSafe("lineNumber1",i,0,1,"Line 1 number"),this.parseFieldSafe("satelliteNumber1",i,2,7,"Satellite number"),this.parseFieldSafe("classification",i,7,8,"Classification"),this.parseFieldSafe("internationalDesignatorYear",i,9,11,"Int. designator year"),this.parseFieldSafe("internationalDesignatorLaunchNumber",i,11,14,"Int. designator launch"),this.parseFieldSafe("internationalDesignatorPiece",i,14,17,"Int. designator piece"),this.parseFieldSafe("epochYear",i,18,20,"Epoch year"),this.parseFieldSafe("epoch",i,20,32,"Epoch"),this.parseFieldSafe("firstDerivative",i,33,43,"First derivative"),this.parseFieldSafe("secondDerivative",i,44,52,"Second derivative"),this.parseFieldSafe("bStar",i,53,61,"B* drag term"),this.parseFieldSafe("ephemerisType",i,62,63,"Ephemeris type"),this.parseFieldSafe("elementSetNumber",i,64,68,"Element set number"),this.parseFieldSafe("checksum1",i,68,69,"Checksum"),"1"!==this.parsedData.lineNumber1&&this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_LINE_NUMBER,`Line 1 must start with '1' (got '${this.parsedData.lineNumber1}')`,{line:1,expected:"1",actual:this.parsedData.lineNumber1});const s=["U","C","S"];if(this.parsedData.classification&&!s.includes(this.parsedData.classification)&&this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_CLASSIFICATION,`Classification must be U, C, or S (got '${this.parsedData.classification}')`,{expected:s,actual:this.parsedData.classification}),69===i.length){const t=this.calculateChecksum(i),s=parseInt(this.parsedData.checksum1||"",10);isNaN(s)||t===s||(this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.CHECKSUM_MISMATCH,`Line 1 checksum mismatch (expected ${t}, got ${s})`,{line:1,expected:t,actual:s}),this.options.attemptRecovery&&this.recordRecovery(e.RecoveryAction.CONTINUE,"Continuing despite checksum mismatch",{line:1}))}}parseLine2(){const t=this.context.line2Index;if(t<0||t>=this.context.lines.length)return void this.addIssue(e.ErrorSeverity.CRITICAL,"INVALID_LINE2_INDEX","Invalid Line 2 index",{index:t});const i=this.context.lines[t];if(i){if(this.parsedData.line2Raw=i,69!==i.length)if(this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_LINE_LENGTH,`Line 2 must be exactly 69 characters (got ${i.length})`,{line:2,expected:69,actual:i.length}),this.options.attemptRecovery)this.recordRecovery(e.RecoveryAction.CONTINUE,"Attempting to parse Line 2 despite incorrect length",{length:i.length});else if(this.options.strictMode)return;if(this.parseFieldSafe("lineNumber2",i,0,1,"Line 2 number"),this.parseFieldSafe("satelliteNumber2",i,2,7,"Satellite number"),this.parseFieldSafe("inclination",i,8,16,"Inclination"),this.parseFieldSafe("rightAscension",i,17,25,"Right ascension"),this.parseFieldSafe("eccentricity",i,26,33,"Eccentricity"),this.parseFieldSafe("argumentOfPerigee",i,34,42,"Argument of perigee"),this.parseFieldSafe("meanAnomaly",i,43,51,"Mean anomaly"),this.parseFieldSafe("meanMotion",i,52,63,"Mean motion"),this.parseFieldSafe("revolutionNumber",i,63,68,"Revolution number"),this.parseFieldSafe("checksum2",i,68,69,"Checksum"),"2"!==this.parsedData.lineNumber2&&this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_LINE_NUMBER,`Line 2 must start with '2' (got '${this.parsedData.lineNumber2}')`,{line:2,expected:"2",actual:this.parsedData.lineNumber2}),69===i.length){const t=this.calculateChecksum(i),s=parseInt(this.parsedData.checksum2||"",10);isNaN(s)||t===s||(this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.CHECKSUM_MISMATCH,`Line 2 checksum mismatch (expected ${t}, got ${s})`,{line:2,expected:t,actual:s}),this.options.attemptRecovery&&this.recordRecovery(e.RecoveryAction.CONTINUE,"Continuing despite checksum mismatch",{line:2}))}}}validateCrossFields(){if(this.parsedData.satelliteNumber1&&this.parsedData.satelliteNumber2){const t=this.parsedData.satelliteNumber1.trim(),i=this.parsedData.satelliteNumber2.trim();t!==i&&this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,`Satellite numbers must match (Line 1: ${t}, Line 2: ${i})`,{line1Value:t,line2Value:i})}if(this.validateNumericField("inclination",0,180,"Inclination"),this.validateNumericField("rightAscension",0,360,"Right Ascension"),this.validateNumericField("argumentOfPerigee",0,360,"Argument of Perigee"),this.validateNumericField("meanAnomaly",0,360,"Mean Anomaly"),this.parsedData.eccentricity){const t=parseFloat("0."+this.parsedData.eccentricity.trim());!isNaN(t)&&(t<0||t>1)&&this.addIssue(e.ErrorSeverity.ERROR,e.ERROR_CODES.VALUE_OUT_OF_RANGE,`Eccentricity must be between 0 and 1 (got ${t})`,{field:"eccentricity",value:t,min:0,max:1})}this.validateNumericField("meanMotion",0,20,"Mean Motion",!0),this.validateNumericField("epochYear",0,99,"Epoch Year")}validateNumericField(t,i,s,r,n=!1){const a=this.parsedData[t];if(!a||"string"!=typeof a)return;const E=parseFloat(a.trim());isNaN(E)?this.addIssue(n?e.ErrorSeverity.WARNING:e.ErrorSeverity.ERROR,e.ERROR_CODES.INVALID_NUMBER_FORMAT,`${r} must be numeric (got '${a}')`,{field:t,value:a}):(E<i||E>s)&&this.addIssue(n?e.ErrorSeverity.WARNING:e.ErrorSeverity.ERROR,e.ERROR_CODES.VALUE_OUT_OF_RANGE,`${r} must be between ${i} and ${s} (got ${E})`,{field:t,value:E,min:i,max:s})}parseFieldSafe(t,i,s,r,n){try{i.length>=r?this.parsedData[t]=i.substring(s,r).trim():i.length>s?(this.parsedData[t]=i.substring(s).trim(),this.addIssue(e.ErrorSeverity.WARNING,"PARTIAL_FIELD",`${n} is incomplete due to short line`,{field:t,expected:[s,r],actual:i.length}),this.options.attemptRecovery&&this.recordRecovery(e.RecoveryAction.USE_DEFAULT,`Using partial value for ${n}`,{field:t})):(this.parsedData[t]=null,this.addIssue(e.ErrorSeverity.WARNING,"MISSING_FIELD",`${n} is missing due to short line`,{field:t,expected:[s,r],actual:i.length}),this.options.attemptRecovery&&this.recordRecovery(e.RecoveryAction.USE_DEFAULT,`Using null for missing ${n}`,{field:t}))}catch(i){this.parsedData[t]=null;const s=i instanceof Error?i.message:String(i);this.addIssue(e.ErrorSeverity.ERROR,"FIELD_PARSE_ERROR",`Error parsing ${n}: ${s}`,{field:t,error:s})}}calculateChecksum(e){let t=0;for(let i=0;i<e.length-1;i++){const s=e[i];s&&s>="0"&&s<="9"?t+=parseInt(s,10):"-"===s&&(t+=1)}return t%10}getResult(){const t=this.errors.map(t=>Object.assign({code:t.code,message:t.message,severity:t.severity===e.ErrorSeverity.CRITICAL?"error":t.severity},Object.fromEntries(Object.entries(t).filter(([e])=>!["severity","code","message","state"].includes(e))))),i=this.warnings.map(e=>Object.assign({code:e.code,message:e.message,severity:"warning"},Object.fromEntries(Object.entries(e).filter(([e])=>!["severity","code","message","state"].includes(e)))));return{success:this.state===e.ParserState.COMPLETED,state:this.state,data:this.parsedData,errors:t,warnings:i,recoveryActions:this.recoveryActions.map(e=>e.action),partialData:this.options.includePartialResults?this.parsedData:void 0,context:{lineCount:this.context.lineCount,hasName:this.context.hasName,recoveryAttempts:this.context.recoveryAttempts}}}}const R={lineNumber1:[0,1],satelliteNumber1:[2,7],classification:[7,8],internationalDesignatorYear:[9,11],internationalDesignatorLaunchNumber:[11,14],internationalDesignatorPiece:[14,17],epochYear:[18,20],epoch:[20,32],firstDerivative:[33,43],secondDerivative:[44,52],bStar:[53,61],ephemerisType:[62,63],elementSetNumber:[64,68],checksum1:[68,69],lineNumber2:[0,1],satelliteNumber2:[2,7],inclination:[8,16],rightAscension:[17,25],eccentricity:[26,33],argumentOfPerigee:[34,42],meanAnomaly:[43,51],meanMotion:[52,63],revolutionNumber:[63,68],checksum2:[68,69]};class c extends Error{constructor(e,t,i=[]){super(e),this.name="TLEValidationError",this.errors=t,this.warnings=i,Error.captureStackTrace(this,this.constructor)}}class l extends Error{constructor(e,t,i={}){super(e),this.name="TLEFormatError",this.code=t,this.details=i,Error.captureStackTrace(this,this.constructor)}}function I(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}function N(e){return I(e).split("\n").map(e=>e.replace(/\t/g," ").trim()).filter(e=>e.length>0)}function _(e){let t=0;for(let i=0;i<e.length-1;i++){const s=e[i];s&&s>="0"&&s<="9"?t+=parseInt(s,10):"-"===s&&(t+=1)}return t%10}function A(t){if(69!==t.length)return{isValid:!1,expected:null,actual:null,error:{code:e.ERROR_CODES.INVALID_LINE_LENGTH,message:"Line length must be 69 characters",field:"line_length",expected:69,actual:t.length,severity:"error"}};const i=_(t),s=parseInt(t[68]||"",10);if(isNaN(s))return{isValid:!1,expected:i,actual:null,error:{code:e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER,message:"Checksum position must contain a digit",field:"checksum",position:68,value:t[68],severity:"error"}};const r=i===s;return{isValid:r,expected:i,actual:s,error:r?null:{code:e.ERROR_CODES.CHECKSUM_MISMATCH,message:`Checksum mismatch: expected ${i}, got ${s}`,field:"checksum",expected:i,actual:s,severity:"error"}}}function u(t,i){const s=[];if(69!==t.length)return s.push({code:e.ERROR_CODES.INVALID_LINE_LENGTH,message:`Line ${i} must be exactly 69 characters (got ${t.length})`,line:i,field:"line_length",expected:69,actual:t.length,severity:"error"}),{isValid:!1,errors:s};const r=t[0];r!==i.toString()&&s.push({code:e.ERROR_CODES.INVALID_LINE_NUMBER,message:`Line ${i} must start with '${i}' (got '${r}')`,line:i,field:"line_number",expected:i.toString(),actual:r,severity:"error"});const n=A(t);return!n.isValid&&n.error&&s.push(Object.assign(Object.assign({},n.error),{line:i,message:`Line ${i}: ${n.error.message}`})),{isValid:0===s.length,errors:s}}function O(t,i){const s=t.substring(2,7).trim(),r=i.substring(2,7).trim();return s!==r?{isValid:!1,error:{code:e.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,message:`Satellite numbers must match (Line 1: ${s}, Line 2: ${r})`,field:"satellite_number",line1Value:s,line2Value:r,severity:"error"}}:/^\d+$/.test(s)?{isValid:!0,error:null}:{isValid:!1,error:{code:e.ERROR_CODES.INVALID_SATELLITE_NUMBER,message:`Satellite number must be numeric (got '${s}')`,field:"satellite_number",value:s,severity:"error"}}}function h(t){const i=t[7],s=["U","C","S"];return s.includes(i||"")?{isValid:!0,error:null}:{isValid:!1,error:{code:e.ERROR_CODES.INVALID_CLASSIFICATION,message:`Classification must be U, C, or S (got '${i}')`,field:"classification",expected:s,actual:i,severity:"error"}}}function d(t,i,s,r){const n=parseFloat(t);return isNaN(n)?{isValid:!1,error:{code:e.ERROR_CODES.INVALID_NUMBER_FORMAT,message:`${i} must be numeric (got '${t}')`,field:i,value:t,severity:"error"}}:n<s||n>r?{isValid:!1,error:{code:e.ERROR_CODES.VALUE_OUT_OF_RANGE,message:`${i} must be between ${s} and ${r} (got ${n})`,field:i,value:n,min:s,max:r,severity:"error"}}:{isValid:!0,error:null}}function m(t){const i=[],s=t[7];return"C"!==s&&"S"!==s||i.push({code:e.ERROR_CODES.CLASSIFIED_DATA_WARNING,message:`Classification '${s}' is unusual in public TLE data (typically 'U' for unclassified)`,field:"classification",value:s,severity:"warning"}),i}function L(t){const i=[],s=parseInt(t.substring(18,20),10),r=parseFloat(t.substring(20,32));if(isNaN(s)||isNaN(r))return i;const n=s>=57?1900+s:2e3+s;n<2e3&&i.push({code:e.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,message:`Epoch year ${n} is in the deprecated 1900s range (two-digit year: ${s})`,field:"epochYear",value:s,fullYear:n,severity:"warning"});const a=new Date(n,0,1);a.setDate(a.getDate()+r-1);const E=((new Date).getTime()-a.getTime())/864e5;return E>30&&i.push({code:e.ERROR_CODES.STALE_TLE_WARNING,message:`TLE epoch is ${Math.floor(E)} days old (epoch: ${a.toISOString().split("T")[0]}). TLE data may be stale.`,field:"epoch",daysSinceEpoch:Math.floor(E),epochDate:a.toISOString().split("T")[0],severity:"warning"}),i}function S(t){const i=[],s=parseFloat("0."+t.substring(26,33).trim());!isNaN(s)&&s>.25&&i.push({code:e.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,message:`Eccentricity ${s.toFixed(7)} is unusually high. This indicates a highly elliptical orbit.`,field:"eccentricity",value:s,severity:"warning"});const r=parseFloat(t.substring(52,63).trim());!isNaN(r)&&r<1&&i.push({code:e.ERROR_CODES.LOW_MEAN_MOTION_WARNING,message:`Mean motion ${r.toFixed(8)} rev/day is unusually low. This indicates a very high orbit.`,field:"meanMotion",value:r,severity:"warning"});const n=parseInt(t.substring(63,68).trim(),10);return!isNaN(n)&&n>9e4&&i.push({code:e.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,message:`Revolution number ${n} is approaching rollover limit (99999). Counter may reset soon.`,field:"revolutionNumber",value:n,severity:"warning"}),i}function T(t){const i=[],s=t.substring(53,61).trim();"00000-0"!==s&&"00000+0"!==s&&"00000 0"!==s||i.push({code:e.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,message:"B* drag term is zero or near-zero, which is unusual for most satellites in LEO",field:"bStar",value:s,severity:"warning"});const r=parseFloat(t.substring(33,43).trim());!isNaN(r)&&r<0&&i.push({code:e.ERROR_CODES.NEGATIVE_DECAY_WARNING,message:`First derivative of mean motion is negative (${r}), indicating orbital decay`,field:"firstDerivative",value:r,severity:"warning"});const n=t.substring(62,63).trim();return"0"!==n&&""!==n&&i.push({code:e.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,message:`Ephemeris type '${n}' is non-standard (expected '0' for SGP4/SDP4)`,field:"ephemerisType",value:n,severity:"warning"}),i}function C(t,i={}){if("string"!=typeof t)throw new TypeError("TLE data must be a string");if("object"!=typeof i||null===i||Array.isArray(i))throw new TypeError("Options must be an object");if(0===t.length)throw new l("TLE string cannot be empty",e.ERROR_CODES.EMPTY_INPUT,{inputLength:0});const{strictChecksums:s=!0,validateRanges:r=!0,mode:n="strict"}=i;if("strict"!==n&&"permissive"!==n)throw new TypeError('Mode must be either "strict" or "permissive"');const a=[],E=[],o=I(t).trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0&&!e.startsWith("#"));if(o.length<2)return a.push({code:e.ERROR_CODES.INVALID_LINE_COUNT,message:"TLE must contain at least 2 lines",field:"line_count",expected:"2 or 3",actual:o.length,severity:"error"}),{isValid:!1,errors:a,warnings:E};if(o.length>3)return a.push({code:e.ERROR_CODES.INVALID_LINE_COUNT,message:`TLE must contain 2 or 3 lines (got ${o.length})`,field:"line_count",expected:"2 or 3",actual:o.length,severity:"error"}),{isValid:!1,errors:a,warnings:E};let R=0,c=1;if(3===o.length){R=1,c=2;const t=o[0];!t||"1"!==t[0]&&"2"!==t[0]||E.push({code:e.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,message:'Line 0 starts with "1" or "2", might be incorrectly formatted',field:"satellite_name",value:t,severity:"warning"}),t&&t.length>24&&E.push({code:e.ERROR_CODES.SATELLITE_NAME_TOO_LONG,message:"Satellite name (Line 0) should be 24 characters or less",field:"satellite_name",expected:24,actual:t.length,severity:"warning"})}const N=o[R],_=o[c];if(!N||!_)return a.push({code:e.ERROR_CODES.INVALID_LINE_COUNT,message:"Missing required TLE lines",severity:"error"}),{isValid:!1,errors:a,warnings:E};const A=u(N,1);if(!A.isValid)if("permissive"===n){const t=A.errors.filter(t=>t.code!==e.ERROR_CODES.CHECKSUM_MISMATCH&&t.code!==e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER),i=A.errors.filter(t=>t.code===e.ERROR_CODES.CHECKSUM_MISMATCH||t.code===e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER);if(a.push(...t),E.push(...i.map(e=>Object.assign(Object.assign({},e),{severity:"warning"}))),t.length>0)return{isValid:!1,errors:a,warnings:E}}else if(a.push(...A.errors),s)return{isValid:!1,errors:a,warnings:E};const C=u(_,2);if(!C.isValid)if("permissive"===n){const t=C.errors.filter(t=>t.code!==e.ERROR_CODES.CHECKSUM_MISMATCH&&t.code!==e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER),i=C.errors.filter(t=>t.code===e.ERROR_CODES.CHECKSUM_MISMATCH||t.code===e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER);if(a.push(...t),E.push(...i.map(e=>Object.assign(Object.assign({},e),{severity:"warning"}))),t.length>0)return{isValid:!1,errors:a,warnings:E}}else if(a.push(...C.errors),s)return{isValid:!1,errors:a,warnings:E};const D=O(N,_);!D.isValid&&D.error&&("permissive"===n?E.push(Object.assign(Object.assign({},D.error),{severity:"warning"})):a.push(D.error));const g=h(N);if(!g.isValid&&g.error&&("permissive"===n?E.push(Object.assign(Object.assign({},g.error),{severity:"warning"})):a.push(g.error)),r&&69===N.length&&69===_.length){const e=[{value:N.substring(2,7).trim(),name:"Satellite Number",min:1,max:99999},{value:N.substring(9,11).trim(),name:"International Designator Year",min:0,max:99,optional:!0},{value:N.substring(11,14).trim(),name:"International Designator Launch Number",min:1,max:999,optional:!0},{value:N.substring(62,63).trim(),name:"Ephemeris Type",min:0,max:9,optional:!0},{value:N.substring(64,68).trim(),name:"Element Set Number",min:0,max:9999,optional:!0},{value:N.substring(18,20).trim(),name:"Epoch Year",min:0,max:99},{value:N.substring(20,32).trim(),name:"Epoch Day",min:1,max:366.99999999},{value:_.substring(8,16).trim(),name:"Inclination",min:0,max:180},{value:_.substring(17,25).trim(),name:"Right Ascension",min:0,max:360},{value:"0."+_.substring(26,33).trim(),name:"Eccentricity",min:0,max:1},{value:_.substring(34,42).trim(),name:"Argument of Perigee",min:0,max:360},{value:_.substring(43,51).trim(),name:"Mean Anomaly",min:0,max:360},{value:_.substring(52,63).trim(),name:"Mean Motion",min:0,max:20,warningOnly:!0},{value:_.substring(63,68).trim(),name:"Revolution Number",min:0,max:99999,optional:!0}];for(const{value:t,name:i,min:s,max:r,optional:o,warningOnly:R}of e){if(o&&0===t.length)continue;const e=d(t,i,s,r);!e.isValid&&e.error&&(R||"permissive"===n?E.push(Object.assign(Object.assign({},e.error),{severity:"warning"})):a.push(e.error))}}return 69===N.length&&(E.push(...m(N)),E.push(...L(N)),E.push(...T(N))),69===_.length&&E.push(...S(_)),{isValid:0===a.length,errors:a,warnings:E}}function D(t,i={}){if("string"!=typeof t)throw new TypeError("TLE data must be a string");if("object"!=typeof i||null===i||Array.isArray(i))throw new TypeError("Options must be an object");const{validate:s=!0,strictChecksums:r=!0,validateRanges:n=!0,includeWarnings:a=!0,includeComments:E=!0,mode:o="strict"}=i;let N=[];if(s){const e=C(t,{strictChecksums:r,validateRanges:n,mode:o});if(!e.isValid){const t="TLE validation failed:\n"+e.errors.map(e=>"string"==typeof e?e:e.message).join("\n");throw new c(t,e.errors,e.warnings)}N=e.warnings}const _=I(t).trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0),A=_.filter(e=>e.startsWith("#")),u=_.filter(e=>!e.startsWith("#"));let O=0,h=1,d=null;3===u.length&&(d=u[0]||null,O=1,h=2);const m=u[O],L=u[h];if(!m||!L)throw new l("Missing required TLE lines",e.ERROR_CODES.INVALID_LINE_COUNT);const S={satelliteName:d},T=["lineNumber2","satelliteNumber2","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion","revolutionNumber","checksum2"];for(const[e,t]of Object.entries(R)){const[i,s]=t,r=T.includes(e)?L:m;S[e]=r.substring(i,s).trim()}return a&&N.length>0&&(S.warnings=N),E&&A.length>0&&(S.comments=A),S}var g={parseTLE:D,validateTLE:C,calculateChecksum:_,validateChecksum:A,validateLineStructure:u,validateSatelliteNumber:O,validateClassification:h,validateNumericRange:d,checkClassificationWarnings:m,checkEpochWarnings:L,checkOrbitalParameterWarnings:S,checkDragAndEphemerisWarnings:T,normalizeLineEndings:I,parseTLELines:N,TLEValidationError:c,TLEFormatError:l,ERROR_CODES:e.ERROR_CODES};e.TLEFormatError=l,e.TLEStateMachineParser=o,e.TLEValidationError=c,e.calculateChecksum=_,e.checkClassificationWarnings=m,e.checkDragAndEphemerisWarnings=T,e.checkEpochWarnings=L,e.checkOrbitalParameterWarnings=S,e.default=g,e.getErrorDescription=function(t){return{[e.ERROR_CODES.INVALID_INPUT_TYPE]:"Input data must be a string",[e.ERROR_CODES.EMPTY_INPUT]:"Input string is empty or contains only whitespace",[e.ERROR_CODES.INVALID_LINE_COUNT]:"TLE must contain exactly 2 or 3 lines",[e.ERROR_CODES.INVALID_LINE_LENGTH]:"TLE line must be exactly 69 characters",[e.ERROR_CODES.INVALID_LINE_NUMBER]:"Line number must be 1 or 2",[e.ERROR_CODES.CHECKSUM_MISMATCH]:"Calculated checksum does not match",[e.ERROR_CODES.INVALID_CHECKSUM_CHARACTER]:"Checksum must be a digit 0-9",[e.ERROR_CODES.SATELLITE_NUMBER_MISMATCH]:"Satellite numbers on line 1 and line 2 must match",[e.ERROR_CODES.INVALID_SATELLITE_NUMBER]:"Satellite catalog number is invalid",[e.ERROR_CODES.INVALID_CLASSIFICATION]:"Classification must be U, C, or S",[e.ERROR_CODES.VALUE_OUT_OF_RANGE]:"Field value is outside valid range",[e.ERROR_CODES.INVALID_NUMBER_FORMAT]:"Field contains invalid numeric format",[e.ERROR_CODES.SATELLITE_NAME_TOO_LONG]:"Satellite name exceeds maximum length",[e.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING]:"Satellite name contains unusual characters",[e.ERROR_CODES.CLASSIFIED_DATA_WARNING]:"TLE contains classified satellite data",[e.ERROR_CODES.STALE_TLE_WARNING]:"TLE epoch is significantly old",[e.ERROR_CODES.HIGH_ECCENTRICITY_WARNING]:"Eccentricity is unusually high",[e.ERROR_CODES.LOW_MEAN_MOTION_WARNING]:"Mean motion is unusually low",[e.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING]:"Epoch year is in the far past",[e.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING]:"Revolution number may have rolled over",[e.ERROR_CODES.NEAR_ZERO_DRAG_WARNING]:"Drag coefficient is near zero",[e.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING]:"Ephemeris type is non-standard",[e.ERROR_CODES.NEGATIVE_DECAY_WARNING]:"Mean motion decay is negative"}[t]||"Unknown error code"},e.isCriticalError=function(e){return!i(e)},e.isParseFailure=function(e){return!1===e.success},e.isParseSuccess=function(e){return!0===e.success},e.isParsedTLE=function(e){return"object"==typeof e&&null!==e&&["lineNumber1","satelliteNumber1","classification","lineNumber2","satelliteNumber2","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion"].every(t=>t in e)},e.isTLEError=E,e.isTLEWarning=function(e){return E(e)&&"warning"===e.severity},e.isValidClassification=function(e){return"U"===e||"C"===e||"S"===e},e.isValidErrorCode=function(t){return Object.values(e.ERROR_CODES).includes(t)},e.isValidationFailure=function(e){return!1===e.success},e.isValidationSuccess=function(e){return!0===e.success},e.isWarningCode=i,e.normalizeLineEndings=I,e.parseTLE=D,e.parseTLELines=N,e.parseWithStateMachine=function(e,t={}){return new o(t).parse(e)},e.validateChecksum=A,e.validateClassification=h,e.validateLineStructure=u,e.validateNumericRange=d,e.validateSatelliteNumber=O,e.validateTLE=C,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.min.js.map
