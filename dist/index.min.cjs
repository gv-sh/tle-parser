/**
 * tle-parser v1.0.0
 * A parser for TLE (Two-Line Element) satellite data.
 * @license MIT
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("fs/promises"),s=require("fs"),i=require("path"),r=require("os"),a=require("util"),n=require("stream"),o=require("zlib");function c(e){return[exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,exports.ERROR_CODES.CLASSIFIED_DATA_WARNING,exports.ERROR_CODES.STALE_TLE_WARNING,exports.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,exports.ERROR_CODES.LOW_MEAN_MOTION_WARNING,exports.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,exports.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,exports.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,exports.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,exports.ERROR_CODES.NEGATIVE_DECAY_WARNING].includes(e)}exports.ERROR_CODES=void 0,(e=exports.ERROR_CODES||(exports.ERROR_CODES={})).INVALID_INPUT_TYPE="INVALID_INPUT_TYPE",e.EMPTY_INPUT="EMPTY_INPUT",e.INVALID_LINE_COUNT="INVALID_LINE_COUNT",e.INVALID_LINE_LENGTH="INVALID_LINE_LENGTH",e.INVALID_LINE_NUMBER="INVALID_LINE_NUMBER",e.CHECKSUM_MISMATCH="CHECKSUM_MISMATCH",e.INVALID_CHECKSUM_CHARACTER="INVALID_CHECKSUM_CHARACTER",e.SATELLITE_NUMBER_MISMATCH="SATELLITE_NUMBER_MISMATCH",e.INVALID_SATELLITE_NUMBER="INVALID_SATELLITE_NUMBER",e.INVALID_CLASSIFICATION="INVALID_CLASSIFICATION",e.VALUE_OUT_OF_RANGE="VALUE_OUT_OF_RANGE",e.INVALID_NUMBER_FORMAT="INVALID_NUMBER_FORMAT",e.SATELLITE_NAME_TOO_LONG="SATELLITE_NAME_TOO_LONG",e.SATELLITE_NAME_FORMAT_WARNING="SATELLITE_NAME_FORMAT_WARNING",e.CLASSIFIED_DATA_WARNING="CLASSIFIED_DATA_WARNING",e.STALE_TLE_WARNING="STALE_TLE_WARNING",e.HIGH_ECCENTRICITY_WARNING="HIGH_ECCENTRICITY_WARNING",e.LOW_MEAN_MOTION_WARNING="LOW_MEAN_MOTION_WARNING",e.DEPRECATED_EPOCH_YEAR_WARNING="DEPRECATED_EPOCH_YEAR_WARNING",e.REVOLUTION_NUMBER_ROLLOVER_WARNING="REVOLUTION_NUMBER_ROLLOVER_WARNING",e.NEAR_ZERO_DRAG_WARNING="NEAR_ZERO_DRAG_WARNING",e.NON_STANDARD_EPHEMERIS_WARNING="NON_STANDARD_EPHEMERIS_WARNING",e.NEGATIVE_DECAY_WARNING="NEGATIVE_DECAY_WARNING",exports.ERROR_CODES.INVALID_INPUT_TYPE,exports.ERROR_CODES.EMPTY_INPUT,exports.ERROR_CODES.INVALID_LINE_COUNT,exports.ERROR_CODES.INVALID_LINE_LENGTH,exports.ERROR_CODES.INVALID_LINE_NUMBER,exports.ERROR_CODES.CHECKSUM_MISMATCH,exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER,exports.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,exports.ERROR_CODES.INVALID_SATELLITE_NUMBER,exports.ERROR_CODES.INVALID_CLASSIFICATION,exports.ERROR_CODES.VALUE_OUT_OF_RANGE,exports.ERROR_CODES.INVALID_NUMBER_FORMAT,exports.ERROR_CODES.SATELLITE_NAME_TOO_LONG,exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,exports.ERROR_CODES.CLASSIFIED_DATA_WARNING,exports.ERROR_CODES.STALE_TLE_WARNING,exports.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,exports.ERROR_CODES.LOW_MEAN_MOTION_WARNING,exports.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,exports.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,exports.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,exports.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,exports.ERROR_CODES.NEGATIVE_DECAY_WARNING;var l,h,u,m;function d(e){return"object"==typeof e&&null!==e&&"code"in e&&"message"in e&&"severity"in e}exports.TLEErrorCode=void 0,(l=exports.TLEErrorCode||(exports.TLEErrorCode={})).INVALID_LINE_COUNT="INVALID_LINE_COUNT",l.INVALID_LINE_LENGTH="INVALID_LINE_LENGTH",l.INVALID_LINE_NUMBER="INVALID_LINE_NUMBER",l.SATELLITE_NUMBER_MISMATCH="SATELLITE_NUMBER_MISMATCH",l.CHECKSUM_MISMATCH="CHECKSUM_MISMATCH",l.INVALID_CHECKSUM_CHARACTER="INVALID_CHECKSUM_CHARACTER",l.INVALID_CLASSIFICATION="INVALID_CLASSIFICATION",l.INVALID_SATELLITE_NUMBER="INVALID_SATELLITE_NUMBER",l.INVALID_INTL_DESIGNATOR_YEAR="INVALID_INTL_DESIGNATOR_YEAR",l.INVALID_INTL_DESIGNATOR_LAUNCH="INVALID_INTL_DESIGNATOR_LAUNCH",l.INVALID_EPOCH_YEAR="INVALID_EPOCH_YEAR",l.INVALID_EPOCH_DAY="INVALID_EPOCH_DAY",l.INVALID_EPHEMERIS_TYPE="INVALID_EPHEMERIS_TYPE",l.INVALID_ELEMENT_SET_NUMBER="INVALID_ELEMENT_SET_NUMBER",l.INVALID_INCLINATION="INVALID_INCLINATION",l.INVALID_RIGHT_ASCENSION="INVALID_RIGHT_ASCENSION",l.INVALID_ECCENTRICITY="INVALID_ECCENTRICITY",l.INVALID_ARG_OF_PERIGEE="INVALID_ARG_OF_PERIGEE",l.INVALID_MEAN_ANOMALY="INVALID_MEAN_ANOMALY",l.INVALID_MEAN_MOTION="INVALID_MEAN_MOTION",l.INVALID_REVOLUTION_NUMBER="INVALID_REVOLUTION_NUMBER",l.UNUSUAL_CLASSIFICATION="UNUSUAL_CLASSIFICATION",l.OLD_EPOCH="OLD_EPOCH",l.EXTREME_ECCENTRICITY="EXTREME_ECCENTRICITY",l.EXTREME_INCLINATION="EXTREME_INCLINATION",l.HIGH_MEAN_MOTION="HIGH_MEAN_MOTION",l.LOW_MEAN_MOTION="LOW_MEAN_MOTION",l.PARSE_ERROR="PARSE_ERROR",l.VALIDATION_ERROR="VALIDATION_ERROR",function(e){e.INITIAL="INITIAL",e.READING_NAME="READING_NAME",e.READING_LINE1="READING_LINE1",e.READING_LINE2="READING_LINE2",e.COMPLETE="COMPLETE",e.ERROR="ERROR",e.RECOVERING="RECOVERING"}(h||(h={})),function(e){e.CONTINUE="CONTINUE",e.SKIP_FIELD="SKIP_FIELD",e.USE_DEFAULT="USE_DEFAULT",e.ATTEMPT_FIX="ATTEMPT_FIX",e.ABORT="ABORT"}(u||(u={})),exports.ParserState=void 0,function(e){e.INITIAL="INITIAL",e.DETECTING_FORMAT="DETECTING_FORMAT",e.PARSING_NAME="PARSING_NAME",e.PARSING_LINE1="PARSING_LINE1",e.PARSING_LINE2="PARSING_LINE2",e.VALIDATING="VALIDATING",e.COMPLETED="COMPLETED",e.ERROR="ERROR"}(exports.ParserState||(exports.ParserState={})),exports.ErrorSeverity=void 0,(m=exports.ErrorSeverity||(exports.ErrorSeverity={})).WARNING="warning",m.ERROR="error",m.CRITICAL="critical",exports.RecoveryAction=void 0,function(e){e.CONTINUE="CONTINUE",e.SKIP_FIELD="SKIP_FIELD",e.USE_DEFAULT="USE_DEFAULT",e.ATTEMPT_FIX="ATTEMPT_FIX",e.ABORT="ABORT"}(exports.RecoveryAction||(exports.RecoveryAction={}));class p{constructor(e={}){this.options={attemptRecovery:!0,maxRecoveryAttempts:10,includePartialResults:!0,strictMode:!1,...e},this.state=exports.ParserState.INITIAL,this.errors=[],this.warnings=[],this.recoveryActions=[],this.parsedData={},this.context={lineCount:0,hasName:!1,nameLineIndex:-1,line1Index:-1,line2Index:-1,lines:[],recoveryAttempts:0},this.reset()}reset(){this.state=exports.ParserState.INITIAL,this.errors=[],this.warnings=[],this.recoveryActions=[],this.parsedData={},this.context={lineCount:0,hasName:!1,nameLineIndex:-1,line1Index:-1,line2Index:-1,lines:[],recoveryAttempts:0}}addIssue(e,t,s,i={}){const r={severity:e,code:t,message:s,state:this.state,...i};return e===exports.ErrorSeverity.WARNING?this.warnings.push(r):this.errors.push(r),r}recordRecovery(e,t,s={}){this.recoveryActions.push({action:e,description:t,state:this.state,timestamp:Date.now(),...s}),this.context.recoveryAttempts++}transition(e,t=""){const s=this.state;return this.state=e,{from:s,to:e,reason:t}}parse(e){return this.reset(),"string"!=typeof e?(this.addIssue(exports.ErrorSeverity.CRITICAL,exports.ERROR_CODES.INVALID_INPUT_TYPE,"TLE data must be a string",{inputType:typeof e}),this.transition(exports.ParserState.ERROR),this.getResult()):0===e.length?(this.addIssue(exports.ErrorSeverity.CRITICAL,exports.ERROR_CODES.EMPTY_INPUT,"TLE string cannot be empty",{inputLength:0}),this.transition(exports.ParserState.ERROR),this.getResult()):(this.transition(exports.ParserState.DETECTING_FORMAT,"Starting parse"),this.detectFormat(e),this.state===exports.ParserState.DETECTING_FORMAT&&this.executeStateMachine(),this.getResult())}detectFormat(e){const t=e.trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(this.context.lines=t,this.context.lineCount=t.length,t.length<2)return this.addIssue(exports.ErrorSeverity.CRITICAL,exports.ERROR_CODES.INVALID_LINE_COUNT,`TLE must contain at least 2 lines (found ${t.length})`,{expected:"2 or 3",actual:t.length}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.ABORT,"Insufficient lines to parse TLE",{lineCount:t.length}),void this.transition(exports.ParserState.ERROR);if(t.length>3){if(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_COUNT,`TLE should contain 2 or 3 lines (found ${t.length})`,{expected:"2 or 3",actual:t.length}),this.options.attemptRecovery){this.recordRecovery(exports.RecoveryAction.ATTEMPT_FIX,"Attempting to identify valid TLE lines from excess lines",{lineCount:t.length});const e=t.filter(e=>"1"===e[0]),s=t.filter(e=>"2"===e[0]);if(1===e.length&&1===s.length){const i=e[0],r=s[0];if(!i||!r)return;const a=t.indexOf(i),n=t.indexOf(r);if(a<n){a>0&&(this.context.hasName=!0,this.context.nameLineIndex=a-1),this.context.line1Index=a,this.context.line2Index=n;const e=t[this.context.nameLineIndex],s=t[a],i=t[n];this.context.lines=this.context.hasName&&e&&s&&i?[e,s,i]:s&&i?[s,i]:[],this.context.lineCount=this.context.lines.length,this.recordRecovery(exports.RecoveryAction.CONTINUE,"Successfully identified TLE lines from excess input",{extractedLines:this.context.lineCount})}}}}else if(3===t.length){const e=t[0]?.[0];"1"!==e&&"2"!==e||this.addIssue(exports.ErrorSeverity.WARNING,exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,'First line starts with "1" or "2", might be missing satellite name',{firstLine:t[0]}),this.context.hasName=!0,this.context.nameLineIndex=0,this.context.line1Index=1,this.context.line2Index=2}else this.context.hasName=!1,this.context.line1Index=0,this.context.line2Index=1}executeStateMachine(){let e=0;for(;this.state!==exports.ParserState.COMPLETED&&this.state!==exports.ParserState.ERROR&&e<100;){switch(this.state){case exports.ParserState.DETECTING_FORMAT:this.context.hasName?this.transition(exports.ParserState.PARSING_NAME):this.transition(exports.ParserState.PARSING_LINE1);break;case exports.ParserState.PARSING_NAME:this.parseSatelliteName(),this.transition(exports.ParserState.PARSING_LINE1);break;case exports.ParserState.PARSING_LINE1:this.parseLine1(),this.transition(exports.ParserState.PARSING_LINE2);break;case exports.ParserState.PARSING_LINE2:this.parseLine2(),this.transition(exports.ParserState.VALIDATING);break;case exports.ParserState.VALIDATING:this.validateCrossFields(),this.errors.some(e=>e.severity===exports.ErrorSeverity.CRITICAL)&&!this.options.includePartialResults?this.transition(exports.ParserState.ERROR):this.transition(exports.ParserState.COMPLETED);break;default:this.transition(exports.ParserState.ERROR,"Unexpected state")}e++}e>=100&&(this.addIssue(exports.ErrorSeverity.CRITICAL,"STATE_MACHINE_LOOP","State machine exceeded maximum iterations",{iterations:e}),this.transition(exports.ParserState.ERROR))}parseSatelliteName(){const e=this.context.nameLineIndex;if(e<0||e>=this.context.lines.length)return void this.addIssue(exports.ErrorSeverity.ERROR,"INVALID_NAME_LINE_INDEX","Invalid satellite name line index",{index:e});const t=this.context.lines[e];t&&(this.parsedData.satelliteName=t,t.length>24&&this.addIssue(exports.ErrorSeverity.WARNING,exports.ERROR_CODES.SATELLITE_NAME_TOO_LONG,"Satellite name exceeds recommended 24 characters",{length:t.length,name:t}),"1"!==t[0]&&"2"!==t[0]||this.addIssue(exports.ErrorSeverity.WARNING,exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,'Satellite name starts with "1" or "2", might be incorrectly formatted',{name:t}))}parseLine1(){const e=this.context.line1Index;if(e<0||e>=this.context.lines.length)return void this.addIssue(exports.ErrorSeverity.CRITICAL,"INVALID_LINE1_INDEX","Invalid Line 1 index",{index:e});const t=this.context.lines[e];if(!t)return;if(this.parsedData.line1Raw=t,69!==t.length)if(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_LENGTH,`Line 1 must be exactly 69 characters (got ${t.length})`,{line:1,expected:69,actual:t.length}),this.options.attemptRecovery)this.recordRecovery(exports.RecoveryAction.CONTINUE,"Attempting to parse Line 1 despite incorrect length",{length:t.length});else if(this.options.strictMode)return;this.parseFieldSafe("lineNumber1",t,0,1,"Line 1 number"),this.parseFieldSafe("satelliteNumber1",t,2,7,"Satellite number"),this.parseFieldSafe("classification",t,7,8,"Classification"),this.parseFieldSafe("internationalDesignatorYear",t,9,11,"Int. designator year"),this.parseFieldSafe("internationalDesignatorLaunchNumber",t,11,14,"Int. designator launch"),this.parseFieldSafe("internationalDesignatorPiece",t,14,17,"Int. designator piece"),this.parseFieldSafe("epochYear",t,18,20,"Epoch year"),this.parseFieldSafe("epoch",t,20,32,"Epoch"),this.parseFieldSafe("firstDerivative",t,33,43,"First derivative"),this.parseFieldSafe("secondDerivative",t,44,52,"Second derivative"),this.parseFieldSafe("bStar",t,53,61,"B* drag term"),this.parseFieldSafe("ephemerisType",t,62,63,"Ephemeris type"),this.parseFieldSafe("elementSetNumber",t,64,68,"Element set number"),this.parseFieldSafe("checksum1",t,68,69,"Checksum"),"1"!==this.parsedData.lineNumber1&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_NUMBER,`Line 1 must start with '1' (got '${this.parsedData.lineNumber1}')`,{line:1,expected:"1",actual:this.parsedData.lineNumber1});const s=["U","C","S"];if(this.parsedData.classification&&!s.includes(this.parsedData.classification)&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_CLASSIFICATION,`Classification must be U, C, or S (got '${this.parsedData.classification}')`,{expected:s,actual:this.parsedData.classification}),69===t.length){const e=this.calculateChecksum(t),s=parseInt(this.parsedData.checksum1||"",10);isNaN(s)||e===s||(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.CHECKSUM_MISMATCH,`Line 1 checksum mismatch (expected ${e}, got ${s})`,{line:1,expected:e,actual:s}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.CONTINUE,"Continuing despite checksum mismatch",{line:1}))}}parseLine2(){const e=this.context.line2Index;if(e<0||e>=this.context.lines.length)return void this.addIssue(exports.ErrorSeverity.CRITICAL,"INVALID_LINE2_INDEX","Invalid Line 2 index",{index:e});const t=this.context.lines[e];if(t){if(this.parsedData.line2Raw=t,69!==t.length)if(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_LENGTH,`Line 2 must be exactly 69 characters (got ${t.length})`,{line:2,expected:69,actual:t.length}),this.options.attemptRecovery)this.recordRecovery(exports.RecoveryAction.CONTINUE,"Attempting to parse Line 2 despite incorrect length",{length:t.length});else if(this.options.strictMode)return;if(this.parseFieldSafe("lineNumber2",t,0,1,"Line 2 number"),this.parseFieldSafe("satelliteNumber2",t,2,7,"Satellite number"),this.parseFieldSafe("inclination",t,8,16,"Inclination"),this.parseFieldSafe("rightAscension",t,17,25,"Right ascension"),this.parseFieldSafe("eccentricity",t,26,33,"Eccentricity"),this.parseFieldSafe("argumentOfPerigee",t,34,42,"Argument of perigee"),this.parseFieldSafe("meanAnomaly",t,43,51,"Mean anomaly"),this.parseFieldSafe("meanMotion",t,52,63,"Mean motion"),this.parseFieldSafe("revolutionNumber",t,63,68,"Revolution number"),this.parseFieldSafe("checksum2",t,68,69,"Checksum"),"2"!==this.parsedData.lineNumber2&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_NUMBER,`Line 2 must start with '2' (got '${this.parsedData.lineNumber2}')`,{line:2,expected:"2",actual:this.parsedData.lineNumber2}),69===t.length){const e=this.calculateChecksum(t),s=parseInt(this.parsedData.checksum2||"",10);isNaN(s)||e===s||(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.CHECKSUM_MISMATCH,`Line 2 checksum mismatch (expected ${e}, got ${s})`,{line:2,expected:e,actual:s}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.CONTINUE,"Continuing despite checksum mismatch",{line:2}))}}}validateCrossFields(){if(this.parsedData.satelliteNumber1&&this.parsedData.satelliteNumber2){const e=this.parsedData.satelliteNumber1.trim(),t=this.parsedData.satelliteNumber2.trim();e!==t&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,`Satellite numbers must match (Line 1: ${e}, Line 2: ${t})`,{line1Value:e,line2Value:t})}if(this.validateNumericField("inclination",0,180,"Inclination"),this.validateNumericField("rightAscension",0,360,"Right Ascension"),this.validateNumericField("argumentOfPerigee",0,360,"Argument of Perigee"),this.validateNumericField("meanAnomaly",0,360,"Mean Anomaly"),this.parsedData.eccentricity){const e=parseFloat("0."+this.parsedData.eccentricity.trim());!isNaN(e)&&(e<0||e>1)&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.VALUE_OUT_OF_RANGE,`Eccentricity must be between 0 and 1 (got ${e})`,{field:"eccentricity",value:e,min:0,max:1})}this.validateNumericField("meanMotion",0,20,"Mean Motion",!0),this.validateNumericField("epochYear",0,99,"Epoch Year")}validateNumericField(e,t,s,i,r=!1){const a=this.parsedData[e];if(!a||"string"!=typeof a)return;const n=parseFloat(a.trim());isNaN(n)?this.addIssue(r?exports.ErrorSeverity.WARNING:exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_NUMBER_FORMAT,`${i} must be numeric (got '${a}')`,{field:e,value:a}):(n<t||n>s)&&this.addIssue(r?exports.ErrorSeverity.WARNING:exports.ErrorSeverity.ERROR,exports.ERROR_CODES.VALUE_OUT_OF_RANGE,`${i} must be between ${t} and ${s} (got ${n})`,{field:e,value:n,min:t,max:s})}parseFieldSafe(e,t,s,i,r){try{t.length>=i?this.parsedData[e]=t.substring(s,i).trim():t.length>s?(this.parsedData[e]=t.substring(s).trim(),this.addIssue(exports.ErrorSeverity.WARNING,"PARTIAL_FIELD",`${r} is incomplete due to short line`,{field:e,expected:[s,i],actual:t.length}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.USE_DEFAULT,`Using partial value for ${r}`,{field:e})):(this.parsedData[e]=null,this.addIssue(exports.ErrorSeverity.WARNING,"MISSING_FIELD",`${r} is missing due to short line`,{field:e,expected:[s,i],actual:t.length}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.USE_DEFAULT,`Using null for missing ${r}`,{field:e}))}catch(t){this.parsedData[e]=null;const s=t instanceof Error?t.message:String(t);this.addIssue(exports.ErrorSeverity.ERROR,"FIELD_PARSE_ERROR",`Error parsing ${r}: ${s}`,{field:e,error:s})}}calculateChecksum(e){let t=0;for(let s=0;s<e.length-1;s++){const i=e[s];i&&i>="0"&&i<="9"?t+=parseInt(i,10):"-"===i&&(t+=1)}return t%10}getResult(){const e=this.errors.map(e=>({code:e.code,message:e.message,severity:e.severity===exports.ErrorSeverity.CRITICAL?"error":e.severity,...Object.fromEntries(Object.entries(e).filter(([e])=>!["severity","code","message","state"].includes(e)))})),t=this.warnings.map(e=>({code:e.code,message:e.message,severity:"warning",...Object.fromEntries(Object.entries(e).filter(([e])=>!["severity","code","message","state"].includes(e)))}));return{success:this.state===exports.ParserState.COMPLETED,state:this.state,data:this.parsedData,errors:e,warnings:t,recoveryActions:this.recoveryActions.map(e=>e.action),partialData:this.options.includePartialResults?this.parsedData:void 0,context:{lineCount:this.context.lineCount,hasName:this.context.hasName,recoveryAttempts:this.context.recoveryAttempts}}}}const g=a.promisify(s.readFile);function E(e,t={}){const{filter:s,continueOnError:i=!1,limit:r,skip:a=0,onTLE:n,onError:o,...c}=t,l=[],h=f(e);let u=0;for(let e=0;e<h.length;e++){if(e<a)continue;if(void 0!==r&&u>=r)break;const t=h[e];if(t)try{const i=dt(t,c);if(s&&!N(i,s))continue;l.push(i),u++,n&&n(i,e)}catch(s){if(o&&o(s,e,t),!i)throw s}}return l}function f(e){const t=et(e).split("\n").map(e=>e.trim()).filter(e=>e.length>0),s=[];let i=[];for(const e of t)e.startsWith("#")?i.length>0&&i.push(e):"1"===e[0]?(i.length>=2&&s.push(i.join("\n")),i=[e]):"2"===e[0]?i.push(e):i.length>=2?(s.push(i.join("\n")),i=[e]):0===i.length?i=[e]:i.push(e);return i.length>=2&&s.push(i.join("\n")),s}async function R(e,t={}){return Promise.resolve(dt(e,t))}function N(e,t){if(void 0!==t.satelliteNumber){const s=e.satelliteNumber1||"";if("function"==typeof t.satelliteNumber){if(!t.satelliteNumber(s))return!1}else if(Array.isArray(t.satelliteNumber)){if(!t.satelliteNumber.includes(s))return!1}else if(s!==t.satelliteNumber)return!1}if(void 0!==t.satelliteName&&e.satelliteName){const s=e.satelliteName;if("function"==typeof t.satelliteName){if(!t.satelliteName(s))return!1}else if(Array.isArray(t.satelliteName)){if(!t.satelliteName.some(e=>s.includes(e)))return!1}else if(!s.includes(t.satelliteName))return!1}if(void 0!==t.intlDesignator){const s=`${e.internationalDesignatorYear||""}${e.internationalDesignatorLaunchNumber||""}${e.internationalDesignatorPiece||""}`.trim();if("function"==typeof t.intlDesignator){if(!t.intlDesignator(s))return!1}else if(Array.isArray(t.intlDesignator)){if(!t.intlDesignator.includes(s))return!1}else if(s!==t.intlDesignator)return!1}if(void 0!==t.classification){const s=e.classification;if(Array.isArray(t.classification)){if(!t.classification.includes(s))return!1}else if(s!==t.classification)return!1}if(t.epochRange){const s=parseInt(e.epochYear||"0",10),i=e.epoch||"0",r=parseFloat(i),a=new Date(s>=57?1900+s:2e3+s,0,1);if(a.setDate(a.getDate()+r-1),t.epochRange.start&&a<t.epochRange.start)return!1;if(t.epochRange.end&&a>t.epochRange.end)return!1}if(t.inclinationRange){const s=parseFloat(e.inclination||"0");if(void 0!==t.inclinationRange.min&&s<t.inclinationRange.min)return!1;if(void 0!==t.inclinationRange.max&&s>t.inclinationRange.max)return!1}return!(t.custom&&!t.custom(e))}class x extends n.Transform{constructor(e={}){super({objectMode:!0,highWaterMark:e.highWaterMark||16}),this.buffer="",this.index=0,this.options=e}_transform(e,t,s){this.buffer+=e.toString();const i=this.buffer.split("\n");this.buffer=i.pop()||"";let r=[];for(const e of i){const t=e.trim();0!==t.length&&(t.startsWith("#")?r.push(t):"1"===t[0]?(r.length>=2&&this.processTLE(r.join("\n")),r=[t]):"2"===t[0]?(r.push(t),r.length>=2&&(this.processTLE(r.join("\n")),r=[])):(r.length>=2&&this.processTLE(r.join("\n")),r=[t]))}s()}_flush(e){if(this.buffer.trim().length>0){const e=this.buffer.split("\n").filter(e=>e.trim().length>0);e.length>=2&&this.processTLE(e.join("\n"))}e()}processTLE(e){const{continueOnError:t=!0,filter:s,onTLE:i,onError:r,...a}=this.options;try{const t=dt(e,a);if(s&&!N(t,s))return;this.push(t),i&&i(t,this.index),this.index++}catch(s){r&&r(s,this.index,e),t||this.destroy(s),this.index++}}}function I(e={}){return new x(e)}async function A(e,t={}){return new Promise((s,i)=>{const r=[],a=I({...t,onTLE:(e,s)=>{r.push(e),t.onTLE&&t.onTLE(e,s)}});e.pipe(a).on("data",()=>{}).on("end",()=>s(r)).on("error",i)})}class T{constructor(){this.middlewares=[],this.plugins=[]}use(e){return this.middlewares.push(e),this}plugin(e){return this.plugins.push(e),e.middleware&&this.use(e.middleware),this}async parse(e,t={}){const s={rawTLE:e,options:t,metadata:{}},i=async e=>{if(e>=this.middlewares.length)return dt(s.rawTLE,s.options);const t=this.middlewares[e];return t?t(s,()=>i(e+1)):dt(s.rawTLE,s.options)};return i(0)}async parseBatch(e,t={}){for(const e of this.plugins)e.onBatchStart&&await e.onBatchStart(t);const s=[],i=f(e);for(let e=0;e<i.length;e++){const r=i[e];if(r)try{const i=await this.parse(r,t);if(t.filter&&!N(i,t.filter))continue;s.push(i);for(const t of this.plugins)t.onTLEParsed&&await t.onTLEParsed(i,e);t.onTLE&&t.onTLE(i,e)}catch(s){for(const t of this.plugins)t.onError&&await t.onError(s,e);if(t.onError&&t.onError(s,e,r),!t.continueOnError)throw s}}for(const e of this.plugins)e.onBatchEnd&&await e.onBatchEnd(s);return s}}class S{constructor(e={}){this.cache=new Map,this.maxSize=e.maxSize||1e3,this.ttl=e.ttl||36e5,this.keyGenerator=e.keyGenerator||this.defaultKeyGenerator}defaultKeyGenerator(e,t){return`${e}:${JSON.stringify(t)}`}get(e,t={}){const s=this.keyGenerator(e,t),i=this.cache.get(s);return i?Date.now()-i.timestamp>this.ttl?(this.cache.delete(s),null):(this.cache.delete(s),this.cache.set(s,i),i.tle):null}set(e,t,s={}){const i=this.keyGenerator(e,s);if(this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;e&&this.cache.delete(e)}this.cache.set(i,{tle:t,timestamp:Date.now()})}clear(){this.cache.clear()}size(){return this.cache.size}}function _(e){return{strict:{validate:!0,strictChecksums:!0,validateRanges:!0,mode:"strict",includeWarnings:!0,includeComments:!0},permissive:{validate:!0,strictChecksums:!1,validateRanges:!1,mode:"permissive",includeWarnings:!0,includeComments:!0},fast:{validate:!1,includeWarnings:!1,includeComments:!1},realtime:{validate:!0,strictChecksums:!1,validateRanges:!1,mode:"permissive",includeWarnings:!1,includeComments:!1},batch:{validate:!0,strictChecksums:!0,validateRanges:!0,mode:"strict",includeWarnings:!1,includeComments:!1},recovery:{validate:!1,includeWarnings:!0,includeComments:!0},legacy:{validate:!0,strictChecksums:!1,validateRanges:!1,mode:"permissive",includeWarnings:!0,includeComments:!0}}[e]}class y{constructor(e,t={}){this.buffer="",this.currentSet=[],this.onTLE=e,this.options=t}push(e){this.buffer+=e,this.processBuffer()}flush(){this.currentSet.length>=2&&(this.emitTLE(this.currentSet.join("\n")),this.currentSet=[])}processBuffer(){const e=this.buffer.split("\n");this.buffer=e.pop()||"";for(const t of e){const e=t.trim();0!==e.length&&(e.startsWith("#")?this.currentSet.push(e):"1"===e[0]?(this.currentSet.length>=2&&this.emitTLE(this.currentSet.join("\n")),this.currentSet=[e]):"2"===e[0]?(this.currentSet.push(e),this.currentSet.length>=2&&(this.emitTLE(this.currentSet.join("\n")),this.currentSet=[])):(this.currentSet.length>=2&&this.emitTLE(this.currentSet.join("\n")),this.currentSet=[e]))}}emitTLE(e){try{const t=dt(e,this.options);this.onTLE(t)}catch(e){}}}function O(e){return{celestrak:{validate:!0,strictChecksums:!0,validateRanges:!0,mode:"strict",includeWarnings:!0,includeComments:!0},spacetrack:{validate:!0,strictChecksums:!0,validateRanges:!0,mode:"strict",includeWarnings:!0,includeComments:!0},amsat:{validate:!0,strictChecksums:!1,validateRanges:!1,mode:"permissive",includeWarnings:!0,includeComments:!0},custom:{validate:!1,includeWarnings:!0,includeComments:!0}}[e]}const L={meanMotion:{min:0,max:20,typical:{min:10,max:17}},eccentricity:{min:0,max:.999999,typical:{min:0,max:.25}},inclination:{min:0,max:180,typical:{min:0,max:100}},rightAscension:{min:0,max:360},argumentOfPerigee:{min:0,max:360},meanAnomaly:{min:0,max:360},bStar:{min:-1,max:1,typical:{min:-.001,max:.001}},meanMotionFirstDerivative:{min:-1,max:1,typical:{min:-.001,max:.001}},meanMotionSecondDerivative:{min:-1,max:1,typical:{min:-1e-5,max:1e-5}},revolutionNumber:{min:0,max:99999},elementSetNumber:{min:0,max:999},ephemerisType:{min:0,max:9}},v={min:1,max:999999,historical5Digit:99999,modern6Digit:999999},C={minYear:57,maxYear:99,minDayOfYear:1,maxDayOfYear:366.99999999,warningAgeThreshold:7,criticalAgeThreshold:30,maxFutureDays:30},M={yearMin:57,yearMax:99,launchNumberMin:1,launchNumberMax:999,piecePattern:/^[A-Z]{1,3}$/},D={checksumValid:20,fieldFormatValid:15,parametersInRange:15,parametersInTypicalRange:10,epochRecent:15,noAnomalies:10,designatorValid:5,consistencyChecks:10};function b(e,t){let s;s=e>=57?1900+e:2e3+e;const i=new Date(Date.UTC(s,0,1)).getTime()+864e5*(t-1),r=new Date(i),a=Math.floor((14-(r.getUTCMonth()+1))/12),n=s+4800-a,o=r.getUTCMonth()+1+12*a-3,c=r.getUTCDate()+Math.floor((153*o+2)/5)+365*n+Math.floor(n/4)-Math.floor(n/100)+Math.floor(n/400)-32045+(r.getUTCHours()+r.getUTCMinutes()/60+r.getUTCSeconds()/3600)/24,l=c-2400000.5;return{year:s,twoDigitYear:e,dayOfYear:t,isoDate:r.toISOString(),date:r,julianDate:c,modifiedJulianDate:l}}function w(e,t){const s=[];if((e<C.minYear||e>C.maxYear)&&s.push(`Epoch year ${e} outside valid range [${C.minYear}, ${C.maxYear}]`),(t<C.minDayOfYear||t>C.maxDayOfYear)&&s.push(`Epoch day ${t} outside valid range [${C.minDayOfYear}, ${C.maxDayOfYear}]`),s.length>0)return{valid:!1,message:s.join("; "),context:{epochYear:e,epochDay:t}};const i=b(e,t),r=i.year,a=r%4==0&&r%100!=0||r%400==0,n=a?366:365;return Math.floor(t)>n&&s.push(`Day ${Math.floor(t)} exceeds maximum for ${r} (${a?"leap year":"non-leap year"}: ${n} days)`),s.length>0?{valid:!1,message:s.join("; "),context:{epochYear:e,epochDay:t,fullYear:r,isLeapYear:a}}:{valid:!0,context:{epochDate:i}}}function P(e,t,s=new Date){const i=b(e,t);return(s.getTime()-i.date.getTime())/864e5}function U(e,t,s={}){const i=P(e,t,s.referenceDate||new Date),r=[];if(i<0){const e=Math.abs(i);if(!s.allowFuture)return{valid:!1,message:`Epoch is ${e.toFixed(2)} days in the future`,context:{age:i,futureDays:e}};e>C.maxFutureDays&&r.push(`Epoch is ${e.toFixed(2)} days in the future (threshold: ${C.maxFutureDays} days)`)}if(i>0){const e=s.maxAge||C.criticalAgeThreshold;i>e&&r.push(`Epoch is ${i.toFixed(2)} days old (threshold: ${e} days)`)}return{valid:!0,message:r.length>0?r.join("; "):void 0,context:{age:i}}}function $(e,t,s=!1){const i=L[e];if(!i)return{valid:!1,message:`Unknown parameter: ${e}`};if(t<i.min||t>i.max)return{valid:!1,message:`${e} value ${t} outside valid range [${i.min}, ${i.max}]`,context:{paramName:e,value:t,min:i.min,max:i.max}};if(s&&"typical"in i&&i.typical){const s=i.typical;if(t<s.min||t>s.max)return{valid:!0,message:`${e} value ${t} outside typical range [${s.min}, ${s.max}]`,context:{paramName:e,value:t,typicalMin:s.min,typicalMax:s.max,outsideTypical:!0}}}return{valid:!0,context:{paramName:e,value:t}}}function F(e,t=!1){const s=[],i={meanMotion:{field:"meanMotion",param:"meanMotion"},eccentricity:{field:"eccentricity",param:"eccentricity"},inclination:{field:"inclination",param:"inclination"},rightAscension:{field:"rightAscension",param:"rightAscension"},argumentOfPerigee:{field:"argumentOfPerigee",param:"argumentOfPerigee"},meanAnomaly:{field:"meanAnomaly",param:"meanAnomaly"},bStar:{field:"bStar",param:"bStar"},firstDerivative:{field:"firstDerivative",param:"meanMotionFirstDerivative"},secondDerivative:{field:"secondDerivative",param:"meanMotionSecondDerivative"},revolutionNumber:{field:"revolutionNumber",param:"revolutionNumber"},elementSetNumber:{field:"elementSetNumber",param:"elementSetNumber"},ephemerisType:{field:"ephemerisType",param:"ephemerisType"}};for(const[r,a]of Object.entries(i)){const i=parseFloat(e[a.field]);if(isNaN(i)){s.push({valid:!1,message:`Field ${r} is not a valid number`,context:{field:r,value:e[a.field]}});continue}const n=$(a.param,i,t);n.valid&&!n.message||s.push({...n,context:{...n.context,field:r}})}return s}function V(e,t){if(e.length<69)return{valid:!1,message:`Line ${t} is too short (${e.length} chars, expected 69)`,context:{lineNumber:t,length:e.length}};const s=e.charAt(68),i=parseInt(s,10),r=function(e){let t=0;const s=e.substring(0,68);for(const e of s)e>="0"&&e<="9"?t+=parseInt(e,10):"-"===e&&(t+=1);return t%10}(e);return isNaN(i)?{valid:!1,message:`Line ${t} checksum is not a digit: '${s}'`,context:{lineNumber:t,checksumChar:s}}:r!==i?{valid:!1,message:`Line ${t} checksum mismatch: expected ${i}, calculated ${r}`,context:{lineNumber:t,expected:i,calculated:r,line:e.substring(0,68)}}:{valid:!0,context:{lineNumber:t,checksum:r}}}function G(e){const t="-"===(e=e.trim())[0]?-1:1,s=e.replace(/^[-+\s]+/,"").replace(/\s+/g,""),i=s.match(/([+-])(\d+)$/);if(!i)return t*parseFloat("0."+s);const r=s.substring(0,s.length-i[0].length),a="-"===(i[1]||"+")?-1:1,n=parseInt(i[2]||"0",10);return t*parseFloat("0."+r)*Math.pow(10,a*n)}function k(e){const t="string"==typeof e?parseInt(e.trim(),10):e;return isNaN(t)?{valid:!1,message:`Satellite number is not a valid integer: '${e}'`,context:{satelliteNumber:e}}:t<v.min||t>v.max?{valid:!1,message:`Satellite number ${t} outside valid range [${v.min}, ${v.max}]`,context:{satelliteNumber:t,min:v.min,max:v.max}}:{valid:!0,context:{satelliteNumber:t,format:t<=v.historical5Digit?"5-digit":"6-digit"}}}function z(e){const t=e.trim(),s=t.match(/^(\d{2})(\d{1,3})([A-Z]{1,3})$/);if(!s)return{valid:!1,message:`Invalid international designator format: '${e}' (expected YYLLLPPP)`,context:{designator:t}};const i=s[1]||"0",r=s[2]||"0",a=s[3]||"",n=parseInt(i,10),o=parseInt(r,10);return n<M.yearMin||n>M.yearMax?{valid:!1,message:`International designator year ${n} outside valid range [${M.yearMin}, ${M.yearMax}]`,context:{designator:t,year:n}}:o<M.launchNumberMin||o>M.launchNumberMax?{valid:!1,message:`International designator launch number ${o} outside valid range [${M.launchNumberMin}, ${M.launchNumberMax}]`,context:{designator:t,launchNumber:o}}:M.piecePattern.test(a)?{valid:!0,context:{designator:t,year:n,launchNumber:o,piece:a,fullYear:n>=M.yearMin?1900+n:2e3+n}}:{valid:!1,message:`International designator piece '${a}' invalid (must be 1-3 uppercase letters)`,context:{designator:t,piece:a}}}const H=.01,W=.01;function Y(e){const t=[],s=parseFloat(e.eccentricity),i=parseFloat(e.meanMotion),r=parseFloat(e.inclination),a=G(e.bStar),n=parseFloat(e.firstDerivative),o=parseInt(e.revolutionNumber,10);return s>.5&&t.push({hasAnomaly:!0,type:"HIGH_ECCENTRICITY",description:`Unusually high eccentricity: ${s.toFixed(6)} (threshold: 0.5)`,severity:s>.9?"error":"warning",score:Math.min(s/.5,1)}),i<1&&t.push({hasAnomaly:!0,type:"LOW_MEAN_MOTION",description:`Unusually low mean motion: ${i.toFixed(8)} rev/day (threshold: 1)`,severity:"warning",score:1-i/1}),i>18&&t.push({hasAnomaly:!0,type:"HIGH_MEAN_MOTION",description:`Unusually high mean motion: ${i.toFixed(8)} rev/day (threshold: 18)`,severity:"warning",score:Math.min(i/18,1)}),r>90&&r<180&&t.push({hasAnomaly:!0,type:"RETROGRADE_ORBIT",description:`Retrograde orbit detected: inclination ${r.toFixed(4)}Â° (>90Â°)`,severity:"info",score:(r-90)/90}),Math.abs(a)>H&&t.push({hasAnomaly:!0,type:"HIGH_DRAG",description:`Unusually high drag coefficient: B* = ${a.toExponential(4)} (threshold: 0.01)`,severity:"warning",score:Math.min(Math.abs(a)/H,1)}),Math.abs(n)>W&&t.push({hasAnomaly:!0,type:"RAPID_ORBITAL_CHANGE",description:`Rapid orbital evolution: dn/dt = ${n.toFixed(8)} (threshold: 0.01)`,severity:"warning",score:Math.min(Math.abs(n)/W,1)}),o<100&&t.push({hasAnomaly:!0,type:"NEW_SATELLITE",description:`Recently launched satellite: revolution number ${o}`,severity:"info",score:1-o/100}),0===s&&t.push({hasAnomaly:!0,type:"CIRCULAR_ORBIT",description:"Perfect circular orbit (eccentricity = 0)",severity:"info",score:.1}),t}function j(e,t){let s=0;const i={checksumScore:0,formatScore:0,rangeScore:0,epochScore:0,anomalyScore:0,consistencyScore:0};t.checksumValid&&(i.checksumScore=D.checksumValid),t.formatValid&&(i.formatScore=D.fieldFormatValid);const r=t.rangeErrors.filter(e=>!e.valid),a=t.rangeResults.filter(e=>e.valid&&e.message);if(0===r.length)i.rangeScore=D.parametersInRange,0===a.length&&(i.rangeScore+=D.parametersInTypicalRange);else{const e=r.length+a.length,t=a.length;i.rangeScore=t/e*D.parametersInRange}const n=Math.abs(t.epochAge);i.epochScore=n<=1?D.epochRecent:n<=C.warningAgeThreshold?.9*D.epochRecent:n<=C.criticalAgeThreshold?.5*D.epochRecent:.2*D.epochRecent;const o={error:1,warning:.5,info:.1},c=t.anomalies.reduce((e,t)=>{const s=o[t.severity||"info"];return e+(t.score||.5)*s},0);i.anomalyScore=Math.max(0,D.noAnomalies-2*c);let l,h,u=D.consistencyChecks;return e.satelliteNumber1!==e.satelliteNumber2&&(u-=5),["U","C","S"].includes(e.classification)||(u-=2),z(e.internationalDesignatorYear+e.internationalDesignatorLaunchNumber+e.internationalDesignatorPiece).valid||(u-=3),i.consistencyScore=Math.max(0,u),s=Object.values(i).reduce((e,t)=>e+t,0),l=s>=90?"A":s>=80?"B":s>=70?"C":s>=60?"D":"F",h="A"===l?"Excellent quality - TLE is fresh, valid, and anomaly-free":"B"===l?"Good quality - TLE is valid with minor warnings":"C"===l?"Acceptable quality - TLE has some issues but is usable":"D"===l?"Poor quality - TLE has significant issues, use with caution":"Invalid - TLE has critical errors and should not be used",{overall:Math.round(s),components:i,grade:l,assessment:h}}function B(e,t){let s=e;const i=[];s.includes("\0")&&(s=s.replace(/\0/g,""),i.push("Removed null bytes")),s.includes("\t")&&(s=s.replace(/\t/g," "),i.push("Normalized tabs to spaces"));const r=/[\x00-\x1F\x7F-\x9F]/g;switch(r.test(s)&&(s=s.replace(r,""),i.push("Removed non-printable characters")),t){case"satelliteName":/^[A-Z0-9\s\-\(\)]+$/i.test(s)||(s=s.replace(/[^A-Z0-9\s\-\(\)]/gi,""),i.push("Removed invalid characters from satellite name"));break;case"classification":s=s.trim().toUpperCase(),s.length>1&&(s=s.charAt(0),i.push("Truncated classification to single character"));break;case"internationalDesignatorYear":case"internationalDesignatorLaunchNumber":case"satelliteNumber1":case"satelliteNumber2":case"elementSetNumber":case"revolutionNumber":/^\d+$/.test(s.trim())||(s=s.replace(/\D/g,""),i.push(`Removed non-numeric characters from ${t}`));break;case"internationalDesignatorPiece":{const e=s;s=s.trim().toUpperCase().replace(/[^A-Z]/g,""),s!==e.trim()&&i.push("Normalized designator piece to uppercase letters");break}}const a=s.trim();return a!==s&&(s=a,i.push("Trimmed whitespace")),{value:s,modified:i.length>0,modifications:i.length>0?i:void 0}}function q(e){const t=new Map;for(const[s,i]of Object.entries(e))if("string"==typeof i){const e=B(i,s);e.modified&&t.set(s,e)}return t}const K=[{name:"checksum",description:"Validate line checksums",severity:"error",enabled:!0,validate:()=>({valid:!0})},{name:"satelliteNumberRange",description:"Validate satellite number is in valid range",severity:"error",enabled:!0,validate:e=>k(e)},{name:"epochDate",description:"Validate epoch date format and range",severity:"error",enabled:!0,validate:e=>w(parseInt(e.epochYear,10),parseFloat(e.epoch))},{name:"epochAge",description:"Warn if epoch is stale or in future",severity:"warning",enabled:!0,validate:(e,t)=>U(parseInt(e.epochYear,10),parseFloat(e.epoch),{referenceDate:t?.referenceDate})},{name:"internationalDesignator",description:"Validate international designator format",severity:"warning",enabled:!0,validate:e=>z(e.internationalDesignatorYear+e.internationalDesignatorLaunchNumber+e.internationalDesignatorPiece)},{name:"orbitalParameterRanges",description:"Validate orbital parameters are in valid ranges",severity:"error",enabled:!0,validate:e=>{const t=F(e,!1).filter(e=>!e.valid);return t.length>0?{valid:!1,message:t.map(e=>e.message).join("; "),context:{errors:t}}:{valid:!0}}},{name:"anomalyDetection",description:"Detect unusual orbital parameters",severity:"warning",enabled:!1,validate:e=>{const t=Y(e);return t.length>0?{valid:!0,message:`${t.length} anomalies detected`,context:{anomalies:t}}:{valid:!0}}}];function Z(e){return e.satelliteNumber1||e.satelliteNumber2||""}function X(e){return`${e.internationalDesignatorYear||""}${e.internationalDesignatorLaunchNumber||""}${e.internationalDesignatorPiece||""}`.trim()}const J={reset:"[0m",bright:"[1m",dim:"[2m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",bgBlack:"[40m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m"};function Q(e,t,s=!0){return s?`${t}${e}${J.reset}`:e}function ee(e,t={}){const{pretty:s=!1,includeWarnings:i=!0,includeComments:r=!0,verbosity:a="normal"}=t,n=e=>{const t={...e};return!i&&"warnings"in t&&delete t.warnings,!r&&"comments"in t&&delete t.comments,"compact"===a?{satelliteName:t.satelliteName,satelliteNumber:Z(t),epoch:t.epochYear+":"+t.epoch,inclination:t.inclination,eccentricity:t.eccentricity,meanMotion:t.meanMotion}:t},o=Array.isArray(e)?e.map(n):n(e);return JSON.stringify(o,null,s?2:0)}function te(e,t={}){const{includeHeader:s=!0,delimiter:i=",",quote:r=!0,verbosity:a="normal"}=t,n=Array.isArray(e)?e:[e],o=[],c=Object.keys(n[0]||{}).filter(e=>!["warnings","comments","checksum1","checksum2","lineNumber1","lineNumber2"].includes(e)),l="compact"===a?["satelliteName","satelliteNumber1","epochYear","epoch","inclination","eccentricity","meanMotion"]:"verbose"===a?c:["satelliteName","satelliteNumber1","classification","epochYear","epoch","firstDerivative","secondDerivative","bStar","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion","revolutionNumber"];s&&o.push(l.map(e=>r?`"${e}"`:e).join(i));for(const e of n){const t=l.map(t=>{const s=e[t]??"",i=String(s);return r?`"${i.replace(/"/g,'""')}"`:i});o.push(t.join(i))}return o.join("\n")}function se(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function ie(e,t={}){const{pretty:s=!1,includeWarnings:i=!0,includeComments:r=!0}=t,a=s?"  ":"",n=s?"\n":"",o=Array.isArray(e)?e:[e],c=['<?xml version="1.0" encoding="UTF-8"?>'];c.push(`<tles>${n}`);for(const e of o){c.push(`${a}<tle>${n}`);for(const[t,s]of Object.entries(e))if(("warnings"!==t||i)&&("comments"!==t||r))if(Array.isArray(s)){c.push(`${a}${a}<${t}>${n}`);for(const e of s){const t="object"==typeof e?JSON.stringify(e):String(e);c.push(`${a}${a}${a}<item>${se(t)}</item>${n}`)}c.push(`${a}${a}</${t}>${n}`)}else{const e=se(String(s??""));c.push(`${a}${a}<${t}>${e}</${t}>${n}`)}c.push(`${a}</tle>${n}`)}return c.push("</tles>"),c.join("")}function re(e,t={}){const{includeWarnings:s=!0,includeComments:i=!0}=t,r=Array.isArray(e)?e:[e],a=[],n=(e,t=0)=>{const s="  ".repeat(t);return null==e?"null":"string"==typeof e?/[:#\[\]{},&*!|>'"%@`]/.test(e)||/^\s|\s$/.test(e)?`"${e.replace(/"/g,'\\"')}"`:e:"number"==typeof e||"boolean"==typeof e?String(e):Array.isArray(e)?0===e.length?"[]":"\n"+e.map(e=>{if("object"==typeof e&&null!==e){const i=o(e,t+1);return`${s}  -${i.substring(s.length+3)}`}return`${s}  - ${n(e,0)}`}).join("\n"):"object"==typeof e?"\n"+o(e,t+1):String(e)},o=(e,t=0)=>{const r="  ".repeat(t),a=[];for(const[o,c]of Object.entries(e)){if("warnings"===o&&!s)continue;if("comments"===o&&!i)continue;const e=n(c,t);e.startsWith("\n")?a.push(`${r}${o}:${e}`):a.push(`${r}${o}: ${e}`)}return a.join("\n")};if(1===r.length)return o(r[0],0);a.push("tles:");for(const e of r){a.push("  -");const t=o(e,2);a.push(t)}return a.join("\n")}function ae(e,t={}){const{colors:s=!1,verbosity:i="normal",includeWarnings:r=!0}=t,a=[];if(a.push(Q("â•".repeat(70),J.cyan,s)),a.push(Q(`  ${e.satelliteName||"Unknown Satellite"}`,J.bright+J.cyan,s)),a.push(Q("â•".repeat(70),J.cyan,s)),a.push(""),a.push(Q("Basic Information:",J.bright+J.yellow,s)),a.push(`  ${Q("Satellite Number:",J.green,s)} ${Z(e)}`),a.push(`  ${Q("Classification:",J.green,s)} ${e.classification||"N/A"}`),a.push(`  ${Q("International Designator:",J.green,s)} ${X(e)||"N/A"}`),a.push(""),a.push(Q("Epoch Information:",J.bright+J.yellow,s)),a.push(`  ${Q("Epoch Year:",J.green,s)} ${e.epochYear}`),a.push(`  ${Q("Epoch Day:",J.green,s)} ${e.epoch}`),a.push(""),a.push(Q("Orbital Parameters:",J.bright+J.yellow,s)),a.push(`  ${Q("Inclination:",J.green,s)} ${e.inclination}Â°`),a.push(`  ${Q("Right Ascension:",J.green,s)} ${e.rightAscension}Â°`),a.push(`  ${Q("Eccentricity:",J.green,s)} ${e.eccentricity}`),a.push(`  ${Q("Argument of Perigee:",J.green,s)} ${e.argumentOfPerigee}Â°`),a.push(`  ${Q("Mean Anomaly:",J.green,s)} ${e.meanAnomaly}Â°`),a.push(`  ${Q("Mean Motion:",J.green,s)} ${e.meanMotion} rev/day`),a.push(""),"verbose"===i&&(a.push(Q("Additional Parameters:",J.bright+J.yellow,s)),a.push(`  ${Q("First Derivative (Mean Motion):",J.green,s)} ${e.firstDerivative}`),a.push(`  ${Q("Second Derivative (Mean Motion):",J.green,s)} ${e.secondDerivative}`),a.push(`  ${Q("B* Drag Term:",J.green,s)} ${e.bStar}`),a.push(`  ${Q("Ephemeris Type:",J.green,s)} ${e.ephemerisType}`),a.push(`  ${Q("Element Set Number:",J.green,s)} ${e.elementSetNumber}`),a.push(`  ${Q("Revolution Number:",J.green,s)} ${e.revolutionNumber}`),a.push("")),r&&"warnings"in e&&Array.isArray(e.warnings)&&e.warnings.length>0){a.push(Q("Warnings:",J.bright+J.yellow,s));for(const t of e.warnings){const e="object"==typeof t&&"message"in t?t.message:String(t);a.push(`  ${Q("âš ",J.yellow,s)} ${e}`)}a.push("")}return a.push(Q("â•".repeat(70),J.cyan,s)),a.join("\n")}function ne(e,t={}){const{includeName:s=!0}=t,i=(e,t)=>e.padEnd(t," "),r=(e,t,s=" ")=>e.padStart(t,s);let a="1 ";a+=r(Z(e),5," "),a+=e.classification||"U",a+=" "+i(X(e),8),a+=" "+r(e.epochYear||"",2,"0"),a+=r(e.epoch||"",12," "),a+=" "+r(e.firstDerivative||"",10," "),a+=" "+i(e.secondDerivative||"",8),a+=" "+i(e.bStar||"",8),a+=" "+(e.ephemerisType||"0"),a+=" "+r(e.elementSetNumber||"",4," ");let n=0;for(let e=0;e<a.length;e++){const t=a[e];t&&t>="0"&&t<="9"?n+=parseInt(t,10):"-"===t&&(n+=1)}a+=(n%10).toString();let o="2 ";o+=r(Z(e),5," "),o+=" "+r(e.inclination||"",8," "),o+=" "+r(e.rightAscension||"",8," "),o+=" "+r((e.eccentricity||"").replace(/^0\./,""),7,"0"),o+=" "+r(e.argumentOfPerigee||"",8," "),o+=" "+r(e.meanAnomaly||"",8," "),o+=" "+r(e.meanMotion||"",11," "),o+=r(e.revolutionNumber||"",5," ");let c=0;for(let e=0;e<o.length;e++){const t=o[e];t&&t>="0"&&t<="9"?c+=parseInt(t,10):"-"===t&&(c+=1)}o+=(c%10).toString();const l=[];return s&&e.satelliteName&&l.push(e.satelliteName),l.push(a),l.push(o),l.join("\n")}class oe{constructor(e){this.config=e,this.queue=[],this.processing=!1,this.tokens=e.maxRequests,this.lastRefill=Date.now()}refillTokens(){const e=Date.now(),t=(e-this.lastRefill)/this.config.intervalMs*this.config.maxRequests;t>=1&&(this.tokens=Math.min(this.config.maxRequests,this.tokens+Math.floor(t)),this.lastRefill=e)}async processQueue(){if(!this.processing){for(this.processing=!0;this.queue.length>0;)if(this.refillTokens(),this.tokens>=1){const e=this.queue.shift();e&&(this.tokens-=1,e.resolve())}else{const e=this.config.intervalMs-(Date.now()-this.lastRefill);e>0&&await new Promise(t=>setTimeout(t,e))}this.processing=!1}}async acquire(){if(this.refillTokens(),this.tokens>=1)return this.tokens-=1,Promise.resolve();if(this.config.maxQueueSize&&this.queue.length>=this.config.maxQueueSize)throw new Error("Rate limiter queue is full");return new Promise((e,t)=>{this.queue.push({resolve:e,reject:t,timestamp:Date.now()}),this.processQueue()})}async execute(e){return await this.acquire(),e()}getStatus(){return this.refillTokens(),{tokens:this.tokens,queueLength:this.queue.length,maxRequests:this.config.maxRequests,intervalMs:this.config.intervalMs}}clearQueue(){for(const e of this.queue)e.reject(new Error("Rate limiter queue cleared"));this.queue=[]}reset(){this.tokens=this.config.maxRequests,this.lastRefill=Date.now(),this.clearQueue()}}class ce{constructor(e={}){this.cache=new Map,this.accessOrder=[],this.persistTimer=null,this.maxSize=e.maxSize||100,this.defaultTTL=e.defaultTTL||36e5,this.persistent=e.persistent||!1,this.cacheDir=e.cacheDir||i.join(r.homedir(),".tle-parser","cache"),this.cacheFile=e.cacheFile||"tle-cache.json",this.persistent&&(this.loadFromDisk().catch(()=>{}),this.persistTimer=setInterval(()=>{this.saveToDisk().catch(()=>{})},3e5))}get(e){const t=this.cache.get(e);if(t){if(!(Date.now()-t.timestamp>t.ttl))return this.updateAccessOrder(e),t.value;this.delete(e)}}set(e,t,s){const i={value:t,timestamp:Date.now(),ttl:s||this.defaultTTL};if(this.cache.size>=this.maxSize&&!this.cache.has(e)){const e=this.accessOrder[0];e&&this.delete(e)}this.cache.set(e,i),this.updateAccessOrder(e)}has(e){return void 0!==this.get(e)}delete(e){return this.accessOrder=this.accessOrder.filter(t=>t!==e),this.cache.delete(e)}clear(){this.cache.clear(),this.accessOrder=[]}size(){return this.cleanExpired(),this.cache.size}cleanExpired(){const e=Date.now();let t=0;for(const[s,i]of this.cache.entries())e-i.timestamp>i.ttl&&(this.delete(s),t++);return t}keys(){return this.cleanExpired(),Array.from(this.cache.keys())}getStats(){const e=this.size(),t=this.accessOrder[0]||null,s=this.accessOrder[this.accessOrder.length-1]||null;return{size:e,maxSize:this.maxSize,hitRate:0,oldestEntry:t,newestEntry:s}}updateAccessOrder(e){this.accessOrder=this.accessOrder.filter(t=>t!==e),this.accessOrder.push(e)}async saveToDisk(){if(this.persistent)try{s.existsSync(this.cacheDir)||await t.mkdir(this.cacheDir,{recursive:!0});const e={entries:Array.from(this.cache.entries()),accessOrder:this.accessOrder,timestamp:Date.now()},r=i.join(this.cacheDir,this.cacheFile);await t.writeFile(r,JSON.stringify(e,null,2),"utf8")}catch(e){console.error("Failed to save cache to disk:",e)}}async loadFromDisk(){if(this.persistent)try{const e=i.join(this.cacheDir,this.cacheFile);if(!s.existsSync(e))return;const r=await t.readFile(e,"utf8"),a=JSON.parse(r);this.cache.clear();for(const[e,t]of a.entries)this.cache.set(e,t);this.accessOrder=a.accessOrder||[],this.cleanExpired()}catch(e){console.error("Failed to load cache from disk:",e)}}destroy(){this.persistTimer&&(clearInterval(this.persistTimer),this.persistTimer=null),this.persistent&&this.saveToDisk().catch(()=>{}),this.clear()}}const le=new ce({maxSize:1e3,defaultTTL:36e5,persistent:!0,cacheFile:"tle-data.json"});function he(e,t={}){const s=Object.keys(t).sort().map(e=>`${e}=${t[e]}`).join("&");return s?`${e}:${s}`:e}function ue(e,t=2592e5){const s=parseInt(e.epochYear,10),i=parseFloat(e.epoch),r=new Date(s<57?2e3+s:1900+s,0,1);r.setDate(i);const a=Date.now()-r.getTime(),n=a<=t,o=Math.floor(a/864e5);return{isFresh:n,age:a,epochDate:r,message:n?`TLE is fresh (${o} days old)`:`TLE is stale (${o} days old)`}}const me={starlink:{name:"Starlink",description:"SpaceX Starlink satellite constellation",namePatterns:[/^STARLINK-/i,/^STARLINK /i],intlDesignatorPatterns:[/^\d{2}-(0[0-9]{2}|1[0-9]{2})[A-Z]{1,3}$/]},oneweb:{name:"OneWeb",description:"OneWeb satellite constellation",namePatterns:[/^ONEWEB-/i,/^ONEWEB /i]},gps:{name:"GPS",description:"Global Positioning System satellites",namePatterns:[/^GPS /i,/^NAVSTAR/i,/^USA-/i],catalogNumbers:[[20959,20959],[22014,22014],[22877,22877],[23833,23833],[24876,24876],[25933,25933],[26360,26360],[26407,26407],[26605,26605],[26690,26690],[28361,28361],[28474,28474],[28874,28874],[29486,29486],[29601,29601],[32260,32260],[32384,32384],[32711,32711],[35752,35752],[36585,36585],[37753,37753],[38833,38833],[39166,39166],[40105,40105],[40294,40294],[40534,40534],[40730,40730],[41019,41019],[41328,41328],[36500,36600],[4e4,41400]]},galileo:{name:"Galileo",description:"European GNSS constellation",namePatterns:[/^GALILEO/i,/^GSAT/i],catalogNumbers:[[37846,37846],[37847,37847],[38857,38857],[38858,38858],[40128,40128],[40129,40129],[40544,40544],[40545,40545],[40889,40889],[40890,40890],[41174,41174],[41175,41175],[41549,41549],[41550,41550],[41859,41859],[41860,41860],[41861,41861],[41862,41862],[43055,43055],[43056,43056],[43057,43057],[43058,43058],[43564,43564],[43565,43565],[43566,43566],[43567,43567]]},glonass:{name:"GLONASS",description:"Russian GNSS constellation",namePatterns:[/^COSMOS \d+$/i,/^GLONASS/i],catalogNumbers:[[28915,28915],[32275,32275],[32276,32276],[32393,32393],[32395,32395],[36111,36111],[36112,36112],[36113,36113],[36400,36400],[36401,36401],[36402,36402],[37139,37139],[37140,37140],[37141,37141],[37829,37829],[37869,37869],[37870,37870],[39155,39155],[39620,39620],[39621,39621],[39622,39622],[40001,40001],[40315,40315],[40315,40315],[41330,41330],[41554,41554],[41555,41555],[36400,36410],[37800,37900],[39100,39700],[4e4,41600]]},beidou:{name:"BeiDou",description:"Chinese GNSS constellation",namePatterns:[/^BEIDOU/i,/^BDS/i,/^COMPASS/i],catalogNumbers:[[36287,36287],[36828,36828],[37210,37210],[37384,37384],[37763,37763],[37948,37948],[38091,38091],[38250,38250],[38251,38251],[38775,38775],[40549,40549],[40748,40748],[40749,40749],[40938,40938],[41434,41434],[41586,41586],[43001,43001],[43002,43002],[43107,43107],[43108,43108],[43207,43207],[43208,43208],[43245,43245],[43246,43246],[36200,43300]]},iss:{name:"ISS",description:"International Space Station",catalogNumbers:[25544],namePatterns:[/^ISS/i]},amateur:{name:"Amateur Radio",description:"Amateur radio satellites",namePatterns:[/^AO-/i,/^SO-/i,/^FO-/i,/^FUNCUBE/i,/^LILACSAT/i,/^DIWATA/i,/^OSCAR/i,/^AMSAT/i,/^CUBESAT/i,/^RS-/i,/^ZARYA/i]},weather:{name:"Weather",description:"Weather and meteorological satellites",namePatterns:[/^NOAA /i,/^GOES /i,/^METEOSAT/i,/^METEOR/i,/^FENGYUN/i,/^FY-/i,/^HIMAWARI/i]},iridium:{name:"Iridium",description:"Iridium satellite constellation",namePatterns:[/^IRIDIUM/i],catalogNumbers:[[41917,41927],[41934,41944],[42803,42813],[42955,42965],[43070,43080],[43249,43259],[43478,43488],[43569,43579]]},planet:{name:"Planet Labs",description:"Planet Labs Earth imaging satellites",namePatterns:[/^DOVE/i,/^FLOCK/i,/^PLANET/i,/^SKYSAT/i]},spire:{name:"Spire",description:"Spire Global satellite constellation",namePatterns:[/^LEMUR/i,/^SPIRE/i]}};function de(e){return me[e.toLowerCase()]}function pe(e,t){const s=de(t);if(!s)return!1;if(s.catalogNumbers&&s.catalogNumbers.length>0){const t=parseInt(e.satelliteNumber1,10);if(!isNaN(t)&&s.catalogNumbers.some(e=>Array.isArray(e)?t>=e[0]&&t<=e[1]:t===e))return!0}return!!(s.namePatterns&&e.satelliteName&&s.namePatterns.some(t=>t.test(e.satelliteName)))||!!s.customFilter&&s.customFilter(e)}class ge{constructor(e,t){this.manager=e,this.config=t,this.timer=null,this.isRunning=!1,this.lastUpdate=null,this.updateCount=0,this.errorCount=0,this.lastError=null,this.retryCount=0,t.autoStart&&this.start()}start(){this.isRunning||(this.isRunning=!0,this.scheduleNext())}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.isRunning=!1}scheduleNext(){this.isRunning&&(this.timer=setTimeout(()=>{this.executeUpdate()},this.config.intervalMs))}async executeUpdate(){try{const e=await this.manager.fetch(this.config.source||null,this.config.fetchOptions||{});this.lastUpdate=new Date,this.updateCount++,this.retryCount=0,this.lastError=null,this.config.onUpdate&&this.config.onUpdate(e),this.scheduleNext()}catch(e){this.errorCount++,this.lastError=e,this.config.onError&&this.config.onError(this.lastError);const t=this.config.maxRetries||3;if(this.retryCount<t){this.retryCount++;const e=this.config.retryDelayMs||6e4;this.timer=setTimeout(()=>{this.executeUpdate()},e)}else this.retryCount=0,this.scheduleNext()}}async updateNow(){return this.manager.fetch(this.config.source||null,this.config.fetchOptions||{})}getStatus(){return{isRunning:this.isRunning,lastUpdate:this.lastUpdate,nextUpdate:this.timer?new Date(Date.now()+this.config.intervalMs):null,updateCount:this.updateCount,errorCount:this.errorCount,lastError:this.lastError}}updateConfig(e){Object.assign(this.config,e),this.isRunning&&(this.stop(),this.start())}resetStats(){this.updateCount=0,this.errorCount=0,this.lastError=null,this.retryCount=0}}var Ee,fe=Math.PI,Re=2*fe,Ne=fe/180,xe=180/fe,Ie=6378.135,Ae=60/Math.sqrt(650942.9922085947),Te=Ie*Ae/60,Se=1/Ae,_e=.001082616,ye=-253881e-11/_e,Oe=2/3,Le=1440/(2*fe);function ve(e,t,s,i,r,a){var n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return 367*e-Math.floor(7*(e+Math.floor((t+9)/12))*.25)+Math.floor(275*t/9)+s+1721013.5+((n/6e4+a/60+r)/60+i)/24}function Ce(e,t,s,i,r,a){var n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(e instanceof Date){var o=e;return ve(o.getUTCFullYear(),o.getUTCMonth()+1,o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds())}return ve(e,t,s,i,r,a,n)}function Me(e,t){var s,i,r,a,n,o,c,l,h,u,m,d,p,g,E,f,R,N,x=e.e3,I=e.ee2,A=e.peo,T=e.pgho,S=e.pho,_=e.pinco,y=e.plo,O=e.se2,L=e.se3,v=e.sgh2,C=e.sgh3,M=e.sgh4,D=e.sh2,b=e.sh3,w=e.si2,P=e.si3,U=e.sl2,$=e.sl3,F=e.sl4,V=e.t,G=e.xgh2,k=e.xgh3,z=e.xgh4,H=e.xh2,W=e.xh3,Y=e.xi2,j=e.xi3,B=e.xl2,q=e.xl3,K=e.xl4,Z=e.zmol,X=e.zmos,J=t.init,Q=t.opsmode,ee=t.ep,te=t.inclp,se=t.nodep,ie=t.argpp,re=t.mp;N=X+119459e-10*V,"y"===J&&(N=X),R=N+.0335*Math.sin(N);var ae=O*(c=.5*(g=Math.sin(R))*g-.25)+L*(l=-.5*g*Math.cos(R)),ne=w*c+P*l,oe=U*c+$*l+F*g,ce=v*c+C*l+M*g,le=D*c+b*l;return N=Z+.00015835218*V,"y"===J&&(N=Z),R=N+.1098*Math.sin(N),h=ae+(I*(c=.5*(g=Math.sin(R))*g-.25)+x*(l=-.5*g*Math.cos(R))),d=ne+(Y*c+j*l),p=oe+(B*c+q*l+K*g),u=ce+(G*c+k*l+z*g),m=le+(H*c+W*l),"n"===J&&(p-=y,u-=T,m-=S,te+=d-=_,ee+=h-=A,a=Math.sin(te),r=Math.cos(te),te>=.2?(ie+=u-=r*(m/=a),se+=m,re+=p):(s=a*(o=Math.sin(se)),i=a*(n=Math.cos(se)),s+=m*n+d*r*o,i+=-m*o+d*r*n,(se%=Re)<0&&"a"===Q&&(se+=Re),E=re+ie+r*se,E+=p+u-d*se*a,f=se,(se=Math.atan2(s,i))<0&&"a"===Q&&(se+=Re),Math.abs(f-se)>fe&&(se<f?se+=Re:se-=Re),ie=E-(re+=p)-r*se)),{ep:ee,inclp:te,nodep:se,argpp:ie,mp:re}}function De(e){var t=(e-2451545)/36525,s=-62e-7*t*t*t+.093104*t*t+3164400184.812866*t+67310.54841;return(s=s*Ne/240%Re)<0&&(s+=Re),s}function be(e,t,s,i,r,a,n){return e instanceof Date?De(Ce(e)):De(e)}function we(e,t){var s,i,r,a,n,o,c,l,h,u,m,d,p,g,E,f,R,N,x,I,A,T,S,_,y,O;e.t=t,e.error=Ee.None;var L=e.mo+e.mdot*e.t,v=e.argpo+e.argpdot*e.t,C=e.nodeo+e.nodedot*e.t;l=v,I=L;var M=e.t*e.t;if(T=C+e.nodecf*M,f=1-e.cc1*e.t,R=e.bstar*e.cc4*e.t,N=e.t2cof*M,1!==e.isimp){o=e.omgcof*e.t;var D=1+e.eta*Math.cos(L);I=L+(E=o+e.xmcof*(D*D*D-e.delmo)),l=v-E,d=(m=M*e.t)*e.t,f=f-e.d2*M-e.d3*m-e.d4*d,R+=e.bstar*e.cc5*(Math.sin(I)-e.sinmao),N=N+e.t3cof*m+d*(e.t4cof+e.t*e.t5cof)}A=e.no;var b=e.ecco;if(x=e.inclo,"d"===e.method){p=e.t;var w=function(e){var t,s,i,r,a,n,o,c,l=e.irez,h=e.d2201,u=e.d2211,m=e.d3210,d=e.d3222,p=e.d4410,g=e.d4422,E=e.d5220,f=e.d5232,R=e.d5421,N=e.d5433,x=e.del1,I=e.del2,A=e.del3,T=e.argpo,S=e.argpdot,_=e.t,y=e.xfact,O=e.xlamo,L=e.no,v=e.atime,C=e.em,M=e.argpm,D=e.inclm,b=e.xli,w=e.mm,P=e.xni,U=e.nodem,$=e.nm,F=.13130908,V=2.8843198,G=.37448087,k=5.7686396,z=.95240898,H=1.8014998,W=1.050833,Y=4.4108898,j=259200,B=0,q=0,K=(e.gsto+.0043752690880113*e.tc)%Re;if(C+=e.dedt*_,D+=e.didt*_,M+=e.domdt*_,U+=e.dnodt*_,w+=e.dmdt*_,0!==l){(0===v||_*v<=0||Math.abs(_)<Math.abs(v))&&(v=0,P=L,b=O),t=_>0?720:-720;for(var Z=381;381===Z;)2!==l?(o=x*Math.sin(b-F)+I*Math.sin(2*(b-V))+A*Math.sin(3*(b-G)),a=P+y,n=x*Math.cos(b-F)+2*I*Math.cos(2*(b-V))+3*A*Math.cos(3*(b-G)),n*=a):(i=(c=T+S*v)+c,s=b+b,o=h*Math.sin(i+b-k)+u*Math.sin(b-k)+m*Math.sin(c+b-z)+d*Math.sin(-c+b-z)+p*Math.sin(i+s-H)+g*Math.sin(s-H)+E*Math.sin(c+b-W)+f*Math.sin(-c+b-W)+R*Math.sin(c+s-Y)+N*Math.sin(-c+s-Y),a=P+y,n=h*Math.cos(i+b-k)+u*Math.cos(b-k)+m*Math.cos(c+b-z)+d*Math.cos(-c+b-z)+E*Math.cos(c+b-W)+f*Math.cos(-c+b-W)+2*(p*Math.cos(i+s-H)+g*Math.cos(s-H)+R*Math.cos(c+s-Y)+N*Math.cos(-c+s-Y)),n*=a),Math.abs(_-v)>=720?Z=381:(q=_-v,Z=0),381===Z&&(b+=a*t+o*j,P+=o*t+n*j,v+=t);$=P+o*q+n*q*q*.5,r=b+a*q+o*q*q*.5,1!==l?(w=r-2*U+2*K,B=$-L):(w=r-U-M+K,B=$-L),$=L+B}return{atime:v,em:C,argpm:M,inclm:D,xli:b,mm:w,xni:P,nodem:U,dndt:B,nm:$}}({irez:e.irez,d2201:e.d2201,d2211:e.d2211,d3210:e.d3210,d3222:e.d3222,d4410:e.d4410,d4422:e.d4422,d5220:e.d5220,d5232:e.d5232,d5421:e.d5421,d5433:e.d5433,dedt:e.dedt,del1:e.del1,del2:e.del2,del3:e.del3,didt:e.didt,dmdt:e.dmdt,dnodt:e.dnodt,domdt:e.domdt,argpo:e.argpo,argpdot:e.argpdot,t:e.t,tc:p,gsto:e.gsto,xfact:e.xfact,xlamo:e.xlamo,no:e.no,atime:e.atime,em:b,argpm:l,inclm:x,xli:e.xli,mm:I,xni:e.xni,nodem:T,nm:A});b=w.em,l=w.argpm,x=w.inclm,I=w.mm,T=w.nodem,A=w.nm}if(A<=0)return e.error=Ee.MeanMotionBelowZero,null;var P=Math.pow(Ae/A,Oe)*f*f;if(A=Ae/Math.pow(P,1.5),(b-=R)>=1||b<-.001)return e.error=Ee.MeanEccentricityOutOfRange,null;b<1e-6&&(b=1e-6),_=(I+=e.no*N)+l+T;var U={am:P,em:b,im:x,Om:T%=Re,om:l%=Re,mm:I=((_%=Re)-l-T)%Re,nm:A},$=b;if(S=x,h=l,O=T,y=I,a=Math.sin(x),r=Math.cos(x),"d"===e.method){var F=Me(e,{inclo:e.inclo,init:"n",ep:$,inclp:S,nodep:O,argpp:h,mp:y,opsmode:e.operationmode});if($=F.ep,O=F.nodep,h=F.argpp,y=F.mp,(S=F.inclp)<0&&(S=-S,O+=fe,h-=fe),$<0||$>1)return e.error=Ee.PerturbedEccentricityOutOfRange,null}"d"===e.method&&(a=Math.sin(S),r=Math.cos(S),e.aycof=-.5*ye*a,Math.abs(r+1)>15e-13?e.xlcof=-.25*ye*a*(3+5*r)/(1+r):e.xlcof=-.25*ye*a*(3+5*r)/15e-13);var V=$*Math.cos(h);E=1/(P*(1-$*$));var G=$*Math.sin(h)+E*e.aycof,k=(y+h+O+E*e.xlcof*V-O)%Re;c=k,g=9999.9;for(var z=1;Math.abs(g)>=1e-12&&z<=10;)i=Math.sin(c),g=(k-G*(s=Math.cos(c))+V*i-c)/(g=1-s*V-i*G),Math.abs(g)>=.95&&(g=g>0?.95:-.95),c+=g,z+=1;var H=V*s+G*i,W=V*i-G*s,Y=V*V+G*G,j=P*(1-Y);if(j<0)return e.error=Ee.SemiLatusRectumBelowZero,null;var B=P*(1-H),q=Math.sqrt(P)*W/B,K=Math.sqrt(j)/B,Z=Math.sqrt(1-Y),X=P/B*(i-G-V*(E=W/(1+Z))),J=P/B*(s-V+G*E);u=Math.atan2(X,J);var Q=(J+J)*X,ee=1-2*X*X,te=.5*_e*(E=1/j),se=te*E;"d"===e.method&&(n=r*r,e.con41=3*n-1,e.x1mth2=1-n,e.x7thm1=7*n-1);var ie=B*(1-1.5*se*Z*e.con41)+.5*te*e.x1mth2*ee;if(ie<1)return e.error=Ee.Decayed,null;u-=.25*se*e.x7thm1*Q;var re=O+1.5*se*r*Q,ae=S+1.5*se*r*a*ee,ne=q-A*te*e.x1mth2*Q/Ae,oe=K+A*te*(e.x1mth2*ee+1.5*e.con41)/Ae,ce=Math.sin(u),le=Math.cos(u),he=Math.sin(re),ue=Math.cos(re),me=Math.sin(ae),de=Math.cos(ae),pe=-he*de,ge=ue*de,Ne=pe*ce+ue*le,xe=ge*ce+he*le,Se=me*ce;return{position:{x:ie*Ne*Ie,y:ie*xe*Ie,z:ie*Se*Ie},velocity:{x:(ne*Ne+oe*(pe*le-ue*ce))*Te,y:(ne*xe+oe*(ge*le-he*ce))*Te,z:(ne*Se+oe*(me*le))*Te},meanElements:U}}function Pe(e,t){var s=e.substring(2,7),i=parseInt(e.substring(18,20),10),r=parseFloat(e.substring(20,32)),a=parseFloat(e.substring(33,43)),n=parseFloat("".concat(e.substring(44,45),".").concat(e.substring(45,50),"E").concat(e.substring(50,52))),o=parseFloat("".concat(e.substring(53,54),".").concat(e.substring(54,59),"E").concat(e.substring(59,61))),c=parseFloat(t.substring(8,16))*Ne,l=parseFloat(t.substring(17,25))*Ne,h=parseFloat(".".concat(t.substring(26,33))),u=parseFloat(t.substring(34,42))*Ne,m=parseFloat(t.substring(43,51))*Ne,d=parseFloat(t.substring(52,63))/Le,p=i<57?i+2e3:i+1900,g=function(e,t){for(var s=[31,e%4==0?29:28,31,30,31,30,31,31,30,31,30,31],i=Math.floor(t),r=1,a=0;i>a+s[r-1]&&r<12;)a+=s[r-1],r+=1;var n=r,o=i-a,c=24*(t-i),l=Math.floor(c);c=60*(c-l);var h=Math.floor(c);return{mon:n,day:o,hr:l,minute:h,sec:60*(c-h)}}(p,r),E={error:0,satnum:s,epochyr:i,epochdays:r,ndot:a,nddot:n,bstar:o,inclo:c,nodeo:l,ecco:h,argpo:u,mo:m,no:d,jdsatepoch:Ce(p,g.mon,g.day,g.hr,g.minute,g.sec)};return function(e,t){var s,i,r,a,n,o,c,l,h,u,m,d,p,g,E,f,R,N,x,I,A,T,S,_,y,O,L,v,C,M,D,b,w,P,U,$,F,V,G,k,z,H,W,Y,j,B,q,K,Z,X,J,Q,ee=t.opsmode,te=t.epoch,se=t.xbstar,ie=t.xecco,re=t.xargpo,ae=t.xinclo,ne=t.xmo,oe=t.xno,ce=t.xnodeo,le=e;le.isimp=0,le.method="n",le.aycof=0,le.con41=0,le.cc1=0,le.cc4=0,le.cc5=0,le.d2=0,le.d3=0,le.d4=0,le.delmo=0,le.eta=0,le.argpdot=0,le.omgcof=0,le.sinmao=0,le.t=0,le.t2cof=0,le.t3cof=0,le.t4cof=0,le.t5cof=0,le.x1mth2=0,le.x7thm1=0,le.mdot=0,le.nodedot=0,le.xlcof=0,le.xmcof=0,le.nodecf=0,le.irez=0,le.d2201=0,le.d2211=0,le.d3210=0,le.d3222=0,le.d4410=0,le.d4422=0,le.d5220=0,le.d5232=0,le.d5421=0,le.d5433=0,le.dedt=0,le.del1=0,le.del2=0,le.del3=0,le.didt=0,le.dmdt=0,le.dnodt=0,le.domdt=0,le.e3=0,le.ee2=0,le.peo=0,le.pgho=0,le.pho=0,le.pinco=0,le.plo=0,le.se2=0,le.se3=0,le.sgh2=0,le.sgh3=0,le.sgh4=0,le.sh2=0,le.sh3=0,le.si2=0,le.si3=0,le.sl2=0,le.sl3=0,le.sl4=0,le.gsto=0,le.xfact=0,le.xgh2=0,le.xgh3=0,le.xgh4=0,le.xh2=0,le.xh3=0,le.xi2=0,le.xi3=0,le.xl2=0,le.xl3=0,le.xl4=0,le.xlamo=0,le.zmol=0,le.zmos=0,le.atime=0,le.xli=0,le.xni=0,le.bstar=se,le.ecco=ie,le.argpo=re,le.inclo=ae,le.mo=ne,le.no=oe,le.nodeo=ce,le.operationmode=ee;var he=78/Ie+1;le.init="y",le.t=0;var ue=function(e){var t=e.ecco,s=e.epoch,i=e.inclo,r=e.opsmode,a=e.no,n=t*t,o=1-n,c=Math.sqrt(o),l=Math.cos(i),h=l*l,u=Math.pow(Ae/a,Oe),m=.75*_e*(3*h-1)/(c*o),d=m/(u*u),p=u*(1-d*d-d*(1/3+134*d*d/81));a/=1+(d=m/(p*p));var g,E=Math.pow(Ae/a,Oe),f=Math.sin(i),R=E*o,N=1-5*h,x=-N-h-h,I=1/E,A=R*R,T=E*(1-t);if("a"===r){var S=s-7305,_=Math.floor(S+1e-8),y=.017202791694070362;(g=(1.7321343856509375+y*_+(y+Re)*(S-_)+S*S*5075514194322695e-30)%Re)<0&&(g+=Re)}else g=be(s+2433281.5);return{no:a,method:"n",ainv:I,ao:E,con41:x,con42:N,cosio:l,cosio2:h,eccsq:n,omeosq:o,posq:A,rp:T,rteosq:c,sinio:f,gsto:g}}({ecco:le.ecco,epoch:te,inclo:le.inclo,no:le.no,method:le.method,opsmode:le.operationmode}),me=ue.ao,de=ue.con42,pe=ue.cosio,ge=ue.cosio2,Ee=ue.eccsq,Ne=ue.omeosq,xe=ue.posq,Te=ue.rp,Le=ue.rteosq,ve=ue.sinio;if(le.no=ue.no,le.con41=ue.con41,le.gsto=ue.gsto,le.a=Math.pow(le.no*Se,-2/3),le.alta=le.a*(1+le.ecco)-1,le.altp=le.a*(1-le.ecco)-1,le.error=0,Ne>=0||le.no>=0){if(le.isimp=0,Te<1.034492841559484&&(le.isimp=1),_=he,N=1.880279159015271e-9,(E=(Te-1)*Ie)<156){_=E-78,E<98&&(_=20);var Ce=(120-_)/Ie;N=Ce*Ce*Ce*Ce,_=_/Ie+1}f=1/xe,H=1/(me-_),le.eta=me*le.ecco*H,d=le.eta*le.eta,m=le.ecco*le.eta,R=Math.abs(1-d),a=(c=(o=N*Math.pow(H,4))/Math.pow(R,3.5))*le.no*(me*(1+1.5*d+m*(4+d))+.375*_e*H/R*le.con41*(8+3*d*(8+d))),le.cc1=le.bstar*a,n=0,le.ecco>1e-4&&(n=-2*o*H*ye*le.no*ve/le.ecco),le.x1mth2=1-ge,le.cc4=2*le.no*c*me*Ne*(le.eta*(2+.5*d)+le.ecco*(.5+2*d)-_e*H/(me*R)*(-3*le.con41*(1-2*m+d*(1.5-.5*m))+.75*le.x1mth2*(2*d-m*(1+d))*Math.cos(2*le.argpo))),le.cc5=2*c*me*Ne*(1+2.75*(d+m)+m*d),l=ge*ge,k=.5*(G=1.5*_e*f*le.no)*_e*f,z=7.762359375e-7*f*f*le.no,le.mdot=le.no+.5*G*Le*le.con41+.0625*k*Le*(13-78*ge+137*l),le.argpdot=-.5*G*de+.0625*k*(7-114*ge+395*l)+z*(3-36*ge+49*l),Y=-G*pe,le.nodedot=Y+(.5*k*(4-19*ge)+2*z*(3-7*ge))*pe,W=le.argpdot+le.nodedot,le.omgcof=le.bstar*n*Math.cos(le.argpo),le.xmcof=0,le.ecco>1e-4&&(le.xmcof=-Oe*o*le.bstar/m),le.nodecf=3.5*Ne*Y*le.cc1,le.t2cof=1.5*le.cc1,Math.abs(pe+1)>15e-13?le.xlcof=-.25*ye*ve*(3+5*pe)/(1+pe):le.xlcof=-.25*ye*ve*(3+5*pe)/15e-13,le.aycof=-.5*ye*ve;var De=1+le.eta*Math.cos(le.mo);if(le.delmo=De*De*De,le.sinmao=Math.sin(le.mo),le.x7thm1=7*ge-1,2*fe/le.no>=225){le.method="d",le.isimp=1,p=le.inclo;var Pe=function(e){var t,s,i,r,a,n,o,c,l,h,u,m,d,p,g,E,f,R,N,x,I,A,T,S,_,y,O,L,v,C,M,D,b,w,P,U,$,F,V,G,k,z,H,W,Y,j,B,q,K,Z,X,J,Q,ee,te,se,ie,re,ae,ne,oe,ce,le,he=e.epoch,ue=e.argpp,me=e.tc,de=e.inclp,pe=e.nodep,ge=.01675,Ee=.0549,fe=e.np,Ne=e.ep,xe=Math.sin(pe),Ie=Math.cos(pe),Ae=Math.sin(ue),Te=Math.cos(ue),Se=Math.sin(de),_e=Math.cos(de),ye=Ne*Ne,Oe=1-ye,Le=Math.sqrt(Oe),ve=he+18261.5+me/1440,Ce=(4.523602-.00092422029*ve)%Re,Me=Math.sin(Ce),De=Math.cos(Ce),be=.91375164-.03568096*De,we=Math.sqrt(1-be*be),Pe=.089683511*Me/we,Ue=Math.sqrt(1-Pe*Pe),$e=5.8351514+.001944368*ve,Fe=.39785416*Me/we,Ve=Ue*De+.91744867*Pe*Me;Fe=Math.atan2(Fe,Ve),Fe+=$e-Ce;var Ge=Math.cos(Fe),ke=Math.sin(Fe);x=.1945905,I=-.98088458,S=.91744867,_=.39785416,A=Ie,T=xe,u=29864797e-13;for(var ze=1/fe,He=0;He<2;)te=-6*(t=x*A+I*S*T)*(a=-Se*(o=-x*T+I*S*A)+_e*(c=I*_))+ye*(-24*(m=t*Te+(s=_e*o+Se*c)*Ae)*(R=a*Te)-6*(p=-t*Ae+s*Te)*(E=a*Ae)),se=-6*(t*(n=-Se*(l=I*T+x*S*A)+_e*(h=x*_))+(i=-I*A+x*S*T)*a)+ye*(-24*((d=i*Te+(r=_e*l+Se*h)*Ae)*R+m*(N=n*Te))+-6*(p*(f=n*Ae)+(g=-i*Ae+r*Te)*E)),ie=-6*i*n+ye*(-24*d*N-6*g*f),re=6*s*a+ye*(24*m*E-6*p*R),ae=6*(r*a+s*n)+ye*(24*(d*E+m*f)-6*(g*R+p*N)),ne=6*r*n+ye*(24*d*f-6*g*N),J=(J=3*(t*t+s*s)+(oe=12*m*m-3*p*p)*ye)+J+Oe*oe,Q=(Q=6*(t*i+s*r)+(ce=24*m*d-6*p*g)*ye)+Q+Oe*ce,ee=(ee=3*(i*i+r*r)+(le=12*d*d-3*g*g)*ye)+ee+Oe*le,j=-.5*(B=u*ze)/Le,Y=-15*Ne*(q=B*Le),K=m*p+d*g,Z=d*p+m*g,X=d*g-m*p,1===(He+=1)&&(y=Y,O=j,L=B,v=q,C=K,M=Z,D=X,b=J,w=Q,P=ee,U=te,$=se,F=ie,V=re,G=ae,k=ne,z=oe,H=ce,W=le,x=Ge,I=ke,S=be,_=we,A=Ue*Ie+Pe*xe,T=xe*Ue-Ie*Pe,u=4.7968065e-7);return{snodm:xe,cnodm:Ie,sinim:Se,cosim:_e,sinomm:Ae,cosomm:Te,day:ve,e3:2*Y*X,ee2:2*Y*Z,em:Ne,emsq:ye,gam:$e,peo:0,pgho:0,pho:0,pinco:0,plo:0,rtemsq:Le,se2:2*y*M,se3:2*y*D,sgh2:2*v*H,sgh3:2*v*(W-z),sgh4:-18*v*ge,sh2:-2*O*G,sh3:-2*O*(k-V),si2:2*O*$,si3:2*O*(F-U),sl2:-2*L*w,sl3:-2*L*(P-b),sl4:-2*L*(-21-9*ye)*ge,s1:Y,s2:j,s3:B,s4:q,s5:K,s6:Z,s7:X,ss1:y,ss2:O,ss3:L,ss4:v,ss5:C,ss6:M,ss7:D,sz1:b,sz2:w,sz3:P,sz11:U,sz12:$,sz13:F,sz21:V,sz22:G,sz23:k,sz31:z,sz32:H,sz33:W,xgh2:2*q*ce,xgh3:2*q*(le-oe),xgh4:-18*q*Ee,xh2:-2*j*ae,xh3:-2*j*(ne-re),xi2:2*j*se,xi3:2*j*(ie-te),xl2:-2*B*Q,xl3:-2*B*(ee-J),xl4:-2*B*(-21-9*ye)*Ee,nm:fe,z1:J,z2:Q,z3:ee,z11:te,z12:se,z13:ie,z21:re,z22:ae,z23:ne,z31:oe,z32:ce,z33:le,zmol:(.2299715*ve-$e+4.7199672)%Re,zmos:(6.2565837+.017201977*ve)%Re}}({epoch:te,ep:le.ecco,argpp:le.argpo,tc:0,inclp:le.inclo,nodep:le.nodeo,np:le.no,e3:le.e3,ee2:le.ee2,peo:le.peo,pgho:le.pgho,pho:le.pho,pinco:le.pinco,plo:le.plo,se2:le.se2,se3:le.se3,sgh2:le.sgh2,sgh3:le.sgh3,sgh4:le.sgh4,sh2:le.sh2,sh3:le.sh3,si2:le.si2,si3:le.si3,sl2:le.sl2,sl3:le.sl3,sl4:le.sl4,xgh2:le.xgh2,xgh3:le.xgh3,xgh4:le.xgh4,xh2:le.xh2,xh3:le.xh3,xi2:le.xi2,xi3:le.xi3,xl2:le.xl2,xl3:le.xl3,xl4:le.xl4,zmol:le.zmol,zmos:le.zmos});le.e3=Pe.e3,le.ee2=Pe.ee2,le.peo=Pe.peo,le.pgho=Pe.pgho,le.pho=Pe.pho,le.pinco=Pe.pinco,le.plo=Pe.plo,le.se2=Pe.se2,le.se3=Pe.se3,le.sgh2=Pe.sgh2,le.sgh3=Pe.sgh3,le.sgh4=Pe.sgh4,le.sh2=Pe.sh2,le.sh3=Pe.sh3,le.si2=Pe.si2,le.si3=Pe.si3,le.sl2=Pe.sl2,le.sl3=Pe.sl3,le.sl4=Pe.sl4,i=Pe.sinim,s=Pe.cosim,h=Pe.em,u=Pe.emsq,x=Pe.s1,I=Pe.s2,A=Pe.s3,T=Pe.s4,S=Pe.s5,y=Pe.ss1,O=Pe.ss2,L=Pe.ss3,v=Pe.ss4,C=Pe.ss5,M=Pe.sz1,D=Pe.sz3,b=Pe.sz11,w=Pe.sz13,P=Pe.sz21,U=Pe.sz23,$=Pe.sz31,F=Pe.sz33,le.xgh2=Pe.xgh2,le.xgh3=Pe.xgh3,le.xgh4=Pe.xgh4,le.xh2=Pe.xh2,le.xh3=Pe.xh3,le.xi2=Pe.xi2,le.xi3=Pe.xi3,le.xl2=Pe.xl2,le.xl3=Pe.xl3,le.xl4=Pe.xl4,le.zmol=Pe.zmol,le.zmos=Pe.zmos,g=Pe.nm,j=Pe.z1,B=Pe.z3,q=Pe.z11,K=Pe.z13,Z=Pe.z21,X=Pe.z23,J=Pe.z31,Q=Pe.z33;var Ue=Me(le,{inclo:p,init:le.init,ep:le.ecco,inclp:le.inclo,nodep:le.nodeo,argpp:le.argpo,mp:le.mo,opsmode:le.operationmode});le.ecco=Ue.ep,le.inclo=Ue.inclp,le.nodeo=Ue.nodep,le.argpo=Ue.argpp,le.mo=Ue.mp;var $e=function(e){var t,s,i,r,a,n,o,c,l,h,u,m,d,p,g,E,f,R,N,x,I=e.cosim,A=e.argpo,T=e.s2,S=e.sinim,_=e.ss2,y=e.t,O=e.mo,L=e.mdot,v=e.no,C=e.nodeo,M=e.nodedot,D=e.xpidot,b=e.ecco,w=e.eccsq,P=e.emsq,U=e.em,$=e.argpm,F=e.inclm,V=e.mm,G=e.nm,k=e.nodem,z=e.irez,H=e.atime,W=e.d2201,Y=e.d2211,j=e.d3210,B=e.d3222,q=e.d4410,K=e.d4422,Z=e.d5220,X=e.d5232,J=e.d5421,Q=e.d5433,ee=e.dnodt,te=e.domdt,se=e.del1,ie=e.del2,re=e.del3,ae=e.xfact,ne=e.xlamo,oe=e.xli,ce=e.xni,le=.0043752690880113,he=.00015835218,ue=119459e-10;z=0,G<.0052359877&&G>.0034906585&&(z=1),G>=.00826&&G<=.00924&&U>=.5&&(z=2);var me=-ue*_*(e.sz21+e.sz23);(F<.052359877||F>fe-.052359877)&&(me=0),0!==S&&(me/=S);var de=-he*T*(e.z21+e.z23);(F<.052359877||F>fe-.052359877)&&(de=0),te=e.ss4*ue*(e.sz31+e.sz33-6)-I*me+e.s4*he*(e.z31+e.z33-6),ee=me,0!==S&&(te-=I/S*de,ee+=de/S);var pe=(e.gsto+e.tc*le)%Re;if(U+=(R=e.ss1*ue*e.ss5+e.s1*he*e.s5)*y,F+=(N=_*ue*(e.sz11+e.sz13)+T*he*(e.z11+e.z13))*y,$+=te*y,k+=ee*y,V+=(x=-ue*e.ss3*(e.sz1+e.sz3-14-6*P)-he*e.s3*(e.z1+e.z3-14-6*P))*y,0!==z){if(g=Math.pow(G/Ae,Oe),2===z){var ge=U,Ee=P;f=(U=b)*(P=w),U<=.65?(i=3.616-13.247*U+16.29*P,r=117.39*U-19.302-228.419*P+156.591*f,a=109.7927*U-18.9068-214.6334*P+146.5816*f,n=242.694*U-41.122-471.094*P+313.953*f,o=841.88*U-146.407-1629.014*P+1083.435*f,c=3017.977*U-532.114-5740.032*P+3708.276*f):(i=331.819*U-72.099-508.738*P+266.724*f,r=1582.851*U-346.844-2415.925*P+1246.113*f,a=1554.908*U-342.585-2366.899*P+1215.972*f,n=4758.686*U-1052.797-7193.992*P+3651.957*f,o=16178.11*U-3581.69-24462.77*P+12422.52*f,c=U>.715?29936.92*U-5149.66-54087.36*P+31324.56*f:1464.74-4664.75*U+3763.64*P),U<.7?(u=4988.61*U-919.2277-9064.77*P+5542.21*f,l=4568.6173*U-822.71072-8491.4146*P+5337.524*f,h=4690.25*U-853.666-8624.77*P+5341.4*f):(u=161616.52*U-37995.78-229838.2*P+109377.94*f,l=218913.95*U-51752.104-309468.16*P+146349.42*f,h=170470.89*U-40023.88-242699.48*P+115605.82*f),W=(d=17891679e-13*(p=G*G*3*(g*g)))*(t=.75*(1+2*I+(E=I*I)))*(-.306-.44*(U-.64)),Y=d*(1.5*(m=S*S))*i,j=(d=3.7393792e-7*(p*=g))*(1.875*S*(1-2*I-3*E))*r,B=d*(-1.875*S*(1+2*I-3*E))*a,q=(d=2*(p*=g)*7.3636953e-9)*(35*m*t)*n,K=d*(39.375*m*m)*o,Z=(d=1.1428639e-7*(p*=g))*(9.84375*S*(m*(1-2*I-5*E)+.33333333*(4*I-2+6*E)))*c,X=d*(S*(4.92187512*m*(-2-4*I+10*E)+6.56250012*(1+2*I-3*E)))*h,J=(d=2*p*2.1765803e-9)*(29.53125*S*(2-8*I+E*(8*I-12+10*E)))*l,Q=d*(29.53125*S*(-2-8*I+E*(12+8*I-10*E)))*u,ne=(O+C+C-(pe+pe))%Re,ae=L+x+2*(M+ee-le)-v,U=ge,P=Ee}1===z&&(s=1+I,ie=2*(se=3*G*G*g*g)*(t=.75*(1+I)*(1+I))*(1+P*(.8125*P-2.5))*17891679e-13,re=3*se*(s*=1.875*s*s)*(1+P*(6.60937*P-6))*2.2123015e-7*g,se=se*(.9375*S*S*(1+3*I)-.75*(1+I))*(r=1+2*P)*21460748e-13*g,ne=(O+C+A-pe)%Re,ae=L+D+x+te+ee-(v+le)),oe=ne,ce=v,H=0,G=v+0}return{em:U,argpm:$,inclm:F,mm:V,nm:G,nodem:k,irez:z,atime:H,d2201:W,d2211:Y,d3210:j,d3222:B,d4410:q,d4422:K,d5220:Z,d5232:X,d5421:J,d5433:Q,dedt:R,didt:N,dmdt:x,dndt:0,dnodt:ee,domdt:te,del1:se,del2:ie,del3:re,xfact:ae,xlamo:ne,xli:oe,xni:ce}}({cosim:s,emsq:u,argpo:le.argpo,s1:x,s2:I,s3:A,s4:T,s5:S,sinim:i,ss1:y,ss2:O,ss3:L,ss4:v,ss5:C,sz1:M,sz3:D,sz11:b,sz13:w,sz21:P,sz23:U,sz31:$,sz33:F,t:le.t,tc:0,gsto:le.gsto,mo:le.mo,mdot:le.mdot,no:le.no,nodeo:le.nodeo,nodedot:le.nodedot,xpidot:W,z1:j,z3:B,z11:q,z13:K,z21:Z,z23:X,z31:J,z33:Q,ecco:le.ecco,eccsq:Ee,em:h,argpm:0,inclm:p,mm:0,nm:g,nodem:0,irez:le.irez,atime:le.atime,d2201:le.d2201,d2211:le.d2211,d3210:le.d3210,d3222:le.d3222,d4410:le.d4410,d4422:le.d4422,d5220:le.d5220,d5232:le.d5232,d5421:le.d5421,d5433:le.d5433,dedt:le.dedt,didt:le.didt,dmdt:le.dmdt,dnodt:le.dnodt,domdt:le.domdt,del1:le.del1,del2:le.del2,del3:le.del3,xfact:le.xfact,xlamo:le.xlamo,xli:le.xli,xni:le.xni});le.irez=$e.irez,le.atime=$e.atime,le.d2201=$e.d2201,le.d2211=$e.d2211,le.d3210=$e.d3210,le.d3222=$e.d3222,le.d4410=$e.d4410,le.d4422=$e.d4422,le.d5220=$e.d5220,le.d5232=$e.d5232,le.d5421=$e.d5421,le.d5433=$e.d5433,le.dedt=$e.dedt,le.didt=$e.didt,le.dmdt=$e.dmdt,le.dnodt=$e.dnodt,le.domdt=$e.domdt,le.del1=$e.del1,le.del2=$e.del2,le.del3=$e.del3,le.xfact=$e.xfact,le.xlamo=$e.xlamo,le.xli=$e.xli,le.xni=$e.xni}1!==le.isimp&&(r=le.cc1*le.cc1,le.d2=4*me*H*r,V=le.d2*H*le.cc1/3,le.d3=(17*me+_)*V,le.d4=.5*V*me*H*(221*me+31*_)*le.cc1,le.t3cof=le.d2+2*r,le.t4cof=.25*(3*le.d3+le.cc1*(12*le.d2+10*r)),le.t5cof=.2*(3*le.d4+12*le.cc1*le.d3+6*le.d2*le.d2+15*r*(2*le.d2+r)))}we(le,0),le.init="n"}(E,{opsmode:"i",satn:E.satnum,epoch:E.jdsatepoch-2433281.5,xbstar:E.bstar,xecco:E.ecco,xargpo:E.argpo,xinclo:E.inclo,xmo:E.mo,xno:E.no,xnodeo:E.nodeo}),E}!function(e){e[e.None=0]="None",e[e.MeanEccentricityOutOfRange=1]="MeanEccentricityOutOfRange",e[e.MeanMotionBelowZero=2]="MeanMotionBelowZero",e[e.PerturbedEccentricityOutOfRange=3]="PerturbedEccentricityOutOfRange",e[e.SemiLatusRectumBelowZero=4]="SemiLatusRectumBelowZero",e[e.Decayed=6]="Decayed"}(Ee||(Ee={}));var Ue=7292115e-11;function $e(e,t,s){var i=t.x-e.x,r=t.y-e.y,a=t.z-e.z,n=Math.sqrt(Math.pow(i,2)+Math.pow(r,2)+Math.pow(a,2));return 1-(i*(s.x+Ue*e.y)+r*(s.y-Ue*e.x)+a*s.z)/n/299792.458}function Fe(e){return e*xe}function Ve(e){return e*Ne}function Ge(e){if(e<-fe/2||e>fe/2)throw new RangeError("Latitude radians must be in range [-pi/2; pi/2].");return Fe(e)}function ke(e){if(e<-fe||e>fe)throw new RangeError("Longitude radians must be in range [-pi; pi].");return Fe(e)}function ze(e){var t=e.longitude,s=e.latitude,i=e.height,r=6378.137,a=(r-6356.7523142)/r,n=2*a-a*a,o=r/Math.sqrt(1-n*(Math.sin(s)*Math.sin(s)));return{x:(o+i)*Math.cos(s)*Math.cos(t),y:(o+i)*Math.cos(s)*Math.sin(t),z:(o*(1-n)+i)*Math.sin(s)}}function He(e,t){return{x:e.x*Math.cos(t)+e.y*Math.sin(t),y:e.x*-Math.sin(t)+e.y*Math.cos(t),z:e.z}}function We(e){try{const t=["1",e.satelliteNumber1.padStart(5," "),e.classification," ",e.internationalDesignatorYear.padStart(2," "),e.internationalDesignatorLaunchNumber.padStart(3," "),e.internationalDesignatorPiece.padEnd(3," ")," ",e.epochYear.padStart(2," "),e.epoch.padStart(12," ")," ",e.firstDerivative.padStart(10," ")," ",e.secondDerivative.padStart(8," ")," ",e.bStar.padStart(8," ")," ",e.ephemerisType," ",e.elementSetNumber.padStart(4," "),e.checksum1],s=["2",e.satelliteNumber2.padStart(5," ")," ",e.inclination.padStart(8," ")," ",e.rightAscension.padStart(8," ")," ",e.eccentricity.padStart(7," ")," ",e.argumentOfPerigee.padStart(8," ")," ",e.meanAnomaly.padStart(8," ")," ",e.meanMotion.padStart(11," "),e.revolutionNumber.padStart(5," "),e.checksum2],i=Pe(t.join(""),s.join(""));return i.error?(console.error(`Satellite record initialization error: ${i.error}`),null):i}catch(e){return console.error("Failed to initialize satellite record:",e),null}}function Ye(e,t){const s=We(e);if(!s)return null;const i=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];return we(e,1440*(Ce.apply(void 0,s)-e.jdsatepoch))}(s,t);if(!i||!i.position||!i.velocity)return null;const r=i.position,a=i.velocity,n=function(e,t){for(var s=6378.137,i=Math.sqrt(e.x*e.x+e.y*e.y),r=(s-6356.7523142)/s,a=2*r-r*r,n=Math.atan2(e.y,e.x)-t;n<-fe;)n+=Re;for(;n>fe;)n-=Re;for(var o,c=0,l=Math.atan2(e.z,Math.sqrt(e.x*e.x+e.y*e.y));c++<20;)o=1/Math.sqrt(1-a*(Math.sin(l)*Math.sin(l))),l=Math.atan2(e.z+s*o*a*Math.sin(l),i);return{longitude:n,latitude:l,height:i/Math.cos(l)-s*o}}(r,be(t));return{timestamp:t,position:r,velocity:a,geographicLocation:{latitude:Ge(n.latitude),longitude:ke(n.longitude),altitude:n.height},altitude:n.height}}function je(e,t,s,i=60){if(!We(e))return null;const r=[],a=t.getTime(),n=s.getTime();for(let t=a;t<=n;t+=1e3*i){const s=Ye(e,new Date(t));s&&r.push(s)}return r}function Be(e,t,s){const i=Ye(e,s);if(!i)return null;const r=be(s),a=(n={latitude:Ve(t.latitude),longitude:Ve(t.longitude),height:t.altitude},o=He(i.position,r),p=function(e,t){var s=e.longitude,i=e.latitude,r=ze(e),a=t.x-r.x,n=t.y-r.y,o=t.z-r.z;return{topS:Math.sin(i)*Math.cos(s)*a+Math.sin(i)*Math.sin(s)*n-Math.cos(i)*o,topE:-Math.sin(s)*a+Math.cos(s)*n,topZ:Math.cos(i)*Math.cos(s)*a+Math.cos(i)*Math.sin(s)*n+Math.sin(i)*o}}(n,o),l=(c=p).topS,h=c.topE,u=c.topZ,m=Math.sqrt(l*l+h*h+u*u),d=Math.asin(u/m),{azimuth:Math.atan2(-h,l)+fe,elevation:d,rangeSat:m});var n,o,c,l,h,u,m,d,p;return{azimuth:ke(a.azimuth),elevation:Ge(a.elevation),range:a.rangeSat}}function qe(e){try{const t=parseFloat(e.meanMotion);return t<=0?null:1440/t}catch{return null}}function Ke(e){try{const t=We(e);if(!t)return null;const s=parseFloat(e.meanMotion),i=t.inclo,r=t.ecco,a=t.argpo,n=t.nodeo,o=t.mo,c=1440/s,l=398600.4418,h=60*c,u=Math.pow(l*h**2/(4*Math.PI**2),1/3),m=6378.137,d=u*(1-r)-m,p=u*(1+r)-m;let g="Unknown";return d<2e3?g="LEO":d>=2e3&&p<35786?g="MEO":Math.abs(p-35786)<100&&r<.01?g="GEO":p>=35786&&(g="HEO"),{periodMinutes:c,semiMajorAxis:u,perigeeAltitude:d,apogeeAltitude:p,meanMotionRevPerDay:s,inclinationDegrees:i*(180/Math.PI),eccentricity:r,argumentOfPerigee:a*(180/Math.PI),rightAscension:n*(180/Math.PI),meanAnomaly:o*(180/Math.PI),orbitType:g}}catch{return null}}function Ze(e){const t=parseInt(e.epochYear),s=t<57?2e3+t:1900+t,i=parseFloat(e.epoch),r=Math.floor(i),a=i-r,n=new Date(Date.UTC(s,0,r));return n.setUTCMilliseconds(864e5*a),n}const Xe={lineNumber1:[0,1],satelliteNumber1:[2,7],classification:[7,8],internationalDesignatorYear:[9,11],internationalDesignatorLaunchNumber:[11,14],internationalDesignatorPiece:[14,17],epochYear:[18,20],epoch:[20,32],firstDerivative:[33,43],secondDerivative:[44,52],bStar:[53,61],ephemerisType:[62,63],elementSetNumber:[64,68],checksum1:[68,69],lineNumber2:[0,1],satelliteNumber2:[2,7],inclination:[8,16],rightAscension:[17,25],eccentricity:[26,33],argumentOfPerigee:[34,42],meanAnomaly:[43,51],meanMotion:[52,63],revolutionNumber:[63,68],checksum2:[68,69]};class Je extends Error{constructor(e,t,s=[]){super(e),this.name="TLEValidationError",this.errors=t,this.warnings=s,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Qe extends Error{constructor(e,t,s={}){super(e),this.name="TLEFormatError",this.code=t,this.details=s,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}function et(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}function tt(e){return et(e).split("\n").map(e=>e.replace(/\t/g," ").trim()).filter(e=>e.length>0)}function st(e){let t=0;for(let s=0;s<e.length-1;s++){const i=e[s];i&&i>="0"&&i<="9"?t+=parseInt(i,10):"-"===i&&(t+=1)}return t%10}function it(e){if(69!==e.length)return{isValid:!1,expected:null,actual:null,error:{code:exports.ERROR_CODES.INVALID_LINE_LENGTH,message:"Line length must be 69 characters",field:"line_length",expected:69,actual:e.length,severity:"error"}};const t=st(e),s=parseInt(e[68]||"",10);if(isNaN(s))return{isValid:!1,expected:t,actual:null,error:{code:exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER,message:"Checksum position must contain a digit",field:"checksum",position:68,value:e[68],severity:"error"}};const i=t===s;return{isValid:i,expected:t,actual:s,error:i?null:{code:exports.ERROR_CODES.CHECKSUM_MISMATCH,message:`Checksum mismatch: expected ${t}, got ${s}`,field:"checksum",expected:t,actual:s,severity:"error"}}}function rt(e,t){const s=[];if(69!==e.length)return s.push({code:exports.ERROR_CODES.INVALID_LINE_LENGTH,message:`Line ${t} must be exactly 69 characters (got ${e.length})`,line:t,field:"line_length",expected:69,actual:e.length,severity:"error"}),{isValid:!1,errors:s};const i=e[0];i!==t.toString()&&s.push({code:exports.ERROR_CODES.INVALID_LINE_NUMBER,message:`Line ${t} must start with '${t}' (got '${i}')`,line:t,field:"line_number",expected:t.toString(),actual:i,severity:"error"});const r=it(e);return!r.isValid&&r.error&&s.push({...r.error,line:t,message:`Line ${t}: ${r.error.message}`}),{isValid:0===s.length,errors:s}}function at(e,t){const s=e.substring(2,7).trim(),i=t.substring(2,7).trim();return s!==i?{isValid:!1,error:{code:exports.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,message:`Satellite numbers must match (Line 1: ${s}, Line 2: ${i})`,field:"satellite_number",line1Value:s,line2Value:i,severity:"error"}}:/^\d+$/.test(s)?{isValid:!0,error:null}:{isValid:!1,error:{code:exports.ERROR_CODES.INVALID_SATELLITE_NUMBER,message:`Satellite number must be numeric (got '${s}')`,field:"satellite_number",value:s,severity:"error"}}}function nt(e){const t=e[7],s=["U","C","S"];return s.includes(t||"")?{isValid:!0,error:null}:{isValid:!1,error:{code:exports.ERROR_CODES.INVALID_CLASSIFICATION,message:`Classification must be U, C, or S (got '${t}')`,field:"classification",expected:s,actual:t,severity:"error"}}}function ot(e,t,s,i){const r=parseFloat(e);return isNaN(r)?{isValid:!1,error:{code:exports.ERROR_CODES.INVALID_NUMBER_FORMAT,message:`${t} must be numeric (got '${e}')`,field:t,value:e,severity:"error"}}:r<s||r>i?{isValid:!1,error:{code:exports.ERROR_CODES.VALUE_OUT_OF_RANGE,message:`${t} must be between ${s} and ${i} (got ${r})`,field:t,value:r,min:s,max:i,severity:"error"}}:{isValid:!0,error:null}}function ct(e){const t=[],s=e[7];return"C"!==s&&"S"!==s||t.push({code:exports.ERROR_CODES.CLASSIFIED_DATA_WARNING,message:`Classification '${s}' is unusual in public TLE data (typically 'U' for unclassified)`,field:"classification",value:s,severity:"warning"}),t}function lt(e){const t=[],s=parseInt(e.substring(18,20),10),i=parseFloat(e.substring(20,32));if(isNaN(s)||isNaN(i))return t;const r=s>=57?1900+s:2e3+s;r<2e3&&t.push({code:exports.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,message:`Epoch year ${r} is in the deprecated 1900s range (two-digit year: ${s})`,field:"epochYear",value:s,fullYear:r,severity:"warning"});const a=new Date(r,0,1);a.setDate(a.getDate()+i-1);const n=((new Date).getTime()-a.getTime())/864e5;return n>30&&t.push({code:exports.ERROR_CODES.STALE_TLE_WARNING,message:`TLE epoch is ${Math.floor(n)} days old (epoch: ${a.toISOString().split("T")[0]}). TLE data may be stale.`,field:"epoch",daysSinceEpoch:Math.floor(n),epochDate:a.toISOString().split("T")[0],severity:"warning"}),t}function ht(e){const t=[],s=parseFloat("0."+e.substring(26,33).trim());!isNaN(s)&&s>.25&&t.push({code:exports.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,message:`Eccentricity ${s.toFixed(7)} is unusually high. This indicates a highly elliptical orbit.`,field:"eccentricity",value:s,severity:"warning"});const i=parseFloat(e.substring(52,63).trim());!isNaN(i)&&i<1&&t.push({code:exports.ERROR_CODES.LOW_MEAN_MOTION_WARNING,message:`Mean motion ${i.toFixed(8)} rev/day is unusually low. This indicates a very high orbit.`,field:"meanMotion",value:i,severity:"warning"});const r=parseInt(e.substring(63,68).trim(),10);return!isNaN(r)&&r>9e4&&t.push({code:exports.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,message:`Revolution number ${r} is approaching rollover limit (99999). Counter may reset soon.`,field:"revolutionNumber",value:r,severity:"warning"}),t}function ut(e){const t=[],s=e.substring(53,61).trim();"00000-0"!==s&&"00000+0"!==s&&"00000 0"!==s||t.push({code:exports.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,message:"B* drag term is zero or near-zero, which is unusual for most satellites in LEO",field:"bStar",value:s,severity:"warning"});const i=parseFloat(e.substring(33,43).trim());!isNaN(i)&&i<0&&t.push({code:exports.ERROR_CODES.NEGATIVE_DECAY_WARNING,message:`First derivative of mean motion is negative (${i}), indicating orbital decay`,field:"firstDerivative",value:i,severity:"warning"});const r=e.substring(62,63).trim();return"0"!==r&&""!==r&&t.push({code:exports.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,message:`Ephemeris type '${r}' is non-standard (expected '0' for SGP4/SDP4)`,field:"ephemerisType",value:r,severity:"warning"}),t}function mt(e,t={}){if("string"!=typeof e)throw new TypeError("TLE data must be a string");if("object"!=typeof t||null===t||Array.isArray(t))throw new TypeError("Options must be an object");if(0===e.length)throw new Qe("TLE string cannot be empty",exports.ERROR_CODES.EMPTY_INPUT,{inputLength:0});const{strictChecksums:s=!0,validateRanges:i=!0,mode:r="strict"}=t;if("strict"!==r&&"permissive"!==r)throw new TypeError('Mode must be either "strict" or "permissive"');const a=[],n=[],o=et(e).trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0&&!e.startsWith("#"));if(o.length<2)return a.push({code:exports.ERROR_CODES.INVALID_LINE_COUNT,message:"TLE must contain at least 2 lines",field:"line_count",expected:"2 or 3",actual:o.length,severity:"error"}),{isValid:!1,errors:a,warnings:n};if(o.length>3)return a.push({code:exports.ERROR_CODES.INVALID_LINE_COUNT,message:`TLE must contain 2 or 3 lines (got ${o.length})`,field:"line_count",expected:"2 or 3",actual:o.length,severity:"error"}),{isValid:!1,errors:a,warnings:n};let c=0,l=1;if(3===o.length){c=1,l=2;const e=o[0];!e||"1"!==e[0]&&"2"!==e[0]||n.push({code:exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,message:'Line 0 starts with "1" or "2", might be incorrectly formatted',field:"satellite_name",value:e,severity:"warning"}),e&&e.length>24&&n.push({code:exports.ERROR_CODES.SATELLITE_NAME_TOO_LONG,message:"Satellite name (Line 0) should be 24 characters or less",field:"satellite_name",expected:24,actual:e.length,severity:"warning"})}const h=o[c],u=o[l];if(!h||!u)return a.push({code:exports.ERROR_CODES.INVALID_LINE_COUNT,message:"Missing required TLE lines",severity:"error"}),{isValid:!1,errors:a,warnings:n};const m=rt(h,1);if(!m.isValid)if("permissive"===r){const e=m.errors.filter(e=>e.code!==exports.ERROR_CODES.CHECKSUM_MISMATCH&&e.code!==exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER),t=m.errors.filter(e=>e.code===exports.ERROR_CODES.CHECKSUM_MISMATCH||e.code===exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER);if(a.push(...e),n.push(...t.map(e=>({...e,severity:"warning"}))),e.length>0)return{isValid:!1,errors:a,warnings:n}}else if(a.push(...m.errors),s)return{isValid:!1,errors:a,warnings:n};const d=rt(u,2);if(!d.isValid)if("permissive"===r){const e=d.errors.filter(e=>e.code!==exports.ERROR_CODES.CHECKSUM_MISMATCH&&e.code!==exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER),t=d.errors.filter(e=>e.code===exports.ERROR_CODES.CHECKSUM_MISMATCH||e.code===exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER);if(a.push(...e),n.push(...t.map(e=>({...e,severity:"warning"}))),e.length>0)return{isValid:!1,errors:a,warnings:n}}else if(a.push(...d.errors),s)return{isValid:!1,errors:a,warnings:n};const p=at(h,u);!p.isValid&&p.error&&("permissive"===r?n.push({...p.error,severity:"warning"}):a.push(p.error));const g=nt(h);if(!g.isValid&&g.error&&("permissive"===r?n.push({...g.error,severity:"warning"}):a.push(g.error)),i&&69===h.length&&69===u.length){const e=[{value:h.substring(2,7).trim(),name:"Satellite Number",min:1,max:99999},{value:h.substring(9,11).trim(),name:"International Designator Year",min:0,max:99,optional:!0},{value:h.substring(11,14).trim(),name:"International Designator Launch Number",min:1,max:999,optional:!0},{value:h.substring(62,63).trim(),name:"Ephemeris Type",min:0,max:9,optional:!0},{value:h.substring(64,68).trim(),name:"Element Set Number",min:0,max:9999,optional:!0},{value:h.substring(18,20).trim(),name:"Epoch Year",min:0,max:99},{value:h.substring(20,32).trim(),name:"Epoch Day",min:1,max:366.99999999},{value:u.substring(8,16).trim(),name:"Inclination",min:0,max:180},{value:u.substring(17,25).trim(),name:"Right Ascension",min:0,max:360},{value:"0."+u.substring(26,33).trim(),name:"Eccentricity",min:0,max:1},{value:u.substring(34,42).trim(),name:"Argument of Perigee",min:0,max:360},{value:u.substring(43,51).trim(),name:"Mean Anomaly",min:0,max:360},{value:u.substring(52,63).trim(),name:"Mean Motion",min:0,max:20,warningOnly:!0},{value:u.substring(63,68).trim(),name:"Revolution Number",min:0,max:99999,optional:!0}];for(const{value:t,name:s,min:i,max:o,optional:c,warningOnly:l}of e){if(c&&0===t.length)continue;const e=ot(t,s,i,o);!e.isValid&&e.error&&(l||"permissive"===r?n.push({...e.error,severity:"warning"}):a.push(e.error))}}return 69===h.length&&(n.push(...ct(h)),n.push(...lt(h)),n.push(...ut(h))),69===u.length&&n.push(...ht(u)),{isValid:0===a.length,errors:a,warnings:n}}function dt(e,t={}){if("string"!=typeof e)throw new TypeError("TLE data must be a string");if("object"!=typeof t||null===t||Array.isArray(t))throw new TypeError("Options must be an object");const{validate:s=!0,strictChecksums:i=!0,validateRanges:r=!0,includeWarnings:a=!0,includeComments:n=!0,mode:o="strict"}=t;let c=[];if(s){const t=mt(e,{strictChecksums:i,validateRanges:r,mode:o});if(!t.isValid){const e="TLE validation failed:\n"+t.errors.map(e=>"string"==typeof e?e:e.message).join("\n");throw new Je(e,t.errors,t.warnings)}c=t.warnings}const l=et(e).trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0),h=l.filter(e=>e.startsWith("#")),u=l.filter(e=>!e.startsWith("#"));let m=0,d=1,p=null;3===u.length&&(p=u[0]||null,m=1,d=2);const g=u[m],E=u[d];if(!g||!E)throw new Qe("Missing required TLE lines",exports.ERROR_CODES.INVALID_LINE_COUNT);const f={satelliteName:p},R=["lineNumber2","satelliteNumber2","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion","revolutionNumber","checksum2"];for(const[e,t]of Object.entries(Xe)){const[s,i]=t,r=R.includes(e)?E:g;f[e]=r.substring(s,i).trim()}return a&&c.length>0&&(f.warnings=c),n&&h.length>0&&(f.comments=h),f}var pt={parseTLE:dt,validateTLE:mt,calculateChecksum:st,validateChecksum:it,validateLineStructure:rt,validateSatelliteNumber:at,validateClassification:nt,validateNumericRange:ot,checkClassificationWarnings:ct,checkEpochWarnings:lt,checkOrbitalParameterWarnings:ht,checkDragAndEphemerisWarnings:ut,normalizeLineEndings:et,parseTLELines:tt,TLEValidationError:Je,TLEFormatError:Qe,ERROR_CODES:exports.ERROR_CODES};exports.AMSATSource=class{constructor(e={}){this.baseUrl="https://www.amsat.org/tle/current/nasabare.txt",this.config={type:"amsat",baseUrl:e.baseUrl||this.baseUrl,enableCache:!1!==e.enableCache,cacheTTL:e.cacheTTL||36e5,timeout:e.timeout||3e4,rateLimit:e.rateLimit||{maxRequests:10,intervalMs:6e4},...e},this.rateLimiter=new oe(this.config.rateLimit),this.cache=new ce({maxSize:10,defaultTTL:this.config.cacheTTL,persistent:!0,cacheFile:"amsat-cache.json"})}async fetch(e={}){const t="amsat:all",s=Date.now();if(this.config.enableCache&&!e.forceRefresh){const i=this.cache.get(t);if(i){const t=E(i,e.parseOptions||{});return{data:t,source:"amsat",timestamp:new Date,cached:!0,count:t.length,age:Date.now()-s}}}const i=await this.rateLimiter.execute(async()=>{const e=new AbortController,t=setTimeout(()=>e.abort(),this.config.timeout);try{const t=await fetch(this.config.baseUrl,{headers:this.config.headers,signal:e.signal});if(!t.ok)throw new Error(`AMSAT fetch failed: ${t.status} ${t.statusText}`);return await t.text()}finally{clearTimeout(t)}});this.config.enableCache&&this.cache.set(t,i,this.config.cacheTTL);const r=E(i,e.parseOptions||{});return{data:r,source:"amsat",timestamp:new Date,cached:!1,count:r.length,age:Date.now()-s}}clearCache(){this.cache.clear()}getCacheStats(){return this.cache.getStats()}},exports.CONSTELLATIONS=me,exports.CelesTrakSource=class{constructor(e={}){this.baseUrl="https://celestrak.org/NORAD/elements/gp.php",this.config={type:"celestrak",baseUrl:e.baseUrl||this.baseUrl,enableCache:!1!==e.enableCache,cacheTTL:e.cacheTTL||36e5,timeout:e.timeout||3e4,rateLimit:e.rateLimit||{maxRequests:20,intervalMs:6e4},...e},this.rateLimiter=new oe(this.config.rateLimit),this.cache=new ce({maxSize:100,defaultTTL:this.config.cacheTTL,persistent:!0,cacheFile:"celestrak-cache.json"})}async fetch(e={}){const t=this.generateCacheKey(e),s=Date.now();if(this.config.enableCache&&!e.forceRefresh){const i=this.cache.get(t);if(i){const t=E(i,e.parseOptions||{});return{data:t,source:"celestrak",timestamp:new Date,cached:!0,count:t.length,age:Date.now()-s}}}const i=this.buildUrl(e),r=await this.rateLimiter.execute(async()=>{const e=new AbortController,t=setTimeout(()=>e.abort(),this.config.timeout);try{const t=await fetch(i,{headers:this.config.headers,signal:e.signal});if(!t.ok)throw new Error(`CelesTrak fetch failed: ${t.status} ${t.statusText}`);return await t.text()}finally{clearTimeout(t)}});this.config.enableCache&&this.cache.set(t,r,this.config.cacheTTL);const a=E(r,e.parseOptions||{});return{data:a,source:"celestrak",timestamp:new Date,cached:!1,count:a.length,age:Date.now()-s}}buildUrl(e){const t=new URLSearchParams;if(e.catalogNumber){const s=Array.isArray(e.catalogNumber)?e.catalogNumber:[e.catalogNumber];t.append("CATNR",s.join(",")),t.append("FORMAT","TLE")}else e.group?(t.append("GROUP",e.group),t.append("FORMAT","TLE")):e.namePattern?(t.append("NAME",e.namePattern),t.append("FORMAT","TLE")):e.intlDesignator?(t.append("INTDES",e.intlDesignator),t.append("FORMAT","TLE")):(t.append("GROUP","active"),t.append("FORMAT","TLE"));if(e.queryParams)for(const[s,i]of Object.entries(e.queryParams))t.append(s,i);return`${this.config.baseUrl}?${t.toString()}`}generateCacheKey(e){return he("celestrak",{catalog:e.catalogNumber,group:e.group,name:e.namePattern,intl:e.intlDesignator})}clearCache(){this.cache.clear()}getCacheStats(){return this.cache.getStats()}},exports.Colors=J,exports.CustomSource=class{constructor(e){if(!e.baseUrl)throw new Error("Custom source requires a base URL");this.config={...e,type:"custom",enableCache:!1!==e.enableCache,cacheTTL:e.cacheTTL||36e5,timeout:e.timeout||3e4,rateLimit:e.rateLimit||{maxRequests:10,intervalMs:6e4}},this.rateLimiter=new oe(this.config.rateLimit),this.cache=new ce({maxSize:50,defaultTTL:this.config.cacheTTL,persistent:!0,cacheFile:"custom-cache.json"})}async fetch(e={}){const t=e.queryParams?.url||this.config.baseUrl,s=he("custom",{url:t}),i=Date.now();if(this.config.enableCache&&!e.forceRefresh){const t=this.cache.get(s);if(t){const s=E(t,e.parseOptions||{});return{data:s,source:"custom",timestamp:new Date,cached:!0,count:s.length,age:Date.now()-i}}}const r=await this.rateLimiter.execute(async()=>{const e=new AbortController,s=setTimeout(()=>e.abort(),this.config.timeout);try{const s={...this.config.headers};this.config.credentials?.apiKey&&(s.Authorization=`Bearer ${this.config.credentials.apiKey}`);const i=await fetch(t,{headers:s,signal:e.signal});if(!i.ok)throw new Error(`Custom source fetch failed: ${i.status} ${i.statusText}`);return await i.text()}finally{clearTimeout(s)}});this.config.enableCache&&this.cache.set(s,r,this.config.cacheTTL);const a=E(r,e.parseOptions||{});return{data:a,source:"custom",timestamp:new Date,cached:!1,count:a.length,age:Date.now()-i}}clearCache(){this.cache.clear()}getCacheStats(){return this.cache.getStats()}},exports.DEFAULT_VALIDATION_RULES=K,exports.DESIGNATOR_CONSTRAINTS=M,exports.DataSourceManager=class{constructor(){this.sources=new Map,this.primarySource=null,this.failoverOrder=[]}register(e,t,s={}){this.sources.set(e,t),s.primary&&(this.primarySource=e),!1!==s.failover&&this.failoverOrder.push(e)}async fetch(e,t={}){const s=e||this.primarySource;if(!s)throw new Error("No data source specified and no primary source configured");const i=[s,...this.failoverOrder.filter(e=>e!==s)];let r=null;for(const e of i){const s=this.sources.get(e);if(s)try{return await s.fetch(t)}catch(t){r=t,console.error(`Failed to fetch from ${e}:`,t)}}throw new Error(`All data sources failed. Last error: ${r?.message||"Unknown error"}`)}getSource(e){return this.sources.get(e)}listSources(){return Array.from(this.sources.keys())}clearAllCaches(){for(const e of this.sources.values())e.clearCache()}},exports.EPOCH_CONSTRAINTS=C,exports.IncrementalParser=y,exports.MiddlewareParser=T,exports.ORBITAL_PARAMETER_RANGES=L,exports.QUALITY_SCORE_WEIGHTS=D,exports.RateLimiter=oe,exports.RateLimiterManager=class{constructor(){this.limiters=new Map}register(e,t){this.limiters.set(e,new oe(t))}get(e){return this.limiters.get(e)}async acquire(e){const t=this.limiters.get(e);if(!t)throw new Error(`No rate limiter registered for source: ${e}`);return t.acquire()}async execute(e,t){const s=this.limiters.get(e);if(!s)throw new Error(`No rate limiter registered for source: ${e}`);return s.execute(t)}getAllStatus(){const e=new Map;for(const[t,s]of this.limiters)e.set(t,s.getStatus());return e}resetAll(){for(const e of this.limiters.values())e.reset()}},exports.SATELLITE_NUMBER_RANGES=v,exports.SCHEDULE_INTERVALS={EVERY_15_MINUTES:9e5,EVERY_30_MINUTES:18e5,HOURLY:36e5,EVERY_2_HOURS:72e5,EVERY_6_HOURS:216e5,EVERY_12_HOURS:432e5,DAILY:864e5,WEEKLY:6048e5},exports.SchedulerManager=class{constructor(){this.schedulers=new Map}create(e,t,s){const i=new ge(t,s);return this.schedulers.set(e,i),i}get(e){return this.schedulers.get(e)}remove(e){const t=this.schedulers.get(e);return!!t&&(t.stop(),this.schedulers.delete(e))}startAll(){for(const e of this.schedulers.values())e.start()}stopAll(){for(const e of this.schedulers.values())e.stop()}getAllStatus(){const e=new Map;for(const[t,s]of this.schedulers)e.set(t,s.getStatus());return e}list(){return Array.from(this.schedulers.keys())}},exports.SpaceTrackSource=class{constructor(e={}){if(this.baseUrl="https://www.space-track.org",this.authUrl="https://www.space-track.org/ajaxauth/login",this.queryUrl="https://www.space-track.org/basicspacedata/query",this.sessionCookie=null,this.lastAuth=0,this.authTTL=72e5,!e.credentials?.username||!e.credentials?.password)throw new Error("Space-Track.org requires username and password credentials");this.config={type:"spacetrack",baseUrl:e.baseUrl||this.baseUrl,credentials:e.credentials,enableCache:!1!==e.enableCache,cacheTTL:e.cacheTTL||18e5,timeout:e.timeout||6e4,rateLimit:e.rateLimit||{maxRequests:20,intervalMs:6e4},...e},this.rateLimiter=new oe(this.config.rateLimit),this.cache=new ce({maxSize:100,defaultTTL:this.config.cacheTTL,persistent:!0,cacheFile:"spacetrack-cache.json"})}async authenticate(){if(this.sessionCookie&&Date.now()-this.lastAuth<this.authTTL)return;const e=new URLSearchParams;e.append("identity",this.config.credentials.username),e.append("password",this.config.credentials.password);const t=await fetch(this.authUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e.toString()});if(!t.ok)throw new Error(`Space-Track authentication failed: ${t.status} ${t.statusText}`);const s=t.headers.get("set-cookie");if(s){const e=s.match(/chocolatechip=([^;]+)/);e&&e[1]&&(this.sessionCookie=e[1],this.lastAuth=Date.now())}if(!this.sessionCookie)throw new Error("Failed to obtain Space-Track session cookie")}async fetch(e={}){const t=this.generateCacheKey(e),s=Date.now();if(this.config.enableCache&&!e.forceRefresh){const i=this.cache.get(t);if(i){const t=E(i,e.parseOptions||{});return{data:t,source:"spacetrack",timestamp:new Date,cached:!0,count:t.length,age:Date.now()-s}}}await this.authenticate();const i=this.buildUrl(e),r=await this.rateLimiter.execute(async()=>{const e=new AbortController,t=setTimeout(()=>e.abort(),this.config.timeout);try{const t=await fetch(i,{headers:{Cookie:`chocolatechip=${this.sessionCookie}`,...this.config.headers},signal:e.signal});if(!t.ok){if(401===t.status){this.sessionCookie=null,await this.authenticate();const t=await fetch(i,{headers:{Cookie:`chocolatechip=${this.sessionCookie}`,...this.config.headers},signal:e.signal});if(!t.ok)throw new Error(`Space-Track fetch failed: ${t.status} ${t.statusText}`);return await t.text()}throw new Error(`Space-Track fetch failed: ${t.status} ${t.statusText}`)}const s=await t.text();try{const e=JSON.parse(s);return this.jsonToTLE(e)}catch{return s}}finally{clearTimeout(t)}});this.config.enableCache&&this.cache.set(t,r,this.config.cacheTTL);const a=E(r,e.parseOptions||{});return{data:a,source:"spacetrack",timestamp:new Date,cached:!1,count:a.length,age:Date.now()-s}}buildUrl(e){let t="/class/gp/";return e.catalogNumber&&(t+=`NORAD_CAT_ID/${(Array.isArray(e.catalogNumber)?e.catalogNumber:[e.catalogNumber]).join(",")}/`),e.intlDesignator&&(t+=`INTLDES/${e.intlDesignator}/`),t+="orderby/EPOCH%20desc/limit/1000/format/tle",`${this.queryUrl}${t}`}jsonToTLE(e){return Array.isArray(e)?e.map(e=>{const t=[];return e.OBJECT_NAME&&t.push(e.OBJECT_NAME),e.TLE_LINE1&&t.push(e.TLE_LINE1),e.TLE_LINE2&&t.push(e.TLE_LINE2),t.join("\n")}).join("\n"):""}generateCacheKey(e){return he("spacetrack",{catalog:e.catalogNumber,intl:e.intlDesignator})}clearCache(){this.cache.clear()}getCacheStats(){return this.cache.getStats()}logout(){this.sessionCookie=null,this.lastAuth=0}},exports.TLECache=S,exports.TLEFormatError=Qe,exports.TLEParserStream=x,exports.TLEScheduler=ge,exports.TLEStateMachineParser=p,exports.TLEValidationError=Je,exports.TTLCache=ce,exports.ValidationRuleManager=class{constructor(e=K){this.rules=new Map;for(const t of e)this.rules.set(t.name,t)}addRule(e){this.rules.set(e.name,e)}removeRule(e){return this.rules.delete(e)}enableRule(e){const t=this.rules.get(e);return!!t&&(t.enabled=!0,!0)}disableRule(e){const t=this.rules.get(e);return!!t&&(t.enabled=!1,!0)}getEnabledRules(){return Array.from(this.rules.values()).filter(e=>e.enabled)}getRule(e){return this.rules.get(e)}getAllRules(){return Array.from(this.rules.values())}},exports.applyFilter=N,exports.calculateChecksum=st,exports.calculateDopplerShift=function(e,t,s,i){const r=Ye(e,s);if(!r)return null;const a=be(s),n={latitude:Ve(t.latitude),longitude:Ve(t.longitude),height:t.altitude},o=He(r.position,a),c=He(r.velocity,a),l=ze(n),h=$e(l,o,c),u=o.x-l.x,m=o.y-l.y,d=o.z-l.z,p=Math.sqrt(u**2+m**2+d**2),g=(u*c.x+m*c.y+d*c.z)/p,E=new Date(s.getTime()+1e3),f=Ye(e,E);let R=0;return f&&(R=(i*($e(l,He(f.position,be(E)),He(f.velocity,be(E)))-1)-i*(h-1))/1),{factor:h,shiftHz:i*(h-1),rateHzPerSecond:R,rangeRate:g}},exports.calculateEclipses=function(e,t,s){const i=[];let r=!1,a=null,n=0;const o=t.getTime(),c=s.getTime();for(let t=o;t<=c;t+=1e4){const s=new Date(t),o=Ye(e,s);if(!o)continue;const c=(Ce(s.getUTCFullYear(),s.getUTCMonth()+1,s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds())-2451545)/36525,l=(357.528+35999.05*c)%360,h=(280.46+36000.771*c)%360+1.915*Math.sin(l*Math.PI/180),u=149597870.7,m={x:u*Math.cos(h*Math.PI/180),y:u*Math.sin(h*Math.PI/180),z:0},d={x:m.x-o.position.x,y:m.y-o.position.y,z:m.z-o.position.z},p=Math.sqrt(d.x**2+d.y**2+d.z**2),g=Math.sqrt(o.position.x**2+o.position.y**2+o.position.z**2),E=-(o.position.x*d.x+o.position.y*d.y+o.position.z*d.z);let f=0;if(E>0&&g<7378.137){const e=Math.sqrt(g**2-(E/p)**2),t=6378.137*(1+E/u);f=Math.max(0,Math.min(1,1-e/t))}if(f>.1)r?n=Math.max(n,f):(r=!0,a=s,n=f);else if(r){const e=new Date(t-1e4);a&&i.push({start:a,end:e,duration:(e.getTime()-a.getTime())/1e3,type:n>.9?"umbra":"penumbra",depth:n}),r=!1,a=null,n=0}}return i},exports.calculateEpochAge=P,exports.calculateGroundTrack=function(e,t,s,i=60){const r=[],a=t.getTime(),n=s.getTime();for(let t=a;t<=n;t+=1e3*i){const s=new Date(t),i=Ye(e,s);if(i){const e=Math.sqrt(i.velocity.x**2+i.velocity.y**2+i.velocity.z**2);r.push({timestamp:s,location:i.geographicLocation,velocity:e})}}return r},exports.calculateLookAngles=Be,exports.calculateOrbitalParameters=Ke,exports.calculateOrbitalPeriod=qe,exports.calculateQualityScore=j,exports.calculateVisibilityWindows=function(e,t,s,i,r=0){const a=[];let n=!1,o=null,c=-90,l=null,h=null,u=null;const m=s.getTime(),d=i.getTime();for(let s=m;s<=d;s+=1e4){const i=new Date(s),m=Be(e,t,i);if(m)if(m.elevation>=r)n?m.elevation>c&&(c=m.elevation,l=i,u=m):(n=!0,o=i,c=m.elevation,l=i,h=m,u=m);else if(n){const i=new Date(s-1e4),r=Be(e,t,i);o&&l&&h&&u&&r&&a.push({aos:o,tca:l,los:i,maxElevation:c,duration:(i.getTime()-o.getTime())/1e3,angles:{aos:h,tca:u,los:r}}),n=!1,o=null,c=-90,l=null}}return a},exports.checkClassificationWarnings=ct,exports.checkDragAndEphemerisWarnings=ut,exports.checkEpochWarnings=lt,exports.checkOrbitalParameterWarnings=ht,exports.convertEpochToDate=b,exports.createCachedParser=function(e={}){const t=new S(e);return{parse:(e,s={})=>{const i=t.get(e,s);if(i)return i;const r=dt(e,s);return t.set(e,r,s),r},parseAsync:async(e,s={})=>{const i=t.get(e,s);if(i)return i;const r=await R(e,s);return t.set(e,r,s),r},cache:t}},exports.createConstellationFilter=function(e){const t=de(e);if(!t)return;const s={};if(t.catalogNumbers&&t.catalogNumbers.length>0&&(s.satelliteNumber=e=>{const s=parseInt(e,10);return!isNaN(s)&&t.catalogNumbers.some(e=>Array.isArray(e)?s>=e[0]&&s<=e[1]:s===e)}),t.namePatterns&&t.namePatterns.length>0){const e=s.satelliteName;s.satelliteName=s=>{const i=t.namePatterns.some(e=>e.test(s));return e&&"function"==typeof e?i&&e(s):i}}if(t.customFilter){const e=s.custom;s.custom=s=>{const i=t.customFilter(s);return e?i&&e(s):i}}return s},exports.createIncrementalParser=function(e,t={}){return new y(e,t)},exports.createMiddlewareParser=function(){return new T},exports.createTLEParserStream=I,exports.createValidationRule=function(e,t,s,i={}){return{name:e,description:t,severity:i.severity||"warning",enabled:!1!==i.enabled,validate:s,errorMessage:i.errorMessage}},exports.default=pt,exports.detectAnomalies=Y,exports.detectStationKeepingManeuver=function(e,t){try{const s=Ke(e),i=Ke(t);if(!s||!i)return{detected:!1};const r=Math.abs(i.semiMajorAxis-s.semiMajorAxis),a=Math.abs(i.eccentricity-s.eccentricity),n=Math.abs(i.inclinationDegrees-s.inclinationDegrees);if(!(r>.1||a>1e-4||n>.01))return{detected:!1};const o=398600.4418,c=Math.sqrt(o/s.semiMajorAxis),l=Math.sqrt(o/i.semiMajorAxis),h=1e3*Math.abs(l-c),u=Ze(e),m=Ze(t);return{detected:!0,deltaV:h,maneuverTime:new Date((u.getTime()+m.getTime())/2),elementChanges:{semiMajorAxis:r,eccentricity:a,inclination:n}}}catch{return{detected:!1}}},exports.filterByConstellation=function(e,t){return e.filter(e=>pe(e,t))},exports.filterByFreshness=function(e,t=2592e5){return e.filter(e=>ue(e,t).isFresh)},exports.formatAsCSV=te,exports.formatAsHuman=ae,exports.formatAsJSON=ee,exports.formatAsXML=ie,exports.formatAsYAML=re,exports.formatTLE=function(e,t={}){const{format:s="json"}=t;switch(s){case"json":return ee(e,t);case"csv":return te(e,t);case"xml":return ie(e,t);case"yaml":return re(e,t);case"human":return Array.isArray(e)?e.map(e=>ae(e,t)).join("\n\n"):ae(e,t);case"tle":return Array.isArray(e)?e.map(e=>ne(e,{includeName:!0})).join("\n\n"):ne(e,{includeName:!0});default:throw new Error(`Unsupported output format: ${s}`)}},exports.generateCacheKey=he,exports.generateOrbitVisualization=function(e,t=100){const s=qe(e);if(!s)return null;const i=new Date,r=new Date(i.getTime()+60*s*1e3),a=je(e,i,r,60*s/t);return a?{orbitPath:a.map(e=>e.position),groundTrack:a.map(e=>({timestamp:e.timestamp,location:e.geographicLocation,velocity:Math.sqrt(e.velocity.x**2+e.velocity.y**2+e.velocity.z**2)}))}:null},exports.generateValidationReport=function(e,t,s={}){const i=[],r=[],a=[],n=[],o=[];let c=0,l=0,h=0;if(!1!==s.validateChecksums){c+=2,o.push("checksum");const e=V(t.line1,1);e.valid?l++:(i.push({code:"CHECKSUM_MISMATCH",message:e.message||"Checksum validation failed",line:1,severity:"error",field:"checksum1"}),h++);const s=V(t.line2,2);s.valid?l++:(i.push({code:"CHECKSUM_MISMATCH",message:s.message||"Checksum validation failed",line:2,severity:"error",field:"checksum2"}),h++)}if(!1!==s.validateEpoch){c++,o.push("epochDate");const t=parseInt(e.epochYear,10),a=parseFloat(e.epoch),n=w(t,a);n.valid?l++:(i.push({code:"INVALID_EPOCH",message:n.message||"Invalid epoch date",severity:"error",field:"epoch"}),h++);const u=U(t,a,{referenceDate:s.referenceDate,allowFuture:s.allowFutureEpochs,maxAge:s.maxEpochAge});u.valid?u.message&&r.push({code:"STALE_EPOCH",message:u.message,severity:"warning",field:"epoch"}):i.push({code:"EPOCH_OUT_OF_RANGE",message:u.message||"Epoch age out of acceptable range",severity:"error",field:"epoch"})}const u={valid:[],invalid:[]};if(!1!==s.validateRanges){o.push("orbitalParameterRanges");const t=F(e,s.strict);c+=t.length;for(const e of t)e.valid?e.message?(r.push({code:"PARAMETER_OUTSIDE_TYPICAL",message:e.message,severity:"warning",field:e.context?.field}),l++,u.valid.push(e)):(l++,u.valid.push(e)):(i.push({code:"PARAMETER_OUT_OF_RANGE",message:e.message||"Parameter out of valid range",severity:"error",field:e.context?.field}),h++,u.invalid.push(e))}if(s.detectAnomalies&&(o.push("anomalyDetection"),a.push(...Y(e))),s.sanitizeFields){o.push("fieldSanitization");const t=q(e);for(const[e]of t)n.push(e)}c++,o.push("satelliteNumber");const m=k(e.satelliteNumber1);m.valid?l++:(i.push({code:"INVALID_SATELLITE_NUMBER",message:m.message||"Invalid satellite number",severity:"error",field:"satelliteNumber"}),h++),e.satelliteNumber1!==e.satelliteNumber2&&r.push({code:"SATELLITE_NUMBER_MISMATCH",message:`Satellite numbers do not match: ${e.satelliteNumber1} vs ${e.satelliteNumber2}`,severity:"warning",field:"satelliteNumber"}),c++,o.push("internationalDesignator");const d=z(e.internationalDesignatorYear+e.internationalDesignatorLaunchNumber+e.internationalDesignatorPiece);let p;if(d.valid?l++:(r.push({code:"INVALID_DESIGNATOR",message:d.message||"Invalid international designator",severity:"warning",field:"internationalDesignator"}),h++),!1!==s.calculateQuality){const t=P(parseInt(e.epochYear,10),parseFloat(e.epoch),s.referenceDate);p=j(e,{checksumValid:0===i.filter(e=>"CHECKSUM_MISMATCH"===e.code).length,formatValid:0===i.filter(e=>e.code?.includes("FORMAT")).length,rangeErrors:u.invalid,rangeResults:[...u.valid,...u.invalid],epochAge:t,anomalies:a})}else p={overall:0,components:{checksumScore:0,formatScore:0,rangeScore:0,epochScore:0,anomalyScore:0,consistencyScore:0},grade:"F",assessment:"Not calculated"};return{isValid:0===i.length,qualityScore:p,errors:i,warnings:r,anomalies:a,sanitizedFields:n,timestamp:new Date,rulesApplied:o,summary:{totalChecks:c,passedChecks:l,failedChecks:h,warningCount:r.length,errorCount:i.length}}},exports.getConstellation=de,exports.getErrorDescription=function(e){return{[exports.ERROR_CODES.INVALID_INPUT_TYPE]:"Input data must be a string",[exports.ERROR_CODES.EMPTY_INPUT]:"Input string is empty or contains only whitespace",[exports.ERROR_CODES.INVALID_LINE_COUNT]:"TLE must contain exactly 2 or 3 lines",[exports.ERROR_CODES.INVALID_LINE_LENGTH]:"TLE line must be exactly 69 characters",[exports.ERROR_CODES.INVALID_LINE_NUMBER]:"Line number must be 1 or 2",[exports.ERROR_CODES.CHECKSUM_MISMATCH]:"Calculated checksum does not match",[exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER]:"Checksum must be a digit 0-9",[exports.ERROR_CODES.SATELLITE_NUMBER_MISMATCH]:"Satellite numbers on line 1 and line 2 must match",[exports.ERROR_CODES.INVALID_SATELLITE_NUMBER]:"Satellite catalog number is invalid",[exports.ERROR_CODES.INVALID_CLASSIFICATION]:"Classification must be U, C, or S",[exports.ERROR_CODES.VALUE_OUT_OF_RANGE]:"Field value is outside valid range",[exports.ERROR_CODES.INVALID_NUMBER_FORMAT]:"Field contains invalid numeric format",[exports.ERROR_CODES.SATELLITE_NAME_TOO_LONG]:"Satellite name exceeds maximum length",[exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING]:"Satellite name contains unusual characters",[exports.ERROR_CODES.CLASSIFIED_DATA_WARNING]:"TLE contains classified satellite data",[exports.ERROR_CODES.STALE_TLE_WARNING]:"TLE epoch is significantly old",[exports.ERROR_CODES.HIGH_ECCENTRICITY_WARNING]:"Eccentricity is unusually high",[exports.ERROR_CODES.LOW_MEAN_MOTION_WARNING]:"Mean motion is unusually low",[exports.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING]:"Epoch year is in the far past",[exports.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING]:"Revolution number may have rolled over",[exports.ERROR_CODES.NEAR_ZERO_DRAG_WARNING]:"Drag coefficient is near zero",[exports.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING]:"Ephemeris type is non-standard",[exports.ERROR_CODES.NEGATIVE_DECAY_WARNING]:"Mean motion decay is negative"}[e]||"Unknown error code"},exports.getPositionAtEpoch=function(e){if(!We(e))return null;const t=parseInt(e.epochYear),s=t<57?2e3+t:1900+t,i=parseFloat(e.epoch),r=Math.floor(i),a=i-r,n=new Date(Date.UTC(s,0,r));return n.setUTCMilliseconds(864e5*a),Ye(e,n)},exports.getPositionAtTime=Ye,exports.getProfileOptions=_,exports.getProviderOptions=O,exports.groupByConstellation=function(e){const t=new Map;for(const s of e){let e=!1;for(const[i]of Object.entries(me))if(pe(s,i)){t.has(i)||t.set(i,[]),t.get(i).push(s),e=!0;break}e||(t.has("unknown")||t.set("unknown",[]),t.get("unknown").push(s))}return t},exports.initializeSatelliteRecord=We,exports.isCriticalError=function(e){return!c(e)},exports.isParseFailure=function(e){return!1===e.success},exports.isParseSuccess=function(e){return!0===e.success},exports.isParsedTLE=function(e){return"object"==typeof e&&null!==e&&["lineNumber1","satelliteNumber1","classification","lineNumber2","satelliteNumber2","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion"].every(t=>t in e)},exports.isTLEError=d,exports.isTLEWarning=function(e){return d(e)&&"warning"===e.severity},exports.isValidClassification=function(e){return"U"===e||"C"===e||"S"===e},exports.isValidErrorCode=function(e){return Object.values(exports.ERROR_CODES).includes(e)},exports.isValidationFailure=function(e){return!1===e.success},exports.isValidationSuccess=function(e){return!0===e.success},exports.isWarningCode=c,exports.listConstellations=function(){return Object.keys(me)},exports.matchesConstellation=pe,exports.normalizeAssumedDecimalNotation=G,exports.normalizeLineEndings=et,exports.normalizeScientificNotation=function(e,t="standard"){return"assumedDecimal"===t?G(e):"integer"===t?parseInt(e.trim(),10):parseFloat(e.trim())},exports.parseBatch=E,exports.parseBatchAsync=async function(e,t={}){return Promise.resolve(E(e,t))},exports.parseFromCompressed=async function(e,t={}){const i=s.createReadStream(e),r=o.createGunzip();return A(i.pipe(r),t)},exports.parseFromFile=async function(e,t={}){const{encoding:s="utf8",...i}=t;return E(await g(e,{encoding:s}),i)},exports.parseFromStream=A,exports.parseFromURL=async function(e,t={}){const{headers:s,timeout:i=3e4,...r}=t,a=new AbortController,n=setTimeout(()=>a.abort(),i);try{const t=await fetch(e,{headers:s,signal:a.signal});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return E(await t.text(),r)}finally{clearTimeout(n)}},exports.parseInterval=function(e){const t=e.match(/^(\d+)\s*(ms|s|m|h|d|w)$/i);if(!t||!t[1]||!t[2])throw new Error(`Invalid interval format: ${e}`);const s=parseInt(t[1],10),i=t[2].toLowerCase();switch(i){case"ms":return s;case"s":return 1e3*s;case"m":return 60*s*1e3;case"h":return 60*s*60*1e3;case"d":return 24*s*60*60*1e3;case"w":return 7*s*24*60*60*1e3;default:throw new Error(`Unknown interval unit: ${i}`)}},exports.parseParallel=async function(e,t={},s){return E(e,t)},exports.parseTLE=dt,exports.parseTLEAsync=R,exports.parseTLELines=tt,exports.parseWithProfile=function(e,t){return dt(e,_(t))},exports.parseWithProvider=function(e,t){return dt(e,O(t))},exports.parseWithStateMachine=function(e,t={}){return new p(t).parse(e)},exports.predictConjunctions=function(e,t,s,i,r=10){const a=[];let n=1/0,o=!1;const c=s.getTime(),l=i.getTime();for(let s=c;s<=l;s+=6e4){const i=new Date(s),c=Ye(e,i),l=Ye(t,i);if(!c||!l)continue;const h=Math.sqrt((c.position.x-l.position.x)**2+(c.position.y-l.position.y)**2+(c.position.z-l.position.z)**2);if(h<n)o=!0;else if(o&&h>n){if(n<=r){const i=Math.sqrt((c.velocity.x-l.velocity.x)**2+(c.velocity.y-l.velocity.y)**2+(c.velocity.z-l.velocity.z)**2);let r="low";n<1?r="critical":n<2?r="high":n<5&&(r="medium");const o=new Date(s-6e4),h=Ye(e,o),u=Ye(t,o);h&&u&&a.push({time:o,distance:n,relativeVelocity:i,satellite1Position:h.position,satellite2Position:u.position,riskLevel:r})}o=!1}n=h}return a},exports.predictFuturePositions=je,exports.reconstructTLE=ne,exports.sanitizeAllFields=q,exports.sanitizeField=B,exports.splitTLEs=f,exports.tleCache=le,exports.validateAllOrbitalParameters=F,exports.validateChecksum=it,exports.validateClassification=nt,exports.validateEpochAge=U,exports.validateEpochDate=w,exports.validateFreshness=ue,exports.validateInternationalDesignator=z,exports.validateLineStructure=rt,exports.validateNumericRange=ot,exports.validateOrbitalParameter=$,exports.validateSatelliteNumber=at,exports.validateTLE=mt,exports.validateTLEAsync=async function(e,t={}){return Promise.resolve(mt(e,t))};
//# sourceMappingURL=index.min.cjs.map
