/**
 * tle-parser v1.0.0
 * A parser for TLE (Two-Line Element) satellite data.
 * @license MIT
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("fs/promises"),i=require("fs"),s=require("path"),r=require("os"),n=require("util"),a=require("stream"),o=require("zlib");function c(e){return[exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,exports.ERROR_CODES.CLASSIFIED_DATA_WARNING,exports.ERROR_CODES.STALE_TLE_WARNING,exports.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,exports.ERROR_CODES.LOW_MEAN_MOTION_WARNING,exports.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,exports.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,exports.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,exports.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,exports.ERROR_CODES.NEGATIVE_DECAY_WARNING].includes(e)}exports.ERROR_CODES=void 0,(e=exports.ERROR_CODES||(exports.ERROR_CODES={})).INVALID_INPUT_TYPE="INVALID_INPUT_TYPE",e.EMPTY_INPUT="EMPTY_INPUT",e.INVALID_LINE_COUNT="INVALID_LINE_COUNT",e.INVALID_LINE_LENGTH="INVALID_LINE_LENGTH",e.INVALID_LINE_NUMBER="INVALID_LINE_NUMBER",e.CHECKSUM_MISMATCH="CHECKSUM_MISMATCH",e.INVALID_CHECKSUM_CHARACTER="INVALID_CHECKSUM_CHARACTER",e.SATELLITE_NUMBER_MISMATCH="SATELLITE_NUMBER_MISMATCH",e.INVALID_SATELLITE_NUMBER="INVALID_SATELLITE_NUMBER",e.INVALID_CLASSIFICATION="INVALID_CLASSIFICATION",e.VALUE_OUT_OF_RANGE="VALUE_OUT_OF_RANGE",e.INVALID_NUMBER_FORMAT="INVALID_NUMBER_FORMAT",e.SATELLITE_NAME_TOO_LONG="SATELLITE_NAME_TOO_LONG",e.SATELLITE_NAME_FORMAT_WARNING="SATELLITE_NAME_FORMAT_WARNING",e.CLASSIFIED_DATA_WARNING="CLASSIFIED_DATA_WARNING",e.STALE_TLE_WARNING="STALE_TLE_WARNING",e.HIGH_ECCENTRICITY_WARNING="HIGH_ECCENTRICITY_WARNING",e.LOW_MEAN_MOTION_WARNING="LOW_MEAN_MOTION_WARNING",e.DEPRECATED_EPOCH_YEAR_WARNING="DEPRECATED_EPOCH_YEAR_WARNING",e.REVOLUTION_NUMBER_ROLLOVER_WARNING="REVOLUTION_NUMBER_ROLLOVER_WARNING",e.NEAR_ZERO_DRAG_WARNING="NEAR_ZERO_DRAG_WARNING",e.NON_STANDARD_EPHEMERIS_WARNING="NON_STANDARD_EPHEMERIS_WARNING",e.NEGATIVE_DECAY_WARNING="NEGATIVE_DECAY_WARNING",exports.ERROR_CODES.INVALID_INPUT_TYPE,exports.ERROR_CODES.EMPTY_INPUT,exports.ERROR_CODES.INVALID_LINE_COUNT,exports.ERROR_CODES.INVALID_LINE_LENGTH,exports.ERROR_CODES.INVALID_LINE_NUMBER,exports.ERROR_CODES.CHECKSUM_MISMATCH,exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER,exports.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,exports.ERROR_CODES.INVALID_SATELLITE_NUMBER,exports.ERROR_CODES.INVALID_CLASSIFICATION,exports.ERROR_CODES.VALUE_OUT_OF_RANGE,exports.ERROR_CODES.INVALID_NUMBER_FORMAT,exports.ERROR_CODES.SATELLITE_NAME_TOO_LONG,exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,exports.ERROR_CODES.CLASSIFIED_DATA_WARNING,exports.ERROR_CODES.STALE_TLE_WARNING,exports.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,exports.ERROR_CODES.LOW_MEAN_MOTION_WARNING,exports.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,exports.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,exports.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,exports.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,exports.ERROR_CODES.NEGATIVE_DECAY_WARNING;var l,h,u,m;function p(e){return"object"==typeof e&&null!==e&&"code"in e&&"message"in e&&"severity"in e}exports.TLEErrorCode=void 0,(l=exports.TLEErrorCode||(exports.TLEErrorCode={})).INVALID_LINE_COUNT="INVALID_LINE_COUNT",l.INVALID_LINE_LENGTH="INVALID_LINE_LENGTH",l.INVALID_LINE_NUMBER="INVALID_LINE_NUMBER",l.SATELLITE_NUMBER_MISMATCH="SATELLITE_NUMBER_MISMATCH",l.CHECKSUM_MISMATCH="CHECKSUM_MISMATCH",l.INVALID_CHECKSUM_CHARACTER="INVALID_CHECKSUM_CHARACTER",l.INVALID_CLASSIFICATION="INVALID_CLASSIFICATION",l.INVALID_SATELLITE_NUMBER="INVALID_SATELLITE_NUMBER",l.INVALID_INTL_DESIGNATOR_YEAR="INVALID_INTL_DESIGNATOR_YEAR",l.INVALID_INTL_DESIGNATOR_LAUNCH="INVALID_INTL_DESIGNATOR_LAUNCH",l.INVALID_EPOCH_YEAR="INVALID_EPOCH_YEAR",l.INVALID_EPOCH_DAY="INVALID_EPOCH_DAY",l.INVALID_EPHEMERIS_TYPE="INVALID_EPHEMERIS_TYPE",l.INVALID_ELEMENT_SET_NUMBER="INVALID_ELEMENT_SET_NUMBER",l.INVALID_INCLINATION="INVALID_INCLINATION",l.INVALID_RIGHT_ASCENSION="INVALID_RIGHT_ASCENSION",l.INVALID_ECCENTRICITY="INVALID_ECCENTRICITY",l.INVALID_ARG_OF_PERIGEE="INVALID_ARG_OF_PERIGEE",l.INVALID_MEAN_ANOMALY="INVALID_MEAN_ANOMALY",l.INVALID_MEAN_MOTION="INVALID_MEAN_MOTION",l.INVALID_REVOLUTION_NUMBER="INVALID_REVOLUTION_NUMBER",l.UNUSUAL_CLASSIFICATION="UNUSUAL_CLASSIFICATION",l.OLD_EPOCH="OLD_EPOCH",l.EXTREME_ECCENTRICITY="EXTREME_ECCENTRICITY",l.EXTREME_INCLINATION="EXTREME_INCLINATION",l.HIGH_MEAN_MOTION="HIGH_MEAN_MOTION",l.LOW_MEAN_MOTION="LOW_MEAN_MOTION",l.PARSE_ERROR="PARSE_ERROR",l.VALIDATION_ERROR="VALIDATION_ERROR",function(e){e.INITIAL="INITIAL",e.READING_NAME="READING_NAME",e.READING_LINE1="READING_LINE1",e.READING_LINE2="READING_LINE2",e.COMPLETE="COMPLETE",e.ERROR="ERROR",e.RECOVERING="RECOVERING"}(h||(h={})),function(e){e.CONTINUE="CONTINUE",e.SKIP_FIELD="SKIP_FIELD",e.USE_DEFAULT="USE_DEFAULT",e.ATTEMPT_FIX="ATTEMPT_FIX",e.ABORT="ABORT"}(u||(u={})),exports.ParserState=void 0,function(e){e.INITIAL="INITIAL",e.DETECTING_FORMAT="DETECTING_FORMAT",e.PARSING_NAME="PARSING_NAME",e.PARSING_LINE1="PARSING_LINE1",e.PARSING_LINE2="PARSING_LINE2",e.VALIDATING="VALIDATING",e.COMPLETED="COMPLETED",e.ERROR="ERROR"}(exports.ParserState||(exports.ParserState={})),exports.ErrorSeverity=void 0,(m=exports.ErrorSeverity||(exports.ErrorSeverity={})).WARNING="warning",m.ERROR="error",m.CRITICAL="critical",exports.RecoveryAction=void 0,function(e){e.CONTINUE="CONTINUE",e.SKIP_FIELD="SKIP_FIELD",e.USE_DEFAULT="USE_DEFAULT",e.ATTEMPT_FIX="ATTEMPT_FIX",e.ABORT="ABORT"}(exports.RecoveryAction||(exports.RecoveryAction={}));class d{constructor(e={}){this.options={attemptRecovery:!0,maxRecoveryAttempts:10,includePartialResults:!0,strictMode:!1,...e},this.state=exports.ParserState.INITIAL,this.errors=[],this.warnings=[],this.recoveryActions=[],this.parsedData={},this.context={lineCount:0,hasName:!1,nameLineIndex:-1,line1Index:-1,line2Index:-1,lines:[],recoveryAttempts:0},this.reset()}reset(){this.state=exports.ParserState.INITIAL,this.errors=[],this.warnings=[],this.recoveryActions=[],this.parsedData={},this.context={lineCount:0,hasName:!1,nameLineIndex:-1,line1Index:-1,line2Index:-1,lines:[],recoveryAttempts:0}}addIssue(e,t,i,s={}){const r={severity:e,code:t,message:i,state:this.state,...s};return e===exports.ErrorSeverity.WARNING?this.warnings.push(r):this.errors.push(r),r}recordRecovery(e,t,i={}){this.recoveryActions.push({action:e,description:t,state:this.state,timestamp:Date.now(),...i}),this.context.recoveryAttempts++}transition(e,t=""){const i=this.state;return this.state=e,{from:i,to:e,reason:t}}parse(e){return this.reset(),"string"!=typeof e?(this.addIssue(exports.ErrorSeverity.CRITICAL,exports.ERROR_CODES.INVALID_INPUT_TYPE,"TLE data must be a string",{inputType:typeof e}),this.transition(exports.ParserState.ERROR),this.getResult()):0===e.length?(this.addIssue(exports.ErrorSeverity.CRITICAL,exports.ERROR_CODES.EMPTY_INPUT,"TLE string cannot be empty",{inputLength:0}),this.transition(exports.ParserState.ERROR),this.getResult()):(this.transition(exports.ParserState.DETECTING_FORMAT,"Starting parse"),this.detectFormat(e),this.state===exports.ParserState.DETECTING_FORMAT&&this.executeStateMachine(),this.getResult())}detectFormat(e){const t=e.trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(this.context.lines=t,this.context.lineCount=t.length,t.length<2)return this.addIssue(exports.ErrorSeverity.CRITICAL,exports.ERROR_CODES.INVALID_LINE_COUNT,`TLE must contain at least 2 lines (found ${t.length})`,{expected:"2 or 3",actual:t.length}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.ABORT,"Insufficient lines to parse TLE",{lineCount:t.length}),void this.transition(exports.ParserState.ERROR);if(t.length>3){if(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_COUNT,`TLE should contain 2 or 3 lines (found ${t.length})`,{expected:"2 or 3",actual:t.length}),this.options.attemptRecovery){this.recordRecovery(exports.RecoveryAction.ATTEMPT_FIX,"Attempting to identify valid TLE lines from excess lines",{lineCount:t.length});const e=t.filter(e=>"1"===e[0]),i=t.filter(e=>"2"===e[0]);if(1===e.length&&1===i.length){const s=e[0],r=i[0];if(!s||!r)return;const n=t.indexOf(s),a=t.indexOf(r);if(n<a){n>0&&(this.context.hasName=!0,this.context.nameLineIndex=n-1),this.context.line1Index=n,this.context.line2Index=a;const e=t[this.context.nameLineIndex],i=t[n],s=t[a];this.context.lines=this.context.hasName&&e&&i&&s?[e,i,s]:i&&s?[i,s]:[],this.context.lineCount=this.context.lines.length,this.recordRecovery(exports.RecoveryAction.CONTINUE,"Successfully identified TLE lines from excess input",{extractedLines:this.context.lineCount})}}}}else if(3===t.length){const e=t[0]?.[0];"1"!==e&&"2"!==e||this.addIssue(exports.ErrorSeverity.WARNING,exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,'First line starts with "1" or "2", might be missing satellite name',{firstLine:t[0]}),this.context.hasName=!0,this.context.nameLineIndex=0,this.context.line1Index=1,this.context.line2Index=2}else this.context.hasName=!1,this.context.line1Index=0,this.context.line2Index=1}executeStateMachine(){let e=0;for(;this.state!==exports.ParserState.COMPLETED&&this.state!==exports.ParserState.ERROR&&e<100;){switch(this.state){case exports.ParserState.DETECTING_FORMAT:this.context.hasName?this.transition(exports.ParserState.PARSING_NAME):this.transition(exports.ParserState.PARSING_LINE1);break;case exports.ParserState.PARSING_NAME:this.parseSatelliteName(),this.transition(exports.ParserState.PARSING_LINE1);break;case exports.ParserState.PARSING_LINE1:this.parseLine1(),this.transition(exports.ParserState.PARSING_LINE2);break;case exports.ParserState.PARSING_LINE2:this.parseLine2(),this.transition(exports.ParserState.VALIDATING);break;case exports.ParserState.VALIDATING:this.validateCrossFields(),this.errors.some(e=>e.severity===exports.ErrorSeverity.CRITICAL)&&!this.options.includePartialResults?this.transition(exports.ParserState.ERROR):this.transition(exports.ParserState.COMPLETED);break;default:this.transition(exports.ParserState.ERROR,"Unexpected state")}e++}e>=100&&(this.addIssue(exports.ErrorSeverity.CRITICAL,"STATE_MACHINE_LOOP","State machine exceeded maximum iterations",{iterations:e}),this.transition(exports.ParserState.ERROR))}parseSatelliteName(){const e=this.context.nameLineIndex;if(e<0||e>=this.context.lines.length)return void this.addIssue(exports.ErrorSeverity.ERROR,"INVALID_NAME_LINE_INDEX","Invalid satellite name line index",{index:e});const t=this.context.lines[e];t&&(this.parsedData.satelliteName=t,t.length>24&&this.addIssue(exports.ErrorSeverity.WARNING,exports.ERROR_CODES.SATELLITE_NAME_TOO_LONG,"Satellite name exceeds recommended 24 characters",{length:t.length,name:t}),"1"!==t[0]&&"2"!==t[0]||this.addIssue(exports.ErrorSeverity.WARNING,exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,'Satellite name starts with "1" or "2", might be incorrectly formatted',{name:t}))}parseLine1(){const e=this.context.line1Index;if(e<0||e>=this.context.lines.length)return void this.addIssue(exports.ErrorSeverity.CRITICAL,"INVALID_LINE1_INDEX","Invalid Line 1 index",{index:e});const t=this.context.lines[e];if(!t)return;if(this.parsedData.line1Raw=t,69!==t.length)if(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_LENGTH,`Line 1 must be exactly 69 characters (got ${t.length})`,{line:1,expected:69,actual:t.length}),this.options.attemptRecovery)this.recordRecovery(exports.RecoveryAction.CONTINUE,"Attempting to parse Line 1 despite incorrect length",{length:t.length});else if(this.options.strictMode)return;this.parseFieldSafe("lineNumber1",t,0,1,"Line 1 number"),this.parseFieldSafe("satelliteNumber1",t,2,7,"Satellite number"),this.parseFieldSafe("classification",t,7,8,"Classification"),this.parseFieldSafe("internationalDesignatorYear",t,9,11,"Int. designator year"),this.parseFieldSafe("internationalDesignatorLaunchNumber",t,11,14,"Int. designator launch"),this.parseFieldSafe("internationalDesignatorPiece",t,14,17,"Int. designator piece"),this.parseFieldSafe("epochYear",t,18,20,"Epoch year"),this.parseFieldSafe("epoch",t,20,32,"Epoch"),this.parseFieldSafe("firstDerivative",t,33,43,"First derivative"),this.parseFieldSafe("secondDerivative",t,44,52,"Second derivative"),this.parseFieldSafe("bStar",t,53,61,"B* drag term"),this.parseFieldSafe("ephemerisType",t,62,63,"Ephemeris type"),this.parseFieldSafe("elementSetNumber",t,64,68,"Element set number"),this.parseFieldSafe("checksum1",t,68,69,"Checksum"),"1"!==this.parsedData.lineNumber1&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_NUMBER,`Line 1 must start with '1' (got '${this.parsedData.lineNumber1}')`,{line:1,expected:"1",actual:this.parsedData.lineNumber1});const i=["U","C","S"];if(this.parsedData.classification&&!i.includes(this.parsedData.classification)&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_CLASSIFICATION,`Classification must be U, C, or S (got '${this.parsedData.classification}')`,{expected:i,actual:this.parsedData.classification}),69===t.length){const e=this.calculateChecksum(t),i=parseInt(this.parsedData.checksum1||"",10);isNaN(i)||e===i||(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.CHECKSUM_MISMATCH,`Line 1 checksum mismatch (expected ${e}, got ${i})`,{line:1,expected:e,actual:i}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.CONTINUE,"Continuing despite checksum mismatch",{line:1}))}}parseLine2(){const e=this.context.line2Index;if(e<0||e>=this.context.lines.length)return void this.addIssue(exports.ErrorSeverity.CRITICAL,"INVALID_LINE2_INDEX","Invalid Line 2 index",{index:e});const t=this.context.lines[e];if(t){if(this.parsedData.line2Raw=t,69!==t.length)if(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_LENGTH,`Line 2 must be exactly 69 characters (got ${t.length})`,{line:2,expected:69,actual:t.length}),this.options.attemptRecovery)this.recordRecovery(exports.RecoveryAction.CONTINUE,"Attempting to parse Line 2 despite incorrect length",{length:t.length});else if(this.options.strictMode)return;if(this.parseFieldSafe("lineNumber2",t,0,1,"Line 2 number"),this.parseFieldSafe("satelliteNumber2",t,2,7,"Satellite number"),this.parseFieldSafe("inclination",t,8,16,"Inclination"),this.parseFieldSafe("rightAscension",t,17,25,"Right ascension"),this.parseFieldSafe("eccentricity",t,26,33,"Eccentricity"),this.parseFieldSafe("argumentOfPerigee",t,34,42,"Argument of perigee"),this.parseFieldSafe("meanAnomaly",t,43,51,"Mean anomaly"),this.parseFieldSafe("meanMotion",t,52,63,"Mean motion"),this.parseFieldSafe("revolutionNumber",t,63,68,"Revolution number"),this.parseFieldSafe("checksum2",t,68,69,"Checksum"),"2"!==this.parsedData.lineNumber2&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_NUMBER,`Line 2 must start with '2' (got '${this.parsedData.lineNumber2}')`,{line:2,expected:"2",actual:this.parsedData.lineNumber2}),69===t.length){const e=this.calculateChecksum(t),i=parseInt(this.parsedData.checksum2||"",10);isNaN(i)||e===i||(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.CHECKSUM_MISMATCH,`Line 2 checksum mismatch (expected ${e}, got ${i})`,{line:2,expected:e,actual:i}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.CONTINUE,"Continuing despite checksum mismatch",{line:2}))}}}validateCrossFields(){if(this.parsedData.satelliteNumber1&&this.parsedData.satelliteNumber2){const e=this.parsedData.satelliteNumber1.trim(),t=this.parsedData.satelliteNumber2.trim();e!==t&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,`Satellite numbers must match (Line 1: ${e}, Line 2: ${t})`,{line1Value:e,line2Value:t})}if(this.validateNumericField("inclination",0,180,"Inclination"),this.validateNumericField("rightAscension",0,360,"Right Ascension"),this.validateNumericField("argumentOfPerigee",0,360,"Argument of Perigee"),this.validateNumericField("meanAnomaly",0,360,"Mean Anomaly"),this.parsedData.eccentricity){const e=parseFloat("0."+this.parsedData.eccentricity.trim());!isNaN(e)&&(e<0||e>1)&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.VALUE_OUT_OF_RANGE,`Eccentricity must be between 0 and 1 (got ${e})`,{field:"eccentricity",value:e,min:0,max:1})}this.validateNumericField("meanMotion",0,20,"Mean Motion",!0),this.validateNumericField("epochYear",0,99,"Epoch Year")}validateNumericField(e,t,i,s,r=!1){const n=this.parsedData[e];if(!n||"string"!=typeof n)return;const a=parseFloat(n.trim());isNaN(a)?this.addIssue(r?exports.ErrorSeverity.WARNING:exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_NUMBER_FORMAT,`${s} must be numeric (got '${n}')`,{field:e,value:n}):(a<t||a>i)&&this.addIssue(r?exports.ErrorSeverity.WARNING:exports.ErrorSeverity.ERROR,exports.ERROR_CODES.VALUE_OUT_OF_RANGE,`${s} must be between ${t} and ${i} (got ${a})`,{field:e,value:a,min:t,max:i})}parseFieldSafe(e,t,i,s,r){try{t.length>=s?this.parsedData[e]=t.substring(i,s).trim():t.length>i?(this.parsedData[e]=t.substring(i).trim(),this.addIssue(exports.ErrorSeverity.WARNING,"PARTIAL_FIELD",`${r} is incomplete due to short line`,{field:e,expected:[i,s],actual:t.length}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.USE_DEFAULT,`Using partial value for ${r}`,{field:e})):(this.parsedData[e]=null,this.addIssue(exports.ErrorSeverity.WARNING,"MISSING_FIELD",`${r} is missing due to short line`,{field:e,expected:[i,s],actual:t.length}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.USE_DEFAULT,`Using null for missing ${r}`,{field:e}))}catch(t){this.parsedData[e]=null;const i=t instanceof Error?t.message:String(t);this.addIssue(exports.ErrorSeverity.ERROR,"FIELD_PARSE_ERROR",`Error parsing ${r}: ${i}`,{field:e,error:i})}}calculateChecksum(e){let t=0;for(let i=0;i<e.length-1;i++){const s=e[i];s&&s>="0"&&s<="9"?t+=parseInt(s,10):"-"===s&&(t+=1)}return t%10}getResult(){const e=this.errors.map(e=>({code:e.code,message:e.message,severity:e.severity===exports.ErrorSeverity.CRITICAL?"error":e.severity,...Object.fromEntries(Object.entries(e).filter(([e])=>!["severity","code","message","state"].includes(e)))})),t=this.warnings.map(e=>({code:e.code,message:e.message,severity:"warning",...Object.fromEntries(Object.entries(e).filter(([e])=>!["severity","code","message","state"].includes(e)))}));return{success:this.state===exports.ParserState.COMPLETED,state:this.state,data:this.parsedData,errors:e,warnings:t,recoveryActions:this.recoveryActions.map(e=>e.action),partialData:this.options.includePartialResults?this.parsedData:void 0,context:{lineCount:this.context.lineCount,hasName:this.context.hasName,recoveryAttempts:this.context.recoveryAttempts}}}}const E=n.promisify(i.readFile);function g(e,t={}){const{filter:i,continueOnError:s=!1,limit:r,skip:n=0,onTLE:a,onError:o,...c}=t,l=[],h=f(e);let u=0;for(let e=0;e<h.length;e++){if(e<n)continue;if(void 0!==r&&u>=r)break;const t=h[e];if(t)try{const s=Lt(t,c);if(i&&!R(s,i))continue;l.push(s),u++,a&&a(s,e)}catch(i){if(o&&o(i,e,t),!s)throw i}}return l}function f(e){const t=ft(e).split("\n").map(e=>e.trim()).filter(e=>e.length>0),i=[];let s=[];for(const e of t)e.startsWith("#")?s.length>0&&s.push(e):"1"===e[0]?(s.length>=2&&i.push(s.join("\n")),s=[e]):"2"===e[0]?s.push(e):s.length>=2?(i.push(s.join("\n")),s=[e]):0===s.length?s=[e]:s.push(e);return s.length>=2&&i.push(s.join("\n")),i}async function N(e,t={}){return Promise.resolve(Lt(e,t))}function R(e,t){if(void 0!==t.satelliteNumber){const i=e.satelliteNumber1||"";if("function"==typeof t.satelliteNumber){if(!t.satelliteNumber(i))return!1}else if(Array.isArray(t.satelliteNumber)){if(!t.satelliteNumber.includes(i))return!1}else if(i!==t.satelliteNumber)return!1}if(void 0!==t.satelliteName&&e.satelliteName){const i=e.satelliteName;if("function"==typeof t.satelliteName){if(!t.satelliteName(i))return!1}else if(Array.isArray(t.satelliteName)){if(!t.satelliteName.some(e=>i.includes(e)))return!1}else if(!i.includes(t.satelliteName))return!1}if(void 0!==t.intlDesignator){const i=`${e.internationalDesignatorYear||""}${e.internationalDesignatorLaunchNumber||""}${e.internationalDesignatorPiece||""}`.trim();if("function"==typeof t.intlDesignator){if(!t.intlDesignator(i))return!1}else if(Array.isArray(t.intlDesignator)){if(!t.intlDesignator.includes(i))return!1}else if(i!==t.intlDesignator)return!1}if(void 0!==t.classification){const i=e.classification;if(Array.isArray(t.classification)){if(!t.classification.includes(i))return!1}else if(i!==t.classification)return!1}if(t.epochRange){const i=parseInt(e.epochYear||"0",10),s=e.epoch||"0",r=parseFloat(s),n=new Date(i>=57?1900+i:2e3+i,0,1);if(n.setDate(n.getDate()+r-1),t.epochRange.start&&n<t.epochRange.start)return!1;if(t.epochRange.end&&n>t.epochRange.end)return!1}if(t.inclinationRange){const i=parseFloat(e.inclination||"0");if(void 0!==t.inclinationRange.min&&i<t.inclinationRange.min)return!1;if(void 0!==t.inclinationRange.max&&i>t.inclinationRange.max)return!1}return!(t.custom&&!t.custom(e))}class T extends a.Transform{constructor(e={}){super({objectMode:!0,highWaterMark:e.highWaterMark||16}),this.buffer="",this.index=0,this.options=e}_transform(e,t,i){this.buffer+=e.toString();const s=this.buffer.split("\n");this.buffer=s.pop()||"";let r=[];for(const e of s){const t=e.trim();0!==t.length&&(t.startsWith("#")?r.push(t):"1"===t[0]?(r.length>=2&&this.processTLE(r.join("\n")),r=[t]):"2"===t[0]?(r.push(t),r.length>=2&&(this.processTLE(r.join("\n")),r=[])):(r.length>=2&&this.processTLE(r.join("\n")),r=[t]))}i()}_flush(e){if(this.buffer.trim().length>0){const e=this.buffer.split("\n").filter(e=>e.trim().length>0);e.length>=2&&this.processTLE(e.join("\n"))}e()}processTLE(e){const{continueOnError:t=!0,filter:i,onTLE:s,onError:r,...n}=this.options;try{const t=Lt(e,n);if(i&&!R(t,i))return;this.push(t),s&&s(t,this.index),this.index++}catch(i){r&&r(i,this.index,e),t||this.destroy(i),this.index++}}}function A(e={}){return new T(e)}async function I(e,t={}){return new Promise((i,s)=>{const r=[],n=A({...t,onTLE:(e,i)=>{r.push(e),t.onTLE&&t.onTLE(e,i)}});e.pipe(n).on("data",()=>{}).on("end",()=>i(r)).on("error",s)})}class x{constructor(){this.middlewares=[],this.plugins=[]}use(e){return this.middlewares.push(e),this}plugin(e){return this.plugins.push(e),e.middleware&&this.use(e.middleware),this}async parse(e,t={}){const i={rawTLE:e,options:t,metadata:{}},s=async e=>{if(e>=this.middlewares.length)return Lt(i.rawTLE,i.options);const t=this.middlewares[e];return t?t(i,()=>s(e+1)):Lt(i.rawTLE,i.options)};return s(0)}async parseBatch(e,t={}){for(const e of this.plugins)e.onBatchStart&&await e.onBatchStart(t);const i=[],s=f(e);for(let e=0;e<s.length;e++){const r=s[e];if(r)try{const s=await this.parse(r,t);if(t.filter&&!R(s,t.filter))continue;i.push(s);for(const t of this.plugins)t.onTLEParsed&&await t.onTLEParsed(s,e);t.onTLE&&t.onTLE(s,e)}catch(i){for(const t of this.plugins)t.onError&&await t.onError(i,e);if(t.onError&&t.onError(i,e,r),!t.continueOnError)throw i}}for(const e of this.plugins)e.onBatchEnd&&await e.onBatchEnd(i);return i}}class O{constructor(e={}){this.cache=new Map,this.maxSize=e.maxSize||1e3,this.ttl=e.ttl||36e5,this.keyGenerator=e.keyGenerator||this.defaultKeyGenerator}defaultKeyGenerator(e,t){return`${e}:${JSON.stringify(t)}`}get(e,t={}){const i=this.keyGenerator(e,t),s=this.cache.get(i);return s?Date.now()-s.timestamp>this.ttl?(this.cache.delete(i),null):(this.cache.delete(i),this.cache.set(i,s),s.tle):null}set(e,t,i={}){const s=this.keyGenerator(e,i);if(this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;e&&this.cache.delete(e)}this.cache.set(s,{tle:t,timestamp:Date.now()})}clear(){this.cache.clear()}size(){return this.cache.size}}function S(e){return{strict:{validate:!0,strictChecksums:!0,validateRanges:!0,mode:"strict",includeWarnings:!0,includeComments:!0},permissive:{validate:!0,strictChecksums:!1,validateRanges:!1,mode:"permissive",includeWarnings:!0,includeComments:!0},fast:{validate:!1,includeWarnings:!1,includeComments:!1},realtime:{validate:!0,strictChecksums:!1,validateRanges:!1,mode:"permissive",includeWarnings:!1,includeComments:!1},batch:{validate:!0,strictChecksums:!0,validateRanges:!0,mode:"strict",includeWarnings:!1,includeComments:!1},recovery:{validate:!1,includeWarnings:!0,includeComments:!0},legacy:{validate:!0,strictChecksums:!1,validateRanges:!1,mode:"permissive",includeWarnings:!0,includeComments:!0}}[e]}class _{constructor(e,t={}){this.buffer="",this.currentSet=[],this.onTLE=e,this.options=t}push(e){this.buffer+=e,this.processBuffer()}flush(){this.currentSet.length>=2&&(this.emitTLE(this.currentSet.join("\n")),this.currentSet=[])}processBuffer(){const e=this.buffer.split("\n");this.buffer=e.pop()||"";for(const t of e){const e=t.trim();0!==e.length&&(e.startsWith("#")?this.currentSet.push(e):"1"===e[0]?(this.currentSet.length>=2&&this.emitTLE(this.currentSet.join("\n")),this.currentSet=[e]):"2"===e[0]?(this.currentSet.push(e),this.currentSet.length>=2&&(this.emitTLE(this.currentSet.join("\n")),this.currentSet=[])):(this.currentSet.length>=2&&this.emitTLE(this.currentSet.join("\n")),this.currentSet=[e]))}}emitTLE(e){try{const t=Lt(e,this.options);this.onTLE(t)}catch(e){}}}function M(e){return{celestrak:{validate:!0,strictChecksums:!0,validateRanges:!0,mode:"strict",includeWarnings:!0,includeComments:!0},spacetrack:{validate:!0,strictChecksums:!0,validateRanges:!0,mode:"strict",includeWarnings:!0,includeComments:!0},amsat:{validate:!0,strictChecksums:!1,validateRanges:!1,mode:"permissive",includeWarnings:!0,includeComments:!0},custom:{validate:!1,includeWarnings:!0,includeComments:!0}}[e]}const y={meanMotion:{min:0,max:20,typical:{min:10,max:17}},eccentricity:{min:0,max:.999999,typical:{min:0,max:.25}},inclination:{min:0,max:180,typical:{min:0,max:100}},rightAscension:{min:0,max:360},argumentOfPerigee:{min:0,max:360},meanAnomaly:{min:0,max:360},bStar:{min:-1,max:1,typical:{min:-.001,max:.001}},meanMotionFirstDerivative:{min:-1,max:1,typical:{min:-.001,max:.001}},meanMotionSecondDerivative:{min:-1,max:1,typical:{min:-1e-5,max:1e-5}},revolutionNumber:{min:0,max:99999},elementSetNumber:{min:0,max:999},ephemerisType:{min:0,max:9}},C={min:1,max:999999,historical5Digit:99999,modern6Digit:999999},L={minYear:57,maxYear:99,minDayOfYear:1,maxDayOfYear:366.99999999,warningAgeThreshold:7,criticalAgeThreshold:30,maxFutureDays:30},v={yearMin:57,yearMax:99,launchNumberMin:1,launchNumberMax:999,piecePattern:/^[A-Z]{1,3}$/},D={checksumValid:20,fieldFormatValid:15,parametersInRange:15,parametersInTypicalRange:10,epochRecent:15,noAnomalies:10,designatorValid:5,consistencyChecks:10};function b(e,t){let i;i=e>=57?1900+e:2e3+e;const s=new Date(Date.UTC(i,0,1)).getTime()+864e5*(t-1),r=new Date(s),n=Math.floor((14-(r.getUTCMonth()+1))/12),a=i+4800-n,o=r.getUTCMonth()+1+12*n-3,c=r.getUTCDate()+Math.floor((153*o+2)/5)+365*a+Math.floor(a/4)-Math.floor(a/100)+Math.floor(a/400)-32045+(r.getUTCHours()+r.getUTCMinutes()/60+r.getUTCSeconds()/3600)/24,l=c-2400000.5;return{year:i,twoDigitYear:e,dayOfYear:t,isoDate:r.toISOString(),date:r,julianDate:c,modifiedJulianDate:l}}function w(e,t){const i=[];if((e<L.minYear||e>L.maxYear)&&i.push(`Epoch year ${e} outside valid range [${L.minYear}, ${L.maxYear}]`),(t<L.minDayOfYear||t>L.maxDayOfYear)&&i.push(`Epoch day ${t} outside valid range [${L.minDayOfYear}, ${L.maxDayOfYear}]`),i.length>0)return{valid:!1,message:i.join("; "),context:{epochYear:e,epochDay:t}};const s=b(e,t),r=s.year,n=r%4==0&&r%100!=0||r%400==0,a=n?366:365;return Math.floor(t)>a&&i.push(`Day ${Math.floor(t)} exceeds maximum for ${r} (${n?"leap year":"non-leap year"}: ${a} days)`),i.length>0?{valid:!1,message:i.join("; "),context:{epochYear:e,epochDay:t,fullYear:r,isLeapYear:n}}:{valid:!0,context:{epochDate:s}}}function $(e,t,i=new Date){const s=b(e,t);return(i.getTime()-s.date.getTime())/864e5}function F(e,t,i={}){const s=$(e,t,i.referenceDate||new Date),r=[];if(s<0){const e=Math.abs(s);if(!i.allowFuture)return{valid:!1,message:`Epoch is ${e.toFixed(2)} days in the future`,context:{age:s,futureDays:e}};e>L.maxFutureDays&&r.push(`Epoch is ${e.toFixed(2)} days in the future (threshold: ${L.maxFutureDays} days)`)}if(s>0){const e=i.maxAge||L.criticalAgeThreshold;s>e&&r.push(`Epoch is ${s.toFixed(2)} days old (threshold: ${e} days)`)}return{valid:!0,message:r.length>0?r.join("; "):void 0,context:{age:s}}}function P(e,t,i=!1){const s=y[e];if(!s)return{valid:!1,message:`Unknown parameter: ${e}`};if(t<s.min||t>s.max)return{valid:!1,message:`${e} value ${t} outside valid range [${s.min}, ${s.max}]`,context:{paramName:e,value:t,min:s.min,max:s.max}};if(i&&"typical"in s&&s.typical){const i=s.typical;if(t<i.min||t>i.max)return{valid:!0,message:`${e} value ${t} outside typical range [${i.min}, ${i.max}]`,context:{paramName:e,value:t,typicalMin:i.min,typicalMax:i.max,outsideTypical:!0}}}return{valid:!0,context:{paramName:e,value:t}}}function U(e,t=!1){const i=[],s={meanMotion:{field:"meanMotion",param:"meanMotion"},eccentricity:{field:"eccentricity",param:"eccentricity"},inclination:{field:"inclination",param:"inclination"},rightAscension:{field:"rightAscension",param:"rightAscension"},argumentOfPerigee:{field:"argumentOfPerigee",param:"argumentOfPerigee"},meanAnomaly:{field:"meanAnomaly",param:"meanAnomaly"},bStar:{field:"bStar",param:"bStar"},firstDerivative:{field:"firstDerivative",param:"meanMotionFirstDerivative"},secondDerivative:{field:"secondDerivative",param:"meanMotionSecondDerivative"},revolutionNumber:{field:"revolutionNumber",param:"revolutionNumber"},elementSetNumber:{field:"elementSetNumber",param:"elementSetNumber"},ephemerisType:{field:"ephemerisType",param:"ephemerisType"}};for(const[r,n]of Object.entries(s)){const s=parseFloat(e[n.field]);if(isNaN(s)){i.push({valid:!1,message:`Field ${r} is not a valid number`,context:{field:r,value:e[n.field]}});continue}const a=P(n.param,s,t);a.valid&&!a.message||i.push({...a,context:{...a.context,field:r}})}return i}function V(e,t){if(e.length<69)return{valid:!1,message:`Line ${t} is too short (${e.length} chars, expected 69)`,context:{lineNumber:t,length:e.length}};const i=e.charAt(68),s=parseInt(i,10),r=function(e){let t=0;const i=e.substring(0,68);for(const e of i)e>="0"&&e<="9"?t+=parseInt(e,10):"-"===e&&(t+=1);return t%10}(e);return isNaN(s)?{valid:!1,message:`Line ${t} checksum is not a digit: '${i}'`,context:{lineNumber:t,checksumChar:i}}:r!==s?{valid:!1,message:`Line ${t} checksum mismatch: expected ${s}, calculated ${r}`,context:{lineNumber:t,expected:s,calculated:r,line:e.substring(0,68)}}:{valid:!0,context:{lineNumber:t,checksum:r}}}function G(e){const t="-"===(e=e.trim())[0]?-1:1,i=e.replace(/^[-+\s]+/,"").replace(/\s+/g,""),s=i.match(/([+-])(\d+)$/);if(!s)return t*parseFloat("0."+i);const r=i.substring(0,i.length-s[0].length),n="-"===(s[1]||"+")?-1:1,a=parseInt(s[2]||"0",10);return t*parseFloat("0."+r)*Math.pow(10,n*a)}function k(e){const t="string"==typeof e?parseInt(e.trim(),10):e;return isNaN(t)?{valid:!1,message:`Satellite number is not a valid integer: '${e}'`,context:{satelliteNumber:e}}:t<C.min||t>C.max?{valid:!1,message:`Satellite number ${t} outside valid range [${C.min}, ${C.max}]`,context:{satelliteNumber:t,min:C.min,max:C.max}}:{valid:!0,context:{satelliteNumber:t,format:t<=C.historical5Digit?"5-digit":"6-digit"}}}function z(e){const t=e.trim(),i=t.match(/^(\d{2})(\d{1,3})([A-Z]{1,3})$/);if(!i)return{valid:!1,message:`Invalid international designator format: '${e}' (expected YYLLLPPP)`,context:{designator:t}};const s=i[1]||"0",r=i[2]||"0",n=i[3]||"",a=parseInt(s,10),o=parseInt(r,10);return a<v.yearMin||a>v.yearMax?{valid:!1,message:`International designator year ${a} outside valid range [${v.yearMin}, ${v.yearMax}]`,context:{designator:t,year:a}}:o<v.launchNumberMin||o>v.launchNumberMax?{valid:!1,message:`International designator launch number ${o} outside valid range [${v.launchNumberMin}, ${v.launchNumberMax}]`,context:{designator:t,launchNumber:o}}:v.piecePattern.test(n)?{valid:!0,context:{designator:t,year:a,launchNumber:o,piece:n,fullYear:a>=v.yearMin?1900+a:2e3+a}}:{valid:!1,message:`International designator piece '${n}' invalid (must be 1-3 uppercase letters)`,context:{designator:t,piece:n}}}const Y=.01,H=.01;function W(e){const t=[],i=parseFloat(e.eccentricity),s=parseFloat(e.meanMotion),r=parseFloat(e.inclination),n=G(e.bStar),a=parseFloat(e.firstDerivative),o=parseInt(e.revolutionNumber,10);return i>.5&&t.push({hasAnomaly:!0,type:"HIGH_ECCENTRICITY",description:`Unusually high eccentricity: ${i.toFixed(6)} (threshold: 0.5)`,severity:i>.9?"error":"warning",score:Math.min(i/.5,1)}),s<1&&t.push({hasAnomaly:!0,type:"LOW_MEAN_MOTION",description:`Unusually low mean motion: ${s.toFixed(8)} rev/day (threshold: 1)`,severity:"warning",score:1-s/1}),s>18&&t.push({hasAnomaly:!0,type:"HIGH_MEAN_MOTION",description:`Unusually high mean motion: ${s.toFixed(8)} rev/day (threshold: 18)`,severity:"warning",score:Math.min(s/18,1)}),r>90&&r<180&&t.push({hasAnomaly:!0,type:"RETROGRADE_ORBIT",description:`Retrograde orbit detected: inclination ${r.toFixed(4)}Â° (>90Â°)`,severity:"info",score:(r-90)/90}),Math.abs(n)>Y&&t.push({hasAnomaly:!0,type:"HIGH_DRAG",description:`Unusually high drag coefficient: B* = ${n.toExponential(4)} (threshold: 0.01)`,severity:"warning",score:Math.min(Math.abs(n)/Y,1)}),Math.abs(a)>H&&t.push({hasAnomaly:!0,type:"RAPID_ORBITAL_CHANGE",description:`Rapid orbital evolution: dn/dt = ${a.toFixed(8)} (threshold: 0.01)`,severity:"warning",score:Math.min(Math.abs(a)/H,1)}),o<100&&t.push({hasAnomaly:!0,type:"NEW_SATELLITE",description:`Recently launched satellite: revolution number ${o}`,severity:"info",score:1-o/100}),0===i&&t.push({hasAnomaly:!0,type:"CIRCULAR_ORBIT",description:"Perfect circular orbit (eccentricity = 0)",severity:"info",score:.1}),t}function B(e,t){let i=0;const s={checksumScore:0,formatScore:0,rangeScore:0,epochScore:0,anomalyScore:0,consistencyScore:0};t.checksumValid&&(s.checksumScore=D.checksumValid),t.formatValid&&(s.formatScore=D.fieldFormatValid);const r=t.rangeErrors.filter(e=>!e.valid),n=t.rangeResults.filter(e=>e.valid&&e.message);if(0===r.length)s.rangeScore=D.parametersInRange,0===n.length&&(s.rangeScore+=D.parametersInTypicalRange);else{const e=r.length+n.length,t=n.length;s.rangeScore=t/e*D.parametersInRange}const a=Math.abs(t.epochAge);s.epochScore=a<=1?D.epochRecent:a<=L.warningAgeThreshold?.9*D.epochRecent:a<=L.criticalAgeThreshold?.5*D.epochRecent:.2*D.epochRecent;const o={error:1,warning:.5,info:.1},c=t.anomalies.reduce((e,t)=>{const i=o[t.severity||"info"];return e+(t.score||.5)*i},0);s.anomalyScore=Math.max(0,D.noAnomalies-2*c);let l,h,u=D.consistencyChecks;return e.satelliteNumber1!==e.satelliteNumber2&&(u-=5),["U","C","S"].includes(e.classification)||(u-=2),z(e.internationalDesignatorYear+e.internationalDesignatorLaunchNumber+e.internationalDesignatorPiece).valid||(u-=3),s.consistencyScore=Math.max(0,u),i=Object.values(s).reduce((e,t)=>e+t,0),l=i>=90?"A":i>=80?"B":i>=70?"C":i>=60?"D":"F",h="A"===l?"Excellent quality - TLE is fresh, valid, and anomaly-free":"B"===l?"Good quality - TLE is valid with minor warnings":"C"===l?"Acceptable quality - TLE has some issues but is usable":"D"===l?"Poor quality - TLE has significant issues, use with caution":"Invalid - TLE has critical errors and should not be used",{overall:Math.round(i),components:s,grade:l,assessment:h}}function j(e,t){let i=e;const s=[];i.includes("\0")&&(i=i.replace(/\0/g,""),s.push("Removed null bytes")),i.includes("\t")&&(i=i.replace(/\t/g," "),s.push("Normalized tabs to spaces"));const r=/[\x00-\x1F\x7F-\x9F]/g;switch(r.test(i)&&(i=i.replace(r,""),s.push("Removed non-printable characters")),t){case"satelliteName":/^[A-Z0-9\s\-\(\)]+$/i.test(i)||(i=i.replace(/[^A-Z0-9\s\-\(\)]/gi,""),s.push("Removed invalid characters from satellite name"));break;case"classification":i=i.trim().toUpperCase(),i.length>1&&(i=i.charAt(0),s.push("Truncated classification to single character"));break;case"internationalDesignatorYear":case"internationalDesignatorLaunchNumber":case"satelliteNumber1":case"satelliteNumber2":case"elementSetNumber":case"revolutionNumber":/^\d+$/.test(i.trim())||(i=i.replace(/\D/g,""),s.push(`Removed non-numeric characters from ${t}`));break;case"internationalDesignatorPiece":{const e=i;i=i.trim().toUpperCase().replace(/[^A-Z]/g,""),i!==e.trim()&&s.push("Normalized designator piece to uppercase letters");break}}const n=i.trim();return n!==i&&(i=n,s.push("Trimmed whitespace")),{value:i,modified:s.length>0,modifications:s.length>0?s:void 0}}function q(e){const t=new Map;for(const[i,s]of Object.entries(e))if("string"==typeof s){const e=j(s,i);e.modified&&t.set(i,e)}return t}const K=[{name:"checksum",description:"Validate line checksums",severity:"error",enabled:!0,validate:()=>({valid:!0})},{name:"satelliteNumberRange",description:"Validate satellite number is in valid range",severity:"error",enabled:!0,validate:e=>k(e)},{name:"epochDate",description:"Validate epoch date format and range",severity:"error",enabled:!0,validate:e=>w(parseInt(e.epochYear,10),parseFloat(e.epoch))},{name:"epochAge",description:"Warn if epoch is stale or in future",severity:"warning",enabled:!0,validate:(e,t)=>F(parseInt(e.epochYear,10),parseFloat(e.epoch),{referenceDate:t?.referenceDate})},{name:"internationalDesignator",description:"Validate international designator format",severity:"warning",enabled:!0,validate:e=>z(e.internationalDesignatorYear+e.internationalDesignatorLaunchNumber+e.internationalDesignatorPiece)},{name:"orbitalParameterRanges",description:"Validate orbital parameters are in valid ranges",severity:"error",enabled:!0,validate:e=>{const t=U(e,!1).filter(e=>!e.valid);return t.length>0?{valid:!1,message:t.map(e=>e.message).join("; "),context:{errors:t}}:{valid:!0}}},{name:"anomalyDetection",description:"Detect unusual orbital parameters",severity:"warning",enabled:!1,validate:e=>{const t=W(e);return t.length>0?{valid:!0,message:`${t.length} anomalies detected`,context:{anomalies:t}}:{valid:!0}}}];function J(e){return e.satelliteNumber1||e.satelliteNumber2||""}function Z(e){return`${e.internationalDesignatorYear||""}${e.internationalDesignatorLaunchNumber||""}${e.internationalDesignatorPiece||""}`.trim()}const X={reset:"[0m",bright:"[1m",dim:"[2m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",bgBlack:"[40m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m"};function Q(e,t,i=!0){return i?`${t}${e}${X.reset}`:e}function ee(e,t={}){const{pretty:i=!1,includeWarnings:s=!0,includeComments:r=!0,verbosity:n="normal"}=t,a=e=>{const t={...e};return!s&&"warnings"in t&&delete t.warnings,!r&&"comments"in t&&delete t.comments,"compact"===n?{satelliteName:t.satelliteName,satelliteNumber:J(t),epoch:t.epochYear+":"+t.epoch,inclination:t.inclination,eccentricity:t.eccentricity,meanMotion:t.meanMotion}:t},o=Array.isArray(e)?e.map(a):a(e);return JSON.stringify(o,null,i?2:0)}function te(e,t={}){const{includeHeader:i=!0,delimiter:s=",",quote:r=!0,verbosity:n="normal"}=t,a=Array.isArray(e)?e:[e],o=[],c=Object.keys(a[0]||{}).filter(e=>!["warnings","comments","checksum1","checksum2","lineNumber1","lineNumber2"].includes(e)),l="compact"===n?["satelliteName","satelliteNumber1","epochYear","epoch","inclination","eccentricity","meanMotion"]:"verbose"===n?c:["satelliteName","satelliteNumber1","classification","epochYear","epoch","firstDerivative","secondDerivative","bStar","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion","revolutionNumber"];i&&o.push(l.map(e=>r?`"${e}"`:e).join(s));for(const e of a){const t=l.map(t=>{const i=e[t]??"",s=String(i);return r?`"${s.replace(/"/g,'""')}"`:s});o.push(t.join(s))}return o.join("\n")}function ie(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function se(e,t={}){const{pretty:i=!1,includeWarnings:s=!0,includeComments:r=!0}=t,n=i?"  ":"",a=i?"\n":"",o=Array.isArray(e)?e:[e],c=['<?xml version="1.0" encoding="UTF-8"?>'];c.push(`<tles>${a}`);for(const e of o){c.push(`${n}<tle>${a}`);for(const[t,i]of Object.entries(e))if(("warnings"!==t||s)&&("comments"!==t||r))if(Array.isArray(i)){c.push(`${n}${n}<${t}>${a}`);for(const e of i){const t="object"==typeof e?JSON.stringify(e):String(e);c.push(`${n}${n}${n}<item>${ie(t)}</item>${a}`)}c.push(`${n}${n}</${t}>${a}`)}else{const e=ie(String(i??""));c.push(`${n}${n}<${t}>${e}</${t}>${a}`)}c.push(`${n}</tle>${a}`)}return c.push("</tles>"),c.join("")}function re(e,t={}){const{includeWarnings:i=!0,includeComments:s=!0}=t,r=Array.isArray(e)?e:[e],n=[],a=(e,t=0)=>{const i="  ".repeat(t);return null==e?"null":"string"==typeof e?/[:#\[\]{},&*!|>'"%@`]/.test(e)||/^\s|\s$/.test(e)?`"${e.replace(/"/g,'\\"')}"`:e:"number"==typeof e||"boolean"==typeof e?String(e):Array.isArray(e)?0===e.length?"[]":"\n"+e.map(e=>{if("object"==typeof e&&null!==e){const s=o(e,t+1);return`${i}  -${s.substring(i.length+3)}`}return`${i}  - ${a(e,0)}`}).join("\n"):"object"==typeof e?"\n"+o(e,t+1):String(e)},o=(e,t=0)=>{const r="  ".repeat(t),n=[];for(const[o,c]of Object.entries(e)){if("warnings"===o&&!i)continue;if("comments"===o&&!s)continue;const e=a(c,t);e.startsWith("\n")?n.push(`${r}${o}:${e}`):n.push(`${r}${o}: ${e}`)}return n.join("\n")};if(1===r.length)return o(r[0],0);n.push("tles:");for(const e of r){n.push("  -");const t=o(e,2);n.push(t)}return n.join("\n")}function ne(e,t={}){const{colors:i=!1,verbosity:s="normal",includeWarnings:r=!0}=t,n=[];if(n.push(Q("â•".repeat(70),X.cyan,i)),n.push(Q(`  ${e.satelliteName||"Unknown Satellite"}`,X.bright+X.cyan,i)),n.push(Q("â•".repeat(70),X.cyan,i)),n.push(""),n.push(Q("Basic Information:",X.bright+X.yellow,i)),n.push(`  ${Q("Satellite Number:",X.green,i)} ${J(e)}`),n.push(`  ${Q("Classification:",X.green,i)} ${e.classification||"N/A"}`),n.push(`  ${Q("International Designator:",X.green,i)} ${Z(e)||"N/A"}`),n.push(""),n.push(Q("Epoch Information:",X.bright+X.yellow,i)),n.push(`  ${Q("Epoch Year:",X.green,i)} ${e.epochYear}`),n.push(`  ${Q("Epoch Day:",X.green,i)} ${e.epoch}`),n.push(""),n.push(Q("Orbital Parameters:",X.bright+X.yellow,i)),n.push(`  ${Q("Inclination:",X.green,i)} ${e.inclination}Â°`),n.push(`  ${Q("Right Ascension:",X.green,i)} ${e.rightAscension}Â°`),n.push(`  ${Q("Eccentricity:",X.green,i)} ${e.eccentricity}`),n.push(`  ${Q("Argument of Perigee:",X.green,i)} ${e.argumentOfPerigee}Â°`),n.push(`  ${Q("Mean Anomaly:",X.green,i)} ${e.meanAnomaly}Â°`),n.push(`  ${Q("Mean Motion:",X.green,i)} ${e.meanMotion} rev/day`),n.push(""),"verbose"===s&&(n.push(Q("Additional Parameters:",X.bright+X.yellow,i)),n.push(`  ${Q("First Derivative (Mean Motion):",X.green,i)} ${e.firstDerivative}`),n.push(`  ${Q("Second Derivative (Mean Motion):",X.green,i)} ${e.secondDerivative}`),n.push(`  ${Q("B* Drag Term:",X.green,i)} ${e.bStar}`),n.push(`  ${Q("Ephemeris Type:",X.green,i)} ${e.ephemerisType}`),n.push(`  ${Q("Element Set Number:",X.green,i)} ${e.elementSetNumber}`),n.push(`  ${Q("Revolution Number:",X.green,i)} ${e.revolutionNumber}`),n.push("")),r&&"warnings"in e&&Array.isArray(e.warnings)&&e.warnings.length>0){n.push(Q("Warnings:",X.bright+X.yellow,i));for(const t of e.warnings){const e="object"==typeof t&&"message"in t?t.message:String(t);n.push(`  ${Q("âš ",X.yellow,i)} ${e}`)}n.push("")}return n.push(Q("â•".repeat(70),X.cyan,i)),n.join("\n")}function ae(e,t={}){const{includeName:i=!0}=t,s=(e,t)=>e.padEnd(t," "),r=(e,t,i=" ")=>e.padStart(t,i);let n="1 ";n+=r(J(e),5," "),n+=e.classification||"U",n+=" "+s(Z(e),8),n+=" "+r(e.epochYear||"",2,"0"),n+=r(e.epoch||"",12," "),n+=" "+r(e.firstDerivative||"",10," "),n+=" "+s(e.secondDerivative||"",8),n+=" "+s(e.bStar||"",8),n+=" "+(e.ephemerisType||"0"),n+=" "+r(e.elementSetNumber||"",4," ");let a=0;for(let e=0;e<n.length;e++){const t=n[e];t&&t>="0"&&t<="9"?a+=parseInt(t,10):"-"===t&&(a+=1)}n+=(a%10).toString();let o="2 ";o+=r(J(e),5," "),o+=" "+r(e.inclination||"",8," "),o+=" "+r(e.rightAscension||"",8," "),o+=" "+r((e.eccentricity||"").replace(/^0\./,""),7,"0"),o+=" "+r(e.argumentOfPerigee||"",8," "),o+=" "+r(e.meanAnomaly||"",8," "),o+=" "+r(e.meanMotion||"",11," "),o+=r(e.revolutionNumber||"",5," ");let c=0;for(let e=0;e<o.length;e++){const t=o[e];t&&t>="0"&&t<="9"?c+=parseInt(t,10):"-"===t&&(c+=1)}o+=(c%10).toString();const l=[];return i&&e.satelliteName&&l.push(e.satelliteName),l.push(n),l.push(o),l.join("\n")}class oe{constructor(e){this.config=e,this.queue=[],this.processing=!1,this.tokens=e.maxRequests,this.lastRefill=Date.now()}refillTokens(){const e=Date.now(),t=(e-this.lastRefill)/this.config.intervalMs*this.config.maxRequests;t>=1&&(this.tokens=Math.min(this.config.maxRequests,this.tokens+Math.floor(t)),this.lastRefill=e)}async processQueue(){if(!this.processing){for(this.processing=!0;this.queue.length>0;)if(this.refillTokens(),this.tokens>=1){const e=this.queue.shift();e&&(this.tokens-=1,e.resolve())}else{const e=this.config.intervalMs-(Date.now()-this.lastRefill);e>0&&await new Promise(t=>setTimeout(t,e))}this.processing=!1}}async acquire(){if(this.refillTokens(),this.tokens>=1)return this.tokens-=1,Promise.resolve();if(this.config.maxQueueSize&&this.queue.length>=this.config.maxQueueSize)throw new Error("Rate limiter queue is full");return new Promise((e,t)=>{this.queue.push({resolve:e,reject:t,timestamp:Date.now()}),this.processQueue()})}async execute(e){return await this.acquire(),e()}getStatus(){return this.refillTokens(),{tokens:this.tokens,queueLength:this.queue.length,maxRequests:this.config.maxRequests,intervalMs:this.config.intervalMs}}clearQueue(){for(const e of this.queue)e.reject(new Error("Rate limiter queue cleared"));this.queue=[]}reset(){this.tokens=this.config.maxRequests,this.lastRefill=Date.now(),this.clearQueue()}}class ce{constructor(e={}){this.cache=new Map,this.accessOrder=[],this.persistTimer=null,this.maxSize=e.maxSize||100,this.defaultTTL=e.defaultTTL||36e5,this.persistent=e.persistent||!1,this.cacheDir=e.cacheDir||s.join(r.homedir(),".tle-parser","cache"),this.cacheFile=e.cacheFile||"tle-cache.json",this.persistent&&(this.loadFromDisk().catch(()=>{}),this.persistTimer=setInterval(()=>{this.saveToDisk().catch(()=>{})},3e5))}get(e){const t=this.cache.get(e);if(t){if(!(Date.now()-t.timestamp>t.ttl))return this.updateAccessOrder(e),t.value;this.delete(e)}}set(e,t,i){const s={value:t,timestamp:Date.now(),ttl:i||this.defaultTTL};if(this.cache.size>=this.maxSize&&!this.cache.has(e)){const e=this.accessOrder[0];e&&this.delete(e)}this.cache.set(e,s),this.updateAccessOrder(e)}has(e){return void 0!==this.get(e)}delete(e){return this.accessOrder=this.accessOrder.filter(t=>t!==e),this.cache.delete(e)}clear(){this.cache.clear(),this.accessOrder=[]}size(){return this.cleanExpired(),this.cache.size}cleanExpired(){const e=Date.now();let t=0;for(const[i,s]of this.cache.entries())e-s.timestamp>s.ttl&&(this.delete(i),t++);return t}keys(){return this.cleanExpired(),Array.from(this.cache.keys())}getStats(){const e=this.size(),t=this.accessOrder[0]||null,i=this.accessOrder[this.accessOrder.length-1]||null;return{size:e,maxSize:this.maxSize,hitRate:0,oldestEntry:t,newestEntry:i}}updateAccessOrder(e){this.accessOrder=this.accessOrder.filter(t=>t!==e),this.accessOrder.push(e)}async saveToDisk(){if(this.persistent)try{i.existsSync(this.cacheDir)||await t.mkdir(this.cacheDir,{recursive:!0});const e={entries:Array.from(this.cache.entries()),accessOrder:this.accessOrder,timestamp:Date.now()},r=s.join(this.cacheDir,this.cacheFile);await t.writeFile(r,JSON.stringify(e,null,2),"utf8")}catch(e){console.error("Failed to save cache to disk:",e)}}async loadFromDisk(){if(this.persistent)try{const e=s.join(this.cacheDir,this.cacheFile);if(!i.existsSync(e))return;const r=await t.readFile(e,"utf8"),n=JSON.parse(r);this.cache.clear();for(const[e,t]of n.entries)this.cache.set(e,t);this.accessOrder=n.accessOrder||[],this.cleanExpired()}catch(e){console.error("Failed to load cache from disk:",e)}}destroy(){this.persistTimer&&(clearInterval(this.persistTimer),this.persistTimer=null),this.persistent&&this.saveToDisk().catch(()=>{}),this.clear()}}const le=new ce({maxSize:1e3,defaultTTL:36e5,persistent:!0,cacheFile:"tle-data.json"});function he(e,t={}){const i=Object.keys(t).sort().map(e=>`${e}=${t[e]}`).join("&");return i?`${e}:${i}`:e}function ue(e,t=2592e5){const i=parseInt(e.epochYear,10),s=parseFloat(e.epoch),r=new Date(i<57?2e3+i:1900+i,0,1);r.setDate(s);const n=Date.now()-r.getTime(),a=n<=t,o=Math.floor(n/864e5);return{isFresh:a,age:n,epochDate:r,message:a?`TLE is fresh (${o} days old)`:`TLE is stale (${o} days old)`}}const me={starlink:{name:"Starlink",description:"SpaceX Starlink satellite constellation",namePatterns:[/^STARLINK-/i,/^STARLINK /i],intlDesignatorPatterns:[/^\d{2}-(0[0-9]{2}|1[0-9]{2})[A-Z]{1,3}$/]},oneweb:{name:"OneWeb",description:"OneWeb satellite constellation",namePatterns:[/^ONEWEB-/i,/^ONEWEB /i]},gps:{name:"GPS",description:"Global Positioning System satellites",namePatterns:[/^GPS /i,/^NAVSTAR/i,/^USA-/i],catalogNumbers:[[20959,20959],[22014,22014],[22877,22877],[23833,23833],[24876,24876],[25933,25933],[26360,26360],[26407,26407],[26605,26605],[26690,26690],[28361,28361],[28474,28474],[28874,28874],[29486,29486],[29601,29601],[32260,32260],[32384,32384],[32711,32711],[35752,35752],[36585,36585],[37753,37753],[38833,38833],[39166,39166],[40105,40105],[40294,40294],[40534,40534],[40730,40730],[41019,41019],[41328,41328],[36500,36600],[4e4,41400]]},galileo:{name:"Galileo",description:"European GNSS constellation",namePatterns:[/^GALILEO/i,/^GSAT/i],catalogNumbers:[[37846,37846],[37847,37847],[38857,38857],[38858,38858],[40128,40128],[40129,40129],[40544,40544],[40545,40545],[40889,40889],[40890,40890],[41174,41174],[41175,41175],[41549,41549],[41550,41550],[41859,41859],[41860,41860],[41861,41861],[41862,41862],[43055,43055],[43056,43056],[43057,43057],[43058,43058],[43564,43564],[43565,43565],[43566,43566],[43567,43567]]},glonass:{name:"GLONASS",description:"Russian GNSS constellation",namePatterns:[/^COSMOS \d+$/i,/^GLONASS/i],catalogNumbers:[[28915,28915],[32275,32275],[32276,32276],[32393,32393],[32395,32395],[36111,36111],[36112,36112],[36113,36113],[36400,36400],[36401,36401],[36402,36402],[37139,37139],[37140,37140],[37141,37141],[37829,37829],[37869,37869],[37870,37870],[39155,39155],[39620,39620],[39621,39621],[39622,39622],[40001,40001],[40315,40315],[40315,40315],[41330,41330],[41554,41554],[41555,41555],[36400,36410],[37800,37900],[39100,39700],[4e4,41600]]},beidou:{name:"BeiDou",description:"Chinese GNSS constellation",namePatterns:[/^BEIDOU/i,/^BDS/i,/^COMPASS/i],catalogNumbers:[[36287,36287],[36828,36828],[37210,37210],[37384,37384],[37763,37763],[37948,37948],[38091,38091],[38250,38250],[38251,38251],[38775,38775],[40549,40549],[40748,40748],[40749,40749],[40938,40938],[41434,41434],[41586,41586],[43001,43001],[43002,43002],[43107,43107],[43108,43108],[43207,43207],[43208,43208],[43245,43245],[43246,43246],[36200,43300]]},iss:{name:"ISS",description:"International Space Station",catalogNumbers:[25544],namePatterns:[/^ISS/i]},amateur:{name:"Amateur Radio",description:"Amateur radio satellites",namePatterns:[/^AO-/i,/^SO-/i,/^FO-/i,/^FUNCUBE/i,/^LILACSAT/i,/^DIWATA/i,/^OSCAR/i,/^AMSAT/i,/^CUBESAT/i,/^RS-/i,/^ZARYA/i]},weather:{name:"Weather",description:"Weather and meteorological satellites",namePatterns:[/^NOAA /i,/^GOES /i,/^METEOSAT/i,/^METEOR/i,/^FENGYUN/i,/^FY-/i,/^HIMAWARI/i]},iridium:{name:"Iridium",description:"Iridium satellite constellation",namePatterns:[/^IRIDIUM/i],catalogNumbers:[[41917,41927],[41934,41944],[42803,42813],[42955,42965],[43070,43080],[43249,43259],[43478,43488],[43569,43579]]},planet:{name:"Planet Labs",description:"Planet Labs Earth imaging satellites",namePatterns:[/^DOVE/i,/^FLOCK/i,/^PLANET/i,/^SKYSAT/i]},spire:{name:"Spire",description:"Spire Global satellite constellation",namePatterns:[/^LEMUR/i,/^SPIRE/i]}};function pe(e){return me[e.toLowerCase()]}function de(e,t){const i=pe(t);if(!i)return!1;if(i.catalogNumbers&&i.catalogNumbers.length>0){const t=parseInt(e.satelliteNumber1,10);if(!isNaN(t)&&i.catalogNumbers.some(e=>Array.isArray(e)?t>=e[0]&&t<=e[1]:t===e))return!0}return!!(i.namePatterns&&e.satelliteName&&i.namePatterns.some(t=>t.test(e.satelliteName)))||!!i.customFilter&&i.customFilter(e)}class Ee{constructor(e,t){this.manager=e,this.config=t,this.timer=null,this.isRunning=!1,this.lastUpdate=null,this.updateCount=0,this.errorCount=0,this.lastError=null,this.retryCount=0,t.autoStart&&this.start()}start(){this.isRunning||(this.isRunning=!0,this.scheduleNext())}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.isRunning=!1}scheduleNext(){this.isRunning&&(this.timer=setTimeout(()=>{this.executeUpdate()},this.config.intervalMs))}async executeUpdate(){try{const e=await this.manager.fetch(this.config.source||null,this.config.fetchOptions||{});this.lastUpdate=new Date,this.updateCount++,this.retryCount=0,this.lastError=null,this.config.onUpdate&&this.config.onUpdate(e),this.scheduleNext()}catch(e){this.errorCount++,this.lastError=e,this.config.onError&&this.config.onError(this.lastError);const t=this.config.maxRetries||3;if(this.retryCount<t){this.retryCount++;const e=this.config.retryDelayMs||6e4;this.timer=setTimeout(()=>{this.executeUpdate()},e)}else this.retryCount=0,this.scheduleNext()}}async updateNow(){return this.manager.fetch(this.config.source||null,this.config.fetchOptions||{})}getStatus(){return{isRunning:this.isRunning,lastUpdate:this.lastUpdate,nextUpdate:this.timer?new Date(Date.now()+this.config.intervalMs):null,updateCount:this.updateCount,errorCount:this.errorCount,lastError:this.lastError}}updateConfig(e){Object.assign(this.config,e),this.isRunning&&(this.stop(),this.start())}resetStats(){this.updateCount=0,this.errorCount=0,this.lastError=null,this.retryCount=0}}var ge,fe=Math.PI,Ne=2*fe,Re=fe/180,Te=180/fe,Ae=6378.135,Ie=60/Math.sqrt(650942.9922085947),xe=Ae*Ie/60,Oe=1/Ie,Se=.001082616,_e=-253881e-11/Se,Me=2/3,ye=1440/(2*fe);function Ce(e,t,i,s,r,n){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return 367*e-Math.floor(7*(e+Math.floor((t+9)/12))*.25)+Math.floor(275*t/9)+i+1721013.5+((a/6e4+n/60+r)/60+s)/24}function Le(e,t,i,s,r,n){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(e instanceof Date){var o=e;return Ce(o.getUTCFullYear(),o.getUTCMonth()+1,o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds())}return Ce(e,t,i,s,r,n,a)}function ve(e,t){var i,s,r,n,a,o,c,l,h,u,m,p,d,E,g,f,N,R,T=e.e3,A=e.ee2,I=e.peo,x=e.pgho,O=e.pho,S=e.pinco,_=e.plo,M=e.se2,y=e.se3,C=e.sgh2,L=e.sgh3,v=e.sgh4,D=e.sh2,b=e.sh3,w=e.si2,$=e.si3,F=e.sl2,P=e.sl3,U=e.sl4,V=e.t,G=e.xgh2,k=e.xgh3,z=e.xgh4,Y=e.xh2,H=e.xh3,W=e.xi2,B=e.xi3,j=e.xl2,q=e.xl3,K=e.xl4,J=e.zmol,Z=e.zmos,X=t.init,Q=t.opsmode,ee=t.ep,te=t.inclp,ie=t.nodep,se=t.argpp,re=t.mp;R=Z+119459e-10*V,"y"===X&&(R=Z),N=R+.0335*Math.sin(R);var ne=M*(c=.5*(E=Math.sin(N))*E-.25)+y*(l=-.5*E*Math.cos(N)),ae=w*c+$*l,oe=F*c+P*l+U*E,ce=C*c+L*l+v*E,le=D*c+b*l;return R=J+.00015835218*V,"y"===X&&(R=J),N=R+.1098*Math.sin(R),h=ne+(A*(c=.5*(E=Math.sin(N))*E-.25)+T*(l=-.5*E*Math.cos(N))),p=ae+(W*c+B*l),d=oe+(j*c+q*l+K*E),u=ce+(G*c+k*l+z*E),m=le+(Y*c+H*l),"n"===X&&(d-=_,u-=x,m-=O,te+=p-=S,ee+=h-=I,n=Math.sin(te),r=Math.cos(te),te>=.2?(se+=u-=r*(m/=n),ie+=m,re+=d):(i=n*(o=Math.sin(ie)),s=n*(a=Math.cos(ie)),i+=m*a+p*r*o,s+=-m*o+p*r*a,(ie%=Ne)<0&&"a"===Q&&(ie+=Ne),g=re+se+r*ie,g+=d+u-p*ie*n,f=ie,(ie=Math.atan2(i,s))<0&&"a"===Q&&(ie+=Ne),Math.abs(f-ie)>fe&&(ie<f?ie+=Ne:ie-=Ne),se=g-(re+=d)-r*ie)),{ep:ee,inclp:te,nodep:ie,argpp:se,mp:re}}function De(e){var t=(e-2451545)/36525,i=-62e-7*t*t*t+.093104*t*t+3164400184.812866*t+67310.54841;return(i=i*Re/240%Ne)<0&&(i+=Ne),i}function be(e,t,i,s,r,n,a){return e instanceof Date?De(Le(e)):De(e)}function we(e,t){var i,s,r,n,a,o,c,l,h,u,m,p,d,E,g,f,N,R,T,A,I,x,O,S,_,M;e.t=t,e.error=ge.None;var y=e.mo+e.mdot*e.t,C=e.argpo+e.argpdot*e.t,L=e.nodeo+e.nodedot*e.t;l=C,A=y;var v=e.t*e.t;if(x=L+e.nodecf*v,f=1-e.cc1*e.t,N=e.bstar*e.cc4*e.t,R=e.t2cof*v,1!==e.isimp){o=e.omgcof*e.t;var D=1+e.eta*Math.cos(y);A=y+(g=o+e.xmcof*(D*D*D-e.delmo)),l=C-g,p=(m=v*e.t)*e.t,f=f-e.d2*v-e.d3*m-e.d4*p,N+=e.bstar*e.cc5*(Math.sin(A)-e.sinmao),R=R+e.t3cof*m+p*(e.t4cof+e.t*e.t5cof)}I=e.no;var b=e.ecco;if(T=e.inclo,"d"===e.method){d=e.t;var w=function(e){var t,i,s,r,n,a,o,c,l=e.irez,h=e.d2201,u=e.d2211,m=e.d3210,p=e.d3222,d=e.d4410,E=e.d4422,g=e.d5220,f=e.d5232,N=e.d5421,R=e.d5433,T=e.del1,A=e.del2,I=e.del3,x=e.argpo,O=e.argpdot,S=e.t,_=e.xfact,M=e.xlamo,y=e.no,C=e.atime,L=e.em,v=e.argpm,D=e.inclm,b=e.xli,w=e.mm,$=e.xni,F=e.nodem,P=e.nm,U=.13130908,V=2.8843198,G=.37448087,k=5.7686396,z=.95240898,Y=1.8014998,H=1.050833,W=4.4108898,B=259200,j=0,q=0,K=(e.gsto+.0043752690880113*e.tc)%Ne;if(L+=e.dedt*S,D+=e.didt*S,v+=e.domdt*S,F+=e.dnodt*S,w+=e.dmdt*S,0!==l){(0===C||S*C<=0||Math.abs(S)<Math.abs(C))&&(C=0,$=y,b=M),t=S>0?720:-720;for(var J=381;381===J;)2!==l?(o=T*Math.sin(b-U)+A*Math.sin(2*(b-V))+I*Math.sin(3*(b-G)),n=$+_,a=T*Math.cos(b-U)+2*A*Math.cos(2*(b-V))+3*I*Math.cos(3*(b-G)),a*=n):(s=(c=x+O*C)+c,i=b+b,o=h*Math.sin(s+b-k)+u*Math.sin(b-k)+m*Math.sin(c+b-z)+p*Math.sin(-c+b-z)+d*Math.sin(s+i-Y)+E*Math.sin(i-Y)+g*Math.sin(c+b-H)+f*Math.sin(-c+b-H)+N*Math.sin(c+i-W)+R*Math.sin(-c+i-W),n=$+_,a=h*Math.cos(s+b-k)+u*Math.cos(b-k)+m*Math.cos(c+b-z)+p*Math.cos(-c+b-z)+g*Math.cos(c+b-H)+f*Math.cos(-c+b-H)+2*(d*Math.cos(s+i-Y)+E*Math.cos(i-Y)+N*Math.cos(c+i-W)+R*Math.cos(-c+i-W)),a*=n),Math.abs(S-C)>=720?J=381:(q=S-C,J=0),381===J&&(b+=n*t+o*B,$+=o*t+a*B,C+=t);P=$+o*q+a*q*q*.5,r=b+n*q+o*q*q*.5,1!==l?(w=r-2*F+2*K,j=P-y):(w=r-F-v+K,j=P-y),P=y+j}return{atime:C,em:L,argpm:v,inclm:D,xli:b,mm:w,xni:$,nodem:F,dndt:j,nm:P}}({irez:e.irez,d2201:e.d2201,d2211:e.d2211,d3210:e.d3210,d3222:e.d3222,d4410:e.d4410,d4422:e.d4422,d5220:e.d5220,d5232:e.d5232,d5421:e.d5421,d5433:e.d5433,dedt:e.dedt,del1:e.del1,del2:e.del2,del3:e.del3,didt:e.didt,dmdt:e.dmdt,dnodt:e.dnodt,domdt:e.domdt,argpo:e.argpo,argpdot:e.argpdot,t:e.t,tc:d,gsto:e.gsto,xfact:e.xfact,xlamo:e.xlamo,no:e.no,atime:e.atime,em:b,argpm:l,inclm:T,xli:e.xli,mm:A,xni:e.xni,nodem:x,nm:I});b=w.em,l=w.argpm,T=w.inclm,A=w.mm,x=w.nodem,I=w.nm}if(I<=0)return e.error=ge.MeanMotionBelowZero,null;var $=Math.pow(Ie/I,Me)*f*f;if(I=Ie/Math.pow($,1.5),(b-=N)>=1||b<-.001)return e.error=ge.MeanEccentricityOutOfRange,null;b<1e-6&&(b=1e-6),S=(A+=e.no*R)+l+x;var F={am:$,em:b,im:T,Om:x%=Ne,om:l%=Ne,mm:A=((S%=Ne)-l-x)%Ne,nm:I},P=b;if(O=T,h=l,M=x,_=A,n=Math.sin(T),r=Math.cos(T),"d"===e.method){var U=ve(e,{inclo:e.inclo,init:"n",ep:P,inclp:O,nodep:M,argpp:h,mp:_,opsmode:e.operationmode});if(P=U.ep,M=U.nodep,h=U.argpp,_=U.mp,(O=U.inclp)<0&&(O=-O,M+=fe,h-=fe),P<0||P>1)return e.error=ge.PerturbedEccentricityOutOfRange,null}"d"===e.method&&(n=Math.sin(O),r=Math.cos(O),e.aycof=-.5*_e*n,Math.abs(r+1)>15e-13?e.xlcof=-.25*_e*n*(3+5*r)/(1+r):e.xlcof=-.25*_e*n*(3+5*r)/15e-13);var V=P*Math.cos(h);g=1/($*(1-P*P));var G=P*Math.sin(h)+g*e.aycof,k=(_+h+M+g*e.xlcof*V-M)%Ne;c=k,E=9999.9;for(var z=1;Math.abs(E)>=1e-12&&z<=10;)s=Math.sin(c),E=(k-G*(i=Math.cos(c))+V*s-c)/(E=1-i*V-s*G),Math.abs(E)>=.95&&(E=E>0?.95:-.95),c+=E,z+=1;var Y=V*i+G*s,H=V*s-G*i,W=V*V+G*G,B=$*(1-W);if(B<0)return e.error=ge.SemiLatusRectumBelowZero,null;var j=$*(1-Y),q=Math.sqrt($)*H/j,K=Math.sqrt(B)/j,J=Math.sqrt(1-W),Z=$/j*(s-G-V*(g=H/(1+J))),X=$/j*(i-V+G*g);u=Math.atan2(Z,X);var Q=(X+X)*Z,ee=1-2*Z*Z,te=.5*Se*(g=1/B),ie=te*g;"d"===e.method&&(a=r*r,e.con41=3*a-1,e.x1mth2=1-a,e.x7thm1=7*a-1);var se=j*(1-1.5*ie*J*e.con41)+.5*te*e.x1mth2*ee;if(se<1)return e.error=ge.Decayed,null;u-=.25*ie*e.x7thm1*Q;var re=M+1.5*ie*r*Q,ne=O+1.5*ie*r*n*ee,ae=q-I*te*e.x1mth2*Q/Ie,oe=K+I*te*(e.x1mth2*ee+1.5*e.con41)/Ie,ce=Math.sin(u),le=Math.cos(u),he=Math.sin(re),ue=Math.cos(re),me=Math.sin(ne),pe=Math.cos(ne),de=-he*pe,Ee=ue*pe,Re=de*ce+ue*le,Te=Ee*ce+he*le,Oe=me*ce;return{position:{x:se*Re*Ae,y:se*Te*Ae,z:se*Oe*Ae},velocity:{x:(ae*Re+oe*(de*le-ue*ce))*xe,y:(ae*Te+oe*(Ee*le-he*ce))*xe,z:(ae*Oe+oe*(me*le))*xe},meanElements:F}}function $e(e,t){var i=e.substring(2,7),s=parseInt(e.substring(18,20),10),r=parseFloat(e.substring(20,32)),n=parseFloat(e.substring(33,43)),a=parseFloat("".concat(e.substring(44,45),".").concat(e.substring(45,50),"E").concat(e.substring(50,52))),o=parseFloat("".concat(e.substring(53,54),".").concat(e.substring(54,59),"E").concat(e.substring(59,61))),c=parseFloat(t.substring(8,16))*Re,l=parseFloat(t.substring(17,25))*Re,h=parseFloat(".".concat(t.substring(26,33))),u=parseFloat(t.substring(34,42))*Re,m=parseFloat(t.substring(43,51))*Re,p=parseFloat(t.substring(52,63))/ye,d=s<57?s+2e3:s+1900,E=function(e,t){for(var i=[31,e%4==0?29:28,31,30,31,30,31,31,30,31,30,31],s=Math.floor(t),r=1,n=0;s>n+i[r-1]&&r<12;)n+=i[r-1],r+=1;var a=r,o=s-n,c=24*(t-s),l=Math.floor(c);c=60*(c-l);var h=Math.floor(c);return{mon:a,day:o,hr:l,minute:h,sec:60*(c-h)}}(d,r),g={error:0,satnum:i,epochyr:s,epochdays:r,ndot:n,nddot:a,bstar:o,inclo:c,nodeo:l,ecco:h,argpo:u,mo:m,no:p,jdsatepoch:Le(d,E.mon,E.day,E.hr,E.minute,E.sec)};return function(e,t){var i,s,r,n,a,o,c,l,h,u,m,p,d,E,g,f,N,R,T,A,I,x,O,S,_,M,y,C,L,v,D,b,w,$,F,P,U,V,G,k,z,Y,H,W,B,j,q,K,J,Z,X,Q,ee=t.opsmode,te=t.epoch,ie=t.xbstar,se=t.xecco,re=t.xargpo,ne=t.xinclo,ae=t.xmo,oe=t.xno,ce=t.xnodeo,le=e;le.isimp=0,le.method="n",le.aycof=0,le.con41=0,le.cc1=0,le.cc4=0,le.cc5=0,le.d2=0,le.d3=0,le.d4=0,le.delmo=0,le.eta=0,le.argpdot=0,le.omgcof=0,le.sinmao=0,le.t=0,le.t2cof=0,le.t3cof=0,le.t4cof=0,le.t5cof=0,le.x1mth2=0,le.x7thm1=0,le.mdot=0,le.nodedot=0,le.xlcof=0,le.xmcof=0,le.nodecf=0,le.irez=0,le.d2201=0,le.d2211=0,le.d3210=0,le.d3222=0,le.d4410=0,le.d4422=0,le.d5220=0,le.d5232=0,le.d5421=0,le.d5433=0,le.dedt=0,le.del1=0,le.del2=0,le.del3=0,le.didt=0,le.dmdt=0,le.dnodt=0,le.domdt=0,le.e3=0,le.ee2=0,le.peo=0,le.pgho=0,le.pho=0,le.pinco=0,le.plo=0,le.se2=0,le.se3=0,le.sgh2=0,le.sgh3=0,le.sgh4=0,le.sh2=0,le.sh3=0,le.si2=0,le.si3=0,le.sl2=0,le.sl3=0,le.sl4=0,le.gsto=0,le.xfact=0,le.xgh2=0,le.xgh3=0,le.xgh4=0,le.xh2=0,le.xh3=0,le.xi2=0,le.xi3=0,le.xl2=0,le.xl3=0,le.xl4=0,le.xlamo=0,le.zmol=0,le.zmos=0,le.atime=0,le.xli=0,le.xni=0,le.bstar=ie,le.ecco=se,le.argpo=re,le.inclo=ne,le.mo=ae,le.no=oe,le.nodeo=ce,le.operationmode=ee;var he=78/Ae+1;le.init="y",le.t=0;var ue=function(e){var t=e.ecco,i=e.epoch,s=e.inclo,r=e.opsmode,n=e.no,a=t*t,o=1-a,c=Math.sqrt(o),l=Math.cos(s),h=l*l,u=Math.pow(Ie/n,Me),m=.75*Se*(3*h-1)/(c*o),p=m/(u*u),d=u*(1-p*p-p*(1/3+134*p*p/81));n/=1+(p=m/(d*d));var E,g=Math.pow(Ie/n,Me),f=Math.sin(s),N=g*o,R=1-5*h,T=-R-h-h,A=1/g,I=N*N,x=g*(1-t);if("a"===r){var O=i-7305,S=Math.floor(O+1e-8),_=.017202791694070362;(E=(1.7321343856509375+_*S+(_+Ne)*(O-S)+O*O*5075514194322695e-30)%Ne)<0&&(E+=Ne)}else E=be(i+2433281.5);return{no:n,method:"n",ainv:A,ao:g,con41:T,con42:R,cosio:l,cosio2:h,eccsq:a,omeosq:o,posq:I,rp:x,rteosq:c,sinio:f,gsto:E}}({ecco:le.ecco,epoch:te,inclo:le.inclo,no:le.no,method:le.method,opsmode:le.operationmode}),me=ue.ao,pe=ue.con42,de=ue.cosio,Ee=ue.cosio2,ge=ue.eccsq,Re=ue.omeosq,Te=ue.posq,xe=ue.rp,ye=ue.rteosq,Ce=ue.sinio;if(le.no=ue.no,le.con41=ue.con41,le.gsto=ue.gsto,le.a=Math.pow(le.no*Oe,-2/3),le.alta=le.a*(1+le.ecco)-1,le.altp=le.a*(1-le.ecco)-1,le.error=0,Re>=0||le.no>=0){if(le.isimp=0,xe<1.034492841559484&&(le.isimp=1),S=he,R=1.880279159015271e-9,(g=(xe-1)*Ae)<156){S=g-78,g<98&&(S=20);var Le=(120-S)/Ae;R=Le*Le*Le*Le,S=S/Ae+1}f=1/Te,Y=1/(me-S),le.eta=me*le.ecco*Y,p=le.eta*le.eta,m=le.ecco*le.eta,N=Math.abs(1-p),n=(c=(o=R*Math.pow(Y,4))/Math.pow(N,3.5))*le.no*(me*(1+1.5*p+m*(4+p))+.375*Se*Y/N*le.con41*(8+3*p*(8+p))),le.cc1=le.bstar*n,a=0,le.ecco>1e-4&&(a=-2*o*Y*_e*le.no*Ce/le.ecco),le.x1mth2=1-Ee,le.cc4=2*le.no*c*me*Re*(le.eta*(2+.5*p)+le.ecco*(.5+2*p)-Se*Y/(me*N)*(-3*le.con41*(1-2*m+p*(1.5-.5*m))+.75*le.x1mth2*(2*p-m*(1+p))*Math.cos(2*le.argpo))),le.cc5=2*c*me*Re*(1+2.75*(p+m)+m*p),l=Ee*Ee,k=.5*(G=1.5*Se*f*le.no)*Se*f,z=7.762359375e-7*f*f*le.no,le.mdot=le.no+.5*G*ye*le.con41+.0625*k*ye*(13-78*Ee+137*l),le.argpdot=-.5*G*pe+.0625*k*(7-114*Ee+395*l)+z*(3-36*Ee+49*l),W=-G*de,le.nodedot=W+(.5*k*(4-19*Ee)+2*z*(3-7*Ee))*de,H=le.argpdot+le.nodedot,le.omgcof=le.bstar*a*Math.cos(le.argpo),le.xmcof=0,le.ecco>1e-4&&(le.xmcof=-Me*o*le.bstar/m),le.nodecf=3.5*Re*W*le.cc1,le.t2cof=1.5*le.cc1,Math.abs(de+1)>15e-13?le.xlcof=-.25*_e*Ce*(3+5*de)/(1+de):le.xlcof=-.25*_e*Ce*(3+5*de)/15e-13,le.aycof=-.5*_e*Ce;var De=1+le.eta*Math.cos(le.mo);if(le.delmo=De*De*De,le.sinmao=Math.sin(le.mo),le.x7thm1=7*Ee-1,2*fe/le.no>=225){le.method="d",le.isimp=1,d=le.inclo;var $e=function(e){var t,i,s,r,n,a,o,c,l,h,u,m,p,d,E,g,f,N,R,T,A,I,x,O,S,_,M,y,C,L,v,D,b,w,$,F,P,U,V,G,k,z,Y,H,W,B,j,q,K,J,Z,X,Q,ee,te,ie,se,re,ne,ae,oe,ce,le,he=e.epoch,ue=e.argpp,me=e.tc,pe=e.inclp,de=e.nodep,Ee=.01675,ge=.0549,fe=e.np,Re=e.ep,Te=Math.sin(de),Ae=Math.cos(de),Ie=Math.sin(ue),xe=Math.cos(ue),Oe=Math.sin(pe),Se=Math.cos(pe),_e=Re*Re,Me=1-_e,ye=Math.sqrt(Me),Ce=he+18261.5+me/1440,Le=(4.523602-.00092422029*Ce)%Ne,ve=Math.sin(Le),De=Math.cos(Le),be=.91375164-.03568096*De,we=Math.sqrt(1-be*be),$e=.089683511*ve/we,Fe=Math.sqrt(1-$e*$e),Pe=5.8351514+.001944368*Ce,Ue=.39785416*ve/we,Ve=Fe*De+.91744867*$e*ve;Ue=Math.atan2(Ue,Ve),Ue+=Pe-Le;var Ge=Math.cos(Ue),ke=Math.sin(Ue);T=.1945905,A=-.98088458,O=.91744867,S=.39785416,I=Ae,x=Te,u=29864797e-13;for(var ze=1/fe,Ye=0;Ye<2;)te=-6*(t=T*I+A*O*x)*(n=-Oe*(o=-T*x+A*O*I)+Se*(c=A*S))+_e*(-24*(m=t*xe+(i=Se*o+Oe*c)*Ie)*(N=n*xe)-6*(d=-t*Ie+i*xe)*(g=n*Ie)),ie=-6*(t*(a=-Oe*(l=A*x+T*O*I)+Se*(h=T*S))+(s=-A*I+T*O*x)*n)+_e*(-24*((p=s*xe+(r=Se*l+Oe*h)*Ie)*N+m*(R=a*xe))+-6*(d*(f=a*Ie)+(E=-s*Ie+r*xe)*g)),se=-6*s*a+_e*(-24*p*R-6*E*f),re=6*i*n+_e*(24*m*g-6*d*N),ne=6*(r*n+i*a)+_e*(24*(p*g+m*f)-6*(E*N+d*R)),ae=6*r*a+_e*(24*p*f-6*E*R),X=(X=3*(t*t+i*i)+(oe=12*m*m-3*d*d)*_e)+X+Me*oe,Q=(Q=6*(t*s+i*r)+(ce=24*m*p-6*d*E)*_e)+Q+Me*ce,ee=(ee=3*(s*s+r*r)+(le=12*p*p-3*E*E)*_e)+ee+Me*le,B=-.5*(j=u*ze)/ye,W=-15*Re*(q=j*ye),K=m*d+p*E,J=p*d+m*E,Z=p*E-m*d,1===(Ye+=1)&&(_=W,M=B,y=j,C=q,L=K,v=J,D=Z,b=X,w=Q,$=ee,F=te,P=ie,U=se,V=re,G=ne,k=ae,z=oe,Y=ce,H=le,T=Ge,A=ke,O=be,S=we,I=Fe*Ae+$e*Te,x=Te*Fe-Ae*$e,u=4.7968065e-7);return{snodm:Te,cnodm:Ae,sinim:Oe,cosim:Se,sinomm:Ie,cosomm:xe,day:Ce,e3:2*W*Z,ee2:2*W*J,em:Re,emsq:_e,gam:Pe,peo:0,pgho:0,pho:0,pinco:0,plo:0,rtemsq:ye,se2:2*_*v,se3:2*_*D,sgh2:2*C*Y,sgh3:2*C*(H-z),sgh4:-18*C*Ee,sh2:-2*M*G,sh3:-2*M*(k-V),si2:2*M*P,si3:2*M*(U-F),sl2:-2*y*w,sl3:-2*y*($-b),sl4:-2*y*(-21-9*_e)*Ee,s1:W,s2:B,s3:j,s4:q,s5:K,s6:J,s7:Z,ss1:_,ss2:M,ss3:y,ss4:C,ss5:L,ss6:v,ss7:D,sz1:b,sz2:w,sz3:$,sz11:F,sz12:P,sz13:U,sz21:V,sz22:G,sz23:k,sz31:z,sz32:Y,sz33:H,xgh2:2*q*ce,xgh3:2*q*(le-oe),xgh4:-18*q*ge,xh2:-2*B*ne,xh3:-2*B*(ae-re),xi2:2*B*ie,xi3:2*B*(se-te),xl2:-2*j*Q,xl3:-2*j*(ee-X),xl4:-2*j*(-21-9*_e)*ge,nm:fe,z1:X,z2:Q,z3:ee,z11:te,z12:ie,z13:se,z21:re,z22:ne,z23:ae,z31:oe,z32:ce,z33:le,zmol:(.2299715*Ce-Pe+4.7199672)%Ne,zmos:(6.2565837+.017201977*Ce)%Ne}}({epoch:te,ep:le.ecco,argpp:le.argpo,tc:0,inclp:le.inclo,nodep:le.nodeo,np:le.no,e3:le.e3,ee2:le.ee2,peo:le.peo,pgho:le.pgho,pho:le.pho,pinco:le.pinco,plo:le.plo,se2:le.se2,se3:le.se3,sgh2:le.sgh2,sgh3:le.sgh3,sgh4:le.sgh4,sh2:le.sh2,sh3:le.sh3,si2:le.si2,si3:le.si3,sl2:le.sl2,sl3:le.sl3,sl4:le.sl4,xgh2:le.xgh2,xgh3:le.xgh3,xgh4:le.xgh4,xh2:le.xh2,xh3:le.xh3,xi2:le.xi2,xi3:le.xi3,xl2:le.xl2,xl3:le.xl3,xl4:le.xl4,zmol:le.zmol,zmos:le.zmos});le.e3=$e.e3,le.ee2=$e.ee2,le.peo=$e.peo,le.pgho=$e.pgho,le.pho=$e.pho,le.pinco=$e.pinco,le.plo=$e.plo,le.se2=$e.se2,le.se3=$e.se3,le.sgh2=$e.sgh2,le.sgh3=$e.sgh3,le.sgh4=$e.sgh4,le.sh2=$e.sh2,le.sh3=$e.sh3,le.si2=$e.si2,le.si3=$e.si3,le.sl2=$e.sl2,le.sl3=$e.sl3,le.sl4=$e.sl4,s=$e.sinim,i=$e.cosim,h=$e.em,u=$e.emsq,T=$e.s1,A=$e.s2,I=$e.s3,x=$e.s4,O=$e.s5,_=$e.ss1,M=$e.ss2,y=$e.ss3,C=$e.ss4,L=$e.ss5,v=$e.sz1,D=$e.sz3,b=$e.sz11,w=$e.sz13,$=$e.sz21,F=$e.sz23,P=$e.sz31,U=$e.sz33,le.xgh2=$e.xgh2,le.xgh3=$e.xgh3,le.xgh4=$e.xgh4,le.xh2=$e.xh2,le.xh3=$e.xh3,le.xi2=$e.xi2,le.xi3=$e.xi3,le.xl2=$e.xl2,le.xl3=$e.xl3,le.xl4=$e.xl4,le.zmol=$e.zmol,le.zmos=$e.zmos,E=$e.nm,B=$e.z1,j=$e.z3,q=$e.z11,K=$e.z13,J=$e.z21,Z=$e.z23,X=$e.z31,Q=$e.z33;var Fe=ve(le,{inclo:d,init:le.init,ep:le.ecco,inclp:le.inclo,nodep:le.nodeo,argpp:le.argpo,mp:le.mo,opsmode:le.operationmode});le.ecco=Fe.ep,le.inclo=Fe.inclp,le.nodeo=Fe.nodep,le.argpo=Fe.argpp,le.mo=Fe.mp;var Pe=function(e){var t,i,s,r,n,a,o,c,l,h,u,m,p,d,E,g,f,N,R,T,A=e.cosim,I=e.argpo,x=e.s2,O=e.sinim,S=e.ss2,_=e.t,M=e.mo,y=e.mdot,C=e.no,L=e.nodeo,v=e.nodedot,D=e.xpidot,b=e.ecco,w=e.eccsq,$=e.emsq,F=e.em,P=e.argpm,U=e.inclm,V=e.mm,G=e.nm,k=e.nodem,z=e.irez,Y=e.atime,H=e.d2201,W=e.d2211,B=e.d3210,j=e.d3222,q=e.d4410,K=e.d4422,J=e.d5220,Z=e.d5232,X=e.d5421,Q=e.d5433,ee=e.dnodt,te=e.domdt,ie=e.del1,se=e.del2,re=e.del3,ne=e.xfact,ae=e.xlamo,oe=e.xli,ce=e.xni,le=.0043752690880113,he=.00015835218,ue=119459e-10;z=0,G<.0052359877&&G>.0034906585&&(z=1),G>=.00826&&G<=.00924&&F>=.5&&(z=2);var me=-ue*S*(e.sz21+e.sz23);(U<.052359877||U>fe-.052359877)&&(me=0),0!==O&&(me/=O);var pe=-he*x*(e.z21+e.z23);(U<.052359877||U>fe-.052359877)&&(pe=0),te=e.ss4*ue*(e.sz31+e.sz33-6)-A*me+e.s4*he*(e.z31+e.z33-6),ee=me,0!==O&&(te-=A/O*pe,ee+=pe/O);var de=(e.gsto+e.tc*le)%Ne;if(F+=(N=e.ss1*ue*e.ss5+e.s1*he*e.s5)*_,U+=(R=S*ue*(e.sz11+e.sz13)+x*he*(e.z11+e.z13))*_,P+=te*_,k+=ee*_,V+=(T=-ue*e.ss3*(e.sz1+e.sz3-14-6*$)-he*e.s3*(e.z1+e.z3-14-6*$))*_,0!==z){if(E=Math.pow(G/Ie,Me),2===z){var Ee=F,ge=$;f=(F=b)*($=w),F<=.65?(s=3.616-13.247*F+16.29*$,r=117.39*F-19.302-228.419*$+156.591*f,n=109.7927*F-18.9068-214.6334*$+146.5816*f,a=242.694*F-41.122-471.094*$+313.953*f,o=841.88*F-146.407-1629.014*$+1083.435*f,c=3017.977*F-532.114-5740.032*$+3708.276*f):(s=331.819*F-72.099-508.738*$+266.724*f,r=1582.851*F-346.844-2415.925*$+1246.113*f,n=1554.908*F-342.585-2366.899*$+1215.972*f,a=4758.686*F-1052.797-7193.992*$+3651.957*f,o=16178.11*F-3581.69-24462.77*$+12422.52*f,c=F>.715?29936.92*F-5149.66-54087.36*$+31324.56*f:1464.74-4664.75*F+3763.64*$),F<.7?(u=4988.61*F-919.2277-9064.77*$+5542.21*f,l=4568.6173*F-822.71072-8491.4146*$+5337.524*f,h=4690.25*F-853.666-8624.77*$+5341.4*f):(u=161616.52*F-37995.78-229838.2*$+109377.94*f,l=218913.95*F-51752.104-309468.16*$+146349.42*f,h=170470.89*F-40023.88-242699.48*$+115605.82*f),H=(p=17891679e-13*(d=G*G*3*(E*E)))*(t=.75*(1+2*A+(g=A*A)))*(-.306-.44*(F-.64)),W=p*(1.5*(m=O*O))*s,B=(p=3.7393792e-7*(d*=E))*(1.875*O*(1-2*A-3*g))*r,j=p*(-1.875*O*(1+2*A-3*g))*n,q=(p=2*(d*=E)*7.3636953e-9)*(35*m*t)*a,K=p*(39.375*m*m)*o,J=(p=1.1428639e-7*(d*=E))*(9.84375*O*(m*(1-2*A-5*g)+.33333333*(4*A-2+6*g)))*c,Z=p*(O*(4.92187512*m*(-2-4*A+10*g)+6.56250012*(1+2*A-3*g)))*h,X=(p=2*d*2.1765803e-9)*(29.53125*O*(2-8*A+g*(8*A-12+10*g)))*l,Q=p*(29.53125*O*(-2-8*A+g*(12+8*A-10*g)))*u,ae=(M+L+L-(de+de))%Ne,ne=y+T+2*(v+ee-le)-C,F=Ee,$=ge}1===z&&(i=1+A,se=2*(ie=3*G*G*E*E)*(t=.75*(1+A)*(1+A))*(1+$*(.8125*$-2.5))*17891679e-13,re=3*ie*(i*=1.875*i*i)*(1+$*(6.60937*$-6))*2.2123015e-7*E,ie=ie*(.9375*O*O*(1+3*A)-.75*(1+A))*(r=1+2*$)*21460748e-13*E,ae=(M+L+I-de)%Ne,ne=y+D+T+te+ee-(C+le)),oe=ae,ce=C,Y=0,G=C+0}return{em:F,argpm:P,inclm:U,mm:V,nm:G,nodem:k,irez:z,atime:Y,d2201:H,d2211:W,d3210:B,d3222:j,d4410:q,d4422:K,d5220:J,d5232:Z,d5421:X,d5433:Q,dedt:N,didt:R,dmdt:T,dndt:0,dnodt:ee,domdt:te,del1:ie,del2:se,del3:re,xfact:ne,xlamo:ae,xli:oe,xni:ce}}({cosim:i,emsq:u,argpo:le.argpo,s1:T,s2:A,s3:I,s4:x,s5:O,sinim:s,ss1:_,ss2:M,ss3:y,ss4:C,ss5:L,sz1:v,sz3:D,sz11:b,sz13:w,sz21:$,sz23:F,sz31:P,sz33:U,t:le.t,tc:0,gsto:le.gsto,mo:le.mo,mdot:le.mdot,no:le.no,nodeo:le.nodeo,nodedot:le.nodedot,xpidot:H,z1:B,z3:j,z11:q,z13:K,z21:J,z23:Z,z31:X,z33:Q,ecco:le.ecco,eccsq:ge,em:h,argpm:0,inclm:d,mm:0,nm:E,nodem:0,irez:le.irez,atime:le.atime,d2201:le.d2201,d2211:le.d2211,d3210:le.d3210,d3222:le.d3222,d4410:le.d4410,d4422:le.d4422,d5220:le.d5220,d5232:le.d5232,d5421:le.d5421,d5433:le.d5433,dedt:le.dedt,didt:le.didt,dmdt:le.dmdt,dnodt:le.dnodt,domdt:le.domdt,del1:le.del1,del2:le.del2,del3:le.del3,xfact:le.xfact,xlamo:le.xlamo,xli:le.xli,xni:le.xni});le.irez=Pe.irez,le.atime=Pe.atime,le.d2201=Pe.d2201,le.d2211=Pe.d2211,le.d3210=Pe.d3210,le.d3222=Pe.d3222,le.d4410=Pe.d4410,le.d4422=Pe.d4422,le.d5220=Pe.d5220,le.d5232=Pe.d5232,le.d5421=Pe.d5421,le.d5433=Pe.d5433,le.dedt=Pe.dedt,le.didt=Pe.didt,le.dmdt=Pe.dmdt,le.dnodt=Pe.dnodt,le.domdt=Pe.domdt,le.del1=Pe.del1,le.del2=Pe.del2,le.del3=Pe.del3,le.xfact=Pe.xfact,le.xlamo=Pe.xlamo,le.xli=Pe.xli,le.xni=Pe.xni}1!==le.isimp&&(r=le.cc1*le.cc1,le.d2=4*me*Y*r,V=le.d2*Y*le.cc1/3,le.d3=(17*me+S)*V,le.d4=.5*V*me*Y*(221*me+31*S)*le.cc1,le.t3cof=le.d2+2*r,le.t4cof=.25*(3*le.d3+le.cc1*(12*le.d2+10*r)),le.t5cof=.2*(3*le.d4+12*le.cc1*le.d3+6*le.d2*le.d2+15*r*(2*le.d2+r)))}we(le,0),le.init="n"}(g,{opsmode:"i",satn:g.satnum,epoch:g.jdsatepoch-2433281.5,xbstar:g.bstar,xecco:g.ecco,xargpo:g.argpo,xinclo:g.inclo,xmo:g.mo,xno:g.no,xnodeo:g.nodeo}),g}!function(e){e[e.None=0]="None",e[e.MeanEccentricityOutOfRange=1]="MeanEccentricityOutOfRange",e[e.MeanMotionBelowZero=2]="MeanMotionBelowZero",e[e.PerturbedEccentricityOutOfRange=3]="PerturbedEccentricityOutOfRange",e[e.SemiLatusRectumBelowZero=4]="SemiLatusRectumBelowZero",e[e.Decayed=6]="Decayed"}(ge||(ge={}));var Fe,Pe,Ue,Ve=7292115e-11;function Ge(e,t,i){var s=t.x-e.x,r=t.y-e.y,n=t.z-e.z,a=Math.sqrt(Math.pow(s,2)+Math.pow(r,2)+Math.pow(n,2));return 1-(s*(i.x+Ve*e.y)+r*(i.y-Ve*e.x)+n*i.z)/a/299792.458}function ke(e){return e*Te}function ze(e){return e*Re}function Ye(e){if(e<-fe/2||e>fe/2)throw new RangeError("Latitude radians must be in range [-pi/2; pi/2].");return ke(e)}function He(e){if(e<-fe||e>fe)throw new RangeError("Longitude radians must be in range [-pi; pi].");return ke(e)}function We(e){var t=e.longitude,i=e.latitude,s=e.height,r=6378.137,n=(r-6356.7523142)/r,a=2*n-n*n,o=r/Math.sqrt(1-a*(Math.sin(i)*Math.sin(i)));return{x:(o+s)*Math.cos(i)*Math.cos(t),y:(o+s)*Math.cos(i)*Math.sin(t),z:(o*(1-a)+s)*Math.sin(i)}}function Be(e,t){return{x:e.x*Math.cos(t)+e.y*Math.sin(t),y:e.x*-Math.sin(t)+e.y*Math.cos(t),z:e.z}}function je(e){try{const t=["1",e.satelliteNumber1.padStart(5," "),e.classification," ",e.internationalDesignatorYear.padStart(2," "),e.internationalDesignatorLaunchNumber.padStart(3," "),e.internationalDesignatorPiece.padEnd(3," ")," ",e.epochYear.padStart(2," "),e.epoch.padStart(12," ")," ",e.firstDerivative.padStart(10," ")," ",e.secondDerivative.padStart(8," ")," ",e.bStar.padStart(8," ")," ",e.ephemerisType," ",e.elementSetNumber.padStart(4," "),e.checksum1],i=["2",e.satelliteNumber2.padStart(5," ")," ",e.inclination.padStart(8," ")," ",e.rightAscension.padStart(8," ")," ",e.eccentricity.padStart(7," ")," ",e.argumentOfPerigee.padStart(8," ")," ",e.meanAnomaly.padStart(8," ")," ",e.meanMotion.padStart(11," "),e.revolutionNumber.padStart(5," "),e.checksum2],s=$e(t.join(""),i.join(""));return s.error?(console.error(`Satellite record initialization error: ${s.error}`),null):s}catch(e){return console.error("Failed to initialize satellite record:",e),null}}function qe(e,t){const i=je(e);if(!i)return null;const s=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];return we(e,1440*(Le.apply(void 0,i)-e.jdsatepoch))}(i,t);if(!s||!s.position||!s.velocity)return null;const r=s.position,n=s.velocity,a=function(e,t){for(var i=6378.137,s=Math.sqrt(e.x*e.x+e.y*e.y),r=(i-6356.7523142)/i,n=2*r-r*r,a=Math.atan2(e.y,e.x)-t;a<-fe;)a+=Ne;for(;a>fe;)a-=Ne;for(var o,c=0,l=Math.atan2(e.z,Math.sqrt(e.x*e.x+e.y*e.y));c++<20;)o=1/Math.sqrt(1-n*(Math.sin(l)*Math.sin(l))),l=Math.atan2(e.z+i*o*n*Math.sin(l),s);return{longitude:a,latitude:l,height:s/Math.cos(l)-i*o}}(r,be(t));return{timestamp:t,position:r,velocity:n,geographicLocation:{latitude:Ye(a.latitude),longitude:He(a.longitude),altitude:a.height},altitude:a.height}}function Ke(e,t,i,s=60){if(!je(e))return null;const r=[],n=t.getTime(),a=i.getTime();for(let t=n;t<=a;t+=1e3*s){const i=qe(e,new Date(t));i&&r.push(i)}return r}function Je(e,t,i){const s=qe(e,i);if(!s)return null;const r=be(i),n=(a={latitude:ze(t.latitude),longitude:ze(t.longitude),height:t.altitude},o=Be(s.position,r),d=function(e,t){var i=e.longitude,s=e.latitude,r=We(e),n=t.x-r.x,a=t.y-r.y,o=t.z-r.z;return{topS:Math.sin(s)*Math.cos(i)*n+Math.sin(s)*Math.sin(i)*a-Math.cos(s)*o,topE:-Math.sin(i)*n+Math.cos(i)*a,topZ:Math.cos(s)*Math.cos(i)*n+Math.cos(s)*Math.sin(i)*a+Math.sin(s)*o}}(a,o),l=(c=d).topS,h=c.topE,u=c.topZ,m=Math.sqrt(l*l+h*h+u*u),p=Math.asin(u/m),{azimuth:Math.atan2(-h,l)+fe,elevation:p,rangeSat:m});var a,o,c,l,h,u,m,p,d;return{azimuth:n.azimuth*(180/Math.PI),elevation:n.elevation*(180/Math.PI),range:n.rangeSat}}function Ze(e){try{const t=parseFloat(e.meanMotion);return t<=0?null:1440/t}catch{return null}}function Xe(e){try{const t=je(e);if(!t)return null;const i=parseFloat(e.meanMotion),s=t.inclo,r=t.ecco,n=t.argpo,a=t.nodeo,o=t.mo,c=1440/i,l=398600.4418,h=60*c,u=Math.pow(l*h**2/(4*Math.PI**2),1/3),m=6378.137,p=u*(1-r)-m,d=u*(1+r)-m;let E="Unknown";return p<2e3?E="LEO":p>=2e3&&d<35786?E="MEO":Math.abs(d-35786)<100&&r<.01?E="GEO":d>=35786&&(E="HEO"),{periodMinutes:c,semiMajorAxis:u,perigeeAltitude:p,apogeeAltitude:d,meanMotionRevPerDay:i,inclinationDegrees:s*(180/Math.PI),eccentricity:r,argumentOfPerigee:n*(180/Math.PI),rightAscension:a*(180/Math.PI),meanAnomaly:o*(180/Math.PI),orbitType:E}}catch{return null}}function Qe(e){const t=parseInt(e.epochYear),i=t<57?2e3+t:1900+t,s=parseFloat(e.epoch),r=Math.floor(s),n=s-r,a=new Date(Date.UTC(i,0,r));return a.setUTCMilliseconds(864e5*n),a}function et(e,t){const i=[],s=["epoch","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion","firstDerivative","bStar","revolutionNumber"];for(const r of s){const s=parseFloat(e[r]),n=parseFloat(t[r]);if(s!==n){const e=n-s,t=0!==s?e/s*100:0;i.push({field:r,oldValue:s,newValue:n,absoluteChange:e,percentChange:t})}}const r=rt(e.epochYear,e.epoch),n=(rt(t.epochYear,t.epoch).getTime()-r.getTime())/864e5,a=i.filter(e=>"meanMotion"===e.field&&Math.abs(e.absoluteChange||0)>.001||"inclination"===e.field&&Math.abs(e.absoluteChange||0)>.1||"eccentricity"===e.field&&Math.abs(e.absoluteChange||0)>1e-4||!!(e.percentChange&&Math.abs(e.percentChange)>1)),o=function(e,t,i){if(0===e.length)return"No changes detected between TLEs.";let s=`${e.length} field(s) changed over ${i.toFixed(2)} days. `;if(t.length>0){s+=`${t.length} significant change(s): `;s+=t.map(e=>e.field).join(", ")+"."}else s+="All changes are minor.";return s}(i,a,n);return{satelliteNumber:t.satelliteNumber1,satelliteName:t.satelliteName,timeDifference:n,differences:i,significantChanges:a,summary:o}}function tt(e,t=new Date){const i=rt(e.epochYear,e.epoch),s=t.getTime()-i.getTime(),r=s/864e5;let n,a,o;return r<1?(n="fresh",a=!1,o="TLE is current and suitable for high-precision applications."):r<3?(n="recent",a=!1,o="TLE is recent and suitable for most applications."):r<7?(n="old",a=!0,o="TLE is getting old. Consider updating for better accuracy."):r<30?(n="very_old",a=!0,o="TLE is very old. Update recommended for accurate predictions."):(n="ancient",a=!0,o="TLE is ancient. Predictions may be highly inaccurate. Update required."),{ageInDays:r,ageInHours:s/36e5,isStale:a,staleness:n,recommendation:o}}function it(e){if(e.length<2)return{isDecaying:!1,decayRate:0,estimatedLifetimeDays:null,severity:"none",details:"Insufficient data for decay analysis (need at least 2 TLEs)"};const t=[...e].sort((e,t)=>{const i=rt(e.epochYear,e.epoch),s=rt(t.epochYear,t.epoch);return i.getTime()-s.getTime()}),i=t[0],s=t[t.length-1],r=parseFloat(i.meanMotion),n=parseFloat(s.meanMotion),a=rt(i.epochYear,i.epoch),o=(n-r)/((rt(s.epochYear,s.epoch).getTime()-a.getTime())/864e5),c=o>1e-4;let l="none",h=null;c&&(o>.01?(l="critical",h=30):o>.001?(l="high",h=180):o>5e-4?(l="moderate",h=365):(l="low",h=1825));const u=c?`Orbital decay detected. Mean motion increasing at ${o.toExponential(2)} rev/dayÂ². Estimated lifetime: ${h} days.`:"No significant orbital decay detected.";return{isDecaying:c,decayRate:o,estimatedLifetimeDays:h,severity:l,details:u}}function st(e){const t=parseFloat(e.meanMotion),i=parseFloat(e.eccentricity),s=parseFloat(e.inclination),r=nt(t);return r>35e3&&r<36500&&s<15&&i<.05?exports.OrbitType.GEO:i>.3?exports.OrbitType.HEO:r<2e3?exports.OrbitType.LEO:r>=2e3&&r<35786?exports.OrbitType.MEO:r>36500?exports.OrbitType.CISLUNAR:exports.OrbitType.UNKNOWN}function rt(e,t){const i=parseInt(e),s=i>=57?1900+i:2e3+i,r=parseFloat(t),n=new Date(Date.UTC(s,0,1));return n.setUTCDate(r),n}function nt(e){const t=2*e*Math.PI/86400;return Math.pow(398600.4418/(t*t),1/3)-6371}function at(e){const t=parseFloat(e.meanMotion),i=parseFloat(e.eccentricity),s=parseFloat(e.inclination),r=parseFloat(e.rightAscension),n=parseFloat(e.argumentOfPerigee),a=parseFloat(e.meanAnomaly),o=ut(e.epochYear,e.epoch),c=398600.4418,l=2*t*Math.PI/86400,h=Math.pow(c/(l*l),1/3),u=2*Math.PI*Math.sqrt(Math.pow(h,3)/c);return{semiMajorAxis:h,eccentricity:i,inclination:s,rightAscensionOfAscendingNode:r,argumentOfPerigee:n,meanAnomaly:a,trueAnomaly:180*function(e,t,i=1e-8){let s=e,r=1;for(;Math.abs(r)>i;)r=(s-t*Math.sin(s)-e)/(1-t*Math.cos(s)),s-=r;return 2*Math.atan2(Math.sqrt(1+t)*Math.sin(s/2),Math.sqrt(1-t)*Math.cos(s/2))}(a*Math.PI/180,i)/Math.PI,epoch:o,meanMotion:l,period:u}}function ot(e){const t=e.semiMajorAxis,i=e.eccentricity,s=e.inclination*Math.PI/180,r=e.rightAscensionOfAscendingNode*Math.PI/180,n=e.argumentOfPerigee*Math.PI/180,a=(e.trueAnomaly||0)*Math.PI/180,o=398600.4418,c=t*(1-i*i)/(1+i*Math.cos(a)),l=c*Math.cos(a),h=c*Math.sin(a),u=Math.sqrt(o*t*(1-i*i)),m=-o/u*Math.sin(a),p=o/u*(i+Math.cos(a)),d=Math.cos(r),E=Math.sin(r),g=Math.cos(s),f=Math.sin(s),N=Math.cos(n),R=Math.sin(n);return{position:{x:(d*N-E*R*g)*l+(-d*R-E*N*g)*h,y:(E*N+d*R*g)*l+(-E*R+d*N*g)*h,z:R*f*l+N*f*h},velocity:{vx:(d*N-E*R*g)*m+(-d*R-E*N*g)*p,vy:(E*N+d*R*g)*m+(-E*R+d*N*g)*p,vz:R*f*m+N*f*p}}}function ct(e){return`["${e.satelliteName||`SATELLITE ${e.satelliteNumber1}`}","${e.lineNumber1} ${e.satelliteNumber1}${e.classification}...","${e.lineNumber2} ${e.satelliteNumber2}..."]`}function lt(e){const t=at(e),i=ut(e.epochYear,e.epoch);let s=`"${e.satelliteName||e.satelliteNumber1}" "Sol/Earth"\n{\n`;return s+='  Class "spacecraft"\n',s+='  Mesh "satellite.3ds"\n',s+="  Radius 0.01\n\n",s+="  EllipticalOrbit\n  {\n",s+=`    Epoch ${i.getTime()/1e3}\n`,s+=`    SemiMajorAxis ${t.semiMajorAxis}\n`,s+=`    Eccentricity ${t.eccentricity}\n`,s+=`    Inclination ${t.inclination}\n`,s+=`    AscendingNode ${t.rightAscensionOfAscendingNode}\n`,s+=`    ArgOfPericenter ${t.argumentOfPerigee}\n`,s+=`    MeanAnomaly ${t.meanAnomaly}\n`,s+="  }\n}\n",s}function ht(e){let t="";return e.satelliteName&&(t+=e.satelliteName+"\n"),t+=`1 ${e.satelliteNumber1}${e.classification} `,t+=`${e.internationalDesignatorYear}${e.internationalDesignatorLaunchNumber}${e.internationalDesignatorPiece} `,t+=`${e.epochYear}${e.epoch} `,t+=`${e.firstDerivative} `,t+=`${e.secondDerivative} `,t+=`${e.bStar} `,t+=`${e.ephemerisType} `,t+=`${e.elementSetNumber}`,t+=e.checksum1+"\n",t+=`2 ${e.satelliteNumber2} `,t+=`${e.inclination} `,t+=`${e.rightAscension} `,t+=`${e.eccentricity} `,t+=`${e.argumentOfPerigee} `,t+=`${e.meanAnomaly} `,t+=`${e.meanMotion}`,t+=`${e.revolutionNumber}`,t+=e.checksum2,t}function ut(e,t){const i=parseInt(e),s=i>=57?1900+i:2e3+i,r=parseFloat(t),n=new Date(Date.UTC(s,0,1));return n.setTime(n.getTime()+864e5*(r-1)),n}function mt(e,t){const i=e>=0?" ":"-",s=Math.abs(e),r=Math.floor(Math.log10(s));return`${i}${(s/Math.pow(10,r)).toFixed(t-4)}${r>=0?"+":""}${r}`}function pt(e){let t=0;for(const i of e)i>="0"&&i<="9"?t+=parseInt(i):"-"===i&&(t+=1);return(t%10).toString()}exports.OrbitType=void 0,(Fe=exports.OrbitType||(exports.OrbitType={})).LEO="LEO",Fe.MEO="MEO",Fe.GEO="GEO",Fe.HEO="HEO",Fe.CISLUNAR="CISLUNAR",Fe.UNKNOWN="UNKNOWN",exports.CoordinateFrame=void 0,(Pe=exports.CoordinateFrame||(exports.CoordinateFrame={})).TEME="TEME",Pe.J2000="J2000",Pe.ITRF="ITRF",Pe.GCRF="GCRF",Pe.EME2000="EME2000",exports.PlanetariumFormat=void 0,(Ue=exports.PlanetariumFormat||(exports.PlanetariumFormat={})).STELLARIUM="STELLARIUM",Ue.CELESTIA="CELESTIA",Ue.SPACENGINE="SPACENGINE",Ue.UNIVERSESANDBOX="UNIVERSESANDBOX";const dt={lineNumber1:[0,1],satelliteNumber1:[2,7],classification:[7,8],internationalDesignatorYear:[9,11],internationalDesignatorLaunchNumber:[11,14],internationalDesignatorPiece:[14,17],epochYear:[18,20],epoch:[20,32],firstDerivative:[33,43],secondDerivative:[44,52],bStar:[53,61],ephemerisType:[62,63],elementSetNumber:[64,68],checksum1:[68,69],lineNumber2:[0,1],satelliteNumber2:[2,7],inclination:[8,16],rightAscension:[17,25],eccentricity:[26,33],argumentOfPerigee:[34,42],meanAnomaly:[43,51],meanMotion:[52,63],revolutionNumber:[63,68],checksum2:[68,69]};class Et extends Error{constructor(e,t,i=[]){super(e),this.name="TLEValidationError",this.errors=t,this.warnings=i,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class gt extends Error{constructor(e,t,i={}){super(e),this.name="TLEFormatError",this.code=t,this.details=i,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}function ft(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}function Nt(e){return ft(e).split("\n").map(e=>e.replace(/\t/g," ").trim()).filter(e=>e.length>0)}function Rt(e){let t=0;for(let i=0;i<e.length-1;i++){const s=e[i];s&&s>="0"&&s<="9"?t+=parseInt(s,10):"-"===s&&(t+=1)}return t%10}function Tt(e){if(69!==e.length)return{isValid:!1,expected:null,actual:null,error:{code:exports.ERROR_CODES.INVALID_LINE_LENGTH,message:"Line length must be 69 characters",field:"line_length",expected:69,actual:e.length,severity:"error"}};const t=Rt(e),i=parseInt(e[68]||"",10);if(isNaN(i))return{isValid:!1,expected:t,actual:null,error:{code:exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER,message:"Checksum position must contain a digit",field:"checksum",position:68,value:e[68],severity:"error"}};const s=t===i;return{isValid:s,expected:t,actual:i,error:s?null:{code:exports.ERROR_CODES.CHECKSUM_MISMATCH,message:`Checksum mismatch: expected ${t}, got ${i}`,field:"checksum",expected:t,actual:i,severity:"error"}}}function At(e,t){const i=[];if(69!==e.length)return i.push({code:exports.ERROR_CODES.INVALID_LINE_LENGTH,message:`Line ${t} must be exactly 69 characters (got ${e.length})`,line:t,field:"line_length",expected:69,actual:e.length,severity:"error"}),{isValid:!1,errors:i};const s=e[0];s!==t.toString()&&i.push({code:exports.ERROR_CODES.INVALID_LINE_NUMBER,message:`Line ${t} must start with '${t}' (got '${s}')`,line:t,field:"line_number",expected:t.toString(),actual:s,severity:"error"});const r=Tt(e);return!r.isValid&&r.error&&i.push({...r.error,line:t,message:`Line ${t}: ${r.error.message}`}),{isValid:0===i.length,errors:i}}function It(e,t){const i=e.substring(2,7).trim(),s=t.substring(2,7).trim();return i!==s?{isValid:!1,error:{code:exports.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,message:`Satellite numbers must match (Line 1: ${i}, Line 2: ${s})`,field:"satellite_number",line1Value:i,line2Value:s,severity:"error"}}:/^\d+$/.test(i)?{isValid:!0,error:null}:{isValid:!1,error:{code:exports.ERROR_CODES.INVALID_SATELLITE_NUMBER,message:`Satellite number must be numeric (got '${i}')`,field:"satellite_number",value:i,severity:"error"}}}function xt(e){const t=e[7],i=["U","C","S"];return i.includes(t||"")?{isValid:!0,error:null}:{isValid:!1,error:{code:exports.ERROR_CODES.INVALID_CLASSIFICATION,message:`Classification must be U, C, or S (got '${t}')`,field:"classification",expected:i,actual:t,severity:"error"}}}function Ot(e,t,i,s){const r=parseFloat(e);return isNaN(r)?{isValid:!1,error:{code:exports.ERROR_CODES.INVALID_NUMBER_FORMAT,message:`${t} must be numeric (got '${e}')`,field:t,value:e,severity:"error"}}:r<i||r>s?{isValid:!1,error:{code:exports.ERROR_CODES.VALUE_OUT_OF_RANGE,message:`${t} must be between ${i} and ${s} (got ${r})`,field:t,value:r,min:i,max:s,severity:"error"}}:{isValid:!0,error:null}}function St(e){const t=[],i=e[7];return"C"!==i&&"S"!==i||t.push({code:exports.ERROR_CODES.CLASSIFIED_DATA_WARNING,message:`Classification '${i}' is unusual in public TLE data (typically 'U' for unclassified)`,field:"classification",value:i,severity:"warning"}),t}function _t(e){const t=[],i=parseInt(e.substring(18,20),10),s=parseFloat(e.substring(20,32));if(isNaN(i)||isNaN(s))return t;const r=i>=57?1900+i:2e3+i;r<2e3&&t.push({code:exports.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,message:`Epoch year ${r} is in the deprecated 1900s range (two-digit year: ${i})`,field:"epochYear",value:i,fullYear:r,severity:"warning"});const n=new Date(r,0,1);n.setDate(n.getDate()+s-1);const a=((new Date).getTime()-n.getTime())/864e5;return a>30&&t.push({code:exports.ERROR_CODES.STALE_TLE_WARNING,message:`TLE epoch is ${Math.floor(a)} days old (epoch: ${n.toISOString().split("T")[0]}). TLE data may be stale.`,field:"epoch",daysSinceEpoch:Math.floor(a),epochDate:n.toISOString().split("T")[0],severity:"warning"}),t}function Mt(e){const t=[],i=parseFloat("0."+e.substring(26,33).trim());!isNaN(i)&&i>.25&&t.push({code:exports.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,message:`Eccentricity ${i.toFixed(7)} is unusually high. This indicates a highly elliptical orbit.`,field:"eccentricity",value:i,severity:"warning"});const s=parseFloat(e.substring(52,63).trim());!isNaN(s)&&s<1&&t.push({code:exports.ERROR_CODES.LOW_MEAN_MOTION_WARNING,message:`Mean motion ${s.toFixed(8)} rev/day is unusually low. This indicates a very high orbit.`,field:"meanMotion",value:s,severity:"warning"});const r=parseInt(e.substring(63,68).trim(),10);return!isNaN(r)&&r>9e4&&t.push({code:exports.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,message:`Revolution number ${r} is approaching rollover limit (99999). Counter may reset soon.`,field:"revolutionNumber",value:r,severity:"warning"}),t}function yt(e){const t=[],i=e.substring(53,61).trim();"00000-0"!==i&&"00000+0"!==i&&"00000 0"!==i||t.push({code:exports.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,message:"B* drag term is zero or near-zero, which is unusual for most satellites in LEO",field:"bStar",value:i,severity:"warning"});const s=parseFloat(e.substring(33,43).trim());!isNaN(s)&&s<0&&t.push({code:exports.ERROR_CODES.NEGATIVE_DECAY_WARNING,message:`First derivative of mean motion is negative (${s}), indicating orbital decay`,field:"firstDerivative",value:s,severity:"warning"});const r=e.substring(62,63).trim();return"0"!==r&&""!==r&&t.push({code:exports.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,message:`Ephemeris type '${r}' is non-standard (expected '0' for SGP4/SDP4)`,field:"ephemerisType",value:r,severity:"warning"}),t}function Ct(e,t={}){if("string"!=typeof e)throw new TypeError("TLE data must be a string");if("object"!=typeof t||null===t||Array.isArray(t))throw new TypeError("Options must be an object");if(0===e.length)throw new gt("TLE string cannot be empty",exports.ERROR_CODES.EMPTY_INPUT,{inputLength:0});const{strictChecksums:i=!0,validateRanges:s=!0,mode:r="strict"}=t;if("strict"!==r&&"permissive"!==r)throw new TypeError('Mode must be either "strict" or "permissive"');const n=[],a=[],o=ft(e).trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0&&!e.startsWith("#"));if(o.length<2)return n.push({code:exports.ERROR_CODES.INVALID_LINE_COUNT,message:"TLE must contain at least 2 lines",field:"line_count",expected:"2 or 3",actual:o.length,severity:"error"}),{isValid:!1,errors:n,warnings:a};if(o.length>3)return n.push({code:exports.ERROR_CODES.INVALID_LINE_COUNT,message:`TLE must contain 2 or 3 lines (got ${o.length})`,field:"line_count",expected:"2 or 3",actual:o.length,severity:"error"}),{isValid:!1,errors:n,warnings:a};let c=0,l=1;if(3===o.length){c=1,l=2;const e=o[0];!e||"1"!==e[0]&&"2"!==e[0]||a.push({code:exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,message:'Line 0 starts with "1" or "2", might be incorrectly formatted',field:"satellite_name",value:e,severity:"warning"}),e&&e.length>24&&a.push({code:exports.ERROR_CODES.SATELLITE_NAME_TOO_LONG,message:"Satellite name (Line 0) should be 24 characters or less",field:"satellite_name",expected:24,actual:e.length,severity:"warning"})}const h=o[c],u=o[l];if(!h||!u)return n.push({code:exports.ERROR_CODES.INVALID_LINE_COUNT,message:"Missing required TLE lines",severity:"error"}),{isValid:!1,errors:n,warnings:a};const m=At(h,1);if(!m.isValid)if("permissive"===r){const e=m.errors.filter(e=>e.code!==exports.ERROR_CODES.CHECKSUM_MISMATCH&&e.code!==exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER),t=m.errors.filter(e=>e.code===exports.ERROR_CODES.CHECKSUM_MISMATCH||e.code===exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER);if(n.push(...e),a.push(...t.map(e=>({...e,severity:"warning"}))),e.length>0)return{isValid:!1,errors:n,warnings:a}}else if(n.push(...m.errors),i)return{isValid:!1,errors:n,warnings:a};const p=At(u,2);if(!p.isValid)if("permissive"===r){const e=p.errors.filter(e=>e.code!==exports.ERROR_CODES.CHECKSUM_MISMATCH&&e.code!==exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER),t=p.errors.filter(e=>e.code===exports.ERROR_CODES.CHECKSUM_MISMATCH||e.code===exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER);if(n.push(...e),a.push(...t.map(e=>({...e,severity:"warning"}))),e.length>0)return{isValid:!1,errors:n,warnings:a}}else if(n.push(...p.errors),i)return{isValid:!1,errors:n,warnings:a};const d=It(h,u);!d.isValid&&d.error&&("permissive"===r?a.push({...d.error,severity:"warning"}):n.push(d.error));const E=xt(h);if(!E.isValid&&E.error&&("permissive"===r?a.push({...E.error,severity:"warning"}):n.push(E.error)),s&&69===h.length&&69===u.length){const e=[{value:h.substring(2,7).trim(),name:"Satellite Number",min:1,max:99999},{value:h.substring(9,11).trim(),name:"International Designator Year",min:0,max:99,optional:!0},{value:h.substring(11,14).trim(),name:"International Designator Launch Number",min:1,max:999,optional:!0},{value:h.substring(62,63).trim(),name:"Ephemeris Type",min:0,max:9,optional:!0},{value:h.substring(64,68).trim(),name:"Element Set Number",min:0,max:9999,optional:!0},{value:h.substring(18,20).trim(),name:"Epoch Year",min:0,max:99},{value:h.substring(20,32).trim(),name:"Epoch Day",min:1,max:366.99999999},{value:u.substring(8,16).trim(),name:"Inclination",min:0,max:180},{value:u.substring(17,25).trim(),name:"Right Ascension",min:0,max:360},{value:"0."+u.substring(26,33).trim(),name:"Eccentricity",min:0,max:1},{value:u.substring(34,42).trim(),name:"Argument of Perigee",min:0,max:360},{value:u.substring(43,51).trim(),name:"Mean Anomaly",min:0,max:360},{value:u.substring(52,63).trim(),name:"Mean Motion",min:0,max:20,warningOnly:!0},{value:u.substring(63,68).trim(),name:"Revolution Number",min:0,max:99999,optional:!0}];for(const{value:t,name:i,min:s,max:o,optional:c,warningOnly:l}of e){if(c&&0===t.length)continue;const e=Ot(t,i,s,o);!e.isValid&&e.error&&(l||"permissive"===r?a.push({...e.error,severity:"warning"}):n.push(e.error))}}return 69===h.length&&(a.push(...St(h)),a.push(..._t(h)),a.push(...yt(h))),69===u.length&&a.push(...Mt(u)),{isValid:0===n.length,errors:n,warnings:a}}function Lt(e,t={}){if("string"!=typeof e)throw new TypeError("TLE data must be a string");if("object"!=typeof t||null===t||Array.isArray(t))throw new TypeError("Options must be an object");const{validate:i=!0,strictChecksums:s=!0,validateRanges:r=!0,includeWarnings:n=!0,includeComments:a=!0,mode:o="strict"}=t;let c=[];if(i){const t=Ct(e,{strictChecksums:s,validateRanges:r,mode:o});if(!t.isValid){const e="TLE validation failed:\n"+t.errors.map(e=>"string"==typeof e?e:e.message).join("\n");throw new Et(e,t.errors,t.warnings)}c=t.warnings}const l=ft(e).trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0),h=l.filter(e=>e.startsWith("#")),u=l.filter(e=>!e.startsWith("#"));let m=0,p=1,d=null;3===u.length&&(d=u[0]||null,m=1,p=2);const E=u[m],g=u[p];if(!E||!g)throw new gt("Missing required TLE lines",exports.ERROR_CODES.INVALID_LINE_COUNT);const f={satelliteName:d},N=["lineNumber2","satelliteNumber2","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion","revolutionNumber","checksum2"];for(const[e,t]of Object.entries(dt)){const[i,s]=t,r=N.includes(e)?g:E;f[e]=r.substring(i,s).trim()}return n&&c.length>0&&(f.warnings=c),a&&h.length>0&&(f.comments=h),f}var vt={parseTLE:Lt,validateTLE:Ct,calculateChecksum:Rt,validateChecksum:Tt,validateLineStructure:At,validateSatelliteNumber:It,validateClassification:xt,validateNumericRange:Ot,checkClassificationWarnings:St,checkEpochWarnings:_t,checkOrbitalParameterWarnings:Mt,checkDragAndEphemerisWarnings:yt,normalizeLineEndings:ft,parseTLELines:Nt,TLEValidationError:Et,TLEFormatError:gt,ERROR_CODES:exports.ERROR_CODES};exports.AMSATSource=class{constructor(e={}){this.baseUrl="https://www.amsat.org/tle/current/nasabare.txt",this.config={type:"amsat",baseUrl:e.baseUrl||this.baseUrl,enableCache:!1!==e.enableCache,cacheTTL:e.cacheTTL||36e5,timeout:e.timeout||3e4,rateLimit:e.rateLimit||{maxRequests:10,intervalMs:6e4},...e},this.rateLimiter=new oe(this.config.rateLimit),this.cache=new ce({maxSize:10,defaultTTL:this.config.cacheTTL,persistent:!0,cacheFile:"amsat-cache.json"})}async fetch(e={}){const t="amsat:all",i=Date.now();if(this.config.enableCache&&!e.forceRefresh){const s=this.cache.get(t);if(s){const t=g(s,e.parseOptions||{});return{data:t,source:"amsat",timestamp:new Date,cached:!0,count:t.length,age:Date.now()-i}}}const s=await this.rateLimiter.execute(async()=>{const e=new AbortController,t=setTimeout(()=>e.abort(),this.config.timeout);try{const t=await fetch(this.config.baseUrl,{headers:this.config.headers,signal:e.signal});if(!t.ok)throw new Error(`AMSAT fetch failed: ${t.status} ${t.statusText}`);return await t.text()}finally{clearTimeout(t)}});this.config.enableCache&&this.cache.set(t,s,this.config.cacheTTL);const r=g(s,e.parseOptions||{});return{data:r,source:"amsat",timestamp:new Date,cached:!1,count:r.length,age:Date.now()-i}}clearCache(){this.cache.clear()}getCacheStats(){return this.cache.getStats()}},exports.CONSTELLATIONS=me,exports.CelesTrakSource=class{constructor(e={}){this.baseUrl="https://celestrak.org/NORAD/elements/gp.php",this.config={type:"celestrak",baseUrl:e.baseUrl||this.baseUrl,enableCache:!1!==e.enableCache,cacheTTL:e.cacheTTL||36e5,timeout:e.timeout||3e4,rateLimit:e.rateLimit||{maxRequests:20,intervalMs:6e4},...e},this.rateLimiter=new oe(this.config.rateLimit),this.cache=new ce({maxSize:100,defaultTTL:this.config.cacheTTL,persistent:!0,cacheFile:"celestrak-cache.json"})}async fetch(e={}){const t=this.generateCacheKey(e),i=Date.now();if(this.config.enableCache&&!e.forceRefresh){const s=this.cache.get(t);if(s){const t=g(s,e.parseOptions||{});return{data:t,source:"celestrak",timestamp:new Date,cached:!0,count:t.length,age:Date.now()-i}}}const s=this.buildUrl(e),r=await this.rateLimiter.execute(async()=>{const e=new AbortController,t=setTimeout(()=>e.abort(),this.config.timeout);try{const t=await fetch(s,{headers:this.config.headers,signal:e.signal});if(!t.ok)throw new Error(`CelesTrak fetch failed: ${t.status} ${t.statusText}`);return await t.text()}finally{clearTimeout(t)}});this.config.enableCache&&this.cache.set(t,r,this.config.cacheTTL);const n=g(r,e.parseOptions||{});return{data:n,source:"celestrak",timestamp:new Date,cached:!1,count:n.length,age:Date.now()-i}}buildUrl(e){const t=new URLSearchParams;if(e.catalogNumber){const i=Array.isArray(e.catalogNumber)?e.catalogNumber:[e.catalogNumber];t.append("CATNR",i.join(",")),t.append("FORMAT","TLE")}else e.group?(t.append("GROUP",e.group),t.append("FORMAT","TLE")):e.namePattern?(t.append("NAME",e.namePattern),t.append("FORMAT","TLE")):e.intlDesignator?(t.append("INTDES",e.intlDesignator),t.append("FORMAT","TLE")):(t.append("GROUP","active"),t.append("FORMAT","TLE"));if(e.queryParams)for(const[i,s]of Object.entries(e.queryParams))t.append(i,s);return`${this.config.baseUrl}?${t.toString()}`}generateCacheKey(e){return he("celestrak",{catalog:e.catalogNumber,group:e.group,name:e.namePattern,intl:e.intlDesignator})}clearCache(){this.cache.clear()}getCacheStats(){return this.cache.getStats()}},exports.Colors=X,exports.CustomSource=class{constructor(e){if(!e.baseUrl)throw new Error("Custom source requires a base URL");this.config={...e,type:"custom",enableCache:!1!==e.enableCache,cacheTTL:e.cacheTTL||36e5,timeout:e.timeout||3e4,rateLimit:e.rateLimit||{maxRequests:10,intervalMs:6e4}},this.rateLimiter=new oe(this.config.rateLimit),this.cache=new ce({maxSize:50,defaultTTL:this.config.cacheTTL,persistent:!0,cacheFile:"custom-cache.json"})}async fetch(e={}){const t=e.queryParams?.url||this.config.baseUrl,i=he("custom",{url:t}),s=Date.now();if(this.config.enableCache&&!e.forceRefresh){const t=this.cache.get(i);if(t){const i=g(t,e.parseOptions||{});return{data:i,source:"custom",timestamp:new Date,cached:!0,count:i.length,age:Date.now()-s}}}const r=await this.rateLimiter.execute(async()=>{const e=new AbortController,i=setTimeout(()=>e.abort(),this.config.timeout);try{const i={...this.config.headers};this.config.credentials?.apiKey&&(i.Authorization=`Bearer ${this.config.credentials.apiKey}`);const s=await fetch(t,{headers:i,signal:e.signal});if(!s.ok)throw new Error(`Custom source fetch failed: ${s.status} ${s.statusText}`);return await s.text()}finally{clearTimeout(i)}});this.config.enableCache&&this.cache.set(i,r,this.config.cacheTTL);const n=g(r,e.parseOptions||{});return{data:n,source:"custom",timestamp:new Date,cached:!1,count:n.length,age:Date.now()-s}}clearCache(){this.cache.clear()}getCacheStats(){return this.cache.getStats()}},exports.DEFAULT_VALIDATION_RULES=K,exports.DESIGNATOR_CONSTRAINTS=v,exports.DataSourceManager=class{constructor(){this.sources=new Map,this.primarySource=null,this.failoverOrder=[]}register(e,t,i={}){this.sources.set(e,t),i.primary&&(this.primarySource=e),!1!==i.failover&&this.failoverOrder.push(e)}async fetch(e,t={}){const i=e||this.primarySource;if(!i)throw new Error("No data source specified and no primary source configured");const s=[i,...this.failoverOrder.filter(e=>e!==i)];let r=null;for(const e of s){const i=this.sources.get(e);if(i)try{return await i.fetch(t)}catch(t){r=t,console.error(`Failed to fetch from ${e}:`,t)}}throw new Error(`All data sources failed. Last error: ${r?.message||"Unknown error"}`)}getSource(e){return this.sources.get(e)}listSources(){return Array.from(this.sources.keys())}clearAllCaches(){for(const e of this.sources.values())e.clearCache()}},exports.EPOCH_CONSTRAINTS=L,exports.IncrementalParser=_,exports.MiddlewareParser=x,exports.ORBITAL_PARAMETER_RANGES=y,exports.QUALITY_SCORE_WEIGHTS=D,exports.RateLimiter=oe,exports.RateLimiterManager=class{constructor(){this.limiters=new Map}register(e,t){this.limiters.set(e,new oe(t))}get(e){return this.limiters.get(e)}async acquire(e){const t=this.limiters.get(e);if(!t)throw new Error(`No rate limiter registered for source: ${e}`);return t.acquire()}async execute(e,t){const i=this.limiters.get(e);if(!i)throw new Error(`No rate limiter registered for source: ${e}`);return i.execute(t)}getAllStatus(){const e=new Map;for(const[t,i]of this.limiters)e.set(t,i.getStatus());return e}resetAll(){for(const e of this.limiters.values())e.reset()}},exports.SATELLITE_NUMBER_RANGES=C,exports.SCHEDULE_INTERVALS={EVERY_15_MINUTES:9e5,EVERY_30_MINUTES:18e5,HOURLY:36e5,EVERY_2_HOURS:72e5,EVERY_6_HOURS:216e5,EVERY_12_HOURS:432e5,DAILY:864e5,WEEKLY:6048e5},exports.SchedulerManager=class{constructor(){this.schedulers=new Map}create(e,t,i){const s=new Ee(t,i);return this.schedulers.set(e,s),s}get(e){return this.schedulers.get(e)}remove(e){const t=this.schedulers.get(e);return!!t&&(t.stop(),this.schedulers.delete(e))}startAll(){for(const e of this.schedulers.values())e.start()}stopAll(){for(const e of this.schedulers.values())e.stop()}getAllStatus(){const e=new Map;for(const[t,i]of this.schedulers)e.set(t,i.getStatus());return e}list(){return Array.from(this.schedulers.keys())}},exports.SpaceTrackSource=class{constructor(e={}){if(this.baseUrl="https://www.space-track.org",this.authUrl="https://www.space-track.org/ajaxauth/login",this.queryUrl="https://www.space-track.org/basicspacedata/query",this.sessionCookie=null,this.lastAuth=0,this.authTTL=72e5,!e.credentials?.username||!e.credentials?.password)throw new Error("Space-Track.org requires username and password credentials");this.config={type:"spacetrack",baseUrl:e.baseUrl||this.baseUrl,credentials:e.credentials,enableCache:!1!==e.enableCache,cacheTTL:e.cacheTTL||18e5,timeout:e.timeout||6e4,rateLimit:e.rateLimit||{maxRequests:20,intervalMs:6e4},...e},this.rateLimiter=new oe(this.config.rateLimit),this.cache=new ce({maxSize:100,defaultTTL:this.config.cacheTTL,persistent:!0,cacheFile:"spacetrack-cache.json"})}async authenticate(){if(this.sessionCookie&&Date.now()-this.lastAuth<this.authTTL)return;const e=new URLSearchParams;e.append("identity",this.config.credentials.username),e.append("password",this.config.credentials.password);const t=await fetch(this.authUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e.toString()});if(!t.ok)throw new Error(`Space-Track authentication failed: ${t.status} ${t.statusText}`);const i=t.headers.get("set-cookie");if(i){const e=i.match(/chocolatechip=([^;]+)/);e&&e[1]&&(this.sessionCookie=e[1],this.lastAuth=Date.now())}if(!this.sessionCookie)throw new Error("Failed to obtain Space-Track session cookie")}async fetch(e={}){const t=this.generateCacheKey(e),i=Date.now();if(this.config.enableCache&&!e.forceRefresh){const s=this.cache.get(t);if(s){const t=g(s,e.parseOptions||{});return{data:t,source:"spacetrack",timestamp:new Date,cached:!0,count:t.length,age:Date.now()-i}}}await this.authenticate();const s=this.buildUrl(e),r=await this.rateLimiter.execute(async()=>{const e=new AbortController,t=setTimeout(()=>e.abort(),this.config.timeout);try{const t=await fetch(s,{headers:{Cookie:`chocolatechip=${this.sessionCookie}`,...this.config.headers},signal:e.signal});if(!t.ok){if(401===t.status){this.sessionCookie=null,await this.authenticate();const t=await fetch(s,{headers:{Cookie:`chocolatechip=${this.sessionCookie}`,...this.config.headers},signal:e.signal});if(!t.ok)throw new Error(`Space-Track fetch failed: ${t.status} ${t.statusText}`);return await t.text()}throw new Error(`Space-Track fetch failed: ${t.status} ${t.statusText}`)}const i=await t.text();try{const e=JSON.parse(i);return this.jsonToTLE(e)}catch{return i}}finally{clearTimeout(t)}});this.config.enableCache&&this.cache.set(t,r,this.config.cacheTTL);const n=g(r,e.parseOptions||{});return{data:n,source:"spacetrack",timestamp:new Date,cached:!1,count:n.length,age:Date.now()-i}}buildUrl(e){let t="/class/gp/";return e.catalogNumber&&(t+=`NORAD_CAT_ID/${(Array.isArray(e.catalogNumber)?e.catalogNumber:[e.catalogNumber]).join(",")}/`),e.intlDesignator&&(t+=`INTLDES/${e.intlDesignator}/`),t+="orderby/EPOCH%20desc/limit/1000/format/tle",`${this.queryUrl}${t}`}jsonToTLE(e){return Array.isArray(e)?e.map(e=>{const t=[];return e.OBJECT_NAME&&t.push(e.OBJECT_NAME),e.TLE_LINE1&&t.push(e.TLE_LINE1),e.TLE_LINE2&&t.push(e.TLE_LINE2),t.join("\n")}).join("\n"):""}generateCacheKey(e){return he("spacetrack",{catalog:e.catalogNumber,intl:e.intlDesignator})}clearCache(){this.cache.clear()}getCacheStats(){return this.cache.getStats()}logout(){this.sessionCookie=null,this.lastAuth=0}},exports.TLECache=O,exports.TLEFormatError=gt,exports.TLEParserStream=T,exports.TLEScheduler=Ee,exports.TLEStateMachineParser=d,exports.TLEValidationError=Et,exports.TTLCache=ce,exports.ValidationRuleManager=class{constructor(e=K){this.rules=new Map;for(const t of e)this.rules.set(t.name,t)}addRule(e){this.rules.set(e.name,e)}removeRule(e){return this.rules.delete(e)}enableRule(e){const t=this.rules.get(e);return!!t&&(t.enabled=!0,!0)}disableRule(e){const t=this.rules.get(e);return!!t&&(t.enabled=!1,!0)}getEnabledRules(){return Array.from(this.rules.values()).filter(e=>e.enabled)}getRule(e){return this.rules.get(e)}getAllRules(){return Array.from(this.rules.values())}},exports.analyzeConstellation=function(e,t){const i={LEO:0,MEO:0,GEO:0,HEO:0,CISLUNAR:0,UNKNOWN:0};let s=0,r=0;const n=[];for(const t of e){i[st(t)]++;const e=parseFloat(t.inclination),a=parseFloat(t.meanMotion),o=parseFloat(t.rightAscension);s+=e,r+=nt(a),n.push(o)}const a=s/e.length,o=r/e.length,c=function(e){if(e.length<2)return 1;const t=[...e].sort((e,t)=>e-t),i=[];let s=[t[0]];for(let e=1;e<t.length;e++)t[e]-t[e-1]<5?s.push(t[e]):(i.push(s),s=[t[e]]);return i.push(s),i.length}(n),l=360/(e.length/c),h=n.length>1?Math.abs(n[1]-n[0]):0;let u;return u=a>80?"Global (polar)":a>50?"High latitude":"Equatorial to mid-latitude",{constellationName:t,totalSatellites:e.length,orbitTypes:i,averageInclination:a,averageAltitude:o,orbitalPlanes:c,spacing:{alongTrack:l,crossTrack:h},coverage:u}},exports.analyzeOrbitalDecay=it,exports.analyzeTrend=function(e,t){if(e.length<3)return{satelliteNumber:e[0]?.satelliteNumber1||"unknown",parameter:t,trend:"stable",trendStrength:0,changeRate:0,predictions:{next7Days:0,next30Days:0}};const i=[...e].sort((e,t)=>{const i=rt(e.epochYear,e.epoch),s=rt(t.epochYear,t.epoch);return i.getTime()-s.getTime()}),s=[],r=[];for(const e of i){const i=e[t];if(i){const t=parseFloat(i);if(!isNaN(t)){s.push(t);const i=rt(e.epochYear,e.epoch);r.push(i.getTime())}}}const n=s.length,a=r.reduce((e,t)=>e+t,0),o=s.reduce((e,t)=>e+t,0),c=(n*r.reduce((e,t,i)=>e+t*s[i],0)-a*o)/(n*r.reduce((e,t)=>e+t*t,0)-a*a),l=(o-c*a)/n;let h;const u=.01*Math.abs(s[s.length-1]-s[0]);h=Math.abs(c)<u/(r[r.length-1]-r[0])?"stable":c>0?"increasing":"decreasing";const m=o/n,p=s.reduce((e,t)=>e+Math.pow(t-m,2),0),d=1-s.reduce((e,t,i)=>{const s=c*r[i]+l;return e+Math.pow(t-s,2)},0)/p,E=864e5*c,g=r[r.length-1],f=c*(g+6048e5)+l,N=c*(g+2592e6)+l;return{satelliteNumber:i[0].satelliteNumber1,parameter:t,trend:h,trendStrength:Math.max(0,Math.min(1,d)),changeRate:E,predictions:{next7Days:f,next30Days:N}}},exports.applyFilter=R,exports.assessTLEStaleness=tt,exports.calculateChecksum=Rt,exports.calculateConjunctionProbability=function(e,t,i=24){const s=nt(parseFloat(e.meanMotion)),r=nt(parseFloat(t.meanMotion)),n=parseFloat(e.inclination),a=parseFloat(t.inclination),o=Math.abs(s-r),c=Math.abs(n-a);if(o>100||c>10)return{satellite1:e.satelliteNumber1,satellite2:t.satelliteNumber1,probabilityOfCollision:0,minimumDistance:o,timeOfClosestApproach:new Date,riskLevel:"low",recommendations:["Orbits are sufficiently separated"]};let l=0,h="low";const u=[];return o<10&&c<2&&(l=.001,h="moderate",u.push("Monitor conjunction","Consider detailed analysis")),o<5&&c<1&&(l=.01,h="high",u.push("Perform detailed conjunction analysis","Prepare collision avoidance maneuver")),o<2&&c<.5&&(l=.1,h="critical",u.push("URGENT: Immediate collision avoidance required","Contact satellite operators")),{satellite1:e.satelliteNumber1,satellite2:t.satelliteNumber1,probabilityOfCollision:l,minimumDistance:o,timeOfClosestApproach:new Date(Date.now()+Math.random()*i*60*60*1e3),riskLevel:h,recommendations:u}},exports.calculateDopplerShift=function(e,t,i,s){const r=qe(e,i);if(!r)return null;const n=be(i),a={latitude:ze(t.latitude),longitude:ze(t.longitude),height:t.altitude},o=Be(r.position,n),c=Be(r.velocity,n),l=We(a),h=Ge(l,o,c),u=o.x-l.x,m=o.y-l.y,p=o.z-l.z,d=Math.sqrt(u**2+m**2+p**2),E=(u*c.x+m*c.y+p*c.z)/d,g=new Date(i.getTime()+1e3),f=qe(e,g);let N=0;return f&&(N=(s*(Ge(l,Be(f.position,be(g)),Be(f.velocity,be(g)))-1)-s*(h-1))/1),{factor:h,shiftHz:s*(h-1),rateHzPerSecond:N,rangeRate:E}},exports.calculateEclipses=function(e,t,i){const s=[];let r=!1,n=null,a=0;const o=t.getTime(),c=i.getTime();for(let t=o;t<=c;t+=1e4){const i=new Date(t),o=qe(e,i);if(!o)continue;const c=(Le(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds())-2451545)/36525,l=(357.528+35999.05*c)%360,h=(280.46+36000.771*c)%360+1.915*Math.sin(l*Math.PI/180),u=149597870.7,m={x:u*Math.cos(h*Math.PI/180),y:u*Math.sin(h*Math.PI/180),z:0},p={x:m.x-o.position.x,y:m.y-o.position.y,z:m.z-o.position.z},d=Math.sqrt(p.x**2+p.y**2+p.z**2),E=Math.sqrt(o.position.x**2+o.position.y**2+o.position.z**2),g=-(o.position.x*p.x+o.position.y*p.y+o.position.z*p.z);let f=0;if(g>0&&E<7378.137){const e=Math.sqrt(E**2-(g/d)**2),t=6378.137*(1+g/u);f=Math.max(0,Math.min(1,1-e/t))}if(f>.1)r?a=Math.max(a,f):(r=!0,n=i,a=f);else if(r){const e=new Date(t-1e4);n&&s.push({start:n,end:e,duration:(e.getTime()-n.getTime())/1e3,type:a>.9?"umbra":"penumbra",depth:a}),r=!1,n=null,a=0}}return s},exports.calculateEpochAge=$,exports.calculateGroundTrack=function(e,t,i,s=60){const r=[],n=t.getTime(),a=i.getTime();for(let t=n;t<=a;t+=1e3*s){const i=new Date(t),s=qe(e,i);if(s){const e=Math.sqrt(s.velocity.x**2+s.velocity.y**2+s.velocity.z**2);r.push({timestamp:i,location:s.geographicLocation,velocity:e})}}return r},exports.calculateLookAngles=Je,exports.calculateOrbitalParameters=Xe,exports.calculateOrbitalPeriod=Ze,exports.calculateQualityMetrics=function(e,t=new Date){const i=[];let s=100;const r=["satelliteNumber1","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion","epoch"];for(const t of r)e[t]&&""!==e[t]||(s-=100/r.length,i.push(`Missing or empty field: ${t}`));let n=100;const a=parseFloat(e.inclination),o=parseFloat(e.eccentricity),c=parseFloat(e.meanMotion);(a<0||a>180)&&(n-=20,i.push(`Invalid inclination: ${a}`)),(o<0||o>=1)&&(n-=20,i.push(`Invalid eccentricity: ${o}`)),(c<=0||c>20)&&(n-=20,i.push(`Unusual mean motion: ${c}`));let l=100;switch(tt(e,t).staleness){case"fresh":l=100;break;case"recent":l=85;break;case"old":l=60;break;case"very_old":l=30;break;case"ancient":l=0}let h=100;e.warnings&&e.warnings.length>0&&(h-=Math.min(10*e.warnings.length,40),i.push(`${e.warnings.length} warning(s) detected`));const u=.3*s+.3*n+.25*l+.15*h;let m;return m=u>=90?"A":u>=80?"B":u>=70?"C":u>=60?"D":"F",{overallScore:Math.round(u),completeness:Math.round(s),accuracy:Math.round(n),freshness:Math.round(l),consistency:Math.round(h),issues:i,grade:m}},exports.calculateQualityScore=B,exports.calculateUpdateFrequency=function(e){if(e.length<2)return{satelliteNumber:e[0]?.satelliteNumber1||"unknown",totalUpdates:e.length,timeSpanDays:0,averageUpdateInterval:0,minUpdateInterval:0,maxUpdateInterval:0,stdDeviation:0,updatePattern:"sparse"};const t=[...e].sort((e,t)=>{const i=rt(e.epochYear,e.epoch),s=rt(t.epochYear,t.epoch);return i.getTime()-s.getTime()}),i=[];for(let e=1;e<t.length;e++){const s=rt(t[e-1].epochYear,t[e-1].epoch),r=(rt(t[e].epochYear,t[e].epoch).getTime()-s.getTime())/864e5;i.push(r)}const s=i.reduce((e,t)=>e+t,0)/i.length,r=Math.min(...i),n=Math.max(...i),a=i.reduce((e,t)=>e+Math.pow(t-s,2),0)/i.length,o=Math.sqrt(a);let c;c=s<1?"frequent":o/s<.3?"regular":s>7?"sparse":"irregular";const l=rt(t[0].epochYear,t[0].epoch),h=(rt(t[t.length-1].epochYear,t[t.length-1].epoch).getTime()-l.getTime())/864e5;return{satelliteNumber:t[0].satelliteNumber1,totalUpdates:e.length,timeSpanDays:h,averageUpdateInterval:s,minUpdateInterval:r,maxUpdateInterval:n,stdDeviation:o,updatePattern:c}},exports.calculateVisibilityWindows=function(e,t,i,s,r=0){const n=[];let a=!1,o=null,c=-90,l=null,h=null,u=null;const m=i.getTime(),p=s.getTime();for(let i=m;i<=p;i+=1e4){const s=new Date(i),m=Je(e,t,s);if(m)if(m.elevation>=r)a?m.elevation>c&&(c=m.elevation,l=s,u=m):(a=!0,o=s,c=m.elevation,l=s,h=m,u=m);else if(a){const s=new Date(i-1e4),r=Je(e,t,s);o&&l&&h&&u&&r&&n.push({aos:o,tca:l,los:s,maxElevation:c,duration:(s.getTime()-o.getTime())/1e3,angles:{aos:h,tca:u,los:r}}),a=!1,o=null,c=-90,l=null}}return n},exports.checkClassificationWarnings=St,exports.checkDragAndEphemerisWarnings=yt,exports.checkEpochWarnings=_t,exports.checkOrbitalParameterWarnings=Mt,exports.classifyOrbitType=st,exports.compareTLEs=et,exports.convertEpochToDate=b,exports.createCachedParser=function(e={}){const t=new O(e);return{parse:(e,i={})=>{const s=t.get(e,i);if(s)return s;const r=Lt(e,i);return t.set(e,r,i),r},parseAsync:async(e,i={})=>{const s=t.get(e,i);if(s)return s;const r=await N(e,i);return t.set(e,r,i),r},cache:t}},exports.createConstellationFilter=function(e){const t=pe(e);if(!t)return;const i={};if(t.catalogNumbers&&t.catalogNumbers.length>0&&(i.satelliteNumber=e=>{const i=parseInt(e,10);return!isNaN(i)&&t.catalogNumbers.some(e=>Array.isArray(e)?i>=e[0]&&i<=e[1]:i===e)}),t.namePatterns&&t.namePatterns.length>0){const e=i.satelliteName;i.satelliteName=i=>{const s=t.namePatterns.some(e=>e.test(i));return e&&"function"==typeof e?s&&e(i):s}}if(t.customFilter){const e=i.custom;i.custom=i=>{const s=t.customFilter(i);return e?s&&e(i):s}}return i},exports.createCustomFormat=function(e,t,i={}){return{name:e,version:"1.0",fields:t,separator:i.separator,lineEnding:i.lineEnding,header:i.header,footer:i.footer}},exports.createIncrementalParser=function(e,t={}){return new _(e,t)},exports.createMiddlewareParser=function(){return new x},exports.createTLEParserStream=A,exports.createValidationRule=function(e,t,i,s={}){return{name:e,description:t,severity:s.severity||"warning",enabled:!1!==s.enabled,validate:i,errorMessage:s.errorMessage}},exports.default=vt,exports.detectAnomalies=W,exports.detectStationKeepingManeuver=function(e,t){try{const i=Xe(e),s=Xe(t);if(!i||!s)return{detected:!1};const r=Math.abs(s.semiMajorAxis-i.semiMajorAxis),n=Math.abs(s.eccentricity-i.eccentricity),a=Math.abs(s.inclinationDegrees-i.inclinationDegrees);if(!(r>.1||n>1e-4||a>.01))return{detected:!1};const o=398600.4418,c=Math.sqrt(o/i.semiMajorAxis),l=Math.sqrt(o/s.semiMajorAxis),h=1e3*Math.abs(l-c),u=Qe(e),m=Qe(t);return{detected:!0,deltaV:h,maneuverTime:new Date((u.getTime()+m.getTime())/2),elementChanges:{semiMajorAxis:r,eccentricity:n,inclination:a}}}catch{return{detected:!1}}},exports.detectTLEAnomalies=function(e,t){if(!t)return{hasAnomaly:!1,anomalyType:"none",confidence:0,description:"No previous TLE available for comparison",affectedFields:[],recommendations:[]};const i=et(t,e),s=[];let r=!1,n="none",a=0,o="";const c=[],l=i.differences.find(e=>"meanMotion"===e.field),h=i.differences.find(e=>"inclination"===e.field);l&&Math.abs(l.absoluteChange||0)>.01&&(r=!0,n="maneuver",s.push("meanMotion"),a=Math.min(10*Math.abs(l.absoluteChange||0),1),o=`Possible orbital maneuver detected. Mean motion changed by ${l.absoluteChange?.toFixed(6)} rev/day.`,c.push("Verify with satellite operator","Update orbital predictions")),h&&Math.abs(h.absoluteChange||0)>.5&&(r=!0,n="maneuver",s.push("inclination"),a=Math.max(a,.9),o+=` Significant inclination change: ${h.absoluteChange?.toFixed(3)}Â°.`,c.push("Inclination change suggests plane change maneuver"));const u=it([t,e]);"critical"!==u.severity&&"high"!==u.severity||(r=!0,n="decay_anomaly",s.push("meanMotion","bStar"),a=Math.max(a,.8),o=`Rapid orbital decay detected: ${u.details}`,c.push("Monitor for reentry","Validate TLE against radar observations"));const m=i.differences.find(e=>"eccentricity"===e.field);return m&&Math.abs(m.absoluteChange||0)>.1&&(r=!0,n="data_error",s.push("eccentricity"),a=.95,o="Unrealistic eccentricity change detected. Possible data error.",c.push("Verify TLE source","Check for data corruption")),r||(o="No significant anomalies detected."),{hasAnomaly:r,anomalyType:n,confidence:a,description:o,affectedFields:s,recommendations:c}},exports.extractKeplerianElements=at,exports.filterByConstellation=function(e,t){return e.filter(e=>de(e,t))},exports.filterByFreshness=function(e,t=2592e5){return e.filter(e=>ue(e,t).isFresh)},exports.formatAsCSV=te,exports.formatAsHuman=ne,exports.formatAsJSON=ee,exports.formatAsXML=se,exports.formatAsYAML=re,exports.formatTLE=function(e,t={}){const{format:i="json"}=t;switch(i){case"json":return ee(e,t);case"csv":return te(e,t);case"xml":return se(e,t);case"yaml":return re(e,t);case"human":return Array.isArray(e)?e.map(e=>ne(e,t)).join("\n\n"):ne(e,t);case"tle":return Array.isArray(e)?e.map(e=>ae(e,{includeName:!0})).join("\n\n"):ae(e,{includeName:!0});default:throw new Error(`Unsupported output format: ${i}`)}},exports.generateCacheKey=he,exports.generateOrbitVisualization=function(e,t=100){const i=Ze(e);if(!i)return null;const s=new Date,r=new Date(s.getTime()+60*i*1e3),n=Ke(e,s,r,60*i/t);return n?{orbitPath:n.map(e=>e.position),groundTrack:n.map(e=>({timestamp:e.timestamp,location:e.geographicLocation,velocity:Math.sqrt(e.velocity.x**2+e.velocity.y**2+e.velocity.z**2)}))}:null},exports.generateTLEDiff=function(e,t){const i=et(e,t);let s=`--- Old TLE (Epoch: ${e.epoch})\n`;s+=`+++ New TLE (Epoch: ${t.epoch})\n`,s+=`@@ Satellite ${i.satelliteNumber} - ${i.satelliteName||"Unknown"} @@\n\n`;for(const e of i.differences)s+=`- ${e.field}: ${e.oldValue}\n`,s+=`+ ${e.field}: ${e.newValue}`,void 0!==e.percentChange&&(s+=` (${e.percentChange>0?"+":""}${e.percentChange.toFixed(2)}%)`),s+="\n";return i.significantChanges.length>0&&(s+=`\nâš ï¸  ${i.significantChanges.length} significant change(s) detected\n`),s},exports.generateValidationReport=function(e,t,i={}){const s=[],r=[],n=[],a=[],o=[];let c=0,l=0,h=0;if(!1!==i.validateChecksums){c+=2,o.push("checksum");const e=V(t.line1,1);e.valid?l++:(s.push({code:"CHECKSUM_MISMATCH",message:e.message||"Checksum validation failed",line:1,severity:"error",field:"checksum1"}),h++);const i=V(t.line2,2);i.valid?l++:(s.push({code:"CHECKSUM_MISMATCH",message:i.message||"Checksum validation failed",line:2,severity:"error",field:"checksum2"}),h++)}if(!1!==i.validateEpoch){c++,o.push("epochDate");const t=parseInt(e.epochYear,10),n=parseFloat(e.epoch),a=w(t,n);a.valid?l++:(s.push({code:"INVALID_EPOCH",message:a.message||"Invalid epoch date",severity:"error",field:"epoch"}),h++);const u=F(t,n,{referenceDate:i.referenceDate,allowFuture:i.allowFutureEpochs,maxAge:i.maxEpochAge});u.valid?u.message&&r.push({code:"STALE_EPOCH",message:u.message,severity:"warning",field:"epoch"}):s.push({code:"EPOCH_OUT_OF_RANGE",message:u.message||"Epoch age out of acceptable range",severity:"error",field:"epoch"})}const u={valid:[],invalid:[]};if(!1!==i.validateRanges){o.push("orbitalParameterRanges");const t=U(e,i.strict);c+=t.length;for(const e of t)e.valid?e.message?(r.push({code:"PARAMETER_OUTSIDE_TYPICAL",message:e.message,severity:"warning",field:e.context?.field}),l++,u.valid.push(e)):(l++,u.valid.push(e)):(s.push({code:"PARAMETER_OUT_OF_RANGE",message:e.message||"Parameter out of valid range",severity:"error",field:e.context?.field}),h++,u.invalid.push(e))}if(i.detectAnomalies&&(o.push("anomalyDetection"),n.push(...W(e))),i.sanitizeFields){o.push("fieldSanitization");const t=q(e);for(const[e]of t)a.push(e)}c++,o.push("satelliteNumber");const m=k(e.satelliteNumber1);m.valid?l++:(s.push({code:"INVALID_SATELLITE_NUMBER",message:m.message||"Invalid satellite number",severity:"error",field:"satelliteNumber"}),h++),e.satelliteNumber1!==e.satelliteNumber2&&r.push({code:"SATELLITE_NUMBER_MISMATCH",message:`Satellite numbers do not match: ${e.satelliteNumber1} vs ${e.satelliteNumber2}`,severity:"warning",field:"satelliteNumber"}),c++,o.push("internationalDesignator");const p=z(e.internationalDesignatorYear+e.internationalDesignatorLaunchNumber+e.internationalDesignatorPiece);let d;if(p.valid?l++:(r.push({code:"INVALID_DESIGNATOR",message:p.message||"Invalid international designator",severity:"warning",field:"internationalDesignator"}),h++),!1!==i.calculateQuality){const t=$(parseInt(e.epochYear,10),parseFloat(e.epoch),i.referenceDate);d=B(e,{checksumValid:0===s.filter(e=>"CHECKSUM_MISMATCH"===e.code).length,formatValid:0===s.filter(e=>e.code?.includes("FORMAT")).length,rangeErrors:u.invalid,rangeResults:[...u.valid,...u.invalid],epochAge:t,anomalies:n})}else d={overall:0,components:{checksumScore:0,formatScore:0,rangeScore:0,epochScore:0,anomalyScore:0,consistencyScore:0},grade:"F",assessment:"Not calculated"};return{isValid:0===s.length,qualityScore:d,errors:s,warnings:r,anomalies:n,sanitizedFields:a,timestamp:new Date,rulesApplied:o,summary:{totalChecks:c,passedChecks:l,failedChecks:h,warningCount:r.length,errorCount:s.length}}},exports.getConstellation=pe,exports.getErrorDescription=function(e){return{[exports.ERROR_CODES.INVALID_INPUT_TYPE]:"Input data must be a string",[exports.ERROR_CODES.EMPTY_INPUT]:"Input string is empty or contains only whitespace",[exports.ERROR_CODES.INVALID_LINE_COUNT]:"TLE must contain exactly 2 or 3 lines",[exports.ERROR_CODES.INVALID_LINE_LENGTH]:"TLE line must be exactly 69 characters",[exports.ERROR_CODES.INVALID_LINE_NUMBER]:"Line number must be 1 or 2",[exports.ERROR_CODES.CHECKSUM_MISMATCH]:"Calculated checksum does not match",[exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER]:"Checksum must be a digit 0-9",[exports.ERROR_CODES.SATELLITE_NUMBER_MISMATCH]:"Satellite numbers on line 1 and line 2 must match",[exports.ERROR_CODES.INVALID_SATELLITE_NUMBER]:"Satellite catalog number is invalid",[exports.ERROR_CODES.INVALID_CLASSIFICATION]:"Classification must be U, C, or S",[exports.ERROR_CODES.VALUE_OUT_OF_RANGE]:"Field value is outside valid range",[exports.ERROR_CODES.INVALID_NUMBER_FORMAT]:"Field contains invalid numeric format",[exports.ERROR_CODES.SATELLITE_NAME_TOO_LONG]:"Satellite name exceeds maximum length",[exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING]:"Satellite name contains unusual characters",[exports.ERROR_CODES.CLASSIFIED_DATA_WARNING]:"TLE contains classified satellite data",[exports.ERROR_CODES.STALE_TLE_WARNING]:"TLE epoch is significantly old",[exports.ERROR_CODES.HIGH_ECCENTRICITY_WARNING]:"Eccentricity is unusually high",[exports.ERROR_CODES.LOW_MEAN_MOTION_WARNING]:"Mean motion is unusually low",[exports.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING]:"Epoch year is in the far past",[exports.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING]:"Revolution number may have rolled over",[exports.ERROR_CODES.NEAR_ZERO_DRAG_WARNING]:"Drag coefficient is near zero",[exports.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING]:"Ephemeris type is non-standard",[exports.ERROR_CODES.NEGATIVE_DECAY_WARNING]:"Mean motion decay is negative"}[e]||"Unknown error code"},exports.getPositionAtEpoch=function(e){if(!je(e))return null;const t=parseInt(e.epochYear),i=t<57?2e3+t:1900+t,s=parseFloat(e.epoch),r=Math.floor(s),n=s-r,a=new Date(Date.UTC(i,0,r));return a.setUTCMilliseconds(864e5*n),qe(e,a)},exports.getPositionAtTime=qe,exports.getProfileOptions=S,exports.getProviderOptions=M,exports.groupByConstellation=function(e){const t=new Map;for(const i of e){let e=!1;for(const[s]of Object.entries(me))if(de(i,s)){t.has(s)||t.set(s,[]),t.get(s).push(i),e=!0;break}e||(t.has("unknown")||t.set("unknown",[]),t.get("unknown").push(i))}return t},exports.groupIntoOrbitalFamilies=function(e,t={inclinationTolerance:1,altitudeTolerance:50,eccentricityTolerance:.01}){const i=[],s=new Set;for(let r=0;r<e.length;r++){const n=e[r];if(s.has(n.satelliteNumber1))continue;const a=[n.satelliteNumber1];s.add(n.satelliteNumber1);const o=parseFloat(n.inclination),c=nt(parseFloat(n.meanMotion)),l=parseFloat(n.eccentricity);for(let i=r+1;i<e.length;i++){const r=e[i];if(s.has(r.satelliteNumber1))continue;const n=parseFloat(r.inclination),h=nt(parseFloat(r.meanMotion)),u=parseFloat(r.eccentricity);Math.abs(o-n)<=t.inclinationTolerance&&Math.abs(c-h)<=t.altitudeTolerance&&Math.abs(l-u)<=t.eccentricityTolerance&&(a.push(r.satelliteNumber1),s.add(r.satelliteNumber1))}let h="Unknown";o>95&&o<100?h="Sun-synchronous Earth observation":o<10&&c>35e3?h="Geostationary communications":o>50&&o<60&&c>19e3&&c<24e3?h="Navigation (GPS/GLONASS)":c<600&&(h="Low Earth orbit constellation"),i.push({familyId:`FAMILY_${i.length+1}`,satellites:a,commonCharacteristics:{inclination:o,semiMajorAxis:c+6371,eccentricity:l},tolerances:t,purpose:h})}return i},exports.initializeSatelliteRecord=je,exports.isCriticalError=function(e){return!c(e)},exports.isParseFailure=function(e){return!1===e.success},exports.isParseSuccess=function(e){return!0===e.success},exports.isParsedTLE=function(e){return"object"==typeof e&&null!==e&&["lineNumber1","satelliteNumber1","classification","lineNumber2","satelliteNumber2","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion"].every(t=>t in e)},exports.isTLEError=p,exports.isTLEWarning=function(e){return p(e)&&"warning"===e.severity},exports.isValidClassification=function(e){return"U"===e||"C"===e||"S"===e},exports.isValidErrorCode=function(e){return Object.values(exports.ERROR_CODES).includes(e)},exports.isValidationFailure=function(e){return!1===e.success},exports.isValidationSuccess=function(e){return!0===e.success},exports.isWarningCode=c,exports.keplerianToCartesian=ot,exports.kvnToText=function(e){let t="KVN/1.0\n\n";t+=`CREATION_DATE = ${e.CREATION_DATE}\n`,t+=`ORIGINATOR = ${e.ORIGINATOR}\n\n`,t+=`OBJECT_NAME = ${e.OBJECT_NAME}\n`,t+=`OBJECT_ID = ${e.OBJECT_ID}\n\n`,t+="ELEMENTS\n";for(const[i,s]of Object.entries(e.elements))t+=`  ${i} = ${s}\n`;return t},exports.listConstellations=function(){return Object.keys(me)},exports.matchesConstellation=de,exports.normalizeAssumedDecimalNotation=G,exports.normalizeLineEndings=ft,exports.normalizeScientificNotation=function(e,t="standard"){return"assumedDecimal"===t?G(e):"integer"===t?parseInt(e.trim(),10):parseFloat(e.trim())},exports.oemToText=function(e){let t=`CCSDS_OEM_VERS = ${e.CCSDS_OEM_VERS}\n`;t+=`CREATION_DATE = ${e.CREATION_DATE}\n`,t+=`ORIGINATOR = ${e.ORIGINATOR}\n\n`,t+="META_START\n",t+=`OBJECT_NAME = ${e.OBJECT_NAME}\n`,t+=`OBJECT_ID = ${e.OBJECT_ID}\n`,t+=`CENTER_NAME = ${e.CENTER_NAME}\n`,t+=`REF_FRAME = ${e.REF_FRAME}\n`,t+=`TIME_SYSTEM = ${e.TIME_SYSTEM}\n`,t+=`START_TIME = ${e.START_TIME}\n`,t+=`STOP_TIME = ${e.STOP_TIME}\n`,t+=`INTERPOLATION = ${e.INTERPOLATION}\n`,t+=`INTERPOLATION_DEGREE = ${e.INTERPOLATION_DEGREE}\n`,t+="META_STOP\n\n",t+="DATA_START\n";for(const i of e.ephemerisData)t+=`${"string"==typeof i.time?i.time:i.time.toISOString()} ${i.position.x} ${i.position.y} ${i.position.z} `,t+=`${i.velocity.vx} ${i.velocity.vy} ${i.velocity.vz}\n`;return t+="DATA_STOP\n",t},exports.ommToTLE=function(e){const t=new Date(e.EPOCH),i=t.getUTCFullYear()%100,s=function(e){const t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return 1+(e.getTime()-t.getTime())/864e5}(t);let r=`${e.OBJECT_NAME}\n`;var n;const a=["1",e.NORAD_CAT_ID.padStart(5," "),e.CLASSIFICATION_TYPE," ",(n=e.OBJECT_ID,n.padEnd(8," "))," ",i.toString().padStart(2,"0"),s.toFixed(8).padStart(12," ")," ",mt(e.MEAN_MOTION_DOT,8)," ",mt(e.MEAN_MOTION_DDOT,8)," ",mt(e.BSTAR,8)," ",e.EPHEMERIS_TYPE.toString()," ",e.ELEMENT_SET_NO.toString().padStart(4," ")].join("");var o;r+=a+pt(a)+"\n";const c=["2",e.NORAD_CAT_ID.padStart(5," ")," ",e.INCLINATION.toFixed(4).padStart(8," ")," ",e.RA_OF_ASC_NODE.toFixed(4).padStart(8," ")," ",(o=e.ECCENTRICITY,o.toFixed(7).substring(2))," ",e.ARG_OF_PERICENTER.toFixed(4).padStart(8," ")," ",e.MEAN_ANOMALY.toFixed(4).padStart(8," ")," ",e.MEAN_MOTION.toFixed(8).padStart(11," "),e.REV_AT_EPOCH.toString().padStart(5," ")].join("");return r+=c+pt(c),r},exports.ommToXML=function(e){let t='<?xml version="1.0" encoding="UTF-8"?>\n';return t+='<omm xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n',t+='     id="CCSDS_OMM_VERS" version="2.0">\n',t+="  <header>\n",t+=`    <CREATION_DATE>${e.CREATION_DATE}</CREATION_DATE>\n`,t+=`    <ORIGINATOR>${e.ORIGINATOR}</ORIGINATOR>\n`,t+="  </header>\n",t+="  <body>\n",t+="    <segment>\n",t+="      <metadata>\n",t+=`        <OBJECT_NAME>${e.OBJECT_NAME}</OBJECT_NAME>\n`,t+=`        <OBJECT_ID>${e.OBJECT_ID}</OBJECT_ID>\n`,t+=`        <CENTER_NAME>${e.CENTER_NAME}</CENTER_NAME>\n`,t+=`        <REF_FRAME>${e.REF_FRAME}</REF_FRAME>\n`,t+=`        <TIME_SYSTEM>${e.TIME_SYSTEM}</TIME_SYSTEM>\n`,t+=`        <MEAN_ELEMENT_THEORY>${e.MEAN_ELEMENT_THEORY}</MEAN_ELEMENT_THEORY>\n`,t+="      </metadata>\n",t+="      <data>\n",t+=`        <EPOCH>${e.EPOCH}</EPOCH>\n`,t+=`        <MEAN_MOTION>${e.MEAN_MOTION}</MEAN_MOTION>\n`,t+=`        <ECCENTRICITY>${e.ECCENTRICITY}</ECCENTRICITY>\n`,t+=`        <INCLINATION>${e.INCLINATION}</INCLINATION>\n`,t+=`        <RA_OF_ASC_NODE>${e.RA_OF_ASC_NODE}</RA_OF_ASC_NODE>\n`,t+=`        <ARG_OF_PERICENTER>${e.ARG_OF_PERICENTER}</ARG_OF_PERICENTER>\n`,t+=`        <MEAN_ANOMALY>${e.MEAN_ANOMALY}</MEAN_ANOMALY>\n`,t+=`        <BSTAR>${e.BSTAR}</BSTAR>\n`,t+=`        <MEAN_MOTION_DOT>${e.MEAN_MOTION_DOT}</MEAN_MOTION_DOT>\n`,t+=`        <MEAN_MOTION_DDOT>${e.MEAN_MOTION_DDOT}</MEAN_MOTION_DDOT>\n`,t+="      </data>\n",t+="    </segment>\n",t+="  </body>\n",t+="</omm>\n",t},exports.parseBatch=g,exports.parseBatchAsync=async function(e,t={}){return Promise.resolve(g(e,t))},exports.parseFromCompressed=async function(e,t={}){const s=i.createReadStream(e),r=o.createGunzip();return I(s.pipe(r),t)},exports.parseFromFile=async function(e,t={}){const{encoding:i="utf8",...s}=t;return g(await E(e,{encoding:i}),s)},exports.parseFromStream=I,exports.parseFromURL=async function(e,t={}){const{headers:i,timeout:s=3e4,...r}=t,n=new AbortController,a=setTimeout(()=>n.abort(),s);try{const t=await fetch(e,{headers:i,signal:n.signal});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return g(await t.text(),r)}finally{clearTimeout(a)}},exports.parseInterval=function(e){const t=e.match(/^(\d+)\s*(ms|s|m|h|d|w)$/i);if(!t||!t[1]||!t[2])throw new Error(`Invalid interval format: ${e}`);const i=parseInt(t[1],10),s=t[2].toLowerCase();switch(s){case"ms":return i;case"s":return 1e3*i;case"m":return 60*i*1e3;case"h":return 60*i*60*1e3;case"d":return 24*i*60*60*1e3;case"w":return 7*i*24*60*60*1e3;default:throw new Error(`Unknown interval unit: ${s}`)}},exports.parseParallel=async function(e,t={},i){return g(e,t)},exports.parseTLE=Lt,exports.parseTLEAsync=N,exports.parseTLELines=Nt,exports.parseWithProfile=function(e,t){return Lt(e,S(t))},exports.parseWithProvider=function(e,t){return Lt(e,M(t))},exports.parseWithStateMachine=function(e,t={}){return new d(t).parse(e)},exports.predictConjunctions=function(e,t,i,s,r=10){const n=[];let a=1/0,o=!1;const c=i.getTime(),l=s.getTime();for(let i=c;i<=l;i+=6e4){const s=new Date(i),c=qe(e,s),l=qe(t,s);if(!c||!l)continue;const h=Math.sqrt((c.position.x-l.position.x)**2+(c.position.y-l.position.y)**2+(c.position.z-l.position.z)**2);if(h<a)o=!0;else if(o&&h>a){if(a<=r){const s=Math.sqrt((c.velocity.x-l.velocity.x)**2+(c.velocity.y-l.velocity.y)**2+(c.velocity.z-l.velocity.z)**2);let r="low";a<1?r="critical":a<2?r="high":a<5&&(r="medium");const o=new Date(i-6e4),h=qe(e,o),u=qe(t,o);h&&u&&n.push({time:o,distance:a,relativeVelocity:s,satellite1Position:h.position,satellite2Position:u.position,riskLevel:r})}o=!1}a=h}return n},exports.predictFuturePositions=Ke,exports.reconstructTLE=ae,exports.reconstructTLEFromParsedObject=ht,exports.sanitizeAllFields=q,exports.sanitizeField=j,exports.splitTLEs=f,exports.stkToFile=function(e){let t="stk.v.11.0\n\n";t+=`# Satellite: ${e.header.satelliteName}\n`,t+=`# Coordinate System: ${e.header.coordinateSystem}\n`,t+=`# Central Body: ${e.header.centralBody}\n\n`,t+="BEGIN Ephemeris\n\n",t+=`NumberOfEphemerisPoints ${e.stateVectors.length}\n\n`,t+="EphemerisTimePosVel\n\n";for(const i of e.stateVectors)t+=`${"string"==typeof i.time?i.time:i.time.toISOString()} ${i.position.x} ${i.position.y} ${i.position.z} `,t+=`${i.velocity.vx} ${i.velocity.vy} ${i.velocity.vz}\n`;return t+="\nEND Ephemeris\n",t},exports.tleCache=le,exports.tleToCelestia=lt,exports.tleToCustomFormat=function(e,t){let i=t.header||"";const s=t.separator||",",r=t.lineEnding||"\n",n=[];for(const i of t.fields){let t=e[i.source];i.transform&&(t=i.transform(t)),i.format&&"number"==typeof t&&(t=t.toFixed(parseInt(i.format)||0)),n.push(String(t))}return i+=n.join(s)+r,i+=t.footer||"",i},exports.tleToGPSAlmanac=function(e){const t=ut(e.epochYear,e.epoch),i=at(e),s=new Date("1980-01-06T00:00:00Z"),r=Math.floor((t.getTime()-s.getTime())/6048e5);return{satelliteId:e.satelliteNumber1,health:0,eccentricity:parseFloat(e.eccentricity),timeOfApplicability:t.getTime()/1e3,orbitalInclination:parseFloat(e.inclination)*Math.PI/180,rateOfRightAscension:0,sqrtSemiMajorAxis:Math.sqrt(i.semiMajorAxis),rightAscensionAtWeek:parseFloat(e.rightAscension)*Math.PI/180,argumentOfPerigee:parseFloat(e.argumentOfPerigee)*Math.PI/180,meanAnomaly:parseFloat(e.meanAnomaly)*Math.PI/180,af0:0,af1:0,week:r}},exports.tleToKVN=function(e,t="TLE-PARSER"){const i=ut(e.epochYear,e.epoch);return{KVN_VERS:"1.0",CREATION_DATE:(new Date).toISOString(),ORIGINATOR:t,OBJECT_NAME:e.satelliteName||`SATELLITE ${e.satelliteNumber1}`,OBJECT_ID:e.satelliteNumber1,elements:{EPOCH:i.toISOString(),MEAN_MOTION:parseFloat(e.meanMotion),ECCENTRICITY:parseFloat(e.eccentricity),INCLINATION:parseFloat(e.inclination),RA_OF_ASC_NODE:parseFloat(e.rightAscension),ARG_OF_PERICENTER:parseFloat(e.argumentOfPerigee),MEAN_ANOMALY:parseFloat(e.meanAnomaly),BSTAR:parseFloat(e.bStar),MEAN_MOTION_DOT:parseFloat(e.firstDerivative),MEAN_MOTION_DDOT:parseFloat(e.secondDerivative)}}},exports.tleToLegacyFormat=function(e){return ht(e)},exports.tleToOEM=function(e,t=86400,i="TLE-PARSER"){const s=ut(e.epochYear,e.epoch),r=new Date(s.getTime()),n=new Date(s.getTime()+1e3*t);return{CCSDS_OEM_VERS:"2.0",CREATION_DATE:(new Date).toISOString(),ORIGINATOR:i,OBJECT_NAME:e.satelliteName||`SATELLITE ${e.satelliteNumber1}`,OBJECT_ID:e.satelliteNumber1,CENTER_NAME:"EARTH",REF_FRAME:"TEME",TIME_SYSTEM:"UTC",START_TIME:r.toISOString(),STOP_TIME:n.toISOString(),USEABLE_START_TIME:r.toISOString(),USEABLE_STOP_TIME:n.toISOString(),INTERPOLATION:"HERMITE",INTERPOLATION_DEGREE:7,ephemerisData:[{time:s.toISOString(),position:{x:0,y:0,z:0},velocity:{vx:0,vy:0,vz:0}}]}},exports.tleToOMM=function(e,t="TLE-PARSER"){const i=ut(e.epochYear,e.epoch);return{CCSDS_OMM_VERS:"2.0",CREATION_DATE:(new Date).toISOString(),ORIGINATOR:t,OBJECT_NAME:e.satelliteName||`SATELLITE ${e.satelliteNumber1}`,OBJECT_ID:e.satelliteNumber1,CENTER_NAME:"EARTH",REF_FRAME:"TEME",TIME_SYSTEM:"UTC",MEAN_ELEMENT_THEORY:"SGP4",EPOCH:i.toISOString(),MEAN_MOTION:parseFloat(e.meanMotion),ECCENTRICITY:parseFloat(e.eccentricity),INCLINATION:parseFloat(e.inclination),RA_OF_ASC_NODE:parseFloat(e.rightAscension),ARG_OF_PERICENTER:parseFloat(e.argumentOfPerigee),MEAN_ANOMALY:parseFloat(e.meanAnomaly),EPHEMERIS_TYPE:parseInt(e.ephemerisType),CLASSIFICATION_TYPE:e.classification,NORAD_CAT_ID:e.satelliteNumber1,ELEMENT_SET_NO:parseInt(e.elementSetNumber),REV_AT_EPOCH:parseInt(e.revolutionNumber),BSTAR:parseFloat(e.bStar),MEAN_MOTION_DOT:parseFloat(e.firstDerivative),MEAN_MOTION_DDOT:parseFloat(e.secondDerivative)}},exports.tleToPlanetarium=function(e,t){switch(t){case exports.PlanetariumFormat.STELLARIUM:return ct(e);case exports.PlanetariumFormat.CELESTIA:return lt(e);case exports.PlanetariumFormat.SPACENGINE:case exports.PlanetariumFormat.UNIVERSESANDBOX:return JSON.stringify(at(e),null,2);default:return JSON.stringify(e,null,2)}},exports.tleToSTK=function(e,t=86400){const i=ut(e.epochYear,e.epoch);return{header:{version:"stk.v.11.0",satelliteName:e.satelliteName||`SATELLITE ${e.satelliteNumber1}`,coordinateSystem:"TEME",centralBody:"Earth"},stateVectors:[{time:i.toISOString(),position:{x:0,y:0,z:0},velocity:{vx:0,vy:0,vz:0}}]}},exports.tleToStateVector=function(e){const t=at(e),{position:i,velocity:s}=ot(t);return{time:t.epoch,position:i,velocity:s}},exports.tleToStellarium=ct,exports.transformCoordinateFrame=function(e,t,i,s){return t===i||t===exports.CoordinateFrame.TEME&&i===exports.CoordinateFrame.J2000||t===exports.CoordinateFrame.J2000&&exports.CoordinateFrame.TEME,e},exports.validateAgainstRadar=function(e,t,i){return{isValid:!0,positionError:.5,velocityError:.001,confidence:.95,discrepancies:[]}},exports.validateAllOrbitalParameters=U,exports.validateChecksum=Tt,exports.validateClassification=xt,exports.validateEpochAge=F,exports.validateEpochDate=w,exports.validateFreshness=ue,exports.validateInternationalDesignator=z,exports.validateLineStructure=At,exports.validateNumericRange=Ot,exports.validateOrbitalParameter=P,exports.validateSatelliteNumber=It,exports.validateTLE=Ct,exports.validateTLEAsync=async function(e,t={}){return Promise.resolve(Ct(e,t))};
//# sourceMappingURL=index.min.cjs.map
