/**
 * tle-parser v1.0.0
 * A parser for TLE (Two-Line Element) satellite data.
 * @license MIT
 */
"use strict";var e;function t(e){return[exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,exports.ERROR_CODES.CLASSIFIED_DATA_WARNING,exports.ERROR_CODES.STALE_TLE_WARNING,exports.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,exports.ERROR_CODES.LOW_MEAN_MOTION_WARNING,exports.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,exports.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,exports.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,exports.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,exports.ERROR_CODES.NEGATIVE_DECAY_WARNING].includes(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ERROR_CODES=void 0,(e=exports.ERROR_CODES||(exports.ERROR_CODES={})).INVALID_INPUT_TYPE="INVALID_INPUT_TYPE",e.EMPTY_INPUT="EMPTY_INPUT",e.INVALID_LINE_COUNT="INVALID_LINE_COUNT",e.INVALID_LINE_LENGTH="INVALID_LINE_LENGTH",e.INVALID_LINE_NUMBER="INVALID_LINE_NUMBER",e.CHECKSUM_MISMATCH="CHECKSUM_MISMATCH",e.INVALID_CHECKSUM_CHARACTER="INVALID_CHECKSUM_CHARACTER",e.SATELLITE_NUMBER_MISMATCH="SATELLITE_NUMBER_MISMATCH",e.INVALID_SATELLITE_NUMBER="INVALID_SATELLITE_NUMBER",e.INVALID_CLASSIFICATION="INVALID_CLASSIFICATION",e.VALUE_OUT_OF_RANGE="VALUE_OUT_OF_RANGE",e.INVALID_NUMBER_FORMAT="INVALID_NUMBER_FORMAT",e.SATELLITE_NAME_TOO_LONG="SATELLITE_NAME_TOO_LONG",e.SATELLITE_NAME_FORMAT_WARNING="SATELLITE_NAME_FORMAT_WARNING",e.CLASSIFIED_DATA_WARNING="CLASSIFIED_DATA_WARNING",e.STALE_TLE_WARNING="STALE_TLE_WARNING",e.HIGH_ECCENTRICITY_WARNING="HIGH_ECCENTRICITY_WARNING",e.LOW_MEAN_MOTION_WARNING="LOW_MEAN_MOTION_WARNING",e.DEPRECATED_EPOCH_YEAR_WARNING="DEPRECATED_EPOCH_YEAR_WARNING",e.REVOLUTION_NUMBER_ROLLOVER_WARNING="REVOLUTION_NUMBER_ROLLOVER_WARNING",e.NEAR_ZERO_DRAG_WARNING="NEAR_ZERO_DRAG_WARNING",e.NON_STANDARD_EPHEMERIS_WARNING="NON_STANDARD_EPHEMERIS_WARNING",e.NEGATIVE_DECAY_WARNING="NEGATIVE_DECAY_WARNING",exports.ERROR_CODES.INVALID_INPUT_TYPE,exports.ERROR_CODES.EMPTY_INPUT,exports.ERROR_CODES.INVALID_LINE_COUNT,exports.ERROR_CODES.INVALID_LINE_LENGTH,exports.ERROR_CODES.INVALID_LINE_NUMBER,exports.ERROR_CODES.CHECKSUM_MISMATCH,exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER,exports.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,exports.ERROR_CODES.INVALID_SATELLITE_NUMBER,exports.ERROR_CODES.INVALID_CLASSIFICATION,exports.ERROR_CODES.VALUE_OUT_OF_RANGE,exports.ERROR_CODES.INVALID_NUMBER_FORMAT,exports.ERROR_CODES.SATELLITE_NAME_TOO_LONG,exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,exports.ERROR_CODES.CLASSIFIED_DATA_WARNING,exports.ERROR_CODES.STALE_TLE_WARNING,exports.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,exports.ERROR_CODES.LOW_MEAN_MOTION_WARNING,exports.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,exports.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,exports.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,exports.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,exports.ERROR_CODES.NEGATIVE_DECAY_WARNING;var r,s,i,n;function a(e){return"object"==typeof e&&null!==e&&"code"in e&&"message"in e&&"severity"in e}exports.TLEErrorCode=void 0,(r=exports.TLEErrorCode||(exports.TLEErrorCode={})).INVALID_LINE_COUNT="INVALID_LINE_COUNT",r.INVALID_LINE_LENGTH="INVALID_LINE_LENGTH",r.INVALID_LINE_NUMBER="INVALID_LINE_NUMBER",r.SATELLITE_NUMBER_MISMATCH="SATELLITE_NUMBER_MISMATCH",r.CHECKSUM_MISMATCH="CHECKSUM_MISMATCH",r.INVALID_CHECKSUM_CHARACTER="INVALID_CHECKSUM_CHARACTER",r.INVALID_CLASSIFICATION="INVALID_CLASSIFICATION",r.INVALID_SATELLITE_NUMBER="INVALID_SATELLITE_NUMBER",r.INVALID_INTL_DESIGNATOR_YEAR="INVALID_INTL_DESIGNATOR_YEAR",r.INVALID_INTL_DESIGNATOR_LAUNCH="INVALID_INTL_DESIGNATOR_LAUNCH",r.INVALID_EPOCH_YEAR="INVALID_EPOCH_YEAR",r.INVALID_EPOCH_DAY="INVALID_EPOCH_DAY",r.INVALID_EPHEMERIS_TYPE="INVALID_EPHEMERIS_TYPE",r.INVALID_ELEMENT_SET_NUMBER="INVALID_ELEMENT_SET_NUMBER",r.INVALID_INCLINATION="INVALID_INCLINATION",r.INVALID_RIGHT_ASCENSION="INVALID_RIGHT_ASCENSION",r.INVALID_ECCENTRICITY="INVALID_ECCENTRICITY",r.INVALID_ARG_OF_PERIGEE="INVALID_ARG_OF_PERIGEE",r.INVALID_MEAN_ANOMALY="INVALID_MEAN_ANOMALY",r.INVALID_MEAN_MOTION="INVALID_MEAN_MOTION",r.INVALID_REVOLUTION_NUMBER="INVALID_REVOLUTION_NUMBER",r.UNUSUAL_CLASSIFICATION="UNUSUAL_CLASSIFICATION",r.OLD_EPOCH="OLD_EPOCH",r.EXTREME_ECCENTRICITY="EXTREME_ECCENTRICITY",r.EXTREME_INCLINATION="EXTREME_INCLINATION",r.HIGH_MEAN_MOTION="HIGH_MEAN_MOTION",r.LOW_MEAN_MOTION="LOW_MEAN_MOTION",r.PARSE_ERROR="PARSE_ERROR",r.VALIDATION_ERROR="VALIDATION_ERROR",function(e){e.INITIAL="INITIAL",e.READING_NAME="READING_NAME",e.READING_LINE1="READING_LINE1",e.READING_LINE2="READING_LINE2",e.COMPLETE="COMPLETE",e.ERROR="ERROR",e.RECOVERING="RECOVERING"}(s||(s={})),function(e){e.CONTINUE="CONTINUE",e.SKIP_FIELD="SKIP_FIELD",e.USE_DEFAULT="USE_DEFAULT",e.ATTEMPT_FIX="ATTEMPT_FIX",e.ABORT="ABORT"}(i||(i={})),exports.ParserState=void 0,function(e){e.INITIAL="INITIAL",e.DETECTING_FORMAT="DETECTING_FORMAT",e.PARSING_NAME="PARSING_NAME",e.PARSING_LINE1="PARSING_LINE1",e.PARSING_LINE2="PARSING_LINE2",e.VALIDATING="VALIDATING",e.COMPLETED="COMPLETED",e.ERROR="ERROR"}(exports.ParserState||(exports.ParserState={})),exports.ErrorSeverity=void 0,(n=exports.ErrorSeverity||(exports.ErrorSeverity={})).WARNING="warning",n.ERROR="error",n.CRITICAL="critical",exports.RecoveryAction=void 0,function(e){e.CONTINUE="CONTINUE",e.SKIP_FIELD="SKIP_FIELD",e.USE_DEFAULT="USE_DEFAULT",e.ATTEMPT_FIX="ATTEMPT_FIX",e.ABORT="ABORT"}(exports.RecoveryAction||(exports.RecoveryAction={}));class o{constructor(e={}){this.options={attemptRecovery:!0,maxRecoveryAttempts:10,includePartialResults:!0,strictMode:!1,...e},this.state=exports.ParserState.INITIAL,this.errors=[],this.warnings=[],this.recoveryActions=[],this.parsedData={},this.context={lineCount:0,hasName:!1,nameLineIndex:-1,line1Index:-1,line2Index:-1,lines:[],recoveryAttempts:0},this.reset()}reset(){this.state=exports.ParserState.INITIAL,this.errors=[],this.warnings=[],this.recoveryActions=[],this.parsedData={},this.context={lineCount:0,hasName:!1,nameLineIndex:-1,line1Index:-1,line2Index:-1,lines:[],recoveryAttempts:0}}addIssue(e,t,r,s={}){const i={severity:e,code:t,message:r,state:this.state,...s};return e===exports.ErrorSeverity.WARNING?this.warnings.push(i):this.errors.push(i),i}recordRecovery(e,t,r={}){this.recoveryActions.push({action:e,description:t,state:this.state,timestamp:Date.now(),...r}),this.context.recoveryAttempts++}transition(e,t=""){const r=this.state;return this.state=e,{from:r,to:e,reason:t}}parse(e){return this.reset(),"string"!=typeof e?(this.addIssue(exports.ErrorSeverity.CRITICAL,exports.ERROR_CODES.INVALID_INPUT_TYPE,"TLE data must be a string",{inputType:typeof e}),this.transition(exports.ParserState.ERROR),this.getResult()):0===e.length?(this.addIssue(exports.ErrorSeverity.CRITICAL,exports.ERROR_CODES.EMPTY_INPUT,"TLE string cannot be empty",{inputLength:0}),this.transition(exports.ParserState.ERROR),this.getResult()):(this.transition(exports.ParserState.DETECTING_FORMAT,"Starting parse"),this.detectFormat(e),this.state===exports.ParserState.DETECTING_FORMAT&&this.executeStateMachine(),this.getResult())}detectFormat(e){const t=e.trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(this.context.lines=t,this.context.lineCount=t.length,t.length<2)return this.addIssue(exports.ErrorSeverity.CRITICAL,exports.ERROR_CODES.INVALID_LINE_COUNT,`TLE must contain at least 2 lines (found ${t.length})`,{expected:"2 or 3",actual:t.length}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.ABORT,"Insufficient lines to parse TLE",{lineCount:t.length}),void this.transition(exports.ParserState.ERROR);if(t.length>3){if(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_COUNT,`TLE should contain 2 or 3 lines (found ${t.length})`,{expected:"2 or 3",actual:t.length}),this.options.attemptRecovery){this.recordRecovery(exports.RecoveryAction.ATTEMPT_FIX,"Attempting to identify valid TLE lines from excess lines",{lineCount:t.length});const e=t.filter(e=>"1"===e[0]),r=t.filter(e=>"2"===e[0]);if(1===e.length&&1===r.length){const s=e[0],i=r[0];if(!s||!i)return;const n=t.indexOf(s),a=t.indexOf(i);if(n<a){n>0&&(this.context.hasName=!0,this.context.nameLineIndex=n-1),this.context.line1Index=n,this.context.line2Index=a;const e=t[this.context.nameLineIndex],r=t[n],s=t[a];this.context.lines=this.context.hasName&&e&&r&&s?[e,r,s]:r&&s?[r,s]:[],this.context.lineCount=this.context.lines.length,this.recordRecovery(exports.RecoveryAction.CONTINUE,"Successfully identified TLE lines from excess input",{extractedLines:this.context.lineCount})}}}}else if(3===t.length){const e=t[0]?.[0];"1"!==e&&"2"!==e||this.addIssue(exports.ErrorSeverity.WARNING,exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,'First line starts with "1" or "2", might be missing satellite name',{firstLine:t[0]}),this.context.hasName=!0,this.context.nameLineIndex=0,this.context.line1Index=1,this.context.line2Index=2}else this.context.hasName=!1,this.context.line1Index=0,this.context.line2Index=1}executeStateMachine(){let e=0;for(;this.state!==exports.ParserState.COMPLETED&&this.state!==exports.ParserState.ERROR&&e<100;){switch(this.state){case exports.ParserState.DETECTING_FORMAT:this.context.hasName?this.transition(exports.ParserState.PARSING_NAME):this.transition(exports.ParserState.PARSING_LINE1);break;case exports.ParserState.PARSING_NAME:this.parseSatelliteName(),this.transition(exports.ParserState.PARSING_LINE1);break;case exports.ParserState.PARSING_LINE1:this.parseLine1(),this.transition(exports.ParserState.PARSING_LINE2);break;case exports.ParserState.PARSING_LINE2:this.parseLine2(),this.transition(exports.ParserState.VALIDATING);break;case exports.ParserState.VALIDATING:this.validateCrossFields(),this.errors.some(e=>e.severity===exports.ErrorSeverity.CRITICAL)&&!this.options.includePartialResults?this.transition(exports.ParserState.ERROR):this.transition(exports.ParserState.COMPLETED);break;default:this.transition(exports.ParserState.ERROR,"Unexpected state")}e++}e>=100&&(this.addIssue(exports.ErrorSeverity.CRITICAL,"STATE_MACHINE_LOOP","State machine exceeded maximum iterations",{iterations:e}),this.transition(exports.ParserState.ERROR))}parseSatelliteName(){const e=this.context.nameLineIndex;if(e<0||e>=this.context.lines.length)return void this.addIssue(exports.ErrorSeverity.ERROR,"INVALID_NAME_LINE_INDEX","Invalid satellite name line index",{index:e});const t=this.context.lines[e];t&&(this.parsedData.satelliteName=t,t.length>24&&this.addIssue(exports.ErrorSeverity.WARNING,exports.ERROR_CODES.SATELLITE_NAME_TOO_LONG,"Satellite name exceeds recommended 24 characters",{length:t.length,name:t}),"1"!==t[0]&&"2"!==t[0]||this.addIssue(exports.ErrorSeverity.WARNING,exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,'Satellite name starts with "1" or "2", might be incorrectly formatted',{name:t}))}parseLine1(){const e=this.context.line1Index;if(e<0||e>=this.context.lines.length)return void this.addIssue(exports.ErrorSeverity.CRITICAL,"INVALID_LINE1_INDEX","Invalid Line 1 index",{index:e});const t=this.context.lines[e];if(!t)return;if(this.parsedData.line1Raw=t,69!==t.length)if(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_LENGTH,`Line 1 must be exactly 69 characters (got ${t.length})`,{line:1,expected:69,actual:t.length}),this.options.attemptRecovery)this.recordRecovery(exports.RecoveryAction.CONTINUE,"Attempting to parse Line 1 despite incorrect length",{length:t.length});else if(this.options.strictMode)return;this.parseFieldSafe("lineNumber1",t,0,1,"Line 1 number"),this.parseFieldSafe("satelliteNumber1",t,2,7,"Satellite number"),this.parseFieldSafe("classification",t,7,8,"Classification"),this.parseFieldSafe("internationalDesignatorYear",t,9,11,"Int. designator year"),this.parseFieldSafe("internationalDesignatorLaunchNumber",t,11,14,"Int. designator launch"),this.parseFieldSafe("internationalDesignatorPiece",t,14,17,"Int. designator piece"),this.parseFieldSafe("epochYear",t,18,20,"Epoch year"),this.parseFieldSafe("epoch",t,20,32,"Epoch"),this.parseFieldSafe("firstDerivative",t,33,43,"First derivative"),this.parseFieldSafe("secondDerivative",t,44,52,"Second derivative"),this.parseFieldSafe("bStar",t,53,61,"B* drag term"),this.parseFieldSafe("ephemerisType",t,62,63,"Ephemeris type"),this.parseFieldSafe("elementSetNumber",t,64,68,"Element set number"),this.parseFieldSafe("checksum1",t,68,69,"Checksum"),"1"!==this.parsedData.lineNumber1&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_NUMBER,`Line 1 must start with '1' (got '${this.parsedData.lineNumber1}')`,{line:1,expected:"1",actual:this.parsedData.lineNumber1});const r=["U","C","S"];if(this.parsedData.classification&&!r.includes(this.parsedData.classification)&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_CLASSIFICATION,`Classification must be U, C, or S (got '${this.parsedData.classification}')`,{expected:r,actual:this.parsedData.classification}),69===t.length){const e=this.calculateChecksum(t),r=parseInt(this.parsedData.checksum1||"",10);isNaN(r)||e===r||(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.CHECKSUM_MISMATCH,`Line 1 checksum mismatch (expected ${e}, got ${r})`,{line:1,expected:e,actual:r}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.CONTINUE,"Continuing despite checksum mismatch",{line:1}))}}parseLine2(){const e=this.context.line2Index;if(e<0||e>=this.context.lines.length)return void this.addIssue(exports.ErrorSeverity.CRITICAL,"INVALID_LINE2_INDEX","Invalid Line 2 index",{index:e});const t=this.context.lines[e];if(t){if(this.parsedData.line2Raw=t,69!==t.length)if(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_LENGTH,`Line 2 must be exactly 69 characters (got ${t.length})`,{line:2,expected:69,actual:t.length}),this.options.attemptRecovery)this.recordRecovery(exports.RecoveryAction.CONTINUE,"Attempting to parse Line 2 despite incorrect length",{length:t.length});else if(this.options.strictMode)return;if(this.parseFieldSafe("lineNumber2",t,0,1,"Line 2 number"),this.parseFieldSafe("satelliteNumber2",t,2,7,"Satellite number"),this.parseFieldSafe("inclination",t,8,16,"Inclination"),this.parseFieldSafe("rightAscension",t,17,25,"Right ascension"),this.parseFieldSafe("eccentricity",t,26,33,"Eccentricity"),this.parseFieldSafe("argumentOfPerigee",t,34,42,"Argument of perigee"),this.parseFieldSafe("meanAnomaly",t,43,51,"Mean anomaly"),this.parseFieldSafe("meanMotion",t,52,63,"Mean motion"),this.parseFieldSafe("revolutionNumber",t,63,68,"Revolution number"),this.parseFieldSafe("checksum2",t,68,69,"Checksum"),"2"!==this.parsedData.lineNumber2&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_LINE_NUMBER,`Line 2 must start with '2' (got '${this.parsedData.lineNumber2}')`,{line:2,expected:"2",actual:this.parsedData.lineNumber2}),69===t.length){const e=this.calculateChecksum(t),r=parseInt(this.parsedData.checksum2||"",10);isNaN(r)||e===r||(this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.CHECKSUM_MISMATCH,`Line 2 checksum mismatch (expected ${e}, got ${r})`,{line:2,expected:e,actual:r}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.CONTINUE,"Continuing despite checksum mismatch",{line:2}))}}}validateCrossFields(){if(this.parsedData.satelliteNumber1&&this.parsedData.satelliteNumber2){const e=this.parsedData.satelliteNumber1.trim(),t=this.parsedData.satelliteNumber2.trim();e!==t&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,`Satellite numbers must match (Line 1: ${e}, Line 2: ${t})`,{line1Value:e,line2Value:t})}if(this.validateNumericField("inclination",0,180,"Inclination"),this.validateNumericField("rightAscension",0,360,"Right Ascension"),this.validateNumericField("argumentOfPerigee",0,360,"Argument of Perigee"),this.validateNumericField("meanAnomaly",0,360,"Mean Anomaly"),this.parsedData.eccentricity){const e=parseFloat("0."+this.parsedData.eccentricity.trim());!isNaN(e)&&(e<0||e>1)&&this.addIssue(exports.ErrorSeverity.ERROR,exports.ERROR_CODES.VALUE_OUT_OF_RANGE,`Eccentricity must be between 0 and 1 (got ${e})`,{field:"eccentricity",value:e,min:0,max:1})}this.validateNumericField("meanMotion",0,20,"Mean Motion",!0),this.validateNumericField("epochYear",0,99,"Epoch Year")}validateNumericField(e,t,r,s,i=!1){const n=this.parsedData[e];if(!n||"string"!=typeof n)return;const a=parseFloat(n.trim());isNaN(a)?this.addIssue(i?exports.ErrorSeverity.WARNING:exports.ErrorSeverity.ERROR,exports.ERROR_CODES.INVALID_NUMBER_FORMAT,`${s} must be numeric (got '${n}')`,{field:e,value:n}):(a<t||a>r)&&this.addIssue(i?exports.ErrorSeverity.WARNING:exports.ErrorSeverity.ERROR,exports.ERROR_CODES.VALUE_OUT_OF_RANGE,`${s} must be between ${t} and ${r} (got ${a})`,{field:e,value:a,min:t,max:r})}parseFieldSafe(e,t,r,s,i){try{t.length>=s?this.parsedData[e]=t.substring(r,s).trim():t.length>r?(this.parsedData[e]=t.substring(r).trim(),this.addIssue(exports.ErrorSeverity.WARNING,"PARTIAL_FIELD",`${i} is incomplete due to short line`,{field:e,expected:[r,s],actual:t.length}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.USE_DEFAULT,`Using partial value for ${i}`,{field:e})):(this.parsedData[e]=null,this.addIssue(exports.ErrorSeverity.WARNING,"MISSING_FIELD",`${i} is missing due to short line`,{field:e,expected:[r,s],actual:t.length}),this.options.attemptRecovery&&this.recordRecovery(exports.RecoveryAction.USE_DEFAULT,`Using null for missing ${i}`,{field:e}))}catch(t){this.parsedData[e]=null;const r=t instanceof Error?t.message:String(t);this.addIssue(exports.ErrorSeverity.ERROR,"FIELD_PARSE_ERROR",`Error parsing ${i}: ${r}`,{field:e,error:r})}}calculateChecksum(e){let t=0;for(let r=0;r<e.length-1;r++){const s=e[r];s&&s>="0"&&s<="9"?t+=parseInt(s,10):"-"===s&&(t+=1)}return t%10}getResult(){const e=this.errors.map(e=>({code:e.code,message:e.message,severity:e.severity===exports.ErrorSeverity.CRITICAL?"error":e.severity,...Object.fromEntries(Object.entries(e).filter(([e])=>!["severity","code","message","state"].includes(e)))})),t=this.warnings.map(e=>({code:e.code,message:e.message,severity:"warning",...Object.fromEntries(Object.entries(e).filter(([e])=>!["severity","code","message","state"].includes(e)))}));return{success:this.state===exports.ParserState.COMPLETED,state:this.state,data:this.parsedData,errors:e,warnings:t,recoveryActions:this.recoveryActions.map(e=>e.action),partialData:this.options.includePartialResults?this.parsedData:void 0,context:{lineCount:this.context.lineCount,hasName:this.context.hasName,recoveryAttempts:this.context.recoveryAttempts}}}}const E={lineNumber1:[0,1],satelliteNumber1:[2,7],classification:[7,8],internationalDesignatorYear:[9,11],internationalDesignatorLaunchNumber:[11,14],internationalDesignatorPiece:[14,17],epochYear:[18,20],epoch:[20,32],firstDerivative:[33,43],secondDerivative:[44,52],bStar:[53,61],ephemerisType:[62,63],elementSetNumber:[64,68],checksum1:[68,69],lineNumber2:[0,1],satelliteNumber2:[2,7],inclination:[8,16],rightAscension:[17,25],eccentricity:[26,33],argumentOfPerigee:[34,42],meanAnomaly:[43,51],meanMotion:[52,63],revolutionNumber:[63,68],checksum2:[68,69]};class R extends Error{constructor(e,t,r=[]){super(e),this.name="TLEValidationError",this.errors=t,this.warnings=r,Error.captureStackTrace(this,this.constructor)}}class l extends Error{constructor(e,t,r={}){super(e),this.name="TLEFormatError",this.code=t,this.details=r,Error.captureStackTrace(this,this.constructor)}}function I(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}function c(e){return I(e).split("\n").map(e=>e.replace(/\t/g," ").trim()).filter(e=>e.length>0)}function N(e){let t=0;for(let r=0;r<e.length-1;r++){const s=e[r];s&&s>="0"&&s<="9"?t+=parseInt(s,10):"-"===s&&(t+=1)}return t%10}function _(e){if(69!==e.length)return{isValid:!1,expected:null,actual:null,error:{code:exports.ERROR_CODES.INVALID_LINE_LENGTH,message:"Line length must be 69 characters",field:"line_length",expected:69,actual:e.length,severity:"error"}};const t=N(e),r=parseInt(e[68]||"",10);if(isNaN(r))return{isValid:!1,expected:t,actual:null,error:{code:exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER,message:"Checksum position must contain a digit",field:"checksum",position:68,value:e[68],severity:"error"}};const s=t===r;return{isValid:s,expected:t,actual:r,error:s?null:{code:exports.ERROR_CODES.CHECKSUM_MISMATCH,message:`Checksum mismatch: expected ${t}, got ${r}`,field:"checksum",expected:t,actual:r,severity:"error"}}}function A(e,t){const r=[];if(69!==e.length)return r.push({code:exports.ERROR_CODES.INVALID_LINE_LENGTH,message:`Line ${t} must be exactly 69 characters (got ${e.length})`,line:t,field:"line_length",expected:69,actual:e.length,severity:"error"}),{isValid:!1,errors:r};const s=e[0];s!==t.toString()&&r.push({code:exports.ERROR_CODES.INVALID_LINE_NUMBER,message:`Line ${t} must start with '${t}' (got '${s}')`,line:t,field:"line_number",expected:t.toString(),actual:s,severity:"error"});const i=_(e);return!i.isValid&&i.error&&r.push({...i.error,line:t,message:`Line ${t}: ${i.error.message}`}),{isValid:0===r.length,errors:r}}function p(e,t){const r=e.substring(2,7).trim(),s=t.substring(2,7).trim();return r!==s?{isValid:!1,error:{code:exports.ERROR_CODES.SATELLITE_NUMBER_MISMATCH,message:`Satellite numbers must match (Line 1: ${r}, Line 2: ${s})`,field:"satellite_number",line1Value:r,line2Value:s,severity:"error"}}:/^\d+$/.test(r)?{isValid:!0,error:null}:{isValid:!1,error:{code:exports.ERROR_CODES.INVALID_SATELLITE_NUMBER,message:`Satellite number must be numeric (got '${r}')`,field:"satellite_number",value:r,severity:"error"}}}function u(e){const t=e[7],r=["U","C","S"];return r.includes(t||"")?{isValid:!0,error:null}:{isValid:!1,error:{code:exports.ERROR_CODES.INVALID_CLASSIFICATION,message:`Classification must be U, C, or S (got '${t}')`,field:"classification",expected:r,actual:t,severity:"error"}}}function O(e,t,r,s){const i=parseFloat(e);return isNaN(i)?{isValid:!1,error:{code:exports.ERROR_CODES.INVALID_NUMBER_FORMAT,message:`${t} must be numeric (got '${e}')`,field:t,value:e,severity:"error"}}:i<r||i>s?{isValid:!1,error:{code:exports.ERROR_CODES.VALUE_OUT_OF_RANGE,message:`${t} must be between ${r} and ${s} (got ${i})`,field:t,value:i,min:r,max:s,severity:"error"}}:{isValid:!0,error:null}}function h(e){const t=[],r=e[7];return"C"!==r&&"S"!==r||t.push({code:exports.ERROR_CODES.CLASSIFIED_DATA_WARNING,message:`Classification '${r}' is unusual in public TLE data (typically 'U' for unclassified)`,field:"classification",value:r,severity:"warning"}),t}function d(e){const t=[],r=parseInt(e.substring(18,20),10),s=parseFloat(e.substring(20,32));if(isNaN(r)||isNaN(s))return t;const i=r>=57?1900+r:2e3+r;i<2e3&&t.push({code:exports.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING,message:`Epoch year ${i} is in the deprecated 1900s range (two-digit year: ${r})`,field:"epochYear",value:r,fullYear:i,severity:"warning"});const n=new Date(i,0,1);n.setDate(n.getDate()+s-1);const a=((new Date).getTime()-n.getTime())/864e5;return a>30&&t.push({code:exports.ERROR_CODES.STALE_TLE_WARNING,message:`TLE epoch is ${Math.floor(a)} days old (epoch: ${n.toISOString().split("T")[0]}). TLE data may be stale.`,field:"epoch",daysSinceEpoch:Math.floor(a),epochDate:n.toISOString().split("T")[0],severity:"warning"}),t}function m(e){const t=[],r=parseFloat("0."+e.substring(26,33).trim());!isNaN(r)&&r>.25&&t.push({code:exports.ERROR_CODES.HIGH_ECCENTRICITY_WARNING,message:`Eccentricity ${r.toFixed(7)} is unusually high. This indicates a highly elliptical orbit.`,field:"eccentricity",value:r,severity:"warning"});const s=parseFloat(e.substring(52,63).trim());!isNaN(s)&&s<1&&t.push({code:exports.ERROR_CODES.LOW_MEAN_MOTION_WARNING,message:`Mean motion ${s.toFixed(8)} rev/day is unusually low. This indicates a very high orbit.`,field:"meanMotion",value:s,severity:"warning"});const i=parseInt(e.substring(63,68).trim(),10);return!isNaN(i)&&i>9e4&&t.push({code:exports.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING,message:`Revolution number ${i} is approaching rollover limit (99999). Counter may reset soon.`,field:"revolutionNumber",value:i,severity:"warning"}),t}function L(e){const t=[],r=e.substring(53,61).trim();"00000-0"!==r&&"00000+0"!==r&&"00000 0"!==r||t.push({code:exports.ERROR_CODES.NEAR_ZERO_DRAG_WARNING,message:"B* drag term is zero or near-zero, which is unusual for most satellites in LEO",field:"bStar",value:r,severity:"warning"});const s=parseFloat(e.substring(33,43).trim());!isNaN(s)&&s<0&&t.push({code:exports.ERROR_CODES.NEGATIVE_DECAY_WARNING,message:`First derivative of mean motion is negative (${s}), indicating orbital decay`,field:"firstDerivative",value:s,severity:"warning"});const i=e.substring(62,63).trim();return"0"!==i&&""!==i&&t.push({code:exports.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING,message:`Ephemeris type '${i}' is non-standard (expected '0' for SGP4/SDP4)`,field:"ephemerisType",value:i,severity:"warning"}),t}function S(e,t={}){if("string"!=typeof e)throw new TypeError("TLE data must be a string");if("object"!=typeof t||null===t||Array.isArray(t))throw new TypeError("Options must be an object");if(0===e.length)throw new l("TLE string cannot be empty",exports.ERROR_CODES.EMPTY_INPUT,{inputLength:0});const{strictChecksums:r=!0,validateRanges:s=!0,mode:i="strict"}=t;if("strict"!==i&&"permissive"!==i)throw new TypeError('Mode must be either "strict" or "permissive"');const n=[],a=[],o=I(e).trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0&&!e.startsWith("#"));if(o.length<2)return n.push({code:exports.ERROR_CODES.INVALID_LINE_COUNT,message:"TLE must contain at least 2 lines",field:"line_count",expected:"2 or 3",actual:o.length,severity:"error"}),{isValid:!1,errors:n,warnings:a};if(o.length>3)return n.push({code:exports.ERROR_CODES.INVALID_LINE_COUNT,message:`TLE must contain 2 or 3 lines (got ${o.length})`,field:"line_count",expected:"2 or 3",actual:o.length,severity:"error"}),{isValid:!1,errors:n,warnings:a};let E=0,R=1;if(3===o.length){E=1,R=2;const e=o[0];!e||"1"!==e[0]&&"2"!==e[0]||a.push({code:exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING,message:'Line 0 starts with "1" or "2", might be incorrectly formatted',field:"satellite_name",value:e,severity:"warning"}),e&&e.length>24&&a.push({code:exports.ERROR_CODES.SATELLITE_NAME_TOO_LONG,message:"Satellite name (Line 0) should be 24 characters or less",field:"satellite_name",expected:24,actual:e.length,severity:"warning"})}const c=o[E],N=o[R];if(!c||!N)return n.push({code:exports.ERROR_CODES.INVALID_LINE_COUNT,message:"Missing required TLE lines",severity:"error"}),{isValid:!1,errors:n,warnings:a};const _=A(c,1);if(!_.isValid)if("permissive"===i){const e=_.errors.filter(e=>e.code!==exports.ERROR_CODES.CHECKSUM_MISMATCH&&e.code!==exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER),t=_.errors.filter(e=>e.code===exports.ERROR_CODES.CHECKSUM_MISMATCH||e.code===exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER);if(n.push(...e),a.push(...t.map(e=>({...e,severity:"warning"}))),e.length>0)return{isValid:!1,errors:n,warnings:a}}else if(n.push(..._.errors),r)return{isValid:!1,errors:n,warnings:a};const S=A(N,2);if(!S.isValid)if("permissive"===i){const e=S.errors.filter(e=>e.code!==exports.ERROR_CODES.CHECKSUM_MISMATCH&&e.code!==exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER),t=S.errors.filter(e=>e.code===exports.ERROR_CODES.CHECKSUM_MISMATCH||e.code===exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER);if(n.push(...e),a.push(...t.map(e=>({...e,severity:"warning"}))),e.length>0)return{isValid:!1,errors:n,warnings:a}}else if(n.push(...S.errors),r)return{isValid:!1,errors:n,warnings:a};const T=p(c,N);!T.isValid&&T.error&&("permissive"===i?a.push({...T.error,severity:"warning"}):n.push(T.error));const C=u(c);if(!C.isValid&&C.error&&("permissive"===i?a.push({...C.error,severity:"warning"}):n.push(C.error)),s&&69===c.length&&69===N.length){const e=[{value:c.substring(2,7).trim(),name:"Satellite Number",min:1,max:99999},{value:c.substring(9,11).trim(),name:"International Designator Year",min:0,max:99,optional:!0},{value:c.substring(11,14).trim(),name:"International Designator Launch Number",min:1,max:999,optional:!0},{value:c.substring(62,63).trim(),name:"Ephemeris Type",min:0,max:9,optional:!0},{value:c.substring(64,68).trim(),name:"Element Set Number",min:0,max:9999,optional:!0},{value:c.substring(18,20).trim(),name:"Epoch Year",min:0,max:99},{value:c.substring(20,32).trim(),name:"Epoch Day",min:1,max:366.99999999},{value:N.substring(8,16).trim(),name:"Inclination",min:0,max:180},{value:N.substring(17,25).trim(),name:"Right Ascension",min:0,max:360},{value:"0."+N.substring(26,33).trim(),name:"Eccentricity",min:0,max:1},{value:N.substring(34,42).trim(),name:"Argument of Perigee",min:0,max:360},{value:N.substring(43,51).trim(),name:"Mean Anomaly",min:0,max:360},{value:N.substring(52,63).trim(),name:"Mean Motion",min:0,max:20,warningOnly:!0},{value:N.substring(63,68).trim(),name:"Revolution Number",min:0,max:99999,optional:!0}];for(const{value:t,name:r,min:s,max:o,optional:E,warningOnly:R}of e){if(E&&0===t.length)continue;const e=O(t,r,s,o);!e.isValid&&e.error&&(R||"permissive"===i?a.push({...e.error,severity:"warning"}):n.push(e.error))}}return 69===c.length&&(a.push(...h(c)),a.push(...d(c)),a.push(...L(c))),69===N.length&&a.push(...m(N)),{isValid:0===n.length,errors:n,warnings:a}}function T(e,t={}){if("string"!=typeof e)throw new TypeError("TLE data must be a string");if("object"!=typeof t||null===t||Array.isArray(t))throw new TypeError("Options must be an object");const{validate:r=!0,strictChecksums:s=!0,validateRanges:i=!0,includeWarnings:n=!0,includeComments:a=!0,mode:o="strict"}=t;let c=[];if(r){const t=S(e,{strictChecksums:s,validateRanges:i,mode:o});if(!t.isValid){const e="TLE validation failed:\n"+t.errors.map(e=>"string"==typeof e?e:e.message).join("\n");throw new R(e,t.errors,t.warnings)}c=t.warnings}const N=I(e).trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0),_=N.filter(e=>e.startsWith("#")),A=N.filter(e=>!e.startsWith("#"));let p=0,u=1,O=null;3===A.length&&(O=A[0]||null,p=1,u=2);const h=A[p],d=A[u];if(!h||!d)throw new l("Missing required TLE lines",exports.ERROR_CODES.INVALID_LINE_COUNT);const m={satelliteName:O},L=["lineNumber2","satelliteNumber2","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion","revolutionNumber","checksum2"];for(const[e,t]of Object.entries(E)){const[r,s]=t,i=L.includes(e)?d:h;m[e]=i.substring(r,s).trim()}return n&&c.length>0&&(m.warnings=c),a&&_.length>0&&(m.comments=_),m}var C={parseTLE:T,validateTLE:S,calculateChecksum:N,validateChecksum:_,validateLineStructure:A,validateSatelliteNumber:p,validateClassification:u,validateNumericRange:O,checkClassificationWarnings:h,checkEpochWarnings:d,checkOrbitalParameterWarnings:m,checkDragAndEphemerisWarnings:L,normalizeLineEndings:I,parseTLELines:c,TLEValidationError:R,TLEFormatError:l,ERROR_CODES:exports.ERROR_CODES};exports.TLEFormatError=l,exports.TLEStateMachineParser=o,exports.TLEValidationError=R,exports.calculateChecksum=N,exports.checkClassificationWarnings=h,exports.checkDragAndEphemerisWarnings=L,exports.checkEpochWarnings=d,exports.checkOrbitalParameterWarnings=m,exports.default=C,exports.getErrorDescription=function(e){return{[exports.ERROR_CODES.INVALID_INPUT_TYPE]:"Input data must be a string",[exports.ERROR_CODES.EMPTY_INPUT]:"Input string is empty or contains only whitespace",[exports.ERROR_CODES.INVALID_LINE_COUNT]:"TLE must contain exactly 2 or 3 lines",[exports.ERROR_CODES.INVALID_LINE_LENGTH]:"TLE line must be exactly 69 characters",[exports.ERROR_CODES.INVALID_LINE_NUMBER]:"Line number must be 1 or 2",[exports.ERROR_CODES.CHECKSUM_MISMATCH]:"Calculated checksum does not match",[exports.ERROR_CODES.INVALID_CHECKSUM_CHARACTER]:"Checksum must be a digit 0-9",[exports.ERROR_CODES.SATELLITE_NUMBER_MISMATCH]:"Satellite numbers on line 1 and line 2 must match",[exports.ERROR_CODES.INVALID_SATELLITE_NUMBER]:"Satellite catalog number is invalid",[exports.ERROR_CODES.INVALID_CLASSIFICATION]:"Classification must be U, C, or S",[exports.ERROR_CODES.VALUE_OUT_OF_RANGE]:"Field value is outside valid range",[exports.ERROR_CODES.INVALID_NUMBER_FORMAT]:"Field contains invalid numeric format",[exports.ERROR_CODES.SATELLITE_NAME_TOO_LONG]:"Satellite name exceeds maximum length",[exports.ERROR_CODES.SATELLITE_NAME_FORMAT_WARNING]:"Satellite name contains unusual characters",[exports.ERROR_CODES.CLASSIFIED_DATA_WARNING]:"TLE contains classified satellite data",[exports.ERROR_CODES.STALE_TLE_WARNING]:"TLE epoch is significantly old",[exports.ERROR_CODES.HIGH_ECCENTRICITY_WARNING]:"Eccentricity is unusually high",[exports.ERROR_CODES.LOW_MEAN_MOTION_WARNING]:"Mean motion is unusually low",[exports.ERROR_CODES.DEPRECATED_EPOCH_YEAR_WARNING]:"Epoch year is in the far past",[exports.ERROR_CODES.REVOLUTION_NUMBER_ROLLOVER_WARNING]:"Revolution number may have rolled over",[exports.ERROR_CODES.NEAR_ZERO_DRAG_WARNING]:"Drag coefficient is near zero",[exports.ERROR_CODES.NON_STANDARD_EPHEMERIS_WARNING]:"Ephemeris type is non-standard",[exports.ERROR_CODES.NEGATIVE_DECAY_WARNING]:"Mean motion decay is negative"}[e]||"Unknown error code"},exports.isCriticalError=function(e){return!t(e)},exports.isParseFailure=function(e){return!1===e.success},exports.isParseSuccess=function(e){return!0===e.success},exports.isParsedTLE=function(e){return"object"==typeof e&&null!==e&&["lineNumber1","satelliteNumber1","classification","lineNumber2","satelliteNumber2","inclination","rightAscension","eccentricity","argumentOfPerigee","meanAnomaly","meanMotion"].every(t=>t in e)},exports.isTLEError=a,exports.isTLEWarning=function(e){return a(e)&&"warning"===e.severity},exports.isValidClassification=function(e){return"U"===e||"C"===e||"S"===e},exports.isValidErrorCode=function(e){return Object.values(exports.ERROR_CODES).includes(e)},exports.isValidationFailure=function(e){return!1===e.success},exports.isValidationSuccess=function(e){return!0===e.success},exports.isWarningCode=t,exports.normalizeLineEndings=I,exports.parseTLE=T,exports.parseTLELines=c,exports.parseWithStateMachine=function(e,t={}){return new o(t).parse(e)},exports.validateChecksum=_,exports.validateClassification=u,exports.validateLineStructure=A,exports.validateNumericRange=O,exports.validateSatelliteNumber=p,exports.validateTLE=S;
//# sourceMappingURL=index.min.cjs.map
