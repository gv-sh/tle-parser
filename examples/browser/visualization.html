<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TLE Parser - Orbit Visualization</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #1a1a2e;
      color: white;
      min-height: 100vh;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      text-align: center;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .subtitle {
      opacity: 0.9;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .controls {
      background: #16213e;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .control-group {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 15px;
    }

    label {
      font-weight: 500;
    }

    input[type="text"], textarea {
      flex: 1;
      min-width: 200px;
      padding: 10px;
      border: 2px solid #667eea;
      border-radius: 6px;
      background: #0f3460;
      color: white;
      font-family: monospace;
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    .btn {
      padding: 10px 24px;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .canvas-container {
      background: #16213e;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    canvas {
      width: 100%;
      height: 500px;
      background: radial-gradient(circle at center, #0f3460 0%, #0a1929 100%);
      border-radius: 8px;
    }

    .info-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .info-card {
      background: #16213e;
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }

    .info-title {
      font-size: 1.2rem;
      margin-bottom: 15px;
      color: #667eea;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #0f3460;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-label {
      color: #aaa;
    }

    .info-value {
      font-weight: 500;
      font-family: monospace;
    }

    .samples {
      background: #16213e;
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
    }

    .sample-btn {
      background: #0f3460;
      color: white;
      border: 1px solid #667eea;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
      transition: all 0.3s ease;
    }

    .sample-btn:hover {
      background: #667eea;
    }

    .legend {
      display: flex;
      gap: 20px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üõ∞Ô∏è TLE Orbit Visualization</h1>
    <div class="subtitle">Interactive 2D orbit visualization from TLE data</div>
  </div>

  <div class="container">
    <div class="controls">
      <div class="control-group">
        <label>TLE Data:</label>
        <textarea id="tleInput" placeholder="Paste TLE data here (2 or 3 line format)..."></textarea>
        <button class="btn btn-primary" onclick="parseTLE()">Parse & Visualize</button>
      </div>

      <div class="samples">
        <strong>Quick Samples:</strong><br><br>
        <button class="sample-btn" onclick="loadSample('ISS')">ISS</button>
        <button class="sample-btn" onclick="loadSample('HUBBLE')">Hubble</button>
        <button class="sample-btn" onclick="loadSample('GPS')">GPS Satellite</button>
        <button class="sample-btn" onclick="loadSample('GEO')">GEO Satellite</button>
      </div>
    </div>

    <div class="canvas-container">
      <canvas id="orbitCanvas"></canvas>
      <div class="legend">
        <div class="legend-item">
          <div class="legend-color" style="background: #4CAF50;"></div>
          <span>Earth</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #2196F3;"></div>
          <span>Orbit Path</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #FF5722;"></div>
          <span>Satellite</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #FFC107;"></div>
          <span>Apogee</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #9C27B0;"></div>
          <span>Perigee</span>
        </div>
      </div>
    </div>

    <div class="info-panel" id="infoPanel" style="display: none;">
      <div class="info-card">
        <div class="info-title">Satellite Information</div>
        <div class="info-row">
          <span class="info-label">Name:</span>
          <span class="info-value" id="satName">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">NORAD ID:</span>
          <span class="info-value" id="satNumber">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Classification:</span>
          <span class="info-value" id="satClass">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Int'l Designator:</span>
          <span class="info-value" id="satIntl">-</span>
        </div>
      </div>

      <div class="info-card">
        <div class="info-title">Orbital Elements</div>
        <div class="info-row">
          <span class="info-label">Inclination:</span>
          <span class="info-value" id="inclination">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Eccentricity:</span>
          <span class="info-value" id="eccentricity">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">RAAN:</span>
          <span class="info-value" id="raan">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Arg of Perigee:</span>
          <span class="info-value" id="argOfPerigee">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Mean Anomaly:</span>
          <span class="info-value" id="meanAnomaly">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Mean Motion:</span>
          <span class="info-value" id="meanMotion">-</span>
        </div>
      </div>

      <div class="info-card">
        <div class="info-title">Calculated Parameters</div>
        <div class="info-row">
          <span class="info-label">Semi-major Axis:</span>
          <span class="info-value" id="semiMajorAxis">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Apogee:</span>
          <span class="info-value" id="apogee">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Perigee:</span>
          <span class="info-value" id="perigee">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Period:</span>
          <span class="info-value" id="period">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Orbit Type:</span>
          <span class="info-value" id="orbitType">-</span>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { parseTLE } from '../../dist/index.browser.min.js';

    const canvas = document.getElementById('orbitCanvas');
    const ctx = canvas.getContext('2d');

    // Sample TLEs
    const samples = {
      ISS: `ISS (ZARYA)
1 25544U 98067A   24001.00000000  .00016717  00000-0  10270-3 0  9005
2 25544  51.6400 208.9163 0006317  69.9862  25.2906 15.50030060000000`,
      HUBBLE: `HST
1 20580U 90037B   24001.00000000  .00000000  00000-0  00000-0 0  9990
2 20580  28.4699 241.9285 0002900 104.6716 343.2590 15.09672029000000`,
      GPS: `GPS BIIA-10 (PRN 32)
1 20959U 90103A   24001.00000000 -.00000028  00000-0  00000-0 0  9994
2 20959  54.9873 187.0046 0114051 146.4550 214.3498  2.00564756000000`,
      GEO: `GOES 16
1 41866U 16071A   24001.00000000 -.00000269  00000-0  00000-0 0  9993
2 41866   0.0176  50.4422 0000611 215.2821 353.2105  1.00270803000000`
    };

    window.loadSample = function(type) {
      document.getElementById('tleInput').value = samples[type];
      parseTLE();
    };

    window.parseTLE = function() {
      const tleText = document.getElementById('tleInput').value.trim();
      if (!tleText) {
        alert('Please enter TLE data');
        return;
      }

      try {
        const tle = parseTLE(tleText);
        displayInfo(tle);
        drawOrbit(tle);
      } catch (error) {
        alert('Error parsing TLE: ' + error.message);
      }
    };

    function displayInfo(tle) {
      document.getElementById('infoPanel').style.display = 'grid';

      // Satellite info
      document.getElementById('satName').textContent = tle.name || 'Unknown';
      document.getElementById('satNumber').textContent = tle.satelliteNumber;
      document.getElementById('satClass').textContent = tle.classification;
      document.getElementById('satIntl').textContent = tle.internationalDesignator;

      // Orbital elements
      document.getElementById('inclination').textContent = tle.inclination.toFixed(4) + '¬∞';
      document.getElementById('eccentricity').textContent = tle.eccentricity.toFixed(7);
      document.getElementById('raan').textContent = tle.rightAscensionOfAscendingNode.toFixed(4) + '¬∞';
      document.getElementById('argOfPerigee').textContent = tle.argumentOfPerigee.toFixed(4) + '¬∞';
      document.getElementById('meanAnomaly').textContent = tle.meanAnomaly.toFixed(4) + '¬∞';
      document.getElementById('meanMotion').textContent = tle.meanMotion.toFixed(8) + ' rev/day';

      // Calculate derived parameters
      const EARTH_RADIUS = 6371; // km
      const MU = 398600.4418; // km^3/s^2

      const n = tle.meanMotion * (2 * Math.PI / 86400); // rad/s
      const a = Math.cbrt(MU / (n * n)); // semi-major axis in km
      const perigee = a * (1 - tle.eccentricity) - EARTH_RADIUS;
      const apogee = a * (1 + tle.eccentricity) - EARTH_RADIUS;
      const period = (2 * Math.PI / n) / 60; // minutes

      document.getElementById('semiMajorAxis').textContent = a.toFixed(2) + ' km';
      document.getElementById('apogee').textContent = apogee.toFixed(2) + ' km';
      document.getElementById('perigee').textContent = perigee.toFixed(2) + ' km';
      document.getElementById('period').textContent = period.toFixed(2) + ' min';

      // Classify orbit
      let orbitType = 'Unknown';
      if (apogee < 2000) orbitType = 'LEO (Low Earth Orbit)';
      else if (apogee < 35786) orbitType = 'MEO (Medium Earth Orbit)';
      else if (Math.abs(a - 42164) < 100) orbitType = 'GEO (Geostationary)';
      else orbitType = 'HEO (High Earth Orbit)';

      document.getElementById('orbitType').textContent = orbitType;
    }

    function drawOrbit(tle) {
      // Set canvas size
      canvas.width = canvas.offsetWidth * 2;
      canvas.height = canvas.offsetHeight * 2;
      ctx.scale(2, 2);

      const width = canvas.width / 2;
      const height = canvas.height / 2;
      const centerX = width / 2;
      const centerY = height / 2;

      // Clear canvas
      ctx.clearRect(0, 0, width, height);

      // Calculate orbit parameters
      const EARTH_RADIUS = 6371; // km
      const MU = 398600.4418; // km^3/s^2

      const n = tle.meanMotion * (2 * Math.PI / 86400);
      const a = Math.cbrt(MU / (n * n));
      const e = tle.eccentricity;
      const w = tle.argumentOfPerigee * Math.PI / 180;

      // Scale for drawing (fit to canvas)
      const scale = Math.min(width, height) * 0.4 / (a * (1 + e));

      // Draw Earth
      const earthRadius = EARTH_RADIUS * scale;
      ctx.fillStyle = '#4CAF50';
      ctx.beginPath();
      ctx.arc(centerX, centerY, earthRadius, 0, 2 * Math.PI);
      ctx.fill();

      ctx.strokeStyle = '#81C784';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Draw orbit
      ctx.strokeStyle = '#2196F3';
      ctx.lineWidth = 2;
      ctx.beginPath();

      for (let theta = 0; theta <= 2 * Math.PI; theta += 0.01) {
        const r = a * (1 - e * e) / (1 + e * Math.cos(theta));
        const x = r * Math.cos(theta + w) * scale;
        const y = r * Math.sin(theta + w) * scale;

        if (theta === 0) {
          ctx.moveTo(centerX + x, centerY - y);
        } else {
          ctx.lineTo(centerX + x, centerY - y);
        }
      }
      ctx.closePath();
      ctx.stroke();

      // Draw satellite position (at mean anomaly)
      const M = tle.meanAnomaly * Math.PI / 180;
      let E = M;
      for (let i = 0; i < 10; i++) {
        E = M + e * Math.sin(E);
      }
      const theta = 2 * Math.atan2(Math.sqrt(1 + e) * Math.sin(E / 2), Math.sqrt(1 - e) * Math.cos(E / 2));
      const r = a * (1 - e * e) / (1 + e * Math.cos(theta));
      const satX = r * Math.cos(theta + w) * scale;
      const satY = r * Math.sin(theta + w) * scale;

      ctx.fillStyle = '#FF5722';
      ctx.beginPath();
      ctx.arc(centerX + satX, centerY - satY, 5, 0, 2 * Math.PI);
      ctx.fill();

      // Draw apogee and perigee
      const rPeri = a * (1 - e);
      const rApo = a * (1 + e);

      ctx.fillStyle = '#9C27B0';
      ctx.beginPath();
      ctx.arc(centerX + rPeri * Math.cos(w) * scale, centerY - rPeri * Math.sin(w) * scale, 4, 0, 2 * Math.PI);
      ctx.fill();

      ctx.fillStyle = '#FFC107';
      ctx.beginPath();
      ctx.arc(centerX - rApo * Math.cos(w) * scale, centerY + rApo * Math.sin(w) * scale, 4, 0, 2 * Math.PI);
      ctx.fill();
    }
  </script>
</body>
</html>
